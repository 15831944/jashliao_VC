<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<!-- saved from url=(0052)http://tech.163.com/06/0428/09/2FPMSA1L00091LRC.html -->
<HTML xmlns="http://www.w3.org/1999/xhtml"><HEAD><TITLE>在VC中调用 WebService・网易学院・教程</TITLE>
<META http-equiv=Content-Type content="text/html; charset=gb2312">
<META http-equiv=Content-Language content=zh-CN>
<META http-equiv=expires content=0>
<META content=vc,vc name=keywords>
<META content="在VC中调用 WebService,vc" name=description>
<META content="index, follow" name=robots>
<META content="index, follow" name=googlebot><LINK 
href="在VC中调用 WebService・网易学院・教程.files/style.css" type=text/css 
rel=stylesheet><LINK href="在VC中调用 WebService・网易学院・教程.files/arcnoad.css" 
type=text/css rel=stylesheet>
<META content="MSHTML 6.00.2900.3314" name=GENERATOR></HEAD>
<BODY>
<H1 class=hidden>网易学院</H1><!-- 顶部通栏广告 -->
<DIV class=adTop><!--顶部通栏-->
<TABLE cellSpacing=0 cellPadding=0 width=750 align=center border=0>
  <TBODY>
  <TR>
    <TD><IFRAME border=0 marginWidth=0 marginHeight=0 
      src="在VC中调用 WebService・网易学院・教程.files/site=netease&amp;affiliate=tech&amp;cat=article&amp;type=column&amp;location=1.htm" 
      frameBorder=no width=750 scrolling=no height=70></IFRAME></TD></TR>
  <TR>
    <TD height=3></TD></TR></TBODY></TABLE></DIV><!-- 导航 -->
<DIV class=arcNav>
<DIV class=logo><A href="http://www.163.com/"><IMG height=46 alt=网易 
src="在VC中调用 WebService・网易学院・教程.files/neteaselogo.gif" width=114 border=0></A> 
</DIV>
<DIV class=text>
<DIV class=title><A href="http://www.163.com/">网易</A> &gt; <A 
href="http://tech.163.com/">科技频道</A> &gt; <A 
href="http://tech.163.com/school/">网易学院</A> &gt; <A 
href="http://tech.163.com/special/d/0009159F/developer.html">编程开发</A></DIV>
<FORM name=form1 action=http://news.so.163.com/newsSearch.jsp method=post 
target=_blank>
<DIV class=search>
<DIV class=s2>教程检索：</DIV>
<DIV class=s3><INPUT name=q></DIV>
<DIV class=s4><INPUT style="CURSOR: hand" onfocus=if(this.blur)this.blur() type=submit value="搜 索" name=Submit> 
</DIV>
<DIV class=s5><A href="http://tech.163.com/special/r/0009rt/rss.html"><IMG 
height=14 alt=rss src="在VC中调用 WebService・网易学院・教程.files/rss.gif" width=26 
border=0></A></DIV></DIV></FORM></DIV>
<DIV class=menu>
<UL>
  <LI><A href="http://tech.163.com/"><STRONG>产业</STRONG></A> <A 
  href="http://tech.163.com/it">IT</A> <A 
  href="http://tech.163.com/internet">互联网</A> <A 
  href="http://tech.163.com/telecom">通信</A> <A 
  href="http://tech.163.com/salon/">沙龙</A> <A 
  href="http://tech.163.com/photo/">读图</A> <A 
  href="http://vote.tech.163.com/vote/tech.html">调查</A> <A 
  href="http://tech.163.com/special/00091MCB/shengyin.html">声音</A> | <A 
  href="http://tech.163.com/school/"><STRONG>学院</STRONG></A> <A 
  href="http://tech.163.com/school/video/"></A><A 
  href="http://tech.163.com/school/video/">视频</A> <A 
  href="http://tech.163.com/school/photo/">图酷</A> <A 
  href="http://tech.163.com/cg/">数字艺术</A> <A 
  href="http://tech.163.com/school/special/">专题</A> <A 
  href="http://tech.163.com/special/00091A1E/schoolweek.html">周刊</A> | <A 
  href="http://tech.163.com/trend/"><STRONG>趋势</STRONG></A> <A 
  href="http://tech.163.com/special/000926OF/trendpic.html">产品库</A> <A 
  href="http://tech.163.com/trendvideo/">高科技视频</A> <A 
  href="http://tech.163.com/special/00091JUD/qianyan.html">前沿科技</A> 
</LI></UL></DIV></DIV><!-- end  -->
<DIV class=clear></DIV>
<DIV class=blank6></DIV><!-- arc -->
<DIV class=areanoad><!-- left -->
<DIV class=col1>
<DIV class=lineBlue></DIV><!--  ad550 -->
<DIV class=ad550>
<CENTER><IFRAME border=0 marginWidth=0 marginHeight=0 
src="在VC中调用 WebService・网易学院・教程.files/site=netease&amp;affiliate=tech&amp;cat=article&amp;type=columnarticle&amp;location=1.htm" 
frameBorder=no width=550 scrolling=no height=150>
</IFRAME></CENTER></DIV><!-- title -->
<DIV class=arcTitle>
<H1>在VC中调用 WebService</H1>
<DIV class=text><A class=url 
href="http://tech.163.com/">http://tech.163.com/</A>　2006-04-28 09:41:00　来源: <A 
href="http://tech.163.com/06/0428/09/2FPMSA1L00091LRC.html#" 
target=_blank>VC知识库</A>　　<A class=cDRed 
href="http://tech.163.com/06/0428/09/2FPMSA1L00091LRC.html#0" 
target=_self>网友评论<SPAN class=cDRed id=replycounttop>0</SPAN>&nbsp;条</A> <A 
href="http://bbs.tech.163.com/">论坛</A></DIV>
<DIV class=clear>　</DIV></DIV><!-- main -->
<DIV id=main>
<DIV id=text>
<P style="TEXT-INDENT: 2em"><STRONG>一、什么是 WebService ？</STRONG></P>
<P style="TEXT-INDENT: 2em">WebService 
其实就是一个基于网络的应用程序,它向外部程序提供一定的调用接口。外部（远程）的程序，可以经由Web对其进行调用。 </P>
<P style="TEXT-INDENT: 2em"><STRONG>二、 WebService 的特性：</STRONG></P>
<P style="TEXT-INDENT: 2em">1.由于 WebService 经由web服务器发布，所以比DCOM而言，可以顺利穿过防火墙。这也是 
WebService 的优点之一，可以说， WebService ,为分布 式应用的开发，提供了一个很好的平台。</P>
<P style="TEXT-INDENT: 2em">2.对 WebService 
的调用，是通过SOAP协议进行的。简单对象访问协议(SOAP)提供了标准的远程过程调用(RPC)方法来调用Web service。 
而SOAP也是基于XML和XSD的，XML是SOAP的数据编码方式,因此，对 WebService 的调用也可以是跨平台的。、 </P>
<P style="TEXT-INDENT: 2em"><STRONG>三、怎样调用 WebService ?</STRONG></P>
<P style="TEXT-INDENT: 2em">Visual Studio.NET 内建提供了对 WebService 的调用。在VC.NET中，调用 
WebService 只需要简单的几个步骤即可。只要找到 WebService 的发布 地址，将地址引入到VC工程中。这时，编译器会预先编译一次，自动生成和 
WebService 相关的头文件（也可以叫Web代理文件） WebService .h。 在你的程序中，包含 WebService 
.h然后生成相关的对象，就可以对远程的 WebService 进行调用了。</P>
<P style="TEXT-INDENT: 2em">为演示怎样调用 WebService ，我们用网上一个已经发布的 WebService 
，名字叫TranslateService，其功能是对多种语言进行互相翻译。 这个 WebService 的地址如下： 
http://www.WebServicex.net/TranslateService.asmx </P>
<P style="TEXT-INDENT: 2em"><STRONG>四、程序示例</STRONG></P>
<P style="TEXT-INDENT: 2em">1.基于控制台的托管程序示例</P>
<P style="TEXT-INDENT: 2em">下面，我们先介绍VC.net中，基于控制台的托管程序，调用 WebService 的例子：</P>
<P style="TEXT-INDENT: 2em">启动Visual Studio.NET 2003，新建一个Visual 
C++项目，类型选择为基于.NET的托管控制台应用。然后，引入 WebService 到工程，在解决方案 
的项目名称上，单击右键，选择“添加Web引用”。如下图（图1）： </P>
<P style="TEXT-INDENT: 2em">
<CENTER><IMG 
src="在VC中调用 WebService・网易学院・教程.files/B50894CC6C97486F505336AA973F1A5C.jpg" 
border=0></CENTER>
<P></P>
<P style="TEXT-INDENT: 2em" align=center>图1 添加 WebService 引用到工程中 </P>
<P style="TEXT-INDENT: 2em">填入 WebService 的地址，然后点击”转到”按钮。 WebService 
的相关细节，会被显示在下面。Web引用名，可以采用默认的名字，也可以自己设置 
一个，在这里，我们起名叫TService。然后点击“添加引用”（图2），编译器自动生成TService.h以及 WebService .h。在 
WebService .h里面已经包含了 TService.h。在工程的代码中，我们直接包含头文件 WebService .h即可。 </P>
<P style="TEXT-INDENT: 2em">
<CENTER><IMG 
src="在VC中调用 WebService・网易学院・教程.files/502A179FDA4F7087074A33F1B855D74F.jpg" 
border=0></CENTER>
<P></P>
<P style="TEXT-INDENT: 2em" align=center>图2 添加 WebService </P>
<P 
style="TEXT-INDENT: 2em">TService.h是由编译器自动生成的，打开文件，我们可以看到，在命名空间TService中，编译器为我们自动封装了一个叫TranslateService的托管 
类，以及一个名字叫Language的枚举类型。</P>
<P style="TEXT-INDENT: 2em">Language类型在这个 WebService 中，用来描述翻译语言的类型，比如：</P>
<P style="TEXT-INDENT: 2em">EnglishTOChinese（英语到中文）</P>
<P style="TEXT-INDENT: 2em">ChineseTOEnglish（中文到英语）</P>
<P style="TEXT-INDENT: 2em">EnglishTOGerman （英语到德语）</P>
<P style="TEXT-INDENT: 2em">EnglishTOFrench （英语到法语）</P>
<P style="TEXT-INDENT: 2em">等等……</P>
<P style="TEXT-INDENT: 2em">在测试程序中，我们选择英语到中文的形式。<BR>#include "stdafx.h"#include 
" WebService .h"//包含 WebService .h头文件到程序中#using <MSCORLIB.DLL>using namespace 
System;<BR>using namespace TService;<BR>//使用TService的命名空间int _tmain(){ String 
*str=new String(S"Hello,world!"); <BR>String *strResult; <BR>TranslateService 
*pService=new TranslateService; <BR>//建立远程 WebService 对象 Language 
Lan=Language::EnglishTOChinese; <BR>//设置翻译类型 
strResult=pService-&gt;Translate(Lan,str);<BR>//调用 WebService 
Console::WriteLine(str);<BR>Console::WriteLine(strResult);<BR>//输出结果 return 
0;}</P>
<P style="TEXT-INDENT: 2em">程序结果如下：(图3） </P>
<P style="TEXT-INDENT: 2em">
<CENTER><IMG 
src="在VC中调用 WebService・网易学院・教程.files/2EC81BA898383977E649CA8EDB40305E.jpg" 
border=0></CENTER>
<P></P>
<P style="TEXT-INDENT: 2em" align=center>2.基于MFC的程序示例</P>
<P style="TEXT-INDENT: 2em">在MFC程序中，一样可以调用 WebService 
，我们可以建立一个简单的基于对话框的MFC程序，工程名字为TranslateMFC。由于需要使用托管类型，所以 
在编译器设置里面，需要打开/clr开关。(图4）选择项目―TranslateMFC属性，打开项目的属性页，在常规，下面的使用托管扩展选项，将其选择为“是”。 
这样，我们的项目就支持托管了C++扩展了。</P>
<P style="TEXT-INDENT: 2em">
<CENTER><IMG 
src="在VC中调用 WebService・网易学院・教程.files/10013C1AC356FD284604702829B2577E.jpg" 
border=0></CENTER>
<P></P>
<P style="TEXT-INDENT: 2em" align=center>图4 在工程属性打开clr开关</P>
<P style="TEXT-INDENT: 2em">和上一个例子的方法一样，引用 WebService 到工程，创建 WebService 对象，然后调用 
WebService 。不过在MFC中，我们如果直接用new来创建 WebService 对象的时候，编译器会报错（如下图）这是为什么呢？</P>
<P style="TEXT-INDENT: 2em">
<CENTER><IMG 
src="在VC中调用 WebService・网易学院・教程.files/0339838A4A3B718FE749085BF0DEA74B.jpg" 
border=0></CENTER>
<P></P>
<P style="TEXT-INDENT: 2em" align=center>图5 编译产生的C3828错误</P>
<P style="TEXT-INDENT: 2em">为了跟踪内存的使用情况，在 MFC 调试版本中使用时 MFC 重定义 new 
运算符。由于此重定义的缘故，会在 MFC 应用程序中创建托管类的实例，从而导致错误。在将现有 MFC 
代码移植到公共语言运行库时通常会发生这种情况。对于发布版本不会发生该错误，这是因为 MFC 不重定义 new 运算符。在以下示例中，放置在 .cpp 
文件中的托管代码创建 String 类的一个实例。这将导致在 MFC 
应用程序调试版本中进行编译时发生C3828编译器错误。若要避免该错误，可在创建托管类型实例前，使用#undef 和 push_macro指令暂时取消定义 new 
运算符。在最后一行托管代码的后面，使用pop_macro 还原先前的 new 运算符定义。示例代码如下：(图6)</P>
<P style="TEXT-INDENT: 2em">
<CENTER><IMG 
src="在VC中调用 WebService・网易学院・教程.files/8CF31727EE45EC000CE465129C4038BB.jpg" 
border=0></CENTER>
<P></P>
<P style="TEXT-INDENT: 2em">由于此 WebService 
支持30多中语言类型的转换，在这里，为示例简单，我只保留了几门语言的转换功能。其他的语言，只需要判断的时候，加入不同 Language枚举类型即可。</P>
<P style="TEXT-INDENT: 2em">下面是程序运行的结果演示：</P>
<P style="TEXT-INDENT: 2em">
<CENTER><IMG 
src="在VC中调用 WebService・网易学院・教程.files/98FEC427EAE26382BC7F8442D4454558.jpg" 
border=0></CENTER>
<P></P>
<P style="TEXT-INDENT: 2em" align=center>图7 MFC程序运行界面</P>
<P style="TEXT-INDENT: 2em">
<CENTER><IMG 
src="在VC中调用 WebService・网易学院・教程.files/37AC3380EA8F7F1A1BCD1C2A32616A10.jpg" 
border=0></CENTER>
<P></P>
<P style="TEXT-INDENT: 2em" align=center>图7 英文翻译为中文</P>
<P style="TEXT-INDENT: 2em">
<CENTER><IMG 
src="在VC中调用 WebService・网易学院・教程.files/248942F0A03350F5A8F114E3FFFA3058.jpg" 
border=0></CENTER>
<P></P>
<P style="TEXT-INDENT: 2em" align=center>图8 英文翻译为日文</P>
<P style="TEXT-INDENT: 2em">
<CENTER><IMG 
src="在VC中调用 WebService・网易学院・教程.files/70C2A2B62633192847AF300BC45FE039.jpg" 
border=0></CENTER>
<P></P>
<P style="TEXT-INDENT: 2em" align=center>图9 英文翻译为法文</P>
<P style="TEXT-INDENT: 2em"><STRONG>五、结束语 </STRONG></P>
<P style="TEXT-INDENT: 2em">通过以上的例子，我们看到了 WebService 为构建分布式应用，提供了强大的功能支持。</P>
<P style="TEXT-INDENT: 2em">更多的有关 WebService 
的问题，请访问http://www.microsoft.com/china/MSDN/library/ WebService s获取更多的信息 </P>
<P style="TEXT-INDENT: 2em">补充：该程序的运行，需要.NET FrameWork的支持。 <A 
href="http://tech.163.com/"><IMG height=12 alt=gigi_miao 
src="在VC中调用 WebService・网易学院・教程.files/arc_d.gif" width=12 border=0></A> 
</P></DIV><!-- page -->
<DIV class=page></DIV></DIV>
<DIV class=clear></DIV>
<DIV class=blank9></DIV><!-- 相关文章 -->
<DIV class=aboutArc>
<DIV class=title>
<H2>相关文章</H2></DIV>
<DIV class=clear></DIV>
<DIV class=content>
<UL>
  <LI><A 
  href="http://tech.163.com/06/0428/09/2FPMMJ1000091LRC.html">vc深入浅出理解索引结构</A> 
  <LI><A href="http://tech.163.com/06/0327/14/2D7RGLCQ00091SB8.html">3.16 习 
  题</A> 
  <LI><A href="http://tech.163.com/06/0327/14/2D7RCQIF00091SB8.html">3.15 
  本章小结</A> 
  <LI><A href="http://tech.163.com/06/0327/14/2D7RBIQT00091SB8.html">3.14 
  别针型指针(Pinned Pointer)</A> 
  <LI><A href="http://tech.163.com/06/0327/14/2D7RAGVD00091SB8.html">3.13 
  异常处理</A> </LI></UL></DIV></DIV>
<DIV class=clear></DIV>
<DIV class=blank9></DIV><!-- 热门评论 -->
<SCRIPT>
var thepostid = '2FPMSA1L00091LRC';
var theboard = 'tech_bbs';
var postid = '';
var board = 'tech_bbs';
var out_nickname;
var out_ip;
var out_board = 'tech_bbs';
var out_postid;
var out_ptime;
var out_body;
</SCRIPT>
<A name=0></A>
<DIV class=endReview2>
<DIV class=topReview2>
<DIV class=title>
<H2>热门评论Top5</H2><SPAN><A 
href="http://comment.tech.163.com/tech_bbs/">更多</A></SPAN> </DIV>
<DIV class=blank9></DIV>
<OL>
  <LI><A 
  href="http://tech.163.com/08/0418/14/49QMVPTK00092LGD.html">网易科技策划：“响一声”电话号码举报平台</A> 
  <SPAN>(评31440条)</SPAN> 
  <LI><A 
  href="http://tech.163.com/08/0420/07/49V4C1OR000915BF.html">CNN发言人称网站遭黑客袭击 
  亚洲用户受影响</A> <SPAN>(评1678条)</SPAN> 
  <LI><A 
  href="http://tech.163.com/08/0421/08/4A1S1RAC000915BE.html">网易科技彻底调查响一声电话真相</A> 
  <SPAN>(评1611条)</SPAN> 
  <LI><A href="http://tech.163.com/08/0419/08/49SM2TNE000915BD.html">中央巡视组进驻央企 
  首批中移动大唐</A> <SPAN>(评801条)</SPAN> 
  <LI><A 
  href="http://tech.163.com/08/0418/20/49RB7C68000915BE.html">工信部称正在向公安部核实“高额吸费”</A> 
  <SPAN>(评568条)</SPAN> </LI></OL></DIV>
<DIV class=inputReview2>
<DIV class=title>
<H2>大家有何高见</H2>
<H3><A href="javascript:reply_allReply()" target=_self>共<SPAN class=cYellow 
id=replycount></SPAN>条评论 点击查看</A> </H3></DIV>
<DIV class=clear></DIV>
<DIV class=inPut>
<FORM id=loginbox name=logfrm action=https://reg.163.com/logins.jsp method=post 
target=_self>通行证:<INPUT class=s2 name=username> 密码:<INPUT class=s2 type=password 
name=password> <INPUT class=s1 onclick=reply_submitlog() type=submit value=登入 name=submitx><INPUT 
type=hidden value=1 name=type><INPUT type=hidden value=content 
name=product><INPUT type=hidden name=url> <A 
href="http://reg.163.com/Service.shtml">注册通行证</A> </FORM></DIV>
<FORM name=formpost onsubmit="return reply_checksubmit();" 
action=http://comment.tech.163.com/reply/dopost.jsp method=post 
target=_self><INPUT type=hidden name=board> <INPUT type=hidden name=threadid> 
<INPUT type=hidden name=url> <TEXTAREA onfocus=reply_clearfield() name=body rows=5 cols=30></TEXTAREA><BR>匿名发表 
<INPUT type=checkbox CHECKED value=true name=hidename> <INPUT class=btn type=submit value="提 交"> </FORM></DIV>
<DIV class=clear></DIV></DIV>
<SCRIPT language=javascript 
src="在VC中调用 WebService・网易学院・教程.files/replyjs.js"></SCRIPT>

<SCRIPT language=javascript>
reply_setHidden('tech_bbs','2FPMSA1L00091LRC','1');
</SCRIPT>
</DIV></DIV><!-- 直达 -->
<DIV class=area>
<DIV class=col1>
<DIV class=direct>
<DIV class=s1>网易科技，更多精彩在首页，</DIV>
<DIV class=s2><A href="http://tech.163.com/"><IMG height=20 
src="在VC中调用 WebService・网易学院・教程.files/direct.gif" width=64 
border=0></A></DIV></DIV></DIV></DIV>
<DIV class=clear></DIV>
<DIV class=blank15></DIV><!-- 页脚 -->
<DIV id=foot><A href="http://corp.163.com/">About NetEase</A> - <A 
href="http://gb.corp.163.com/gb/about/overview.html">公司简介</A> - <A 
href="http://gb.corp.163.com/gb/contactus.html">联系方法</A> - <A 
href="http://corp.163.com/gb/job/job.html">招聘信息</A> - <A 
href="http://gb.corp.163.com/gb/cs.html">客户服务</A> - <A 
href="http://gb.corp.163.com/gb/legal.html">相关法律</A> - <A 
href="http://emarketing.biz.163.com/">网络营销</A> - <A 
href="http://help.163.com/">帮助中心</A><BR>网易公司版权所有 &copy; 1997-2006 </DIV>
<DIV class=blank6></DIV><!-- START WRating v1.0 -->
<SCRIPT src="在VC中调用 WebService・网易学院・教程.files/a1.js" 
type=text/javascript>
</SCRIPT>

<SCRIPT type=text/javascript>
var vjAcc="860010-0509010000";
var wrUrl="http://163.wrating.com/";
vjTrack("");
</SCRIPT>
<NOSCRIPT><IMG height=1 src="在VC中调用 WebService・网易学院・教程.files/a.gif" 
width=1></NOSCRIPT> <!-- END WRating v1.0 -->
<SCRIPT language=JavaScript src="在VC中调用 WebService・网易学院・教程.files/log.js" 
type=text/javascript></SCRIPT>
<!-- NetEase Analytics code 2006-06-27 -->
<SCRIPT src="在VC中调用 WebService・网易学院・教程.files/ntes.js" 
type=text/javascript></SCRIPT>

<SCRIPT language=javascript type=text/javascript>
    _ntes_nacc = "tech"; //站点ID。
    neteaseTracker();
</SCRIPT>
<!-- START NNR Site Census V5.1 --><!-- COPYRIGHT 2004 Nielsen // Netratings -->
<SCRIPT language=JavaScript type=text/javascript>
<!--
	var _rsCI="cn-netease";
	var _rsCG="0";
	var _rsDT=0;
	var _rsDU=0; 
	var _rsDO=0; 
	var _rsX6=0;  
	var _rsSI=escape(window.location);
	var _rsLP=location.protocol.indexOf('https')>-1?'https:':'http:';
	var _rsRP=escape(document.referrer);
	var _rsND=_rsLP+'//secure-cn.imrworldwide.com/';
	if (parseInt(navigator.appVersion)>=4)
	{
		var _rsRD=(new Date()).getTime();
		var _rsSE=1;	
		var _rsSV="";
		var _rsSM=0.01;
		_rsCL='<scr'+'ipt language="JavaScript" type="text/javascript" src="'+_rsND+'v51.js"><\/scr'+'ipt>';
	}
	else
	{
		_rsCL='<img src="'+_rsND+'cgi-bin/m?ci='+_rsCI+'&cg='+_rsCG+'&si='+_rsSI+'&rp='+_rsRP+'">';
	}
	document.write(_rsCL);
//-->
</SCRIPT>
<NOSCRIPT><IMG alt="" src="在VC中调用 WebService・网易学院・教程.files/m.gif"> </NOSCRIPT><!-- END NNR Site Census V5.1 --></BODY></HTML>
