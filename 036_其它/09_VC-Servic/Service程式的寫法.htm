<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<!-- saved from url=(0138)http://www.programmer-club.com/pc2020v5/forum/ShowSameTitle.asp?URL=N&board_pc2020=vc&index=24&id=18297&mode=&type_pc2020=sametitleLevel-2 -->
<!-- "adovbs.inc" Must place in the same directory--><!--同主題閱讀文章列表--><HTML><HEAD><TITLE>程式設計俱樂部</TITLE>
<META content="text/html; charset=big5" http-equiv=Content-Type>
<META content="MSHTML 5.00.2014.210" name=GENERATOR>
<SCRIPT language=JavaScript>
<!--
function openWindow2(){
	window.open('/pc2020v5/board_rule.asp', "", "width=400,height=350,scrollbars=yes");
}
function OpenWindows(theURL) { //v2.0
  window.open(theURL,'Name','width=400, height=400,scrollbars=yes');
}

function GiveEva(authoruid, boardName, ParentDocId, DocId){
	var bEv = window.confirm('您確定要此篇訊息加上一個好的評價嗎 ?');
	if (bEv) {
		formEv.authoruid.value = authoruid;
		formEv.boardName.value = boardName;
		formEv.ParentDocId.value = ParentDocId;
		formEv.DocId.value = DocId;
		formEv.submit();
	}	
}

function GiveMark(mode, authoruid, boardName, ParentDocId, DocId){	
	var bEv;
	switch (mode) {
	case '1':
		bEv = window.confirm('Yes !! 這則回應解決了我的問題 確定嗎 ?');
		break;
	case '2':
		bEv = window.confirm('Ya !! 這則回應很有道理 確定嗎 ? ');
		break;
	case '0':
		bEv = window.confirm('確定取消您對這則回應的評語嗎 ?');		
		break;
	}		 	
	if (bEv) {
		formEv.authoruid.value = authoruid;
		formEv.boardName.value = boardName;
		formEv.ParentDocId.value = ParentDocId;
		formEv.DocId.value = DocId;
		formEv.mode.value = mode;
		formEv.submit();
	}
}

function ChangeCSS(sty){
	var bC = window.confirm("確定更改字型大小 ?");
	if (bC){
			location.href = "/pc2020v5/forum/showsametitle.asp?board_pc2020=vc&id=18297&CSS=" + sty;
	}
}


//-->
</SCRIPT>

<STYLE>.c3 {
	FONT-FAMILY: Century Gothic; FONT-SIZE: 10pt
}
</STYLE>
<LINK href="Service程式的寫法.files/cx.css" rel=stylesheet type=text/css></HEAD>
<BODY leftMargin=0 topMargin=0 align="center" width="100%">
<TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">
  <TBODY></TBODY></TABLE>
<TABLE align=center border=0 cellSpacing=0 width="99%">
  <TBODY>
  <TR bgColor=#ffffff>
    <TD height=70 vAlign=bottom width="100%"><A 
      href="http://www.programmer-club.com/pc2020v5/"><IMG border=0 
      src="Service程式的寫法.files/logo-v6.gif"></A> <A 
      href="http://www.010101.com.tw/index.php?MATaid=13" target=blank><IMG 
      alt=松焰虛擬主機 border=0 src="Service程式的寫法.files/banner4.gif"></A> <A 
      href="http://www.career.com.tw/test/resume/start.asp?r_getfrom=programmer" 
      target=_blank><IMG border=0 
      src="Service程式的寫法.files/programmer-120ad2.gif"></A> </TD></TR>
  <TR>
    <TD>
      <TABLE align=center bgColor=#000000 border=0 cellPadding=2 cellSpacing=1 
      width="100%">
        <TBODY>
        <TR class=c2>
          <TD align=middle bgColor=#5a67aa><A 
            href="http://www.programmer-club.com/pc2020v5/memberlogon.asp"><FONT 
            color=white>會員登入</A></FONT></TD>
          <TD align=middle bgColor=#5a67aa><A 
            href="http://www.programmer-club.com/pc2020v5/newuserfaq.asp"><FONT 
            color=white>初學入門</A></FONT></TD>
          <TD align=middle bgColor=#5a67aa><A 
            href="http://www.programmer-club.com/pc2020v5/Case/Case2.asp"><FONT 
            color=white>外包案件庫</A></FONT></TD>
          <TD align=middle bgColor=#5a67aa><A 
            href="http://www.programmer-club.com/pc2020v5/getcase/"><FONT 
            color=white>接案人才庫</A></FONT></TD>
          <TD align=middle bgColor=#5a67aa><A 
            href="http://www.career.com.tw/test/resume/start.asp?r_getfrom=programmer" 
            target=_blank><FONT color=white>找工作</A></FONT></TD>
          <TD align=middle bgColor=#5a67aa><A 
            href="http://www.programmer-club.com/pc2020v5/TitleList.asp"><FONT 
            color=white>分類主題</A></FONT></TD>
          <TD align=middle bgColor=#5a67aa><A 
            href="http://www.programmer-club.com/pc2020v5/ForumList.asp"><FONT 
            color=white>分類討論</A></FONT></TD>
          <TD align=middle bgColor=#5a67aa><A 
            href="http://www.programmer-club.com/book/"><FONT 
            color=white>好書票選</A></FONT></TD>
          <TD align=middle bgColor=#5a67aa><A 
            href="http://www.programmer-club.com/pc2020v5/techdoc.asp"><FONT 
            color=white>技術文章</A></FONT></TD>
          <TD align=middle bgColor=#5a67aa><A 
            href="http://www.programmer-club.com/pc2020v5/school.asp"><FONT 
            color=white>校園檔案</A></FONT></TD>
          <TD align=middle bgColor=#5a67aa><A 
            href="http://www.programmer-club.com/pc2020v5/FAQ.asp"><FONT 
            color=white>FAQ</A></FONT></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TABLE>
<TABLE align=center bgColor=#ffffff width="98%">
  <TBODY>
  <TR>
    <TD align=right vAlign=top width=65>
      <TABLE align=right border=0>
        <TBODY>
        <TR>
          <TD align=right bgColor=#808080>
            <TABLE bgColor=#ffffff border=0 class=c2 width="100%">
              <TBODY>
              <TR>
                <TD align=middle class=c1>Online Users : 178</TD></TR>
              <TR>
                <TD align=middle width="100%">
                  <TABLE bgColor=#ffffff border=0 cellSpacing=1 class=font3 
                  width="100%">
                    <TBODY>
                    <TR>
                      <TD bgColor=#ffffff class=font3 width="100%"><!--
                <a href="http://myweb.hinet.net/home6/angel0512/" target=_new><img  border="1" style="border-style: solid; border-color: #000000" src="/pc2020v5/images/SkyLight/Light.gif"></a>
                --><!--
		  		<a href="http://www.g-number.com/matrix/index.php?dealer_id=pc000" target=_blank><img src="/pc2020v5/images/GNumber/120x60.gif" border=0  style="border: 1 solid #000000"></a>
		  		--></TD></TR></TBODY></TABLE></TD></TR>
              <TR>
                <TD align=middle bgColor=#c0c0c0></TD></TR>
              <TR>
                <TD align=left>&nbsp;■&nbsp;<A class=menu 
                  href="http://www.programmer-club.com/pc2020v5/forum/forum.asp?type_PC2020=sametitle&amp;board_pc2020=vc&amp;mode=essence"><FONT 
                  color=#bd0000>精華區</B>&nbsp;</A></FONT></TD></TR>
              <TR>
                <TD align=left>&nbsp;■&nbsp;<A class=menu 
                  href="http://www.programmer-club.com/pc2020v5/forum/forum.asp?type_PC2020=sametitle&amp;board_pc2020=vc&amp;mode=month"><FONT 
                  color=#ec5800>月熱門文章</B></A></FONT></TD></TR>
              <TR>
                <TD align=left>&nbsp;■&nbsp;<A class=menu 
                  href="http://www.programmer-club.com/pc2020v5/forum/forum.asp?type_PC2020=sametitle&amp;board_pc2020=vc&amp;mode=quarter"><FONT 
                  color=#ff9a10>季熱門文章</B></A></FONT></TD></TR>
              <TR>
                <TD align=left>&nbsp;■&nbsp;<A class=menu 
                  href="http://www.programmer-club.com/pc2020v5/forum/forum.asp?type_PC2020=sametitle&amp;board_pc2020=vc&amp;mode=top20"><FONT 
                  color=#00a652>熱門文章Top 20</B></A></FONT></TD></TR><!--
        <tr>
          <td width="" align="Left">&nbsp;■&nbsp;<a href="/pc2020v5/forum/forum.asp?type_PC2020=sametitle&amp;board_pc2020=vc&amp;mode=eva20" class="menu"><font color=#00A652>文章評價Top 20</b></a></td>
        </tr>        
        -->
              <TR>
                <TD align=left>&nbsp;■&nbsp;<A class=menu 
                  href="http://www.programmer-club.com/pc2020v5/forum/ranklist.asp?board_pc2020=vc&amp;mode=RankList_Post"><FONT 
                  color=#000080>本區Post排行榜</B></A></FONT></TD></TR>
              <TR>
                <TD align=left>&nbsp;■&nbsp;<A class=menu 
                  href="http://www.programmer-club.com/pc2020v5/forum/ranklist.asp?board_pc2020=vc&amp;mode=RankList_Eva"><FONT 
                  color=#000080>本區評價排行榜</B></A></FONT></TD></TR>
              <TR>
                <TD align=middle bgColor=#c0c0c0></TD></TR>
              <TR>
                <TD align=left>&nbsp;■&nbsp;<A class=menu 
                  href="http://www.programmer-club.com/pc2020v5/forum/ranklist2.asp?board_pc2020=vc&amp;mode=AllRankList_Post"><FONT 
                  color=#2d2d2d>全站Post排行榜</B></A></FONT></TD></TR>
              <TR>
                <TD align=left>&nbsp;■&nbsp;<A class=menu 
                  href="http://www.programmer-club.com/pc2020v5/forum/ranklist2.asp?board_pc2020=vc&amp;mode=AllRankList_Eva"><FONT 
                  color=#2d2d2d>全站評價排行榜</B></A></FONT></TD></TR>
              <TR>
                <TD align=left>&nbsp;■&nbsp;<A class=menu 
                  href="http://www.programmer-club.com/pc2020v5/forum/ranklist2.asp?board_pc2020=vc&amp;mode=AllRankList_Hot"><FONT 
                  color=#2d2d2d>全站人氣排行榜</B></A></FONT></TD></TR>
              <TR>
                <TD align=middle bgColor=#c0c0c0></TD></TR>
              <TR>
                <TD align=left>&nbsp;■&nbsp;<A class=menu 
                  href="http://www.programmer-club.com/book/rankList.asp?ClassID=14" 
                  target=_blank><FONT 
              color=#0066ff>VC++好書排行榜</B></A></FONT></TD></TR>
              <TR>
                <TD align=left>&nbsp;■&nbsp;<A class=menu 
                  href="http://www.programmer-club.com/pc2020v5/RecentDocList.asp"><FONT 
                  color=#0066ff>全站最新Post列表</B></A></FONT></TD></TR><!--
		<tr>         
			<td align=center>
				<a href="http://www.answer168.com/ad_agent/agent.asp?id=03EC0EY&path=http://www.answer168.com/answersms/" target=_blank><img border=0 src="http://www.answer168.com/ad_agent/ad/img/button_sms_1.gif"></a> 			
			</td>
		</tr>        		
		-->
              <TR>
                <TD align=middle height=70><A 
                  href="http://www.intercall.com.tw/webpartner.asp?part_id=jammy98" 
                  target=blank><IMG border=0 
                  src="Service程式的寫法.files/smpc.gif"></A> </TD></TR><!--		
						  <tr>
						    <td width="100%" align=center>
                              <table border="0" width="100%" bgcolor="#000000" class="font3" cellspacing="1">
                                <tr>
                                  <td width="100%" bgcolor="#FFFFFF" class="font3">
<a href="http://www.waiter.com.tw/FoodAp/FromAd.asp?site=5287" target=_blank><img border=0 src="http://www.waiter.com.tw/images/4_banner/banner_waiter_120x60a1.gif"></a> 
                                  </td>
                                </tr>
                              </table>						    							    
						    </td>
						  </tr>					  
-->
              <TR>
                <TD align=middle width="100%">
                  <TABLE border=0 cellSpacing=1 class=font3 width="100%">
                    <TBODY>
                    <TR>
                      <TD bgColor=#ffffff class=font3 width="100%"><IFRAME 
                        frameBorder=0 height=60 marginHeight=0 marginWidth=0 
                        scrolling=no src="Service程式的寫法.files/partner_image.php3" 
                        width=120></IFRAME></TD></TR></TBODY></TABLE></TD></TR><!--
						  <tr>
						    <td width="100%" align=center>
                              <table border="0" width="100%" bgcolor="#000000" cellspacing="1">
                                <tr>
                                  <td width="100%" bgcolor="#FFFFFF">
<a href="http://www.answer168.com/ad_agent/agent.asp?id=03EC0EY&path=http://www.answer168.com/detail.asp?goods_no=209001006001" target=_blank><img border=0 src="http://www.answer168.com/ad_agent/ad/ad_img/209001006001_120x60.gif"></a> 
                                  </td>
                                </tr>
                              </table>						    							    
						    </td>
						  </tr>
						  <tr>
						    <td width="100%" align=center>
                              <table border="0" width="100%" bgcolor="#000000" cellspacing="1">
                                <tr>
                                  <td width="100%" bgcolor="#FFFFFF">
<a href="http://www.answer168.com/ad_agent/agent.asp?id=03EC0EY&path=http://www.answer168.com/detail.asp?goods_no=201104003005" target=_blank><img border=0 src="http://www.answer168.com/ad_agent/ad/ad_img/201104003005_120x60.gif"></a> 
                                  </td>
                                </tr>
                              </table>						    							    
						    </td>
						  </tr>
						  <tr>
						    <td width="100%" align=center>
                              <table border="0" width="100%" bgcolor="#000000" cellspacing="1">
                                <tr>
                                  <td width="100%" bgcolor="#FFFFFF">
<a href="http://www.answer168.com/ad_agent/agent.asp?id=03EC0EY&path=http://www.answer168.com/detail.asp?goods_no=201108190002" target=_blank><img border=0 src="http://www.answer168.com/ad_agent/ad/ad_img/201108190002_120x60.gif"></a> 
                                  </td>
                                </tr>
                              </table>						    							    
						    </td>
						  </tr>
-->
              <TR>
                <TD align=middle><A 
                  href="http://www.career.com.tw/test/resume/start.asp?r_getfrom=programmer" 
                  target=_blank><IMG border=0 
                  src="Service程式的寫法.files/programmer-120ad2.gif"></A> </TD></TR>
              <TR>
                <TD align=middle><A 
                  href="http://www.programmer-club.com/pc2020v5/getcase/" 
                  target=_new><IMG border=0 
                  src="Service程式的寫法.files/getcaseBannerS.gif"></A></TD></TR></TBODY></TABLE></TD></TR><!--  
  <tr>
    <td width="100%" bgcolor="#808080">
      <table border="0" width="100%" bgcolor="#FFFFFF" class="font3">
        <tr>
          <td width="100%" align="center">
			          
			<a href=http://tw.bid.yahoo.com/booth/lulumi1969 target=new5><img border="0" src="/pc2020v5/images/YahooBid.jpg"></a>
          </td>
        </tr>        
      </table>
    </td>
  </tr>            
  <tr>
    <td width="100%" Align=center bgcolor="#FAF0BF">		  
    </td>
  </tr>        
-->
        <TR>
          <TD width="100%"></TD></TR>
        <TR>
          <TD width="100%">
            <HR color=#ffffff SIZE=1 width="100%">
          </TD></TR></TBODY></TABLE></TD>
    <TD vAlign=top width="100%">
      <TABLE align=center bgColor=#ffffff class=font3 width="100%">
        <TBODY>
        <TR>
          <TD bgColor=#ffffff><B><FONT face="Trebuchet MS">Current area : Home 
            -&gt; <A 
            href="http://www.programmer-club.com/pc2020v5/forum/forum.asp?board_pc2020=vc">Visual 
            C++ </A>-&gt; <A 
            href="http://www.programmer-club.com/pc2020v5/forum/forum.asp?board_pc2020=vc">Visual 
            C++ </A>討論區列表</B> &nbsp;&nbsp;<FONT class=c2 color=#666666>Hi !! 
            ghost(<B><FONT face="Trebuchet MS">ghost_liao</B>)</FONT> 
            </FONT></FONT></TD>
          <TD align=right class=font3 vAlign=top><!--
      [發表新主題] [回覆文章] [友善列印] [轉寄文章]-->[ <A 
            href="javascript:history.go(-1);"><B>回上頁</B></A> ] [ <A 
            href="javascript:openWindow2();"><B>討論區發言規則</B></A> ] 
      </TD></TR></TBODY></TABLE>
      <TABLE align=center bgColor=#8995b8 border=0 cellPadding=0 cellSpacing=1 
      width="100%">
        <TBODY>
        <TR>
          <TD bgColor=#c0c0c0 width="100%">
            <TABLE bgColor=#8995b8 width="100%">
              <TBODY>
              <TR>
                <TD class=font4><FONT color=white>Topic : <B>[教學] 
                  Service程式的寫法</B> </FONT></TD>
                <TD class=font4><FONT color=#ffffff>更改閱讀文章字型大小<INPUT CHECKED 
                  onclick="javascript:ChangeCSS('font4');" type=radio><FONT 
                  class=font4 color=#ffffff>大</FONT> <INPUT 
                  onclick="javascript:ChangeCSS('c3');" type=radio><FONT 
                  class=c3 color=#ffffff>中</FONT> <INPUT 
                  onclick="javascript:ChangeCSS('c2');" type=radio><FONT 
                  class=c2 color=#ffffff>小</FONT> </FONT></TD>
                <TD align=right class=font4></TD></TR></TBODY></TABLE>
            <TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR>
                <TD bgColor=#c0c0c0>
                  <TABLE bgColor=#c0c0c0 border=0 cellPadding=0 cellSpacing=0 
                  width="100%">
                    <TBODY>
                    <TR>
                      <TD height=1></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE bgColor=#e4e7ed width="100%">
              <TBODY>
              <TR width="100%">
                <TD class=C4 width="50%">作者 : <A class=fonthref 
                  href="http://www.programmer-club.com/pc2020v5/forum/ShowSameTitle.asp?URL=N&amp;board_pc2020=vc&amp;index=24&amp;id=18297&amp;mode=&amp;type_pc2020=sametitleLevel-2#" 
                  onclick="JavaScript:OpenWindows('memberdata.asp?uid=chiuinan2'); return false">青衫</A><!--人氣指數--> 
                  <SPAN class=c1>[ 貼文 247 | 人氣 12.18 | <FONT 
                  color=blue>評價</FONT> 273 ]</FONT> </SPAN></TD>
                <TD align=right class=C2 width="50%"><A 
                  href="http://www.programmer-club.com/pc2020v5/forum/reply.asp?board_pc2020=vc&amp;id=18297">回應本文</A>&nbsp; 
                  <A 
                  href="http://www.programmer-club.com/pc2020v5/forum/postform.asp?board_pc2020=vc" 
                  target=_top>發表新文</A>&nbsp; <A 
                  href="javascript:GiveEva('chiuinan2',%20'vc',%20'18297',%20'18297');"><FONT 
                  color=blue>給予評價</FONT></A>&nbsp; <SPAN class=c1>10/28/2004 
                  2:13:34 PM </SPAN></TD></TR></TBODY></TABLE>
            <TABLE align=center bgColor=#ffffff width="100%">
              <TBODY>
              <TR bgColor=#ffffff>
                <TD bgColor=#ffffff class=font4 width="100%">
                  <TABLE align=center width="99%">
                    <TBODY>
                    <TR>
                      <TD align=middle vAlign=top width="1%"></TD>
                      <TD class=font4 vAlign=top>其實在MSDN裡都有sample可以參考, 
                        不過Service程式的基本寫法蠻固定的, 看一看便大概能夠了解如何去撰寫. 想要了解更多的, 
                        可再去參考MSDN的相關資料, 
                        尤其是關於Service程式的帳號權限與執行空間.<BR><BR>我的習慣是將Service程式寫成一個console 
                        mode程式, 而這個程式同時做為Service服務, 並可對Service進行安裝與控制等功能. 
                        它的主程式就是大家熟悉的main函數:<BR><BR><FONT color=blue><B>int 
                        </B></FONT>main(<FONT color=blue><B>int </B></FONT>argc, 
                        char* argv[])<BR>{<BR>&nbsp;&nbsp;<FONT color=blue><B>if 
                        </B></FONT>(argc &gt;= 
                        2)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT 
                        color=blue><B>const </B></FONT>char* param = 
                        argv[1];<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT 
                        color=blue><B>if </B></FONT>(stricmp(param,"/install") 
                        == 
                        0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 安裝Service<BR>&nbsp;&nbsp;&nbsp;&nbsp; return 
                        0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT 
                        color=blue><B>if </B></FONT>(stricmp(param,"/uninstall") 
                        == 
                        0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 反安裝Service<BR>&nbsp;&nbsp;&nbsp;&nbsp; return 
                        0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT 
                        color=blue><B>if </B></FONT>(stricmp(param,"/status") == 
                        0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 顯示Service狀態<BR>&nbsp;&nbsp;&nbsp;&nbsp; return 
                        0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT 
                        color=blue><B>if </B></FONT>(stricmp(param,"/start") == 
                        0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 啟動Service<BR>&nbsp;&nbsp;&nbsp;&nbsp; return 
                        0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT 
                        color=blue><B>if </B></FONT>(stricmp(param,"/stop") == 
                        0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 停止Service<BR>&nbsp;&nbsp;&nbsp;&nbsp; return 
                        0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT 
                        color=blue><B>if </B></FONT>(strcmp(param,某種參數) == 
                        0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 執行Service<BR>&nbsp;&nbsp;&nbsp;&nbsp; return 
                        0;<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;// 
                        顯示help<BR>&nbsp;&nbsp;return 
                        0;<BR>}<BR><BR>因此一個程式就能控制Service的安裝/反安裝/查詢狀態/啟動/停止, 
                        而自己本身也做為Service服務的程式. 注意程式裡的"某種參數"是由自己去定義的, 
                        而在安裝時指定Service程式在啟動時, 應以該參數來呼叫, 
                        這樣才能配合去執行Service服務的程式部份.<BR><BR>Service程式的安裝與控制, 
                        都必須透過Service Control Manager才行, 
                        因此首先要先開啟SCM:<BR><BR>SC_HANDLE scm_handle = 
                        OpenSCManager(<FONT color=blue><B>null</B></FONT>,<FONT 
                        color=blue><B>null</B></FONT>,SC_MANAGER_ALL_ACCESS);<BR><FONT 
                        color=blue><B>if </B></FONT>(scm_handle == <FONT 
                        color=blue><B>null</B></FONT>) 
                        錯誤處理...<BR>其他處理...<BR>CloseServiceHandle(scm_handle);<BR><BR>後面用有到scm_handle這個變數的, 
                        便不再多做說明了. 
                        以下便是各種安裝與控制的處理方法:<BR><BR>1.安裝Service程式<BR><BR>SC_HANDLE 
                        sv_handle = 
                        CreateService(scm_handle,SERVICE_NAME,SERVICE_NAME,SC_MANAGER_ALL_ACCESS,SERVICE_WIN32_OWN_PROCESS,SERVICE_<FONT 
                        color=blue><B>auto</B></FONT>_START,SERVICE_ERROR_IGNORE,prg_name,<FONT 
                        color=blue><B>null</B></FONT>,<FONT 
                        color=blue><B>null</B></FONT>,<FONT 
                        color=blue><B>null</B></FONT>,<FONT 
                        color=blue><B>null</B></FONT>,<FONT 
                        color=blue><B>null</B></FONT>);<BR><FONT 
                        color=blue><B>if </B></FONT>(sv_handle == <FONT 
                        color=blue><B>null</B></FONT>) 
                        錯誤處理...<BR>CloseServiceHandle(sv_handle);<BR><BR>其中SERVICE_NAME便是Serivce程式的名稱, 
                        prg_name則是Service程式應執行的command line, 
                        其中必須包括main函數裡所謂的"某種參數". 為了避免Service程式所在路徑有空白字元, 
                        最好是將程式檔名用引號"括起來. CreateService最後兩個參數是帳號/密碼, 
                        不給的話是以LocalSystem帳號執行, 處理本機資料大都已足夠, 如果需要更高權限的話, 便要另行給定 
                        (帳號為domain\username). 另外, 這裡的範例寫法是不支援Interactive功能的, 
                        也就是你不能顯示視窗, 也不能要求user輸入資料, 需要的話, 請參考MSDN裡的資料, 
                        改變一下參數的設定.<BR><BR></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR>
                <TD bgColor=#c0c0c0>
                  <TABLE bgColor=#c0c0c0 border=0 cellPadding=0 cellSpacing=0 
                  width="100%">
                    <TBODY>
                    <TR>
                      <TD height=1></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE bgColor=#e4e7ed width="100%">
              <TBODY>
              <TR width="100%">
                <TD class=C4 width="50%">作者 : <A class=fonthref 
                  href="http://www.programmer-club.com/pc2020v5/forum/ShowSameTitle.asp?URL=N&amp;board_pc2020=vc&amp;index=24&amp;id=18297&amp;mode=&amp;type_pc2020=sametitleLevel-2#" 
                  onclick="JavaScript:OpenWindows('memberdata.asp?uid=chiuinan2'); return false">青衫</A><!--人氣指數--> 
                  <SPAN class=c1>[ 貼文 247 | 人氣 12.18 | <FONT 
                  color=blue>評價</FONT> 273 ]</FONT> </SPAN></TD>
                <TD align=right class=C2 width="50%"><A 
                  href="http://www.programmer-club.com/pc2020v5/forum/reply.asp?board_pc2020=vc&amp;id=18298">回應本文</A>&nbsp; 
                  <A 
                  href="http://www.programmer-club.com/pc2020v5/forum/postform.asp?board_pc2020=vc" 
                  target=_top>發表新文</A>&nbsp; <A 
                  href="javascript:GiveEva('chiuinan2',%20'vc',%20'18297',%20'18298');"><FONT 
                  color=blue>給予評價</FONT></A>&nbsp; <SPAN class=c1>10/28/2004 
                  2:20:53 PM </SPAN></TD></TR></TBODY></TABLE>
            <TABLE align=center bgColor=#ffffff width="100%">
              <TBODY>
              <TR bgColor=#ffffff>
                <TD bgColor=#ffffff class=font4 width="100%">
                  <TABLE align=center width="99%">
                    <TBODY>
                    <TR>
                      <TD align=middle vAlign=top width="1%"></TD>
                      <TD class=font4 
                        vAlign=top>2.反安裝Service程式<BR><BR>SC_HANDLE sv_handle = 
                        OpenService(scm_handle,SERVICE_NAME,access);<BR><FONT 
                        color=blue><B>if </B></FONT>(sv_handle == <FONT 
                        color=blue><B>null</B></FONT>) 錯誤處理...<BR><FONT 
                        color=blue><B>if </B></FONT>(!DeleteService(sv_handle)) 
                        錯誤處理...<BR>CloseServiceHandle(sv_handle);<BR><BR>SCM其實只是先將Service程式標示為刪除, 
                        必須等Service程式所有的process和thread都停止後, 才會做真正的移除動作 
                        (重開機亦可).<BR><BR>3.查詢狀態<BR><BR>SC_HANDLE sv_handle = 
                        OpenService(scm_handle,SERVICE_NAME,access);<BR><FONT 
                        color=blue><B>if </B></FONT>(sv_handle == <FONT 
                        color=blue><B>null</B></FONT>) 錯誤處理...<BR>SERVICE_STATUS 
                        status;<BR><FONT color=blue><B>if 
                        </B></FONT>(!QueryServiceStatus(sv_handle,&amp;status)) 
                        錯誤處理...<BR>status.dwCurrentState便是目前Service程式的狀態值,<BR>CloseServiceHandle(sv_handle);<BR><BR>關於status.dwCurrentState的值, 
                        必須配合你的Service服務程式裡的寫法而定, 一般SERVICE_RUNNING表正在執行, 
                        SERVICE_STOPPED表已經停止.<BR><BR>4.啟動Service程式<BR><BR>SC_HANDLE 
                        sv_handle = 
                        OpenService(scm_handle,SERVICE_NAME,access);<BR><FONT 
                        color=blue><B>if </B></FONT>(sv_handle == <FONT 
                        color=blue><B>null</B></FONT>) 錯誤處理...<BR><FONT 
                        color=blue><B>if 
                        </B></FONT>(!StartService(sv_handle,0,<FONT 
                        color=blue><B>null</B></FONT>)) 
                        錯誤處理...<BR>CloseServiceHandle(sv_handle);<BR><BR>5.停止Service程式<BR><BR>SC_HANDLE 
                        sv_handle = 
                        OpenService(scm_handle,SERVICE_NAME,access);<BR><FONT 
                        color=blue><B>if </B></FONT>(sv_handle == <FONT 
                        color=blue><B>null</B></FONT>) 錯誤處理...<BR>SERVICE_STATUS 
                        status;<BR><FONT color=blue><B>if 
                        </B></FONT>(!ControlService(sv_handle,SERVICE_CONTROL_STOP,&amp;status)) 
                        錯誤處理...<BR>status.dwCurrentState便是目前Service程式的狀態值<BR>CloseServiceHandle(sv_handle);<BR><BR>ControlService會將第2參數的值送到Service服務控制程式內, 
                        而這個服務控制程式是由我們寫的. 因此如何停止, 其實還是我們的事. 
                        這裡可以經由回傳的狀態值來決定是否成功.<BR><BR>6.執行Service程式<BR><BR>SERVICE_TABLE_EN<FONT 
                        color=blue><B>try </B></FONT>dispatch_table[] 
                        =<BR>{<BR>&nbsp;&nbsp;{SERVICE_NAME, 
                        ServiceMain},<BR>&nbsp;&nbsp;{<FONT 
                        color=blue><B>null</B></FONT>, <FONT 
                        color=blue><B>null</B></FONT>}<BR>};<BR>StartServiceCtrlDispatcher(dispatch_table);<BR><BR>當呼叫StartServiceCtrlDispatcher後, 
                        Service程式便會進入常駐狀態, 直到狀態值變成SERVICE_STOPPED後, 這個函數才會還回控制權. 
                        而在dispatch裡定義的ServiceMain函數, 便是我們要寫的Service服務主程式. 
                        以下便是一個範例:<BR></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR>
                <TD bgColor=#c0c0c0>
                  <TABLE bgColor=#c0c0c0 border=0 cellPadding=0 cellSpacing=0 
                  width="100%">
                    <TBODY>
                    <TR>
                      <TD height=1></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE bgColor=#e4e7ed width="100%">
              <TBODY>
              <TR width="100%">
                <TD class=C4 width="50%">作者 : <A class=fonthref 
                  href="http://www.programmer-club.com/pc2020v5/forum/ShowSameTitle.asp?URL=N&amp;board_pc2020=vc&amp;index=24&amp;id=18297&amp;mode=&amp;type_pc2020=sametitleLevel-2#" 
                  onclick="JavaScript:OpenWindows('memberdata.asp?uid=chiuinan2'); return false">青衫</A><!--人氣指數--> 
                  <SPAN class=c1>[ 貼文 247 | 人氣 12.18 | <FONT 
                  color=blue>評價</FONT> 273 ]</FONT> </SPAN></TD>
                <TD align=right class=C2 width="50%"><A 
                  href="http://www.programmer-club.com/pc2020v5/forum/reply.asp?board_pc2020=vc&amp;id=18300">回應本文</A>&nbsp; 
                  <A 
                  href="http://www.programmer-club.com/pc2020v5/forum/postform.asp?board_pc2020=vc" 
                  target=_top>發表新文</A>&nbsp; <A 
                  href="javascript:GiveEva('chiuinan2',%20'vc',%20'18297',%20'18300');"><FONT 
                  color=blue>給予評價</FONT></A>&nbsp; <SPAN class=c1>10/28/2004 
                  2:29:31 PM </SPAN></TD></TR></TBODY></TABLE>
            <TABLE align=center bgColor=#ffffff width="100%">
              <TBODY>
              <TR bgColor=#ffffff>
                <TD bgColor=#ffffff class=font4 width="100%">
                  <TABLE align=center width="99%">
                    <TBODY>
                    <TR>
                      <TD align=middle vAlign=top width="1%"></TD>
                      <TD class=font4 vAlign=top><FONT 
                        color=blue><B>static</B></FONT> SERVICE_STATUS 
                        Service_Status;<BR><FONT color=blue><B>static</B></FONT> 
                        SERVICE_STATUS_HANDLE 
                        Service_Status_Handle;<BR><BR><FONT 
                        color=blue><B>void</B></FONT> WINAPI ServiceMain(DWORD 
                        argc, LPTSTR *argv)<BR>{<BR>&nbsp;&nbsp;// 登錄Service 
                        Control Handler<BR>&nbsp;&nbsp;Service_Status_Handle = 
                        RegisterServiceCtrlHandler(SERVICE_NAME,ServiceCtrlHandler);<BR>&nbsp;&nbsp;<FONT 
                        color=blue><B>if </B></FONT>(Service_Status_Handle == 
                        <FONT color=blue><B>null</B></FONT>) 
                        return;<BR>&nbsp;&nbsp;// 
                        設定執行狀態<BR>&nbsp;&nbsp;Service_Status.dwServiceType = 
                        SERVICE_WIN32;<BR>&nbsp;&nbsp;Service_Status.dwCurrentState 
                        = 
                        SERVICE_RUNNING;<BR>&nbsp;&nbsp;Service_Status.dwControlsAccepted 
                        = 
                        SERVICE_ACCEPT_STOP;<BR>&nbsp;&nbsp;Service_Status.dwWin32ExitCode 
                        = 
                        0;<BR>&nbsp;&nbsp;Service_Status.dwServiceSpecificExitCode 
                        = 0;<BR>&nbsp;&nbsp;Service_Status.dwCheckPo<FONT 
                        color=blue><B>int </B></FONT>= 
                        0;<BR>&nbsp;&nbsp;Service_Status.dwWaitH<FONT 
                        color=blue><B>int </B></FONT>= 0;<BR>&nbsp;&nbsp;<FONT 
                        color=blue><B>if 
                        </B></FONT>(!SetServiceStatus(Service_Status_Handle,&amp;Service_Status)) 
                        return;<BR>&nbsp;&nbsp;// 建一個新的執行緒, 
                        開始正式處理資料<BR>&nbsp;&nbsp;AfxBeginThread(thread_start_service,<FONT 
                        color=blue><B>null</B></FONT>);<BR>}<BR><BR>這邊有兩個議題, 
                        一個是Service Control Handler, 一個是新的執行緒, 前者待會再提. 
                        由於ServiceMain主要是做Service服務的初始化動作, 因此在一定時限內必須結束返回, 
                        不然會被視同Timeout失敗, 因此我們可將實際要處理的部份, 經由另一個執行緒來處理 (有需要的話, 
                        也可常駐在系統裡), 如此ServiceMain的主控制權便很快地便還回給SCM.<BR><BR>Service 
                        Control Handler的目的, 便是用來提供給外界控制Service之用, 它傳入的參數, 
                        便是前面提到ControlService傳入的功能碼. 不過這些功能碼是固定的, 
                        而且在SetServiceStatus時, 便必須指定能夠接收那幾種碼. 
                        這邊我們只設定可接收SERVICE_CONTROL_STOP訊息. 以下是一個範例:<BR><BR><FONT 
                        color=blue><B>void</B></FONT> WINAPI 
                        ServiceCtrlHandler(DWORD 
                        opcode)<BR>{<BR>&nbsp;&nbsp;<FONT 
                        color=blue><B>switch</B></FONT>(opcode)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;<FONT 
                        color=blue><B> case</B></FONT> 
                        SERVICE_CONTROL_STOP:<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        停掉ServiceMain建立的執行緒, 
                        以及所有其他該關掉的東西...<BR>&nbsp;&nbsp;&nbsp;&nbsp; <FONT 
                        color=blue><B>if </B></FONT>(失敗) <FONT 
                        color=blue><B>break</B></FONT>;<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 設定狀態值<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        Service_Status.dwServiceType = 
                        SERVICE_WIN32;<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        Service_Status.dwCurrentState = 
                        SERVICE_STOPPED;<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        Service_Status.dwControlsAccepted = 
                        SERVICE_ACCEPT_STOP;<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        Service_Status.dwWin32ExitCode = 
                        0;<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        Service_Status.dwServiceSpecificExitCode = 
                        0;<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        Service_Status.dwCheckPo<FONT color=blue><B>int 
                        </B></FONT>= 0;<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        Service_Status.dwWaitH<FONT color=blue><B>int 
                        </B></FONT>= 0;<BR>&nbsp;&nbsp;&nbsp;&nbsp; <FONT 
                        color=blue><B>break</B></FONT>;<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT 
                        color=blue><B>default</B></FONT>:<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        return;<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;SetServiceStatus(Service_Status_Handle,&amp;Service_Status);<BR>}<BR><BR></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR>
                <TD bgColor=#c0c0c0>
                  <TABLE bgColor=#c0c0c0 border=0 cellPadding=0 cellSpacing=1 
                  width="100%">
                    <TBODY>
                    <TR>
                      <TD align=middle bgColor=#ffffff height=62><!--
				<A href="http://www.pentax.com.tw" target=_blank>
				<IMG src="http://www.digital.idv.tw/logo/ad-pentax-optioS.gif" align=left border=0></A> &nbsp;
				<A href="#">
	<IMG height=60 src="http://www.photosharp.com.tw/logo/ad-contax-banner1.gif" width=180 border=0></A>&nbsp;
<A href="#"><IMG height=60 src="http://www.photosharp.com.tw/logo/ad/ad-neophoto-banner1.gif" width=180 
border=0></A>	
--><!--每月主打 固定不輪播強力放送 2003/7/10--><A 
                        href="http://www.intercall.com.tw/webpartner.asp?part_id=jammy98" 
                        target=blank><IMG border=0 height=60 
                        src="Service程式的寫法.files/bgcnc.gif" width=468></A> <A 
                        href="http://www.career.com.tw/test/resume/start.asp?r_getfrom=programmer" 
                        target=_blank><IMG border=0 
                        src="Service程式的寫法.files/programmer-120ad2.gif"></A> <!--SNOOPY精品 2003/11/08--></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE bgColor=#e4e7ed width="100%">
              <TBODY>
              <TR width="100%">
                <TD class=C4 width="50%">作者 : <A class=fonthref 
                  href="http://www.programmer-club.com/pc2020v5/forum/ShowSameTitle.asp?URL=N&amp;board_pc2020=vc&amp;index=24&amp;id=18297&amp;mode=&amp;type_pc2020=sametitleLevel-2#" 
                  onclick="JavaScript:OpenWindows('memberdata.asp?uid=chiuinan2'); return false">青衫</A><!--人氣指數--> 
                  <SPAN class=c1>[ 貼文 247 | 人氣 12.18 | <FONT 
                  color=blue>評價</FONT> 273 ]</FONT> </SPAN></TD>
                <TD align=right class=C2 width="50%"><A 
                  href="http://www.programmer-club.com/pc2020v5/forum/reply.asp?board_pc2020=vc&amp;id=18301">回應本文</A>&nbsp; 
                  <A 
                  href="http://www.programmer-club.com/pc2020v5/forum/postform.asp?board_pc2020=vc" 
                  target=_top>發表新文</A>&nbsp; <A 
                  href="javascript:GiveEva('chiuinan2',%20'vc',%20'18297',%20'18301');"><FONT 
                  color=blue>給予評價</FONT></A>&nbsp; <SPAN class=c1>10/28/2004 
                  2:44:08 PM </SPAN></TD></TR></TBODY></TABLE>
            <TABLE align=center bgColor=#ffffff width="100%">
              <TBODY>
              <TR bgColor=#ffffff>
                <TD bgColor=#ffffff class=font4 width="100%">
                  <TABLE align=center width="99%">
                    <TBODY>
                    <TR>
                      <TD align=middle vAlign=top width="1%"></TD>
                      <TD class=font4 vAlign=top>現在我們要做的事, 
                        便是如何在thread_start_service處理我們所需的服務, 由於這部份隨個人而定, 
                        因此便不再說明下去. 例如可能是開始socket listener, 不斷接收資料並做處理, 
                        或是一個timer, 去監控某些事件等等...<BR><BR>當然我們也可以再去啟動另一個程式檔, 
                        來實際處理所需的服務 (用CreateProcess). 如果涉及到網路資源的存取, 
                        而目前的執行帳號是LocalSystem, 也可利用LogonUser來做轉換, 
                        例如:<BR><BR><FONT color=blue><B>static</B></FONT> 
                        PROCESS_INFORMATION pi; // process資訊<BR><BR>// 
                        登入使用者<BR>HANDLE token;<BR><FONT color=blue><B>if 
                        </B></FONT>(!LogonUser(username,domain_name,password,LOGON32_LOGON_INTERACTIVE,LOGON32_PROVIDER_<FONT 
                        color=blue><B>default</B></FONT>,&amp;token)) 
                        return;<BR>// 執行處理程式<BR>STARTUPINFO 
                        si;<BR>memset(&amp;si,0,<FONT 
                        color=blue><B>sizeof</B></FONT>(si));<BR>memset(&amp;pi,0,<FONT 
                        color=blue><B>sizeof</B></FONT>(pi));<BR>si.cb = <FONT 
                        color=blue><B>sizeof</B></FONT>(si);<BR><FONT 
                        color=blue><B>if 
                        </B></FONT>(!CreateProcessAsUser(token,<FONT 
                        color=blue><B>null</B></FONT>,程式檔名,<FONT 
                        color=blue><B>null</B></FONT>,<FONT 
                        color=blue><B>null</B></FONT>,<FONT 
                        color=blue><B>false</B></FONT>,NORMAL_PRIORITY_CLASS,<FONT 
                        color=blue><B>null</B></FONT>,<FONT 
                        color=blue><B>null</B></FONT>,&amp;si,&amp;pi))<BR>{<BR>&nbsp;&nbsp;CloseHandle(token);<BR>&nbsp;&nbsp;return;<BR>}<BR>WaitForSingleObject(pi.hProcess,INFINITE);<BR>CloseHandle(pi.hProcess);<BR>CloseHandle(pi.hThread);<BR>memset(&amp;pi,0,<FONT 
                        color=blue><B>sizeof</B></FONT>(pi));<BR>CloseHandle(token);<BR><BR>這樣的寫法會永久等待所呼叫的程式處理結束. 
                        這邊PROCESS_INFORMATION做成global變數的目的, 
                        便是用來在處理SERVICE_CONTROL_STOP訊息時, 
                        可利用TerminateProcess直接將此程序關掉, 而達到停止Service的作用. 
                        不過強迫停止該程式是否會造成副作用, 則必須自己去考慮, 
                    不然便要用其他方法來通知停止.<BR></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR>
                <TD bgColor=#c0c0c0>
                  <TABLE bgColor=#c0c0c0 border=0 cellPadding=0 cellSpacing=0 
                  width="100%">
                    <TBODY>
                    <TR>
                      <TD height=1></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE bgColor=#e4e7ed width="100%">
              <TBODY>
              <TR width="100%">
                <TD class=C4 width="50%">作者 : <A class=fonthref 
                  href="http://www.programmer-club.com/pc2020v5/forum/ShowSameTitle.asp?URL=N&amp;board_pc2020=vc&amp;index=24&amp;id=18297&amp;mode=&amp;type_pc2020=sametitleLevel-2#" 
                  onclick="JavaScript:OpenWindows('memberdata.asp?uid=akira32'); return false">Akira</A><!--人氣指數--> 
                  <SPAN class=c1>[ 貼文 598 | 人氣 238.2 | <FONT 
                  color=blue>評價</FONT> 71 ]</FONT> </SPAN></TD>
                <TD align=right class=C2 width="50%"><A 
                  href="http://www.programmer-club.com/pc2020v5/forum/reply.asp?board_pc2020=vc&amp;id=18323">回應本文</A>&nbsp; 
                  <A 
                  href="http://www.programmer-club.com/pc2020v5/forum/postform.asp?board_pc2020=vc" 
                  target=_top>發表新文</A>&nbsp; <A 
                  href="javascript:GiveEva('akira32',%20'vc',%20'18297',%20'18323');"><FONT 
                  color=blue>給予評價</FONT></A>&nbsp; <SPAN class=c1>10/30/2004 
                  12:27:26 AM </SPAN></TD></TR></TBODY></TABLE>
            <TABLE align=center bgColor=#ffffff width="100%">
              <TBODY>
              <TR bgColor=#ffffff>
                <TD bgColor=#ffffff class=font4 width="100%">
                  <TABLE align=center width="99%">
                    <TBODY>
                    <TR>
                      <TD align=middle vAlign=top width="1%"></TD>
                      <TD class=font4 vAlign=top>可以減少return 0;<BR><BR><FONT 
                        color=blue><B>int </B></FONT>main(<FONT 
                        color=blue><B>int </B></FONT>argc, char* 
                        argv[])<BR>{<BR>&nbsp;&nbsp;<FONT color=blue><B>if 
                        </B></FONT>(argc &gt;= 
                        2)<BR>&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT 
                        color=blue><B>const </B></FONT>char* param = 
                        argv[1];<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT 
                        color=blue><B>if </B></FONT>(stricmp(param,"/install") 
                        == 
                        0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 
                        安裝Service<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;else 
                        <FONT color=blue><B>if 
                        </B></FONT>(stricmp(param,"/uninstall") == 
                        0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 
                        反安裝Service<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;else 
                        <FONT color=blue><B>if 
                        </B></FONT>(stricmp(param,"/status") == 
                        0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 
                        顯示Service狀態<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;else 
                        <FONT color=blue><B>if 
                        </B></FONT>(stricmp(param,"/start") == 
                        0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 
                        啟動Service<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;else 
                        <FONT color=blue><B>if 
                        </B></FONT>(stricmp(param,"/stop") == 
                        0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 
                        停止Service<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;else 
                        <FONT color=blue><B>if </B></FONT>(strcmp(param,某種參數) == 
                        0)<BR>&nbsp;&nbsp;&nbsp;&nbsp;{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        // 
                        執行Service<BR>&nbsp;&nbsp;&nbsp;&nbsp;}<BR>&nbsp;&nbsp;&nbsp;&nbsp;<FONT 
                        color=blue><B>else<BR></B></FONT>{<BR>&nbsp;&nbsp;&nbsp;&nbsp; 
                        //不合法的參數<BR>&nbsp;&nbsp;&nbsp;&nbsp; return 
                        -1;<BR>&nbsp;&nbsp;&nbsp;&nbsp; } 
                        <BR>&nbsp;&nbsp;&nbsp;&nbsp;return 
                        0;<BR>&nbsp;&nbsp;}<BR>&nbsp;&nbsp;// 
                        顯示help<BR>&nbsp;&nbsp;return 
                  0;<BR>}<BR></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR>
                <TD bgColor=#c0c0c0>
                  <TABLE bgColor=#c0c0c0 border=0 cellPadding=0 cellSpacing=0 
                  width="100%">
                    <TBODY>
                    <TR>
                      <TD height=1></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE bgColor=#e4e7ed width="100%">
              <TBODY>
              <TR width="100%">
                <TD class=C4 width="50%">作者 : <A class=fonthref 
                  href="http://www.programmer-club.com/pc2020v5/forum/ShowSameTitle.asp?URL=N&amp;board_pc2020=vc&amp;index=24&amp;id=18297&amp;mode=&amp;type_pc2020=sametitleLevel-2#" 
                  onclick="JavaScript:OpenWindows('memberdata.asp?uid=chiuinan2'); return false">青衫</A><!--人氣指數--> 
                  <SPAN class=c1>[ 貼文 247 | 人氣 12.18 | <FONT 
                  color=blue>評價</FONT> 273 ]</FONT> </SPAN></TD>
                <TD align=right class=C2 width="50%"><A 
                  href="http://www.programmer-club.com/pc2020v5/forum/reply.asp?board_pc2020=vc&amp;id=18324">回應本文</A>&nbsp; 
                  <A 
                  href="http://www.programmer-club.com/pc2020v5/forum/postform.asp?board_pc2020=vc" 
                  target=_top>發表新文</A>&nbsp; <A 
                  href="javascript:GiveEva('chiuinan2',%20'vc',%20'18297',%20'18324');"><FONT 
                  color=blue>給予評價</FONT></A>&nbsp; <SPAN class=c1>10/30/2004 
                  6:45:14 AM </SPAN></TD></TR></TBODY></TABLE>
            <TABLE align=center bgColor=#ffffff width="100%">
              <TBODY>
              <TR bgColor=#ffffff>
                <TD bgColor=#ffffff class=font4 width="100%">
                  <TABLE align=center width="99%">
                    <TBODY>
                    <TR>
                      <TD align=middle vAlign=top width="1%"></TD>
                      <TD class=font4 vAlign=top>&gt;可以減少return 0;<BR><BR>... 
                        真的不知該說些什麼... (有點程度的應該知道我想說的是什麼)<BR><BR>算了, 當我沒說好了... 
                        it's nonsense... 
</TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR>
                <TD bgColor=#c0c0c0>
                  <TABLE bgColor=#c0c0c0 border=0 cellPadding=0 cellSpacing=0 
                  width="100%">
                    <TBODY>
                    <TR>
                      <TD height=1></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE bgColor=#e4e7ed width="100%">
              <TBODY>
              <TR width="100%">
                <TD class=C4 width="50%">作者 : <A class=fonthref 
                  href="http://www.programmer-club.com/pc2020v5/forum/ShowSameTitle.asp?URL=N&amp;board_pc2020=vc&amp;index=24&amp;id=18297&amp;mode=&amp;type_pc2020=sametitleLevel-2#" 
                  onclick="JavaScript:OpenWindows('memberdata.asp?uid=whatthis'); return false">WhatThis</A><!--人氣指數--> 
                  <SPAN class=c1>[ 貼文 696 | 人氣 3.53 | <FONT color=blue>評價</FONT> 
                  66 ]</FONT> </SPAN></TD>
                <TD align=right class=C2 width="50%"><A 
                  href="http://www.programmer-club.com/pc2020v5/forum/reply.asp?board_pc2020=vc&amp;id=18325">回應本文</A>&nbsp; 
                  <A 
                  href="http://www.programmer-club.com/pc2020v5/forum/postform.asp?board_pc2020=vc" 
                  target=_top>發表新文</A>&nbsp; <A 
                  href="javascript:GiveEva('whatthis',%20'vc',%20'18297',%20'18325');"><FONT 
                  color=blue>給予評價</FONT></A>&nbsp; <SPAN class=c1>10/30/2004 
                  8:50:19 AM </SPAN></TD></TR></TBODY></TABLE>
            <TABLE align=center bgColor=#ffffff width="100%">
              <TBODY>
              <TR bgColor=#ffffff>
                <TD bgColor=#ffffff class=font4 width="100%">
                  <TABLE align=center width="99%">
                    <TBODY>
                    <TR>
                      <TD align=middle vAlign=top width="1%"></TD>
                      <TD class=font4 vAlign=top>&gt;... 真的不知該說些什麼... 
                        (有點程度的應該知道我想說的是什麼)<BR>&gt;<BR>&gt;算了, 當我沒說好了... it''s 
                        nonsense...<BR><BR>青衫兄整理這篇很有用啊,以前看WROX一本專講Windows 
                        Service的書,薄薄一本就要價1400呢<BR><BR>可以去搜尋一下那個說減少return 
                        0;仁兄以前的發言,就可以知道不需要太在意了 ...... XD 
              </TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE border=0 cellPadding=0 cellSpacing=0 width="100%">
              <TBODY>
              <TR>
                <TD bgColor=#c0c0c0>
                  <TABLE bgColor=#c0c0c0 border=0 cellPadding=0 cellSpacing=1 
                  width="100%">
                    <TBODY>
                    <TR>
                      <TD align=middle bgColor=#ffffff height=62><!--
				<A href="http://www.pentax.com.tw" target=_blank>
				<IMG src="http://www.digital.idv.tw/logo/ad-pentax-optioS.gif" align=left border=0></A> &nbsp;
				<A href="#">
	<IMG height=60 src="http://www.photosharp.com.tw/logo/ad-contax-banner1.gif" width=180 border=0></A>&nbsp;
<A href="#"><IMG height=60 src="http://www.photosharp.com.tw/logo/ad/ad-neophoto-banner1.gif" width=180 
border=0></A>	
--><!--每月主打 固定不輪播強力放送 2003/7/10--><A 
                        href="http://www.intercall.com.tw/webpartner.asp?part_id=jammy98" 
                        target=blank><IMG border=0 height=60 
                        src="Service程式的寫法.files/bgcnc.gif" width=468></A> <A 
                        href="http://www.career.com.tw/test/resume/start.asp?r_getfrom=programmer" 
                        target=_blank><IMG border=0 
                        src="Service程式的寫法.files/programmer-120ad2.gif"></A> <!--SNOOPY精品 2003/11/08--></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
            <TABLE bgColor=#e4e7ed width="100%">
              <TBODY>
              <TR width="100%">
                <TD class=C4 width="50%">作者 : <A class=fonthref 
                  href="http://www.programmer-club.com/pc2020v5/forum/ShowSameTitle.asp?URL=N&amp;board_pc2020=vc&amp;index=24&amp;id=18297&amp;mode=&amp;type_pc2020=sametitleLevel-2#" 
                  onclick="JavaScript:OpenWindows('memberdata.asp?uid=cog'); return false">Cog</A><!--人氣指數--> 
                  <SPAN class=c1>[ 貼文 75 | 人氣 0.05 | <FONT color=blue>評價</FONT> 
                  58 ]</FONT> </SPAN></TD>
                <TD align=right class=C2 width="50%"><A 
                  href="http://www.programmer-club.com/pc2020v5/forum/reply.asp?board_pc2020=vc&amp;id=18332">回應本文</A>&nbsp; 
                  <A 
                  href="http://www.programmer-club.com/pc2020v5/forum/postform.asp?board_pc2020=vc" 
                  target=_top>發表新文</A>&nbsp; <A 
                  href="javascript:GiveEva('cog',%20'vc',%20'18297',%20'18332');"><FONT 
                  color=blue>給予評價</FONT></A>&nbsp; <SPAN class=c1>10/31/2004 
                  1:35:12 AM </SPAN></TD></TR></TBODY></TABLE>
            <TABLE align=center bgColor=#ffffff width="100%">
              <TBODY>
              <TR bgColor=#ffffff>
                <TD bgColor=#ffffff class=font4 width="100%">
                  <TABLE align=center width="99%">
                    <TBODY>
                    <TR>
                      <TD align=middle vAlign=top width="1%"></TD>
                      <TD class=font4 vAlign=top>其實使用VC的專案精靈開"ATL 
                        project"，就可以很快速的建立一個service起來，<BR>實作上跟前文說是大同小異。只除了ServiceMain那一段我有不一樣的看法。<BR><BR>&gt;這邊有兩個議題, 
                        一個是Service Control Handler, 一個是新的執行緒, 前者待會再提. 
                        由於ServiceMain主要是做Service服務的初始化動作, 因此在一定時限內必須結束返回, 
                        不然會被視同Timeout失敗, 因此我們可將實際要處理的部份, 經由另一個執行緒來處理 (有需要的話, 
                        也可常駐在系統裡), 
                        如此ServiceMain的主控制權便很快地便還回給SCM.<BR><BR>檢查VC產生出來的程式碼，會發現ServiceMain會呼叫Run()去跑<FONT 
                        color=blue><B>while</B></FONT> 
                        loop<BR>loop裡面做的事就是GetMessage &amp; 
                        DispatchMessage，一直至service被中止。<BR>至於SCM等待Timeout的關鍵在SetServiceStatus(SERVICE_RUNNING)上面，<BR>如果程式一直不設定SERVICE_RUNNING，一段時間後就Timeout了。<BR>應該還不需要使用到另外一個執行緒來完成Service的動作。 
                      </TD>
                      <TD align=middle vAlign=top>
                        <TABLE align=center class=font4 valign="top"><!--include virtual="/pc2020v5/Product_Banner/AD_Learning.asp"-->
                          <TBODY></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
      <TABLE width="100%">
        <TBODY>
        <TR align=middle>
          <TD align=middle width="100%"></TD></TR>
        <TR>
          <TD width="100%">
            <TABLE align=center border=0 cellPadding=0 cellSpacing=0 class=font3 
            width="100%">
              <TBODY>
              <TR>
                <TD align=middle vAlign=center>
                  <TABLE bgColor=#c0c0c0 border=0 cellSpacing=1>
                    <TBODY>
                    <TR>
                      <TD align=middle bgColor=#ffffff><A 
                        href="http://www.intercall.com.tw/webpartner.asp?part_id=jammy98" 
                        target=blank><IMG border=0 height=60 
                        src="Service程式的寫法.files/bgitc.gif" width=468></A> <A 
                        href="http://www.career.com.tw/test/resume/start.asp?r_getfrom=programmer" 
                        target=_blank><IMG border=0 
                        src="Service程式的寫法.files/programmer-120ad2.gif"></A> 
                    </TD></TR></TBODY></TABLE></TD></TR>
              <TR bgColor=#eeeeee class=c2>
                <TD align=middle><A 
                  href="http://www.programmer-club.com/pc2020v5/">回首頁</A> | <A 
                  href="http://www.programmer-club.com/pc2020v5/diary-v3.asp">本站大事記</A> 
                  | <A 
                  href="http://www.programmer-club.com/pc2020v5/award.asp">得獎記錄</A> 
                  | <A 
                  href="http://www.programmer-club.com/pc2020v5/about.asp">站長的話</A> 
                  | <A 
                  href="http://www.programmer-club.com/pc2020v5/addhelp.asp">贊助本站</A> 
                  | <A 
                  href="http://www.programmer-club.com/pc2020v5/webemail.asp?type=1">意見信箱</A> 
                  | <A 
                  href="http://www.programmer-club.com/pc2020v5/memberlogon.asp">板主登入</A> 
                  | <A 
                  href="http://www.programmer-club.com/pc2020v5/ad.asp">廣告刊登</A> 
                </TD></TR>
              <TR>
                <TD align=middle class=c2><FONT color=#808080 f>Microsoft 
                  Internet Explorer 4.0, Screen 1024x768 pixel, High Color (16 
                  bit), Large Font.<BR>2000-2004 程式設計俱樂部 <A 
                  href="http://www.programmer-club.com/pc2020v5/webemail.asp?type=1"><FONT 
                  color=#000080>Webmaster</FONT></A></FONT> &nbsp; 
            </TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE></TD></TR></TBODY></TABLE>
<FORM action=AddEva.asp method=post name=formEv><INPUT name=authoruid 
type=hidden> <INPUT name=boardName type=hidden> <INPUT name=ParentDocId 
type=hidden> <INPUT name=DocId type=hidden> <INPUT name=mode type=hidden> 
</FORM>
<SCRIPT language=javascript>
<!--
function deldoc(url){
	var rtn;
	rtn = window.confirm('確定刪除此篇文章 ?');
	if (rtn) location.href = url;
}
//-->
</SCRIPT>
<FONT size=2>0.203125</FONT></BODY></HTML>
