<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DSACSS Operational Code: AddressClient.h Source File</title>
<link href="doxygen.css" tppabs="http://dsacss.sourceforge.net/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<h1>AddressClient.h</h1><a href="AddressClient_8h.html" tppabs="http://dsacss.sourceforge.net/AddressClient_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 
00008 <span class="preprocessor">#ifndef ADDRESS_CLIENT_H</span>
00009 <span class="preprocessor"></span><span class="preprocessor">#define ADDRESS_CLIENT_H</span>
00010 <span class="preprocessor"></span>
00011 <span class="preprocessor">#include "ace/INET_Addr.h"</span>
00012 <span class="preprocessor">#include "ace/SOCK_Dgram.h"</span>
00013 <span class="preprocessor">#include "ace/Reactor.h"</span>
00014 
00015 <span class="preprocessor">#include "ace/Synch_T.h"</span>
00016 
00017 <span class="preprocessor">#include &lt;map&gt;</span>
00018 <span class="preprocessor">#include &lt;list&gt;</span>
00019 <span class="preprocessor">#include &lt;vector&gt;</span>
00020 
00021 <span class="preprocessor">#include "<a class="code" href="ReplyQueue_8h.html" tppabs="http://dsacss.sourceforge.net/ReplyQueue_8h.html">Comm/ReplyQueue.h</a>"</span>
00022 
00023 <span class="comment">//</span>
00024 <span class="comment">// A reactor-based class that knows how to communicate with an AddressServer.</span>
00025 <span class="comment">//</span>
00026 <span class="comment">// This class is a fundamental part of the MessageClient/MessageServer scheme.</span>
00027 <span class="comment">// Message clients are user-derived classes that send and receive messages</span>
00028 <span class="comment">// on the network. Message clients carry an integer identifier that</span>
00029 <span class="comment">// determines which messages they are to receive.  Since clients can be</span>
00030 <span class="comment">// distributed over a network, a means is needed to keep track of which</span>
00031 <span class="comment">// message clients are at which IP addresses -- or more specifically which</span>
00032 <span class="comment">// IP addresses are interested in which messages.</span>
00033 <span class="comment">// An address server is an object that holds the mappings from message ID</span>
00034 <span class="comment">// to IP address (called bindings). The address server will typically</span>
00035 <span class="comment">// be located at a multicast address so it can be physically located anywhere</span>
00036 <span class="comment">// on the network.</span>
00037 <span class="comment">//</span>
00038 <span class="comment">// AddressClient is a class that manages communication with the address server.</span>
00039 <span class="comment">// Through AddressClient method calls, bindings can be queried, added or</span>
00040 <span class="comment">// removed from an address server.  A message server depends on its</span>
00041 <span class="comment">// AddressClient to route incoming and outgoing messages.</span>
00042 <span class="comment">//</span>
00043 <span class="comment">// The AddressClient class is a subclass of ACE_Event_Handler, and must</span>
00044 <span class="comment">// be registered with an ACE_Reactor to function properly.</span>
<a name="l00045"></a><a class="code" href="classAddressClient.html" tppabs="http://dsacss.sourceforge.net/classAddressClient.html">00045</a> <span class="keyword">class </span><a class="code" href="classAddressClient.html" tppabs="http://dsacss.sourceforge.net/classAddressClient.html">AddressClient</a> : <span class="keyword">public</span> ACE_Event_Handler
00046 {
00047 <span class="keyword">public</span>:
00048         <span class="comment">//</span>
00049         <span class="comment">// The data type that hold a list of IP addresses.</span>
<a name="l00050"></a><a class="code" href="classAddressClient.html#AddressClientw0" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientw0">00050</a>         <span class="keyword">typedef</span> std::vector&lt;ACE_INET_Addr&gt;                              <a class="code" href="classAddressClient.html#AddressClientw0" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientw0">AddrList_t</a>;
00051 
00052         <span class="comment">//</span>
00053         <span class="comment">// Constructor. </span>
00054         <span class="comment">// Given the IP address of the address server, this</span>
00055         <span class="comment">// method constructs an AddressClient.  The client</span>
00056         <span class="comment">// must be registered with a reactor before it will be useful,</span>
00057         <span class="comment">// however.</span>
00058         <span class="keyword">explicit</span> <a class="code" href="classAddressClient.html#AddressClienta0" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta0">AddressClient</a> (<span class="keyword">const</span> ACE_INET_Addr &amp;addrServer);
00059 
00060         <span class="comment">//</span>
00061         <span class="comment">// Destroys the AddressClient.  The client should have been</span>
00062         <span class="comment">// deregistered from its reactor (if any) before this method</span>
00063         <span class="comment">// is called.</span>
00064         <a class="code" href="classAddressClient.html#AddressClienta1" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta1">~AddressClient</a> (<span class="keywordtype">void</span>);
00065 
00066         <span class="comment">//</span>
00067         <span class="comment">// Connect this object to a reactor.</span>
00068         <span class="comment">// This must be done before any server communication is initiated.</span>
00069         <span class="comment">// Returns zero on success and -1 on failure.</span>
00070         <span class="keywordtype">int</span> <a class="code" href="classAddressClient.html#AddressClienta2" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta2">RegisterWithReactor</a>(ACE_Reactor &amp;theReactor);
00071 
00072         <span class="comment">//</span>
00073         <span class="comment">// Disconnects this object from the reactor.</span>
00074         <span class="comment">// This effectively disables the AddressClient.  This method</span>
00075         <span class="comment">// should be called before destroying the object.</span>
00076         <span class="comment">// The "immediate" flag determines whether the call should</span>
00077         <span class="comment">// return immediately or not.  If set to false, then the</span>
00078         <span class="comment">// AddressClient will attempt to remove itself from the </span>
00079         <span class="comment">// AddressServer's notification list. The "immediate" flag</span>
00080         <span class="comment">// will typically only be set if the client needs to shut</span>
00081         <span class="comment">// down quickly or if the AddressServer is shutting down as well.</span>
00082         <span class="comment">// Returns zero on success and -1 on failure.</span>
00083         <span class="keywordtype">int</span> <a class="code" href="classAddressClient.html#AddressClienta3" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta3">RemoveFromReactor</a>(ACE_Reactor &amp;theReactor, <span class="keywordtype">bool</span> immediate=<span class="keyword">false</span>);
00084 
00085         <span class="comment">//</span>
00086         <span class="comment">// Sets the amount of time a server call will wait</span>
00087         <span class="comment">// before giving up and reporting an error. A value of zero</span>
00088         <span class="comment">// means "wait forever".</span>
00089         <span class="keywordtype">void</span> <a class="code" href="classAddressClient.html#AddressClienta4" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta4">SetTimeout</a>(<span class="keyword">const</span> ACE_Time_Value &amp;tv);
00090 
00091         <span class="comment">//</span>
00092         <span class="comment">// Queries the server to see if it is responding.</span>
00093         <span class="comment">// The client will wait up to its specified timeout interval</span>
00094         <span class="comment">// before returning a failure.</span>
00095         <span class="comment">// Returns zero on success and -1 on failure.</span>
00096         <span class="keywordtype">int</span> <a class="code" href="classAddressClient.html#AddressClienta5" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta5">PingServer</a>();
00097 
00098         <span class="comment">//</span>
00099         <span class="comment">// Registers the AddressClient to be notified when the server's</span>
00100         <span class="comment">// bindings change. This is necessary to know when to invalidate</span>
00101         <span class="comment">// the AddressClient's cache. This method should be called one time</span>
00102         <span class="comment">// after the AddressClient is registered with the reactor, but before</span>
00103         <span class="comment">// any bindings are requested.</span>
00104         <span class="keywordtype">int</span> <a class="code" href="classAddressClient.html#AddressClienta6" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta6">RegisterServerCallback</a>();
00105 
00106         <span class="comment">//</span>
00107         <span class="comment">// Removes the AddressClient from the AddressServer's notification list.</span>
00108         <span class="comment">// The AddressClient will no longer be notified when the server's</span>
00109         <span class="comment">// bindings change. This method is automatically called from </span>
00110         <span class="comment">// RemoveFromReactor() unless the "immediate" flag was set.</span>
00111         <span class="comment">// Calling this method is typically a precursor to shutdown.</span>
00112         <span class="comment">// Returns zero on success and -1 on failure.</span>
00113         <span class="keywordtype">int</span> <a class="code" href="classAddressClient.html#AddressClienta7" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta7">RemoveServerCallback</a>();
00114 
00115         <span class="comment">//</span>
00116         <span class="comment">// Clears the AddressServer's notification list.</span>
00117         <span class="comment">// No AddressClient objects will be notified any longer when</span>
00118         <span class="comment">// the server's bindings change. Note that this method does not</span>
00119         <span class="comment">// notify the other AddressClients that this has happened.</span>
00120         <span class="comment">// This method would typically only be called when the AddressServer</span>
00121         <span class="comment">// is to be reset from an indeterminate state (such as after a restart)</span>
00122         <span class="comment">// and all other clients have been shut down.</span>
00123         <span class="comment">// Returns zero on success and -1 on failure.</span>
00124         <span class="keywordtype">int</span> <a class="code" href="classAddressClient.html#AddressClienta8" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta8">ClearServerCallbacks</a>();
00125 
00126         <span class="comment">//</span>
00127         <span class="comment">// Retrieves a list of IP addresses bound to a given message ID.</span>
00128         <span class="comment">// The MessageServer will call this method any time a message</span>
00129         <span class="comment">// is sent.  Messages destined for a given ID will be routed</span>
00130         <span class="comment">// to each IP address in the binding list.</span>
00131         <span class="comment">// Returns zero on success and -1 on failure.</span>
00132         <span class="keywordtype">int</span> <a class="code" href="classAddressClient.html#AddressClienta9" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta9">GetBindings</a>(u_int dest, <a class="code" href="classAddressClient.html#AddressClientw0" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientw0">AddrList_t</a> &amp;theList);
00133 
00134         <span class="comment">//</span>
00135         <span class="comment">// Adds an IP address/ID binding to the AddressServer.</span>
00136         <span class="comment">// This method is called when a MessageClient is added to the</span>
00137         <span class="comment">// MessageServer with a previously-unused ID. The AddressServer</span>
00138         <span class="comment">// will add the IP address from the binding string to its list</span>
00139         <span class="comment">// of addresses for the given ID.</span>
00140         <span class="comment">// The binding string is of standard ACE format:</span>
00141         <span class="comment">//    "&lt;hostname&gt;:&lt;port&gt;"</span>
00142         <span class="comment">// Returns zero on success and -1 on failure.</span>
00143         <span class="keywordtype">int</span> <a class="code" href="classAddressClient.html#AddressClienta10" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta10">AddBinding</a>(u_int id, <span class="keyword">const</span> <span class="keywordtype">char</span> *binding);
00144 
00145         <span class="comment">//</span>
00146         <span class="comment">// Removes an IP address/ID binding from the AddressServer.</span>
00147         <span class="comment">// This method is called when a MessageClient is removed from the</span>
00148         <span class="comment">// MessageServer and the ID is otherwise-unused. The AddressServer</span>
00149         <span class="comment">// will remove the IP address from the binding string from its list</span>
00150         <span class="comment">// of addresses for the given ID.</span>
00151         <span class="comment">// The binding string is of standard ACE format:</span>
00152         <span class="comment">//    "&lt;hostname&gt;:&lt;port&gt;"</span>
00153         <span class="comment">// Returns zero on success and -1 on failure.</span>
00154         <span class="keywordtype">int</span> <a class="code" href="classAddressClient.html#AddressClienta11" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta11">RemoveBinding</a>(u_int id, <span class="keyword">const</span> <span class="keywordtype">char</span> *binding);
00155 
00156         <span class="comment">//</span>
00157         <span class="comment">// Clears all IP address/ID bindings from the AddressServer.</span>
00158         <span class="comment">// This method would typically only be called when the AddressServer</span>
00159         <span class="comment">// is being reset from an indeterminate state (such as after a restart)</span>
00160         <span class="comment">// and no MessageClients are currently registered.</span>
00161         <span class="comment">// Returns zero on success and -1 on failure.</span>
00162         <span class="keywordtype">int</span> <a class="code" href="classAddressClient.html#AddressClienta12" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta12">ClearBindings</a>();
00163         
00164         <span class="comment">//</span>
00165         <span class="comment">// Implementation of the handle_input() method derived from</span>
00166         <span class="comment">// ACE_Event_Handler.  This method processes messages sent from the</span>
00167         <span class="comment">// address server.</span>
00168         <span class="keyword">virtual</span> <span class="keywordtype">int</span>                     <a class="code" href="classAddressClient.html#AddressClienta13" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta13">handle_input</a> (ACE_HANDLE fd);   
00169 
00170         <span class="comment">//</span>
00171         <span class="comment">// Implementation of the get_handle() method derived from</span>
00172         <span class="comment">// ACE_Event_Handler.  This method returns a handle to the AddressClient's</span>
00173         <span class="comment">// UDP socket.</span>
00174         <span class="keyword">virtual</span> ACE_HANDLE      <a class="code" href="classAddressClient.html#AddressClienta14" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClienta14">get_handle</a> (<span class="keywordtype">void</span>) <span class="keyword">const</span>;
00175 
00176 <span class="keyword">protected</span>:
00177 
00178         <span class="comment">//</span>
00179         <span class="comment">// The data structure used to hold cached bindings.</span>
<a name="l00180"></a><a class="code" href="classAddressClient.html#AddressClientx0" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientx0">00180</a>         <span class="keyword">typedef</span> std::map&lt;u_int, AddrList_t&gt;                             <a class="code" href="classAddressClient.html#AddressClientx0" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientx0">BindMap_t</a>;
00181         <span class="comment">//</span>
00182         <span class="comment">// The internal structure that holds individual binding pairs.</span>
<a name="l00183"></a><a class="code" href="classAddressClient.html#AddressClientx1" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientx1">00183</a>         <span class="keyword">typedef</span> BindMap_t::value_type                                   <a class="code" href="classAddressClient.html#AddressClientx1" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientx1">BindValue_t</a>;
00184 
00185         <span class="comment">//</span>
00186         <span class="comment">// The data type of the queue used to serialize the replies</span>
00187         <span class="comment">// expected after AddressServer commands.</span>
<a name="l00188"></a><a class="code" href="classAddressClient.html#AddressClientx2" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientx2">00188</a>         <span class="keyword">typedef</span> <a class="code" href="classReplyQueue.html" tppabs="http://dsacss.sourceforge.net/classReplyQueue.html">ReplyQueue&lt;std::string, ACE_SYNCH&gt;</a>              <a class="code" href="classReplyQueue.html" tppabs="http://dsacss.sourceforge.net/classReplyQueue.html">ReplyQueue_t</a>;
00189 
00190         <span class="comment">//</span>
00191         <span class="comment">// Sends a command to the AddressServer via UDP/IP.  Note that all</span>
00192         <span class="comment">// AddressServer commands are in the form of ASCII strings. If a reply</span>
00193         <span class="comment">// is received before the AddressClient's timeout period expires,</span>
00194         <span class="comment">// it is placed in the "reply" argument.</span>
00195         <span class="comment">// Returns zero if command was send and a reply was received within</span>
00196         <span class="comment">// the timeout period, -1 otherwise.</span>
00197         <span class="keywordtype">int</span> <a class="code" href="classAddressClient.html#AddressClientb0" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientb0">SendCommand</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, std::string &amp;reply);
00198                 
00199 <span class="keyword">private</span>:
<a name="l00200"></a><a class="code" href="classAddressClient.html#AddressClientr0" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr0">00200</a>         ACE_INET_Addr                                                                   <a class="code" href="classAddressClient.html#AddressClientr0" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr0">m_addrServer</a>;
00201 
<a name="l00202"></a><a class="code" href="classAddressClient.html#AddressClientr1" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr1">00202</a>         <span class="keywordtype">char</span>                                                                                    <a class="code" href="classAddressClient.html#AddressClientr1" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr1">m_buf</a>[BUFSIZ];
<a name="l00203"></a><a class="code" href="classAddressClient.html#AddressClientr2" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr2">00203</a>         ACE_SOCK_Dgram                                                                  <a class="code" href="classAddressClient.html#AddressClientr2" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr2">m_socket</a>;
00204 
<a name="l00205"></a><a class="code" href="classAddressClient.html#AddressClientr3" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr3">00205</a>         ACE_Thread_Mutex                                                                <a class="code" href="classAddressClient.html#AddressClientr3" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr3">m_bindingMutex</a>;
<a name="l00206"></a><a class="code" href="classAddressClient.html#AddressClientr4" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr4">00206</a>         <a class="code" href="classAddressClient.html#AddressClientx0" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientx0">BindMap_t</a>                                                                               <a class="code" href="classAddressClient.html#AddressClientr4" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr4">m_bindings</a>;
00207 
<a name="l00208"></a><a class="code" href="classAddressClient.html#AddressClientr5" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr5">00208</a>         ACE_Thread_Mutex                                                                <a class="code" href="classAddressClient.html#AddressClientr5" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr5">m_pendingReplyMutex</a>;
<a name="l00209"></a><a class="code" href="classAddressClient.html#AddressClientr6" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr6">00209</a>         <a class="code" href="classReplyQueue.html" tppabs="http://dsacss.sourceforge.net/classReplyQueue.html">ReplyQueue_t</a>                                                                    <a class="code" href="classAddressClient.html#AddressClientr6" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr6">m_pendingReplyQueue</a>;
00210 
<a name="l00211"></a><a class="code" href="classAddressClient.html#AddressClientr7" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr7">00211</a>         <span class="keywordtype">long</span>                                                                                    <a class="code" href="classAddressClient.html#AddressClientr7" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr7">m_notificationID</a>;
00212 
<a name="l00213"></a><a class="code" href="classAddressClient.html#AddressClientr8" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr8">00213</a>         ACE_Thread_Mutex                                                                <a class="code" href="classAddressClient.html#AddressClientr8" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr8">m_pingMutex</a>;
<a name="l00214"></a><a class="code" href="classAddressClient.html#AddressClientr9" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr9">00214</a>         ACE_Thread_Condition&lt;ACE_Thread_Mutex&gt;                  <a class="code" href="classAddressClient.html#AddressClientr9" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr9">m_pingCondition</a>;
00215 
<a name="l00216"></a><a class="code" href="classAddressClient.html#AddressClientr10" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr10">00216</a>         ACE_Time_Value                                                                  <a class="code" href="classAddressClient.html#AddressClientr10" tppabs="http://dsacss.sourceforge.net/classAddressClient.html#AddressClientr10">m_timeout</a>;
00217 };
00218 
00219 <span class="preprocessor">#endif // ADDRESS_CLIENT_H</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 15 11:49:53 2004 for DSACSS Operational Code by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.png" tppabs="http://dsacss.sourceforge.net/doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
