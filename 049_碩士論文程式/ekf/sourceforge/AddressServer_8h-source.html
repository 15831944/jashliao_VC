<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DSACSS Operational Code: AddressServer.h Source File</title>
<link href="doxygen.css" tppabs="http://dsacss.sourceforge.net/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<h1>AddressServer.h</h1><a href="AddressServer_8h.html" tppabs="http://dsacss.sourceforge.net/AddressServer_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 
00008 <span class="preprocessor">#ifndef ADDRESS_SERVER_H</span>
00009 <span class="preprocessor"></span><span class="preprocessor">#define ADDRESS_SERVER_H</span>
00010 <span class="preprocessor"></span>
00011 <span class="preprocessor">#include "ace/INET_Addr.h"</span>
00012 <span class="preprocessor">#include "ace/SOCK_Dgram_Mcast.h"</span>
00013 <span class="preprocessor">#include "ace/Reactor.h"</span>
00014 
00015 <span class="preprocessor">#include &lt;map&gt;</span>
00016 
00017 <span class="comment">//</span>
00018 <span class="comment">// A reactor-based class that stores and reports message ID bindings via UDP.</span>
00019 <span class="comment">//</span>
00020 <span class="comment">// This class is a fundamental part of the MessageClient/MessageServer scheme.</span>
00021 <span class="comment">// Message clients are user-derived classes that send and receive messages</span>
00022 <span class="comment">// on the network. Message clients carry an integer identifier that</span>
00023 <span class="comment">// determines which messages they are to receive.  Since clients can be</span>
00024 <span class="comment">// distributed over a network, a means is needed to keep track of which</span>
00025 <span class="comment">// message clients are at which IP addresses -- or more specifically which</span>
00026 <span class="comment">// IP addresses are interested in which messages.</span>
00027 <span class="comment">//</span>
00028 <span class="comment">// An address server is an object that holds the mappings from message ID</span>
00029 <span class="comment">// to IP address (called bindings). The address server will typically</span>
00030 <span class="comment">// be located at a multicast address so it can be relocated anywhere on</span>
00031 <span class="comment">// the network without changing its IP address.</span>
00032 <span class="comment">//</span>
00033 <span class="comment">// The AddressServer class is a subclass of ACE_Event_Handler, and must</span>
00034 <span class="comment">// be registered with an ACE_Reactor to function properly.</span>
<a name="l00035"></a><a class="code" href="classAddressServer.html" tppabs="http://dsacss.sourceforge.net/classAddressServer.html">00035</a> <span class="keyword">class </span><a class="code" href="classAddressServer.html" tppabs="http://dsacss.sourceforge.net/classAddressServer.html">AddressServer</a> : <span class="keyword">public</span> ACE_Event_Handler
00036 {
00037 <span class="keyword">public</span>:
00038         <span class="comment">//</span>
00039         <span class="comment">// Constructor. </span>
00040         <span class="comment">// Constructs an AddressServer and binds it to the specified</span>
00041         <span class="comment">// multicast address and port.</span>
00042         <span class="comment">// If an interface is specified, then the server will listen</span>
00043         <span class="comment">// on that ethernet interface only.</span>
00044         <span class="comment">// The server must be registered with a reactor before it will be</span>
00045         <span class="comment">// useful, however.</span>
00046         <span class="keyword">explicit</span> <a class="code" href="classAddressServer.html#AddressServera0" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServera0">AddressServer</a> (u_short port = ACE_DEFAULT_MULTICAST_PORT,
00047                 <span class="keyword">const</span> <span class="keywordtype">char</span> *mcast_addr = ACE_DEFAULT_MULTICAST_ADDR,
00048                 <span class="keyword">const</span> <span class="keywordtype">char</span> *mcast_iface=NULL);
00049 
00050         <span class="comment">//</span>
00051         <span class="comment">// Constructor. </span>
00052         <span class="comment">// Constructs an AddressServer and binds it to the specified</span>
00053         <span class="comment">// multicast IP address.</span>
00054         <span class="comment">// If an interface is specified, then the server will listen</span>
00055         <span class="comment">// on that ethernet interface only.</span>
00056         <span class="comment">// The server must be registered with a reactor before it will be</span>
00057         <span class="comment">// useful, however.</span>
00058         <span class="keyword">explicit</span> <a class="code" href="classAddressServer.html#AddressServera0" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServera0">AddressServer</a> (<span class="keyword">const</span> ACE_INET_Addr &amp;mcast_addr,
00059                 <span class="keyword">const</span> <span class="keywordtype">char</span> *mcast_iface=NULL);
00060 
00061         <span class="comment">//</span>
00062         <span class="comment">// Destroys the AddressServer.  The server should have been</span>
00063         <span class="comment">// deregistered from its reactor (if any) before this method</span>
00064         <span class="comment">// is called.</span>
00065         <a class="code" href="classAddressServer.html#AddressServera2" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServera2">~AddressServer</a> (<span class="keywordtype">void</span>);
00066         
00067         <span class="comment">//</span>
00068         <span class="comment">// Enables/disables loopback of multicast messages.</span>
00069         <span class="comment">// AddressClients on the same host will not be able to communicate</span>
00070         <span class="comment">// with the AddressServer unless loopback is enabled.</span>
00071         <span class="comment">// Returns 0 on success and -1 on failure.</span>
00072         <span class="keywordtype">int</span> <a class="code" href="classAddressServer.html#AddressServera3" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServera3">SetLoopbackEnable</a>(<span class="keywordtype">bool</span> enabled);
00073 
00074         <span class="comment">//</span>
00075         <span class="comment">// Sets the multicast message time to live (TTL).</span>
00076         <span class="comment">// If TTL is set to 1, then messages will only be sent on the local</span>
00077         <span class="comment">// subnet. Setting this number higher determines how many routers through</span>
00078         <span class="comment">// which multicast messages may travel.  Set this higher than one only </span>
00079         <span class="comment">// if you have clients on different subnets than the server.</span>
00080         <span class="comment">// Returns 0 on success or -1 on failure.</span>
00081         <span class="keywordtype">int</span> <a class="code" href="classAddressServer.html#AddressServera4" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServera4">SetTimeToLive</a>(u_char ttl);
00082 
00083         <span class="comment">//</span>
00084         <span class="comment">// Connect this object to a reactor.</span>
00085         <span class="comment">// The server will not receive network communication until this is called.</span>
00086         <span class="comment">// Returns zero on success and -1 on failure.</span>
00087         <span class="keywordtype">int</span> <a class="code" href="classAddressServer.html#AddressServera5" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServera5">RegisterWithReactor</a>(ACE_Reactor &amp;theReactor);
00088 
00089         <span class="comment">//</span>
00090         <span class="comment">// Disconnect this object from a reactor.</span>
00091         <span class="comment">// The server will no longer receive network communication after</span>
00092         <span class="comment">// this is called. This method should be called prior to destroying the</span>
00093         <span class="comment">// AddressServer.</span>
00094         <span class="comment">// Returns zero on success and -1 on failure.</span>
00095         <span class="keywordtype">int</span> <a class="code" href="classAddressServer.html#AddressServera6" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServera6">RemoveFromReactor</a>(ACE_Reactor &amp;theReactor);
00096 
00097         <span class="comment">//</span>
00098         <span class="comment">// Implementation of the handle_input() method derived from</span>
00099         <span class="comment">// ACE_Event_Handler.  This method processes messages sent to the address</span>
00100         <span class="comment">// server's multicast UDP socket.</span>
00101         <span class="keyword">virtual</span> <span class="keywordtype">int</span>                     <a class="code" href="classAddressServer.html#AddressServera7" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServera7">handle_input</a> (ACE_HANDLE fd);   
00102 
00103         <span class="comment">//</span>
00104         <span class="comment">// Implementation of the get_handle() method derived from</span>
00105         <span class="comment">// ACE_Event_Handler.  This method returns a handle to the AddressServer's</span>
00106         <span class="comment">// multicast UDP socket.</span>
00107         <span class="keyword">virtual</span> ACE_HANDLE      <a class="code" href="classAddressServer.html#AddressServera8" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServera8">get_handle</a> (<span class="keywordtype">void</span>) <span class="keyword">const</span>;
00108 
00109 <span class="keyword">protected</span>:
00110         <span class="comment">//</span>
00111         <span class="comment">// This method sends an ASCII string to the specified destination</span>
00112         <span class="comment">// address via UDP.</span>
00113         <span class="comment">// Returns the number of bytes sent on success and -1 on failure.</span>
00114         <span class="keywordtype">int</span> <a class="code" href="classAddressServer.html#AddressServerb0" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerb0">SendString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *str, <span class="keyword">const</span> ACE_INET_Addr &amp;dest);
00115 
00116         <span class="comment">//</span>
00117         <span class="comment">// Notifies all registered AddressClients that a global change</span>
00118         <span class="comment">// to the bindings has occured (such as a "CLEAR_BINDINGS" command).</span>
00119         <span class="comment">// Returns 0 if all clients were successfully notified, or -1</span>
00120         <span class="comment">// if any failures occurred.</span>
00121         <span class="keywordtype">int</span> <a class="code" href="classAddressServer.html#AddressServerb1" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerb1">NotifyChange</a>();
00122 
00123         <span class="comment">//</span>
00124         <span class="comment">// Notifies all registered AddressClients that the bindings for a given</span>
00125         <span class="comment">// message ID have changed (such as a "ADD" or "REMOVE" command).</span>
00126         <span class="comment">// Returns 0 if all clients were successfully notified, or -1</span>
00127         <span class="comment">// if any failures occurred.</span>
00128         <span class="keywordtype">int</span> <a class="code" href="classAddressServer.html#AddressServerb1" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerb1">NotifyChange</a>(u_int id);
00129                 
00130 <span class="keyword">private</span>:
00131         <span class="comment">//</span>
00132         <span class="comment">// The data structure type used to hold ID/address bindings.</span>
<a name="l00133"></a><a class="code" href="classAddressServer.html#AddressServery0" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServery0">00133</a>         <span class="keyword">typedef</span> std::multimap&lt;u_int, std::string&gt;       <a class="code" href="classAddressServer.html#AddressServery0" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServery0">BindMap_t</a>;
00134 
00135         <span class="comment">//</span>
00136         <span class="comment">// The internal data type of a single binding.</span>
<a name="l00137"></a><a class="code" href="classAddressServer.html#AddressServery1" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServery1">00137</a>         <span class="keyword">typedef</span> BindMap_t::value_type                           <a class="code" href="classAddressServer.html#AddressServery1" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServery1">BindValue_t</a>;
00138 
00139         <span class="comment">//</span>
00140         <span class="comment">// The data structure type used to record the AddressClient</span>
00141         <span class="comment">// notification list.</span>
<a name="l00142"></a><a class="code" href="classAddressServer.html#AddressServery2" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServery2">00142</a>         <span class="keyword">typedef</span> std::map&lt;u_int,ACE_INET_Addr&gt;           <a class="code" href="classAddressServer.html#AddressServery2" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServery2">NotificationMap_t</a>;
00143 
00144         <span class="comment">//</span>
00145         <span class="comment">// The internal data type of a single notification entry.</span>
<a name="l00146"></a><a class="code" href="classAddressServer.html#AddressServery3" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServery3">00146</a>         <span class="keyword">typedef</span> NotificationMap_t::value_type           <a class="code" href="classAddressServer.html#AddressServery3" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServery3">NotificationValue_t</a>;
00147 
<a name="l00148"></a><a class="code" href="classAddressServer.html#AddressServerr0" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr0">00148</a>         ACE_INET_Addr                                                           <a class="code" href="classAddressServer.html#AddressServerr0" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr0">m_remoteAddr</a>;
<a name="l00149"></a><a class="code" href="classAddressServer.html#AddressServerr1" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr1">00149</a>         <span class="keywordtype">char</span>                                                                            <a class="code" href="classAddressServer.html#AddressServerr1" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr1">m_buf</a>[BUFSIZ];
00150         
<a name="l00151"></a><a class="code" href="classAddressServer.html#AddressServerr2" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr2">00151</a>         ACE_SOCK_Dgram                                                          <a class="code" href="classAddressServer.html#AddressServerr2" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr2">m_replySocket</a>;
<a name="l00152"></a><a class="code" href="classAddressServer.html#AddressServerr3" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr3">00152</a>         ACE_SOCK_Dgram_Mcast                                            <a class="code" href="classAddressServer.html#AddressServerr3" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr3">m_mcastDgram</a>;
<a name="l00153"></a><a class="code" href="classAddressServer.html#AddressServerr4" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr4">00153</a>         ACE_INET_Addr                                                           <a class="code" href="classAddressServer.html#AddressServerr4" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr4">m_mcastAddr</a>;
00154 
<a name="l00155"></a><a class="code" href="classAddressServer.html#AddressServerr5" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr5">00155</a>         <a class="code" href="classAddressServer.html#AddressServery0" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServery0">BindMap_t</a>                                                                       <a class="code" href="classAddressServer.html#AddressServerr5" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr5">m_bindings</a>;
00156 
<a name="l00157"></a><a class="code" href="classAddressServer.html#AddressServerr6" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr6">00157</a>         <a class="code" href="classAddressServer.html#AddressServery2" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServery2">NotificationMap_t</a>                                                       <a class="code" href="classAddressServer.html#AddressServerr6" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr6">m_observers</a>;
<a name="l00158"></a><a class="code" href="classAddressServer.html#AddressServerr7" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr7">00158</a>         u_int                                                                           <a class="code" href="classAddressServer.html#AddressServerr7" tppabs="http://dsacss.sourceforge.net/classAddressServer.html#AddressServerr7">m_nextObserverID</a>;
00159 };
00160 
00161 
00162 
00163 <span class="preprocessor">#endif // ADDRESS_SERVER_H</span>
00164 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 15 11:49:53 2004 for DSACSS Operational Code by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.png" tppabs="http://dsacss.sourceforge.net/doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
