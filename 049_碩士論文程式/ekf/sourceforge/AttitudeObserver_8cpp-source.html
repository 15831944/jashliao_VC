<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DSACSS Operational Code: AttitudeObserver.cpp Source File</title>
<link href="doxygen.css" tppabs="http://dsacss.sourceforge.net/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<h1>AttitudeObserver.cpp</h1><a href="AttitudeObserver_8cpp.html" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 
00009 <span class="comment">/*  </span>
00010 <span class="comment">*/</span>
00012 
00013 <span class="preprocessor">#include "<a class="code" href="AttitudeObserver_8h.html" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8h.html">AttitudeObserver.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="RungeKutta_8h.html" tppabs="http://dsacss.sourceforge.net/RungeKutta_8h.html">RungeKutta.h</a>"</span>
00015 
00016 Matrix <a class="code" href="AttitudeObserver_8cpp.html#a0" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a0">Att_Fmatrix</a>(<a class="code" href="classKalmanFilter.html" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html">KalmanFilter</a>* ekf);
00017 Matrix <a class="code" href="AttitudeObserver_8cpp.html#a1" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a1">Att_Hmatrix</a>(<a class="code" href="classKalmanFilter.html" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html">KalmanFilter</a>* kf);
00018 Matrix <a class="code" href="AttitudeObserver_8cpp.html#a2" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a2">Att_Qmatrix</a>(<a class="code" href="classKalmanFilter.html" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html">KalmanFilter</a>* kf);
00019 Matrix <a class="code" href="AttitudeObserver_8cpp.html#a3" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a3">Att_Rmatrix</a>(<a class="code" href="classKalmanFilter.html" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html">KalmanFilter</a>* kf);
00020 Vector <a class="code" href="AttitudeObserver_8cpp.html#a4" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a4">Att_stateRHSFunc</a>(<span class="keywordtype">double</span> t, Vector initialState, Vector controls, Vector params);
00021 Vector <a class="code" href="AttitudeObserver_8cpp.html#a5" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a5">Att_measurementRHSFunc</a>(<a class="code" href="classExtendedKalmanFilter.html" tppabs="http://dsacss.sourceforge.net/classExtendedKalmanFilter.html">ExtendedKalmanFilter</a>* ekf);
00022 Vector <a class="code" href="AttitudeObserver_8cpp.html#a6" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a6">qdot</a>(<span class="keywordtype">double</span> time, Vector state, Vector controls, Vector params);
00023 
<a name="l00025"></a><a class="code" href="classAttitudeObserver.html#AttitudeObservera3" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObservera3">00025</a> <span class="keywordtype">int</span> <a class="code" href="classAttitudeObserver.html#AttitudeObservera3" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObservera3">AttitudeObserver::Initialize</a>() {
00026         
00028         Matrix P(3,3);
00029         P(1,1) = 0.001; P(1,2) = 0.0;   P(1,3) = 0.0;
00030         P(2,1) = 0.0;   P(2,2) = 0.001; P(2,3) = 0.0;
00031         P(3,1) = 0.0;   P(3,2) = 0.0;   P(3,3) = 0.001;
00032         Matrix K(3,3);
00033         K(1,1) = 0.001; K(1,2) = 0.0;   K(1,3) = 0.0;
00034         K(2,1) = 0.0;   K(2,2) = 0.001; K(2,3) = 0.0;
00035         K(3,1) = 0.0;   K(3,2) = 0.0;   K(3,3) = 0.001;
00036         
00037         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classKalmanFilter.html#KalmanFiltera8" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html#KalmanFiltera8">SetCovarianceMatrix</a>(P);
00038         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classKalmanFilter.html#KalmanFiltera9" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html#KalmanFiltera9">SetKalmanGainMatrix</a>(K);
00039         
00040         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classKalmanFilter.html#KalmanFiltera15" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html#KalmanFiltera15">SetSystemProcessNoiseMatrix</a>(&amp;<a class="code" href="AttitudeObserver_8cpp.html#a2" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a2">Att_Qmatrix</a>);
00041         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classKalmanFilter.html#KalmanFiltera16" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html#KalmanFiltera16">SetMeasurementCovarianceMatrix</a>(&amp;<a class="code" href="AttitudeObserver_8cpp.html#a3" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a3">Att_Rmatrix</a>);
00042         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classKalmanFilter.html#KalmanFiltera17" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html#KalmanFiltera17">SetStateJacobianMatrix</a>(&amp;<a class="code" href="AttitudeObserver_8cpp.html#a0" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a0">Att_Fmatrix</a>);
00043         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classKalmanFilter.html#KalmanFiltera18" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html#KalmanFiltera18">SetMeasurementJacobianMatrix</a>(&amp;<a class="code" href="AttitudeObserver_8cpp.html#a1" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a1">Att_Hmatrix</a>);
00044         
00045         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classExtendedKalmanFilter.html#IteratedExtendedKalmanFiltera9" tppabs="http://dsacss.sourceforge.net/classExtendedKalmanFilter.html#IteratedExtendedKalmanFiltera9">SetStateRHS</a>(&amp;<a class="code" href="AttitudeObserver_8cpp.html#a4" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a4">Att_stateRHSFunc</a>);
00046         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classExtendedKalmanFilter.html#IteratedExtendedKalmanFiltera10" tppabs="http://dsacss.sourceforge.net/classExtendedKalmanFilter.html#IteratedExtendedKalmanFiltera10">SetMeasurementRHS</a>(&amp;<a class="code" href="AttitudeObserver_8cpp.html#a5" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a5">Att_measurementRHSFunc</a>);
00047         
00048         Vector b(3);
00049         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> ii = 1; ii &lt;= 100; ii++ ) {
00050                 b(1) = b(1) + <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla15" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla15">GetRateGyro</a>(string(<span class="stringliteral">"dmu_rg1"</span>))-&gt;<a class="code" href="classSensor.html#WheelSensora3" tppabs="http://dsacss.sourceforge.net/classSensor.html#WheelSensora3">GetMeasurement</a>().<a class="code" href="classMeasurement.html#Measurementa12" tppabs="http://dsacss.sourceforge.net/classMeasurement.html#Measurementa12">GetAsDouble</a>();
00051                 b(2) = b(2) + <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla15" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla15">GetRateGyro</a>(string(<span class="stringliteral">"dmu_rg2"</span>))-&gt;<a class="code" href="classSensor.html#WheelSensora3" tppabs="http://dsacss.sourceforge.net/classSensor.html#WheelSensora3">GetMeasurement</a>().<a class="code" href="classMeasurement.html#Measurementa12" tppabs="http://dsacss.sourceforge.net/classMeasurement.html#Measurementa12">GetAsDouble</a>();
00052                 b(3) = b(3) + <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla15" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla15">GetRateGyro</a>(string(<span class="stringliteral">"dmu_rg3"</span>))-&gt;<a class="code" href="classSensor.html#WheelSensora3" tppabs="http://dsacss.sourceforge.net/classSensor.html#WheelSensora3">GetMeasurement</a>().<a class="code" href="classMeasurement.html#Measurementa12" tppabs="http://dsacss.sourceforge.net/classMeasurement.html#Measurementa12">GetAsDouble</a>();
00053         };
00054         
00055         Vector zeroVector(3);
00056         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr0" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr0">m_b</a> = zeroVector;               
00057         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr0" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr0">m_b</a> = b / 100;
00058         
00059         <span class="keywordflow">return</span> 0;
00060         
00061 };
00062 
<a name="l00064"></a><a class="code" href="classAttitudeObserver.html#AttitudeObservera4" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObservera4">00064</a> <span class="keywordtype">int</span> <a class="code" href="classAttitudeObserver.html#AttitudeObservera4" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObservera4">AttitudeObserver::Run</a>() {
00065         
00067         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr3" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr3">m_measurements</a>[0] = <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla15" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla15">GetRateGyro</a>(string(<span class="stringliteral">"dmu_rg1"</span>))-&gt;<a class="code" href="classSensor.html#WheelSensora3" tppabs="http://dsacss.sourceforge.net/classSensor.html#WheelSensora3">GetMeasurement</a>();
00068         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr3" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr3">m_measurements</a>[1] = <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla15" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla15">GetRateGyro</a>(string(<span class="stringliteral">"dmu_rg2"</span>))-&gt;<a class="code" href="classSensor.html#WheelSensora3" tppabs="http://dsacss.sourceforge.net/classSensor.html#WheelSensora3">GetMeasurement</a>();
00069         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr3" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr3">m_measurements</a>[2] = <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla15" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla15">GetRateGyro</a>(string(<span class="stringliteral">"dmu_rg3"</span>))-&gt;<a class="code" href="classSensor.html#WheelSensora3" tppabs="http://dsacss.sourceforge.net/classSensor.html#WheelSensora3">GetMeasurement</a>();
00070         Vector z(3);
00071         z(1) = <a class="code" href="classAttitudeObserver.html#AttitudeObserverr3" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr3">m_measurements</a>[0].<a class="code" href="classMeasurement.html#Measurementa12" tppabs="http://dsacss.sourceforge.net/classMeasurement.html#Measurementa12">GetAsDouble</a>() - <a class="code" href="classAttitudeObserver.html#AttitudeObserverr0" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr0">m_b</a>(1);
00072         z(2) = <a class="code" href="classAttitudeObserver.html#AttitudeObserverr3" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr3">m_measurements</a>[1].<a class="code" href="classMeasurement.html#Measurementa12" tppabs="http://dsacss.sourceforge.net/classMeasurement.html#Measurementa12">GetAsDouble</a>() - <a class="code" href="classAttitudeObserver.html#AttitudeObserverr0" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr0">m_b</a>(2);
00073         z(3) = <a class="code" href="classAttitudeObserver.html#AttitudeObserverr3" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr3">m_measurements</a>[2].<a class="code" href="classMeasurement.html#Measurementa12" tppabs="http://dsacss.sourceforge.net/classMeasurement.html#Measurementa12">GetAsDouble</a>() - <a class="code" href="classAttitudeObserver.html#AttitudeObserverr0" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr0">m_b</a>(3);
00074         
00076         timeval measurementTime, currentTime;
00077         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr3" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr3">m_measurements</a>[0].<a class="code" href="classMeasurement.html#Measurementa6" tppabs="http://dsacss.sourceforge.net/classMeasurement.html#Measurementa6">GetTime</a>(measurementTime);
00078         currentTime = <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla10" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla10">GetTimeOfEstimate</a>();
00079         <span class="keywordtype">double</span> relTimeOfMeasurement = static_cast&lt;double&gt;(measurementTime.tv_sec - currentTime.tv_sec) + (static_cast&lt;double&gt;(measurementTime.tv_usec - currentTime.tv_usec)) * 1e-6;
00080         
00081         <span class="comment">/* Begin filter code --------------------------------- */</span>
00082         
00084         Vector state   = <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla8" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla8">GetOmegaBL</a>();
00085         Vector control = <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla9" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla9">GetControl</a>();
00086         Vector params  = <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla3" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla3">GetParameter</a>();
00087         <span class="keywordtype">double</span> zero = 0.0;
00088         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classSequentialFilter.html#SequentialFiltera1" tppabs="http://dsacss.sourceforge.net/classSequentialFilter.html#SequentialFiltera1">SetTimeOfEstimate</a>(zero);             <span class="comment">// set time of the last estimate</span>
00089         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classSequentialFilter.html#SequentialFiltera2" tppabs="http://dsacss.sourceforge.net/classSequentialFilter.html#SequentialFiltera2">SetTimeOfMeasurements</a>(relTimeOfMeasurement); <span class="comment">// set time of the measurements</span>
00090         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classSequentialFilter.html#SequentialFiltera3" tppabs="http://dsacss.sourceforge.net/classSequentialFilter.html#SequentialFiltera3">SetStateVector</a>(state);                  <span class="comment">// set the state vector</span>
00091         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classSequentialFilter.html#SequentialFiltera4" tppabs="http://dsacss.sourceforge.net/classSequentialFilter.html#SequentialFiltera4">SetControlVector</a>(control);
00092         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classSequentialFilter.html#SequentialFiltera6" tppabs="http://dsacss.sourceforge.net/classSequentialFilter.html#SequentialFiltera6">SetParameterVector</a>(params);
00093         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classSequentialFilter.html#SequentialFiltera5" tppabs="http://dsacss.sourceforge.net/classSequentialFilter.html#SequentialFiltera5">SetMeasurementVector</a>(z);
00094         
00096         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classExtendedKalmanFilter.html#ExtendedKalmanFiltera7" tppabs="http://dsacss.sourceforge.net/classExtendedKalmanFilter.html#ExtendedKalmanFiltera7">EstimateState</a>();
00097         
00098         <span class="comment">/* End filter code --------------------------------- */</span>
00099         <span class="comment">// Update the global Whorl class</span>
00100         state = <a class="code" href="classAttitudeObserver.html#AttitudeObserverr1" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr1">ekf</a>.<a class="code" href="classSequentialFilter.html#SequentialFiltera10" tppabs="http://dsacss.sourceforge.net/classSequentialFilter.html#SequentialFiltera10">GetStateVector</a>();
00101         Vector fullState(7);
00102         <span class="keywordtype">int</span> numberOfSteps = 5;
00103         Vector q = <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla7" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla7">GetQuaternion</a>();
00104         fullState(_(1,4)) = <a class="code" href="RungeKutta_8h.html#a1" tppabs="http://dsacss.sourceforge.net/RungeKutta_8h.html#a1">RungeKutta</a>(q, state, control, 0.0, relTimeOfMeasurement, numberOfSteps, &amp;<a class="code" href="AttitudeObserver_8cpp.html#a6" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a6">qdot</a>);
00105         fullState(_(5,7)) = state;
00106         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla11" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla11">SetState</a>(fullState);
00107         <a class="code" href="classAttitudeObserver.html#AttitudeObserverr2" tppabs="http://dsacss.sourceforge.net/classAttitudeObserver.html#AttitudeObserverr2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla14" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla14">SetTimeOfEstimate</a>(measurementTime);
00108         
00109         <span class="keywordflow">return</span> 0;
00110         
00111 };
00112 
<a name="l00113"></a><a class="code" href="AttitudeObserver_8cpp.html#a6" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a6">00113</a> Vector <a class="code" href="AttitudeObserver_8cpp.html#a6" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a6">qdot</a>(<span class="keywordtype">double</span> time, Vector q, Vector controls, Vector w) {
00114         
00115         Matrix Q(4,3);
00116         Q(_(1,3),_(1,3)) = skew(q(_(1,3))) + q(4) * eye(3);
00117         Q(4,1) = -q(1);
00118         Q(4,2) = -q(2);
00119         Q(4,3) = -q(3);
00120         
00121         <span class="keywordflow">return</span> 0.5 * Q * w;
00122         
00123 };
00124 
<a name="l00125"></a><a class="code" href="AttitudeObserver_8cpp.html#a0" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a0">00125</a> Matrix <a class="code" href="AttitudeObserver_8cpp.html#a0" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a0">Att_Fmatrix</a>(<a class="code" href="classKalmanFilter.html" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html">KalmanFilter</a>* ekf) {
00126         
00127         Vector state  = ekf-&gt;<a class="code" href="classSequentialFilter.html#SequentialFiltera10" tppabs="http://dsacss.sourceforge.net/classSequentialFilter.html#SequentialFiltera10">GetStateVector</a>();
00128         Vector params = ekf-&gt;<a class="code" href="classSequentialFilter.html#SequentialFiltera13" tppabs="http://dsacss.sourceforge.net/classSequentialFilter.html#SequentialFiltera13">GetParameterVector</a>();
00129         
00130         Matrix MOI(3,3);
00131 
00132         MOI(1,1) = params(1); MOI(1,2) = params(2); MOI(1,3) = params(3);
00133         MOI(2,1) = params(2); MOI(2,2) = params(4); MOI(2,3) = params(5);
00134         MOI(3,1) = params(3); MOI(3,2) = params(5); MOI(3,3) = params(6);
00135         
00136         Vector w = state;
00137         
00138         Matrix temp = MOI/( -skew(w)*MOI +  skew(MOI * w) );
00139         
00140         <span class="keywordflow">return</span> temp;
00141         
00142 };
00143 
<a name="l00144"></a><a class="code" href="AttitudeObserver_8cpp.html#a1" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a1">00144</a> Matrix <a class="code" href="AttitudeObserver_8cpp.html#a1" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a1">Att_Hmatrix</a>(<a class="code" href="classKalmanFilter.html" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html">KalmanFilter</a>* kf) {
00145         
00146         Matrix temp(3,3);
00147         
00148         temp(1,1) = 1.0; temp(1,2) = 0.0; temp(1,3) = 0.0;
00149         temp(2,1) = 0.0; temp(2,2) = 1.0; temp(2,3) = 0.0;
00150         temp(3,1) = 0.0; temp(3,2) = 0.0; temp(3,3) = 1.0;
00151         
00152         <span class="keywordflow">return</span> temp;
00153         
00154 };
00155 
<a name="l00156"></a><a class="code" href="AttitudeObserver_8cpp.html#a2" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a2">00156</a> Matrix <a class="code" href="AttitudeObserver_8cpp.html#a2" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a2">Att_Qmatrix</a>(<a class="code" href="classKalmanFilter.html" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html">KalmanFilter</a>* kf) {
00157         
00158         Matrix temp(3,3);
00159         
00160         temp(1,1) = 0.0001; temp(1,2) = 0.0;   temp(1,3) = 0.0;
00161         temp(2,1) = 0.0;   temp(2,2) = 0.001; temp(2,3) = 0.0;
00162         temp(3,1) = 0.0;   temp(3,2) = 0.0;   temp(3,3) = 0.001;
00163 
00164         <span class="keywordflow">return</span> temp;
00165 
00166 };
00167 
<a name="l00168"></a><a class="code" href="AttitudeObserver_8cpp.html#a3" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a3">00168</a> Matrix <a class="code" href="AttitudeObserver_8cpp.html#a3" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a3">Att_Rmatrix</a>(<a class="code" href="classKalmanFilter.html" tppabs="http://dsacss.sourceforge.net/classKalmanFilter.html">KalmanFilter</a>* ekf) {
00169         
00170         Matrix temp(3,3);
00171         <span class="keywordtype">double</span> gyro_err = 0.005, gyro_std = gyro_err / pow(2.0, 0.5);
00172         
00173         temp(1,1) = pow(gyro_std, 2.0); temp(1,2) = 0.0;                temp(1,3) = 0.0;
00174         temp(2,1) = 0.0;                temp(2,2) = pow(gyro_std, 2.0); temp(2,3) = 0.0;
00175         temp(3,1) = 0.0;                temp(3,2) = 0.0;                temp(3,3) = pow(gyro_std, 2.0);
00176         
00177         <span class="keywordflow">return</span> temp;
00178         
00179 };
00180 
<a name="l00181"></a><a class="code" href="AttitudeObserver_8cpp.html#a4" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a4">00181</a> Vector <a class="code" href="AttitudeObserver_8cpp.html#a4" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a4">Att_stateRHSFunc</a>(<span class="keywordtype">double</span> t, Vector initialState, Vector controls, Vector params) {
00182 
00183         Vector w = initialState;
00184 
00185         Matrix MOI(3,3);
00186 
00187         MOI(1,1) = params(1); MOI(1,2) = params(2); MOI(1,3) = params(3);
00188         MOI(2,1) = params(2); MOI(2,2) = params(4); MOI(2,3) = params(5);
00189         MOI(3,1) = params(3); MOI(3,2) = params(5); MOI(3,3) = params(6);
00190         
00191         <span class="keywordflow">return</span> (MOI / ( (-skew(w) * MOI * w) + controls) );
00192         
00193 };
00194 
<a name="l00195"></a><a class="code" href="AttitudeObserver_8cpp.html#a5" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a5">00195</a> Vector <a class="code" href="AttitudeObserver_8cpp.html#a5" tppabs="http://dsacss.sourceforge.net/AttitudeObserver_8cpp.html#a5">Att_measurementRHSFunc</a>(<a class="code" href="classExtendedKalmanFilter.html" tppabs="http://dsacss.sourceforge.net/classExtendedKalmanFilter.html">ExtendedKalmanFilter</a>* ekf) { <span class="keywordflow">return</span> ekf-&gt;<a class="code" href="classSequentialFilter.html#SequentialFiltera10" tppabs="http://dsacss.sourceforge.net/classSequentialFilter.html#SequentialFiltera10">GetStateVector</a>(); };
00196 
00197 <span class="comment">// Do not change the comments below - they will be added automatically by CVS</span>
00198 <span class="comment">/*****************************************************************************</span>
00199 <span class="comment">*       $Log: AttitudeObserver.cpp,v $</span>
00200 <span class="comment">*       Revision 1.2  2003/08/27 21:55:43  simpliciter</span>
00201 <span class="comment">*       Fixed bugs in RHS and F functions.</span>
00202 <span class="comment">*       </span>
00203 <span class="comment">*       Revision 1.1  2003/08/18 19:38:37  mavandyk</span>
00204 <span class="comment">*       *** empty log message ***</span>
00205 <span class="comment">*       </span>
00206 <span class="comment">*       Revision 1.10  2003/08/13 23:18:07  mavandyk</span>
00207 <span class="comment">*       Altered structure as outline in meeting.</span>
00208 <span class="comment">*       </span>
00209 <span class="comment">*       Revision 1.9  2003/08/06 21:49:11  mavandyk</span>
00210 <span class="comment">*       Added comments fixed class structure and runs with config parsig.</span>
00211 <span class="comment">*       </span>
00212 <span class="comment">*       Revision 1.8  2003/08/01 11:21:30  mavandyk</span>
00213 <span class="comment">*       Changed class structure.</span>
00214 <span class="comment">*       </span>
00215 <span class="comment">*       Revision 1.7  2003/07/22 21:22:52  mavandyk</span>
00216 <span class="comment">*       Fixed bugs.</span>
00217 <span class="comment">*       </span>
00218 <span class="comment">*       Revision 1.6  2003/07/21 21:53:48  mavandyk</span>
00219 <span class="comment">*       Fixed some syntax errors.</span>
00220 <span class="comment">*       </span>
00221 <span class="comment">*       Revision 1.5  2003/07/14 20:06:48  mavandyk</span>
00222 <span class="comment">*       Fixed calls to Whorl class, and handling of time and measurements.</span>
00223 <span class="comment">*       </span>
00224 <span class="comment">*       Revision 1.4  2003/07/10 19:51:02  mavandyk</span>
00225 <span class="comment">*       Fixed time handling.</span>
00226 <span class="comment">*       </span>
00227 <span class="comment">*       Revision 1.3  2003/07/07 20:47:44  mavandyk</span>
00228 <span class="comment">*       Changed the state RHS function to use the skew utility function.</span>
00229 <span class="comment">*       </span>
00230 <span class="comment">*       Revision 1.2  2003/07/07 20:43:34  mavandyk</span>
00231 <span class="comment">*       Fixed the Fmatrix function with JS's derivation of the Jacobian matrix for omegadot.</span>
00232 <span class="comment">*       </span>
00233 <span class="comment">*       Revision 1.1  2003/07/04 14:12:29  simpliciter</span>
00234 <span class="comment">*       Moved from src directory.</span>
00235 <span class="comment">*       </span>
00236 <span class="comment">*       Revision 1.1  2003/07/02 21:33:42  mavandyk</span>
00237 <span class="comment">*       The observer for the demo.</span>
00238 <span class="comment">*       </span>
00239 <span class="comment">*       Revision 1.1  2003/06/30 16:06:00  nicmcp</span>
00240 <span class="comment">*       replaced the controller files with the Controller files</span>
00241 <span class="comment">*       </span>
00242 <span class="comment">*       Revision 1.3  2003/06/30 15:51:57  nicmcp</span>
00243 <span class="comment">*       made some changes to the controller files</span>
00244 <span class="comment">*       </span>
00245 <span class="comment">*       Revision 1.2  2003/06/30 14:13:35  simpliciter</span>
00246 <span class="comment">*       Modified comments, added log blocks.</span>
00247 <span class="comment">*       </span>
00248 <span class="comment">*       </span>
00249 <span class="comment">*</span>
00250 <span class="comment">******************************************************************************/</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 15 11:49:53 2004 for DSACSS Operational Code by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.png" tppabs="http://dsacss.sourceforge.net/doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
