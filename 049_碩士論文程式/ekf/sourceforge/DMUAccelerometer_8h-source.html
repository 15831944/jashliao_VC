<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DSACSS Operational Code: DMUAccelerometer.h Source File</title>
<link href="doxygen.css" tppabs="http://dsacss.sourceforge.net/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<h1>DMUAccelerometer.h</h1><a href="DMUAccelerometer_8h.html" tppabs="http://dsacss.sourceforge.net/DMUAccelerometer_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/************************************************************************************************/</span>
00012 <span class="preprocessor">#ifndef __SSSL_DMUACCELEROMETER_H__</span>
00013 <span class="preprocessor"></span><span class="preprocessor">#define __SSSL_DMUACCELEROMETER_H__</span>
00014 <span class="preprocessor"></span><span class="preprocessor">#include &lt;math.h&gt;</span>
00015 
00016 <span class="preprocessor">#include "<a class="code" href="DMU_8h.html" tppabs="http://dsacss.sourceforge.net/DMU_8h.html">DMU.h</a>"</span>
00017 <span class="preprocessor">#include "<a class="code" href="DAQCard_8h-1.html" tppabs="http://dsacss.sourceforge.net/DAQCard_8h.html">DAQCard.h</a>"</span>
00018 <span class="preprocessor">#include "<a class="code" href="Accelerometer_8h.html" tppabs="http://dsacss.sourceforge.net/Accelerometer_8h.html">Accelerometer.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="CfgParse_8h.html" tppabs="http://dsacss.sourceforge.net/CfgParse_8h.html">CfgParse.h</a>"</span>
00020 
00021 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00022 
<a name="l00023"></a><a class="code" href="classDMUAccelerometer.html" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html">00023</a> <span class="keyword">class </span><a class="code" href="classDMUAccelerometer.html" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html">DMUAccelerometer</a> : <span class="keyword">public</span> <a class="code" href="classAccelerometer.html" tppabs="http://dsacss.sourceforge.net/classAccelerometer.html">Accelerometer</a>  
00024 {
00025 <span class="keyword">public</span>:
00026         <span class="comment">// Contructors/Deconstructors</span>
00027         
<a name="l00033"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometera0" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera0">00033</a>          <a class="code" href="classDMUAccelerometer.html#DMUAccelerometera0" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera0">DMUAccelerometer</a>() {};
00034          <a class="code" href="classDMUAccelerometer.html#DMUAccelerometera0" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera0">DMUAccelerometer</a>(<span class="keyword">const</span> <a class="code" href="structcfgBody.html" tppabs="http://dsacss.sourceforge.net/structcfgBody.html">cfgBody</a>&amp; configBdy);
00035         
00036          <span class="comment">// should change to not call initialize in constructor</span>
<a name="l00037"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometera2" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera2">00037</a>          <a class="code" href="classDMUAccelerometer.html#DMUAccelerometera0" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera0">DMUAccelerometer</a>(<span class="keywordtype">int</span> _channel)
00038          { 
00039                 <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr2" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr2">m_channelID</a> = _channel;
00040                 <a class="code" href="classDMUAccelerometer.html#DMUAccelerometera4" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera4">Initialize</a>();
00041          };
00042 
<a name="l00043"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometera3" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera3">00043</a>     <a class="code" href="classDMUAccelerometer.html#DMUAccelerometera3" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera3">~DMUAccelerometer</a>() {};
00044 
<a name="l00045"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometera4" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera4">00045</a>     <span class="keywordtype">int</span> <a class="code" href="classDMUAccelerometer.html#DMUAccelerometera4" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera4">Initialize</a>()
00046     {
00047         <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr0" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr0">m_DMU</a> = <a class="code" href="classDMU.html#DMUe0" tppabs="http://dsacss.sourceforge.net/classDMU.html#DMUe0">DMU::Instance</a>(<a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr3" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr3">m_mode</a>);
00048         <span class="keywordflow">if</span> (<a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr3" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr3">m_mode</a> == 2) <span class="comment">// means analog mode, so need the daq card</span>
00049         {
00050                 <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr1" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr1">m_DAQCard</a> = <a class="code" href="classDAQCard.html#DAQCarde0" tppabs="http://dsacss.sourceforge.net/classDAQCard.html#DAQCarde0">DAQCard::Instance</a>();
00051         };
00052         <span class="keywordflow">return</span> 0;
00053     };
00054        
00055         <span class="comment">// Facilitators</span>
00056         
00057                 <span class="comment">// Inspectors</span>
00058         
<a name="l00060"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometera5" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera5">00060</a>                         <span class="keyword">inline</span> <a class="code" href="classMeasurement.html" tppabs="http://dsacss.sourceforge.net/classMeasurement.html">Measurement</a> <a class="code" href="classDMUAccelerometer.html#DMUAccelerometera5" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera5">GetMeasurement</a>() 
00061                         {
00062                                 <span class="keywordtype">double</span> accelData = 0.0;
00063                                 timeval timeStamp;
00064                                 <span class="keywordflow">switch</span>(<a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr3" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr3">m_mode</a>)
00065                                 {
00066                                         <span class="keywordflow">case</span> 1:
00067                                                 <span class="comment">// use digital mode of operation for the DMU</span>
00068                                                 <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr0" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr0">m_DMU</a>-&gt;<a class="code" href="classDMU.html#DMUa2" tppabs="http://dsacss.sourceforge.net/classDMU.html#DMUa2">GetDigitalReading</a>(<a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr2" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr2">m_channelID</a>, timeStamp, accelData);
00069                                                 <span class="keywordflow">break</span>;
00070                                         <span class="keywordflow">case</span> 2:
00071                                                 <span class="comment">// use analog mode of operation for the DMU</span>
00072                                                 <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr0" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr0">m_DMU</a>-&gt;<a class="code" href="classDMU.html#DMUa3" tppabs="http://dsacss.sourceforge.net/classDMU.html#DMUa3">GetAnalogReading</a>(<a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr2" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr2">m_channelID</a>, <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr1" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr1">m_DAQCard</a>, timeStamp, accelData);
00073 
00074                                                 <span class="comment">// Correct raw voltage using scale factor and offset.</span>
00075                                                 <span class="comment">// Note that (despite not being mentioned in the MoPak manual)</span>
00076                                                 <span class="comment">// the negative sign is needed for Low Analog operation in order</span>
00077                                                 <span class="comment">// to match the directions on the MoPak label.</span>
00078                                                 accelData = -(accelData - <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr4" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr4">m_offset</a>)/<a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr5" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr5">m_accelScaleFactor</a>;
00079                                                 <span class="comment">// accelData is now in units of g</span>
00080                                                 <span class="keywordflow">break</span>;
00081                                         <span class="keywordflow">default</span>:
00082                                                 <span class="keywordflow">break</span>;
00083                                 }
00084                                 
00085                                 <span class="comment">// Measurement is given in g's without gravity.</span>
00086                                 <span class="comment">// Restore to SI units and add in gravity.</span>
00087                                 <span class="comment">//if ( m_channelID == 6 )  </span>
00088                                 <span class="comment">//{</span>
00089                                 <span class="comment">//      accelData += -1.0;  //  here's gravity</span>
00090                                 <span class="comment">//}</span>
00091                                 
00092                                 <span class="comment">// convert from g's to m/s^2</span>
00093                                 accelData *= 9.81; 
00094 
00095                                 <span class="comment">/* NOTE!  This may not be the best (right?) way to </span>
00096 <span class="comment">                                 * re-include the effects of gravity.  I think it's</span>
00097 <span class="comment">                                 * right, but if answers seem screwy than the above </span>
00098 <span class="comment">                                 * is a good place to look.</span>
00099 <span class="comment">                                 * Also, declaring a new Vector each loop may be slow.</span>
00100 <span class="comment">                                 * Make a private data member?</span>
00101 <span class="comment">                                 */</span>
00102                                 
00103                                 <span class="comment">/* Set up measurement to return */</span>
00104                                 <a class="code" href="classMeasurement.html" tppabs="http://dsacss.sourceforge.net/classMeasurement.html">Measurement</a> accelMeasurement(accelData);
00105                                 <span class="comment">// for now...</span>
00106                                 accelMeasurement.<a class="code" href="classMeasurement.html#Measurementa5" tppabs="http://dsacss.sourceforge.net/classMeasurement.html#Measurementa5">SetTime</a>(timeStamp.tv_sec, timeStamp.tv_usec);
00107                                 <span class="keywordflow">return</span> accelMeasurement;
00108                                 
00109                         };
00110                                 
<a name="l00112"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometera6" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera6">00112</a>                         <span class="keyword">inline</span> Vector <a class="code" href="classDMUAccelerometer.html#DMUAccelerometera6" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera6">GetSensorToBodyQuaternion</a>() {     <span class="keywordflow">return</span> <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr0" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr0">m_DMU</a>-&gt;<a class="code" href="classDMU.html#DMUa5" tppabs="http://dsacss.sourceforge.net/classDMU.html#DMUa5">GetSensorToBodyQuaternion</a>(<a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr2" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr2">m_channelID</a>); };
00113                         
<a name="l00115"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometera7" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera7">00115</a>                         <span class="keyword">inline</span> Vector <a class="code" href="classDMUAccelerometer.html#DMUAccelerometera7" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera7">GetLocation</a>() { <span class="keywordflow">return</span> <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr0" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr0">m_DMU</a>-&gt;<a class="code" href="classDMU.html#DMUa4" tppabs="http://dsacss.sourceforge.net/classDMU.html#DMUa4">GetLocation</a>(); };
00116 
<a name="l00118"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometera8" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera8">00118</a>                         <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classDMUAccelerometer.html#DMUAccelerometera8" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometera8">GetMode</a>() { <span class="keywordflow">return</span> <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr3" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr3">m_mode</a>; };
00119 
00120 <span class="keyword">protected</span>:
00121         
00122 <span class="keyword">private</span>:
00123 
<a name="l00124"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr0" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr0">00124</a>         <a class="code" href="classDMU.html" tppabs="http://dsacss.sourceforge.net/classDMU.html">DMU</a>* <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr0" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr0">m_DMU</a>;      
<a name="l00126"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr1" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr1">00126</a>         <a class="code" href="classDAQCard.html" tppabs="http://dsacss.sourceforge.net/classDAQCard.html">DAQCard</a>* <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr1" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr1">m_DAQCard</a>; 
<a name="l00128"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr2" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr2">00128</a>         <span class="keywordtype">int</span>  <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr2" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr2">m_channelID</a>; 
<a name="l00129"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr3" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr3">00129</a>         <span class="keywordtype">int</span> <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr3" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr3">m_mode</a>; 
<a name="l00130"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr4" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr4">00130</a>         <span class="keywordtype">float</span> <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr4" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr4">m_offset</a>; 
<a name="l00131"></a><a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr5" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr5">00131</a>         <span class="keywordtype">float</span> <a class="code" href="classDMUAccelerometer.html#DMUAccelerometerr5" tppabs="http://dsacss.sourceforge.net/classDMUAccelerometer.html#DMUAccelerometerr5">m_accelScaleFactor</a>; 
00133 };
00134 
00135 <span class="preprocessor">#endif </span>
00136 <span class="preprocessor"></span><span class="comment">// Do not change the comments below - they will be added automatically by CVS</span>
00137 <span class="comment">/*****************************************************************************</span>
00138 <span class="comment">*       $Log: DMUAccelerometer.h,v $</span>
00139 <span class="comment">*       Revision 1.8  2004/05/27 19:07:28  shoemaker</span>
00140 <span class="comment">*       Made changes corresponding to new daq card settings and calibration methods</span>
00141 <span class="comment">*       </span>
00142 <span class="comment">*       Revision 1.7  2004/03/29 16:43:11  shoemaker</span>
00143 <span class="comment">*       Added code to work with analog DAQ card code</span>
00144 <span class="comment">*       </span>
00145 <span class="comment">*       Revision 1.6  2003/12/09 02:10:37  simpliciter</span>
00146 <span class="comment">*       Changed rate --&gt; accel in variable and function names.</span>
00147 <span class="comment">*       </span>
00148 <span class="comment">*       Revision 1.5  2003/08/18 19:14:17  mavandyk</span>
00149 <span class="comment">*       Moved funciton bodies to implementation file</span>
00150 <span class="comment">*       </span>
00151 <span class="comment">*       Revision 1.4  2003/08/01 11:23:52  mavandyk</span>
00152 <span class="comment">*       Fixed some bugs.</span>
00153 <span class="comment">*       </span>
00154 <span class="comment">*       Revision 1.4  2003/07/18 17:22:13  shoemaker</span>
00155 <span class="comment">*       Now uses Measurement class.  Still has timing and data-wasting issues.</span>
00156 <span class="comment">*       </span>
00157 <span class="comment">*       Revision 1.3  2003/07/03 16:54:50  shoemaker</span>
00158 <span class="comment">*       Added semi-working versions of DMU code</span>
00159 <span class="comment">*       </span>
00160 <span class="comment">*       Revision 1.2  2003/06/26 20:12:08  mavandyk</span>
00161 <span class="comment">*       Added code to inline functions for the calls to the DMU class.</span>
00162 <span class="comment">*       </span>
00163 <span class="comment">*       Revision 1.1  2003/06/25 21:49:23  mavandyk</span>
00164 <span class="comment">*       Alter architechture of class structure.</span>
00165 <span class="comment">*       </span>
00166 <span class="comment">*       Revision 1.1.1.1  2003/06/06 18:44:15  simpliciter</span>
00167 <span class="comment">*       Initial submission.</span>
00168 <span class="comment">*       </span>
00169 <span class="comment">*</span>
00170 <span class="comment">******************************************************************************/</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 15 11:49:54 2004 for DSACSS Operational Code by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.png" tppabs="http://dsacss.sourceforge.net/doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
