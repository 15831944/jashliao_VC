<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DSACSS Operational Code: DMURateGyro.h Source File</title>
<link href="doxygen.css" tppabs="http://dsacss.sourceforge.net/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<h1>DMURateGyro.h</h1><a href="DMURateGyro_8h.html" tppabs="http://dsacss.sourceforge.net/DMURateGyro_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/************************************************************************************************/</span>
00012 <span class="preprocessor">#ifndef __SSSL_DMURATEGYRO_H__</span>
00013 <span class="preprocessor"></span><span class="preprocessor">#define __SSSL_DMURATEGYRO_H__</span>
00014 <span class="preprocessor"></span><span class="preprocessor">#include &lt;math.h&gt;</span>
00015 <span class="preprocessor">#include &lt;string.h&gt;</span>
00016 <span class="preprocessor">#include &lt;iostream.h&gt;</span>
00017 
00018 <span class="preprocessor">#include "<a class="code" href="DMU_8h.html" tppabs="http://dsacss.sourceforge.net/DMU_8h.html">DMU.h</a>"</span>
00019 <span class="preprocessor">#include "<a class="code" href="DAQCard_8h-1.html" tppabs="http://dsacss.sourceforge.net/DAQCard_8h.html">DAQCard.h</a>"</span>
00020 <span class="preprocessor">#include "<a class="code" href="RateGyro_8h.html" tppabs="http://dsacss.sourceforge.net/RateGyro_8h.html">RateGyro.h</a>"</span>
00021 <span class="preprocessor">#include "<a class="code" href="CfgParse_8h.html" tppabs="http://dsacss.sourceforge.net/CfgParse_8h.html">CfgParse.h</a>"</span>
00022 
00023 <span class="keyword">using</span> <span class="keyword">namespace </span>std;
00024 
<a name="l00025"></a><a class="code" href="classDMURateGyro.html" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html">00025</a> <span class="keyword">class </span><a class="code" href="classDMURateGyro.html" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html">DMURateGyro</a> : <span class="keyword">public</span> <a class="code" href="classRateGyro.html" tppabs="http://dsacss.sourceforge.net/classRateGyro.html">RateGyro</a>  
00026 {
00027 <span class="keyword">public</span>:
00028         <span class="comment">// Contructors/Deconstructors</span>
00029         
<a name="l00031"></a><a class="code" href="classDMURateGyro.html#DMURateGyroa0" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa0">00031</a>         <a class="code" href="classDMURateGyro.html#DMURateGyroa0" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa0">DMURateGyro</a>() {};
00032         
<a name="l00034"></a><a class="code" href="classDMURateGyro.html#DMURateGyroa1" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa1">00034</a>         <a class="code" href="classDMURateGyro.html#DMURateGyroa0" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa0">DMURateGyro</a>(<span class="keywordtype">int</span> _channel)
00035         { 
00036                 <a class="code" href="classDMURateGyro.html#DMURateGyror2" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror2">m_channelID</a> = _channel;
00037                 <a class="code" href="classDMURateGyro.html#DMURateGyroa4" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa4">Initialize</a>();
00038         };
00039 
00041         <a class="code" href="classDMURateGyro.html#DMURateGyroa0" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa0">DMURateGyro</a>(<span class="keyword">const</span> <a class="code" href="structcfgBody.html" tppabs="http://dsacss.sourceforge.net/structcfgBody.html">cfgBody</a>&amp; configBdy);
<a name="l00042"></a><a class="code" href="classDMURateGyro.html#DMURateGyroa3" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa3">00042</a>         <a class="code" href="classDMURateGyro.html#DMURateGyroa3" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa3">~DMURateGyro</a>() {};
00043 
<a name="l00045"></a><a class="code" href="classDMURateGyro.html#DMURateGyroa4" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa4">00045</a>         <span class="keywordtype">int</span> <a class="code" href="classDMURateGyro.html#DMURateGyroa4" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa4">Initialize</a>()
00046         {
00047                 <a class="code" href="classDMURateGyro.html#DMURateGyror0" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror0">m_DMU</a> = <a class="code" href="classDMU.html#DMUe0" tppabs="http://dsacss.sourceforge.net/classDMU.html#DMUe0">DMU::Instance</a>(<a class="code" href="classDMURateGyro.html#DMURateGyror3" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror3">m_mode</a>);
00048                 <span class="keywordflow">if</span> (<a class="code" href="classDMURateGyro.html#DMURateGyror3" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror3">m_mode</a> == 2) <span class="comment">// means the analog mode, so need DAQ card</span>
00049                 {
00050                         <a class="code" href="classDMURateGyro.html#DMURateGyror1" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror1">m_DAQCard</a> = <a class="code" href="classDAQCard.html#DAQCarde0" tppabs="http://dsacss.sourceforge.net/classDAQCard.html#DAQCarde0">DAQCard::Instance</a>();
00051                         <span class="comment">//cout &lt;&lt; " DMURateGyro::Initialize() just called DAQCard::Instance() " &lt;&lt; endl;</span>
00052                 };
00053                 <span class="keywordflow">return</span> 0;
00054         }; 
00055         <span class="comment">// Facilitators</span>
00056                 <span class="comment">// Inspectors</span>
<a name="l00058"></a><a class="code" href="classDMURateGyro.html#DMURateGyroa5" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa5">00058</a> <span class="comment"></span>                        <span class="keyword">inline</span> <a class="code" href="classMeasurement.html" tppabs="http://dsacss.sourceforge.net/classMeasurement.html">Measurement</a> <a class="code" href="classDMURateGyro.html#DMURateGyroa5" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa5">GetMeasurement</a>() 
00059                         {
00060                                 <span class="keywordtype">double</span> rateData = 0.0;
00061                                 timeval timeStamp;
00062                                 <span class="keywordflow">switch</span>(<a class="code" href="classDMURateGyro.html#DMURateGyror3" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror3">m_mode</a>)
00063                                 {
00064                                         <span class="keywordflow">case</span> 1: 
00065                                                 <span class="comment">// use digital mode of operation for the DMU</span>
00066                                                 <a class="code" href="classDMURateGyro.html#DMURateGyror0" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror0">m_DMU</a>-&gt;<a class="code" href="classDMU.html#DMUa2" tppabs="http://dsacss.sourceforge.net/classDMU.html#DMUa2">GetDigitalReading</a>(<a class="code" href="classDMURateGyro.html#DMURateGyror2" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror2">m_channelID</a>, timeStamp, rateData);
00067                                                 <span class="keywordflow">break</span>;
00068                                         <span class="keywordflow">case</span> 2:
00069                                                 <span class="comment">// use analog mode of operation for the DMU, so need to </span>
00070                                                 <span class="comment">// pass pointer to DAQCard object</span>
00071                                                 <a class="code" href="classDMURateGyro.html#DMURateGyror0" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror0">m_DMU</a>-&gt;<a class="code" href="classDMU.html#DMUa3" tppabs="http://dsacss.sourceforge.net/classDMU.html#DMUa3">GetAnalogReading</a>(<a class="code" href="classDMURateGyro.html#DMURateGyror2" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror2">m_channelID</a>, <a class="code" href="classDMURateGyro.html#DMURateGyror1" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror1">m_DAQCard</a>, timeStamp, rateData);
00072                                                 
00073                                                 <span class="comment">// Correct raw voltage using scale factor and offset.</span>
00074                                                 <span class="comment">// Note that (despite not being mentioned in the MoPak manual) when </span>
00075                                                 <span class="comment">// the MoPak is used in Low Analog mode, the negative is needed to </span>
00076                                                 <span class="comment">// get directions matching the MoPak label.</span>
00077                                                 rateData = -(rateData - <a class="code" href="classDMURateGyro.html#DMURateGyror4" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror4">m_offset</a>)/<a class="code" href="classDMURateGyro.html#DMURateGyror5" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror5">m_rateScaleFactor</a>;
00078                                                 <span class="comment">// rateData is now in units of deg/s</span>
00079                                                 <span class="keywordflow">break</span>;
00080                                         <span class="keywordflow">default</span>:
00081                                                 <span class="keywordflow">break</span>;
00082                                 };
00083         
00084                                 <span class="comment">/* Convert rate data from degrees/sec to radians/sec */</span>
00085                                 rateData = rateData * M_PI/180;
00086 
00087                                 <span class="comment">/* Set up measurement to return */</span>
00088                                 <a class="code" href="classMeasurement.html" tppabs="http://dsacss.sourceforge.net/classMeasurement.html">Measurement</a> rateMeasurement(rateData);
00089                                 <span class="comment">// for now...</span>
00090                                 rateMeasurement.<a class="code" href="classMeasurement.html#Measurementa5" tppabs="http://dsacss.sourceforge.net/classMeasurement.html#Measurementa5">SetTime</a>(timeStamp.tv_sec, timeStamp.tv_usec);
00091                                 <span class="keywordflow">return</span> rateMeasurement;                         
00092                         };
00093                                 
<a name="l00095"></a><a class="code" href="classDMURateGyro.html#DMURateGyroa6" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa6">00095</a>                         <span class="keyword">inline</span> Vector <a class="code" href="classDMURateGyro.html#DMURateGyroa6" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa6">GetSensorToBodyQuaternion</a>() {     <span class="keywordflow">return</span> <a class="code" href="classDMURateGyro.html#DMURateGyror0" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror0">m_DMU</a>-&gt;<a class="code" href="classDMU.html#DMUa5" tppabs="http://dsacss.sourceforge.net/classDMU.html#DMUa5">GetSensorToBodyQuaternion</a>(<a class="code" href="classDMURateGyro.html#DMURateGyror2" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror2">m_channelID</a>); };
00096                         
<a name="l00098"></a><a class="code" href="classDMURateGyro.html#DMURateGyroa7" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa7">00098</a>                         <span class="keyword">inline</span> Vector <a class="code" href="classDMURateGyro.html#DMURateGyroa7" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa7">GetLocation</a>() { <span class="keywordflow">return</span> <a class="code" href="classDMURateGyro.html#DMURateGyror0" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror0">m_DMU</a>-&gt;<a class="code" href="classDMU.html#DMUa4" tppabs="http://dsacss.sourceforge.net/classDMU.html#DMUa4">GetLocation</a>(); };
00099 
<a name="l00101"></a><a class="code" href="classDMURateGyro.html#DMURateGyroa8" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa8">00101</a>                         <span class="keyword">inline</span> <span class="keywordtype">int</span> <a class="code" href="classDMURateGyro.html#DMURateGyroa8" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyroa8">GetMode</a>() { <span class="keywordflow">return</span> <a class="code" href="classDMURateGyro.html#DMURateGyror3" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror3">m_mode</a>; };
00102 <span class="keyword">protected</span>:
00103         
00104 <span class="keyword">private</span>:
<a name="l00105"></a><a class="code" href="classDMURateGyro.html#DMURateGyror0" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror0">00105</a>         <a class="code" href="classDMU.html" tppabs="http://dsacss.sourceforge.net/classDMU.html">DMU</a>* <a class="code" href="classDMURateGyro.html#DMURateGyror0" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror0">m_DMU</a>;      
<a name="l00106"></a><a class="code" href="classDMURateGyro.html#DMURateGyror1" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror1">00106</a>         <a class="code" href="classDAQCard.html" tppabs="http://dsacss.sourceforge.net/classDAQCard.html">DAQCard</a>* <a class="code" href="classDMURateGyro.html#DMURateGyror1" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror1">m_DAQCard</a>; 
<a name="l00108"></a><a class="code" href="classDMURateGyro.html#DMURateGyror2" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror2">00108</a>         <span class="keywordtype">int</span> <a class="code" href="classDMURateGyro.html#DMURateGyror2" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror2">m_channelID</a>; 
<a name="l00109"></a><a class="code" href="classDMURateGyro.html#DMURateGyror3" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror3">00109</a>         <span class="keywordtype">int</span> <a class="code" href="classDMURateGyro.html#DMURateGyror3" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror3">m_mode</a>; 
<a name="l00110"></a><a class="code" href="classDMURateGyro.html#DMURateGyror4" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror4">00110</a>         <span class="keywordtype">float</span> <a class="code" href="classDMURateGyro.html#DMURateGyror4" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror4">m_offset</a>; 
<a name="l00111"></a><a class="code" href="classDMURateGyro.html#DMURateGyror5" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror5">00111</a>         <span class="keywordtype">float</span> <a class="code" href="classDMURateGyro.html#DMURateGyror5" tppabs="http://dsacss.sourceforge.net/classDMURateGyro.html#DMURateGyror5">m_rateScaleFactor</a>; 
00112 };
00113 
00114 <span class="preprocessor">#endif </span>
00115 <span class="preprocessor"></span><span class="comment">// Do not change the comments below - they will be added automatically by CVS</span>
00116 <span class="comment">/*****************************************************************************</span>
00117 <span class="comment">*       $Log: DMURateGyro.h,v $</span>
00118 <span class="comment">*       Revision 1.10  2004/05/27 19:07:28  shoemaker</span>
00119 <span class="comment">*       Made changes corresponding to new daq card settings and calibration methods</span>
00120 <span class="comment">*       </span>
00121 <span class="comment">*       Revision 1.9  2004/04/11 19:33:25  shoemaker</span>
00122 <span class="comment">*       Fixed bugs in analog code and cleaned up random messages</span>
00123 <span class="comment">*       </span>
00124 <span class="comment">*       Revision 1.8  2004/04/08 06:07:08  shoemaker</span>
00125 <span class="comment">*       Added analog MoPak calibration routines</span>
00126 <span class="comment">*       </span>
00127 <span class="comment">*       Revision 1.7  2004/03/29 16:43:11  shoemaker</span>
00128 <span class="comment">*       Added code to work with analog DAQ card code</span>
00129 <span class="comment">*       </span>
00130 <span class="comment">*       Revision 1.6  2003/08/18 19:15:43  mavandyk</span>
00131 <span class="comment">*       Changed config parsing</span>
00132 <span class="comment">*       </span>
00133 <span class="comment">*       Revision 1.5  2003/08/13 23:19:53  mavandyk</span>
00134 <span class="comment">*       Fixed a few lines that had warnings.</span>
00135 <span class="comment">*       </span>
00136 <span class="comment">*       Revision 1.4  2003/07/18 17:22:13  shoemaker</span>
00137 <span class="comment">*       Now uses Measurement class.  Still has timing and data-wasting issues.</span>
00138 <span class="comment">*       </span>
00139 <span class="comment">*       Revision 1.3  2003/07/03 16:54:50  shoemaker</span>
00140 <span class="comment">*       Added semi-working versions of DMU code</span>
00141 <span class="comment">*       </span>
00142 <span class="comment">*       Revision 1.2  2003/06/26 20:12:08  mavandyk</span>
00143 <span class="comment">*       Added code to inline functions for the calls to the DMU class.</span>
00144 <span class="comment">*       </span>
00145 <span class="comment">*       Revision 1.1  2003/06/25 21:49:23  mavandyk</span>
00146 <span class="comment">*       Alter architechture of class structure.</span>
00147 <span class="comment">*       </span>
00148 <span class="comment">*       Revision 1.1.1.1  2003/06/06 18:44:15  simpliciter</span>
00149 <span class="comment">*       Initial submission.</span>
00150 <span class="comment">*       </span>
00151 <span class="comment">*</span>
00152 <span class="comment">******************************************************************************/</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 15 11:49:54 2004 for DSACSS Operational Code by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.png" tppabs="http://dsacss.sourceforge.net/doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
