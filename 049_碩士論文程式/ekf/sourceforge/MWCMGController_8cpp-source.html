<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DSACSS Operational Code: MWCMGController.cpp Source File</title>
<link href="doxygen.css" tppabs="http://dsacss.sourceforge.net/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<h1>MWCMGController.cpp</h1><a href="MWCMGController_8cpp.html" tppabs="http://dsacss.sourceforge.net/MWCMGController_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 
00008 
00010 
00011 
00012 <span class="comment">// This file implements the velocity feedback controller written by Eugene Skelton</span>
00013 
00014 <span class="preprocessor">#include "<a class="code" href="MWCMGController_8h.html" tppabs="http://dsacss.sourceforge.net/MWCMGController_8h.html">MWCMGController.h</a>"</span>
00015 <span class="preprocessor">#include "Matrix.h"</span>
00016 <span class="preprocessor">#include &lt;fstream.h&gt;</span>
00017 
<a name="l00018"></a><a class="code" href="classMWCMGController.html#MWCMGControllera4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllera4">00018</a> <span class="keywordtype">int</span> <a class="code" href="classMWCMGController.html#MWCMGControllera4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllera4">MWCMGController::Initialize</a>() {
00019         
00020         <a class="code" href="classMWCMGController.html#MWCMGControllera6" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllera6">LoadLUT</a>(<span class="stringliteral">"ReferenceMotion.txt"</span>);
00022         Matrix k(3,3);
00023         k(1,1) = 1;
00024         k(2,2) = 1;
00025         k(3,3) = 2;
00026         
00027         <a class="code" href="classMWCMGController.html#MWCMGControllerp0" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerp0">m_gainMatrix</a> = k;
00028         <a class="code" href="classController.html#SingleAxisControllerp3" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllerp3">A</a> = <a class="code" href="classController.html#SingleAxisControllera8" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllera8">FindA</a>();
00029         <a class="code" href="classController.html#SingleAxisControllerp4" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllerp4">MOI_sw</a> = <a class="code" href="classController.html#SingleAxisControllera9" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllera9">FindMOI_sw</a>();
00030         gettimeofday(&amp;<a class="code" href="classMWCMGController.html#MWCMGControllerr0" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr0">InitialTime</a>,NULL);
00031         
00032         <span class="keywordflow">return</span> 0;
00033 }
00034 
00035 ofstream <a class="code" href="MWCMGController_8cpp.html#a0" tppabs="http://dsacss.sourceforge.net/MWCMGController_8cpp.html#a0">MRPoFile</a>(<span class="stringliteral">"MRPcurrent.txt"</span>,ios::out);
00036 
00037 
00038 
00039 
<a name="l00040"></a><a class="code" href="classMWCMGController.html#MWCMGControllera3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllera3">00040</a> <span class="keywordtype">int</span> <a class="code" href="classMWCMGController.html#MWCMGControllera3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllera3">MWCMGController::Run</a>()
00041 {
00042 
00044         Vector recentOmega_BL = <a class="code" href="classController.html#SingleAxisControllerp2" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllerp2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla8" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla8">GetOmegaBL</a>();
00045         Matrix recentMOI = <a class="code" href="classController.html#SingleAxisControllerp2" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllerp2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla4" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla4">GetMOI</a>();
00046         Vector Omega_s(3);
00047         <span class="keywordtype">double</span> samplingTime;
00048         <a class="code" href="classController.html#SingleAxisControllerp2" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllerp2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla17" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla17">GetMomentumWheel</a>(<span class="stringliteral">"Wheel1"</span>)-&gt;<a class="code" href="classMomentumWheel.html#MomentumWheela16" tppabs="http://dsacss.sourceforge.net/classMomentumWheel.html#MomentumWheela16">GetWheelSpeed</a>( Omega_s(1), samplingTime );
00049         <a class="code" href="classController.html#SingleAxisControllerp2" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllerp2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla17" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla17">GetMomentumWheel</a>(<span class="stringliteral">"Wheel2"</span>)-&gt;<a class="code" href="classMomentumWheel.html#MomentumWheela16" tppabs="http://dsacss.sourceforge.net/classMomentumWheel.html#MomentumWheela16">GetWheelSpeed</a>( Omega_s(2), samplingTime );
00050         <a class="code" href="classController.html#SingleAxisControllerp2" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllerp2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla17" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla17">GetMomentumWheel</a>(<span class="stringliteral">"Wheel3"</span>)-&gt;<a class="code" href="classMomentumWheel.html#MomentumWheela16" tppabs="http://dsacss.sourceforge.net/classMomentumWheel.html#MomentumWheela16">GetWheelSpeed</a>( Omega_s(3), samplingTime );
00051 <span class="comment">//      cout&lt;&lt;"get Omega_s"&lt;&lt;Omega_s&lt;&lt;endl;</span>
00052         cout&lt;&lt;<span class="stringliteral">"Omega_BL = "</span>&lt;&lt;recentOmega_BL&lt;&lt;endl;
00053 
00054         Vector <a class="code" href="classMWCMGController.html#MWCMGControllerr6" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr6">Qcurrent</a>(4);
00055         Qcurrent = <a class="code" href="classController.html#SingleAxisControllerp2" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllerp2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla7" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla7">GetQuaternion</a>();
00056         <span class="comment">//cout&lt;&lt;"Q = "&lt;&lt;Qcurrent&lt;&lt;endl;</span>
00057         
00058         <span class="comment">//I need to convert the Current quaternion to MRPs</span>
00059         Vector <a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(3);
00060         <a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(1) = <a class="code" href="classMWCMGController.html#MWCMGControllerr6" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr6">Qcurrent</a>(1)/(1+<a class="code" href="classMWCMGController.html#MWCMGControllerr6" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr6">Qcurrent</a>(4)); 
00061         <a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(2) = <a class="code" href="classMWCMGController.html#MWCMGControllerr6" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr6">Qcurrent</a>(2)/(1+<a class="code" href="classMWCMGController.html#MWCMGControllerr6" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr6">Qcurrent</a>(4)); 
00062         <a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(3) = <a class="code" href="classMWCMGController.html#MWCMGControllerr6" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr6">Qcurrent</a>(3)/(1+<a class="code" href="classMWCMGController.html#MWCMGControllerr6" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr6">Qcurrent</a>(4)); 
00063 
00064         <span class="keywordtype">double</span> MRPnorm;
00065         MRPnorm = <a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(1)+<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(2)+<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(3);
00066                 
00067         <span class="comment">//cout&lt;&lt; "MRP^2 = "&lt;&lt;(MRPcurrent(1)*MRPcurrent(1)+MRPcurrent(2)*MRPcurrent(2)+MRPcurrent(3)*MRPcurrent(3)) &lt;&lt; endl;</span>
00068         <span class="keywordflow">if</span> (MRPnorm &gt; 1)
00069         {
00070                 <a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(1) = -<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(1)/MRPnorm;
00071                 <a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(2) = -<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(2)/MRPnorm;
00072                 <a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(3) = -<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(3)/MRPnorm; 
00073         <span class="comment">//cout&lt;&lt; "MRP^2 = "&lt;&lt;(MRPcurrent(1)*MRPcurrent(1)+MRPcurrent(2)*MRPcurrent(2)+MRPcurrent(3)*MRPcurrent(3)) &lt;&lt; endl;</span>
00074         }
00075                 
00076         <span class="comment">//cout&lt;&lt;"MRPcurrent = "&lt;&lt;MRPcurrent&lt;&lt;endl;</span>
00077         
00079         gettimeofday(&amp;<a class="code" href="classMWCMGController.html#MWCMGControllerr2" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr2">CurrentTime</a>,NULL);        <span class="comment">//this line finds the current time in the maneuver</span>
00080         
00081         <span class="keywordtype">double</span> <a class="code" href="classMWCMGController.html#MWCMGControllerr1" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr1">RunTime</a> = static_cast&lt;double&gt;(<a class="code" href="classMWCMGController.html#MWCMGControllerr2" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr2">CurrentTime</a>.tv_sec - <a class="code" href="classMWCMGController.html#MWCMGControllerr0" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr0">InitialTime</a>.tv_sec) + (static_cast&lt;double&gt;(<a class="code" href="classMWCMGController.html#MWCMGControllerr2" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr2">CurrentTime</a>.tv_usec - <a class="code" href="classMWCMGController.html#MWCMGControllerr0" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr0">InitialTime</a>.tv_usec)) * 1e-6;
00082         cout&lt;&lt;<span class="stringliteral">"RunTime = "</span>&lt;&lt;RunTime&lt;&lt;endl;
00083 
00085         <span class="keywordtype">double</span> *<a class="code" href="classMWCMGController.html#MWCMGControllerr11" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr11">myRow</a> = <a class="code" href="classMWCMGController.html#MWCMGControllera5" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllera5">tlu</a>(RunTime);   <span class="comment">//this line finds the vectors sigma,omega,and hdotref from the reference table.</span>
00086         
00087 <span class="comment">//      cout&lt;&lt;"get myRow"&lt;&lt;myRow[0]&lt;&lt;"  "&lt;&lt;myRow[1]&lt;&lt;"  "&lt;&lt;myRow[2]&lt;&lt;"  "&lt;&lt;myRow[3]&lt;&lt;"  "&lt;&lt;myRow[4]&lt;&lt;"  "&lt;&lt;myRow[5]&lt;&lt;"  "&lt;&lt;myRow[6]&lt;&lt;"  "&lt;&lt;myRow[7]&lt;&lt;"  "&lt;&lt;myRow[8]&lt;&lt;"  "&lt;&lt;myRow[9]&lt;&lt;endl;</span>
00088 <span class="comment">//      Vector MRPrefendl;</span>
00089         Vector <a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(3);
00090         <a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(1) = myRow[3];
00091         <a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(2) = myRow[4];
00092         <a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(3) = myRow[5];
00093  <span class="comment">// cout &lt;&lt; "MRPRef = "&lt;&lt;MRPRef&lt;&lt;endl;</span>
00094 
00095         Vector <a class="code" href="classMWCMGController.html#MWCMGControllerr5" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr5">omegaRef</a>(3);
00096         <a class="code" href="classMWCMGController.html#MWCMGControllerr5" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr5">omegaRef</a>(1) = myRow[0];
00097         <a class="code" href="classMWCMGController.html#MWCMGControllerr5" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr5">omegaRef</a>(2) = myRow[1];
00098         <a class="code" href="classMWCMGController.html#MWCMGControllerr5" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr5">omegaRef</a>(3) = myRow[2];
00099   <span class="comment">//cout &lt;&lt; "omegaRef"&lt;&lt;omegaRef&lt;&lt;endl;</span>
00100         
00101         Vector hdotRef(3);
00102         hdotRef(1) = myRow[6];
00103         hdotRef(2) = myRow[7];
00104         hdotRef(3) = myRow[8];
00105   <span class="comment">//cout &lt;&lt; "hdotRef = "&lt;&lt;hdotRef&lt;&lt;endl;</span>
00106         
00107         <span class="comment">//cout&lt;&lt;"set stuff from myRow"&lt;&lt;MRPRef&lt;&lt;omegaRef&lt;&lt;hdotRef&lt;&lt;endl;</span>
00109 <span class="comment"></span>        Matrix <a class="code" href="classMWCMGController.html#MWCMGControllerr7" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr7">RBR</a>(3,3);  <span class="comment">//RBR is the rotation between the body and reference frames</span>
00110         Vector <a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3);
00111         Vector <a class="code" href="classMWCMGController.html#MWCMGControllerr9" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr9">domega</a>(3);
00112         
00113         dMRP = ((1-<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(1)-<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(2)-<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(3))*MRPRef +(1-<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(1)-<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(2)-<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(3))*MRPcurrent + 2*skew(MRPcurrent)*MRPRef)/(1+(<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(1)+<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(2)+<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(3))*(<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(1)+<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(2)+<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(3))+2*<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(1)+<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(2)+<a class="code" href="classMWCMGController.html#MWCMGControllerr3" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr3">MRPcurrent</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr4" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr4">MRPRef</a>(3));
00114 
00115 cout&lt;&lt;<span class="stringliteral">"dMRP "</span> &lt;&lt; dMRP &lt;&lt; endl;
00116 
00127         <span class="comment">//Make a rotation matrix from the dMRP</span>
00128         <a class="code" href="classMWCMGController.html#MWCMGControllerr12" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr12">SIGMA</a> = 1 - (<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1) + <a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2) + <a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)); 
00129         
00130         <span class="comment">// Column 1</span>
00131         <a class="code" href="classMWCMGController.html#MWCMGControllerr7" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr7">RBR</a>(1,1) = 4*(<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1) - <a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2) - <a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)) + <a class="code" href="classMWCMGController.html#MWCMGControllerr12" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr12">SIGMA</a>*<a class="code" href="classMWCMGController.html#MWCMGControllerr12" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr12">SIGMA</a>;
00132         <a class="code" href="classMWCMGController.html#MWCMGControllerr7" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr7">RBR</a>(2,1) = 8*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1) - 4*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)*SIGMA;
00133         <a class="code" href="classMWCMGController.html#MWCMGControllerr7" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr7">RBR</a>(3,1) = 8*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1) + 4*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2)*SIGMA;
00134         <span class="comment">// Column 2</span>
00135         <a class="code" href="classMWCMGController.html#MWCMGControllerr7" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr7">RBR</a>(1,2) = 8*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2) + 4*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)*SIGMA;
00136         <a class="code" href="classMWCMGController.html#MWCMGControllerr7" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr7">RBR</a>(2,2) = 4*(-<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1) + <a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2) - <a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)) + SIGMA*SIGMA;
00137         <a class="code" href="classMWCMGController.html#MWCMGControllerr7" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr7">RBR</a>(3,2) = 8*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2) - 4*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1)*SIGMA;
00138         <span class="comment">// Column 3</span>
00139         <a class="code" href="classMWCMGController.html#MWCMGControllerr7" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr7">RBR</a>(1,3) = 8*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3) - 4*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2) * SIGMA;
00140         <a class="code" href="classMWCMGController.html#MWCMGControllerr7" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr7">RBR</a>(2,3) = 8*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3) + 4*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1)*SIGMA;
00141         <a class="code" href="classMWCMGController.html#MWCMGControllerr7" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr7">RBR</a>(3,3) = 4*(-<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1) - <a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2) + <a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)) + SIGMA*SIGMA;
00142 
00143         RBR=1/pow((1+(<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(1) + <a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(2) + <a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3)*<a class="code" href="classMWCMGController.html#MWCMGControllerr8" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr8">dMRP</a>(3))),2) * RBR;
00144 
00145         <span class="comment">//cout&lt;&lt;"RBR = "&lt;&lt; RBR &lt;&lt; endl;</span>
00146         
00147         domega = recentOmega_BL + RBR * omegaRef;
00148         cout&lt;&lt;<span class="stringliteral">"domega"</span>&lt;&lt;domega&lt;&lt;endl;
00149         
00150         <span class="comment">//Make some controller gain matricces</span>
00151         Matrix k1(3,3);  <span class="comment">//dMRP Gains</span>
00152         k1(1,1) = 1;
00153         k1(2,2) = 1;
00154         k1(3,3) = 2;
00155         
00156         Matrix k2(3,3); <span class="comment">//domega Gains</span>
00157         k2(1,1) = 1;
00158         k2(2,2) = 1;
00159         k2(3,3) = 1;
00160         
00161 
00162 
00163         
00165 <span class="comment">//      m_controlTorque =-skew(recentOmega_BL)*(recentMOI*recentOmega_BL + MOI_sw*Omega_s) - recentMOI*skew(recentOmega_BL)*domega - RBR*(hdotRef) - m_gainMatrix*domega - m_gainMatrix*dMRP;</span>
00166         <a class="code" href="classMWCMGController.html#MWCMGControllerp1" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerp1">m_controlTorque</a> = - k1*dMRP - k2*domega ;
00167         cout&lt;&lt;<span class="stringliteral">"Control Torque = "</span> &lt;&lt; <a class="code" href="classMWCMGController.html#MWCMGControllerp1" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerp1">m_controlTorque</a>&lt;&lt;endl;
00168 
00170         <a class="code" href="classController.html#SingleAxisControllerp2" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllerp2">m_whorl</a>-&gt;<a class="code" href="classWhorl.html#Whorla13" tppabs="http://dsacss.sourceforge.net/classWhorl.html#Whorla13">SetControl</a>(<a class="code" href="classMWCMGController.html#MWCMGControllerp1" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerp1">m_controlTorque</a>);
00171 
00172         <span class="comment">//hacking the controller to reject q drift</span>
00173 <span class="comment">//      m_controlTorque(1)=0;</span>
00174 <span class="comment">//      m_controlTorque(2)=0;</span>
00175 <span class="comment">//      m_controlTorque(3)=0;   </span>
00176 
00178         <span class="keywordflow">if</span> ( norm2(<a class="code" href="classMWCMGController.html#MWCMGControllerp1" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerp1">m_controlTorque</a>) &lt; 0.5 )
00179                 <a class="code" href="classController.html#SingleAxisControllera6" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllera6">SetWheelTorque</a>(<a class="code" href="classMWCMGController.html#MWCMGControllerp1" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerp1">m_controlTorque</a>); 
00180         <span class="keywordflow">else</span> {
00181         <a class="code" href="classMWCMGController.html#MWCMGControllerp1" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerp1">m_controlTorque</a> = 0.5 * ( <a class="code" href="classMWCMGController.html#MWCMGControllerp1" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerp1">m_controlTorque</a> / norm2(<a class="code" href="classMWCMGController.html#MWCMGControllerp1" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerp1">m_controlTorque</a>) );
00182         <a class="code" href="classController.html#SingleAxisControllera6" tppabs="http://dsacss.sourceforge.net/classController.html#SingleAxisControllera6">SetWheelTorque</a>(<a class="code" href="classMWCMGController.html#MWCMGControllerp1" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerp1">m_controlTorque</a>);
00183         };
00184 
00185         <span class="comment">//      MRPoFile&lt;&lt;" " &lt;&lt;MRPcurrent&lt;&lt;" ";</span>
00186 
00187         <span class="keywordflow">return</span> 0;
00188 }
00189 
00190 
00191 <span class="comment">// BUG: Will give crap data if it stops directly on the last line of data.</span>
00192 
<a name="l00193"></a><a class="code" href="classMWCMGController.html#MWCMGControllera5" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllera5">00193</a> <span class="keywordtype">double</span> *<a class="code" href="classMWCMGController.html#MWCMGControllera5" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllera5">MWCMGController::tlu</a>(<span class="keywordtype">double</span> curtime) {
00194   <span class="keywordtype">int</span> i;
00195   <span class="keywordtype">double</span> *row;
00196   <span class="keyword">const</span> <span class="keywordtype">double</span> TOL = 0.001;
00197 
00198   <span class="comment">// The table has ascending times (column 0) with a negative time to</span>
00199   <span class="comment">// mark the end of the table.</span>
00200 
00201   <span class="comment">//cout &lt;&lt; "tlu(): Debug 1\n"; cout.flush();</span>
00202   <span class="comment">// Find the time that is less than what we've been given.</span>
00203   <span class="keywordflow">for</span> (i = 0;
00204         (<a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i][0] &gt;= 0.0) &amp;&amp; (<a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i][0] &lt;= curtime) &amp;&amp; fabs(<a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i][0] - curtime) &gt; TOL;
00205         i++);
00206 
00207   <span class="comment">//cout &lt;&lt; "tlu(): Debug 2\n"; cout.flush();</span>
00208   <span class="comment">// If time on the row where we stopped is negative, we're dead,</span>
00209   <span class="comment">// because that means we ran of the end of the table.</span>
00210   <span class="keywordflow">if</span> (<a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i][0] &lt; 0.0)
00211     <span class="keywordflow">return</span> NULL;
00212 
00213   <span class="comment">// Allocate the returned array (which must be delete'd later</span>
00214   row = <span class="keyword">new</span> <span class="keywordtype">double</span>[9];
00215 
00216   <span class="comment">// If we're dead on (defined as the diff being less than TOL), we just copy</span>
00217   <span class="comment">//cout &lt;&lt; "tlu(): Debug 3\n"; cout.flush();</span>
00218   <span class="comment">//printf("Table entry (%d): %.5f   Ref Time: %.5f\n", i, lut[i][0], curtime);</span>
00219   <span class="keywordflow">if</span> (fabs(<a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i][0] - curtime) &lt; TOL) {
00220     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt;= 9; j++)
00221       row[j-1] = <a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i][j];
00222   <span class="comment">// Otherwise, we do interpolation...</span>
00223   } <span class="keywordflow">else</span> {
00224     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 1; j &lt;= 9; j++)
00225       row[j-1] = (curtime-<a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i-1][0])/(<a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i][0]-<a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i-1][0]) *
00226             (<a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i][j] - <a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i-1][j]) + <a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i-1][j];
00227   }
00228         
00229 <span class="comment">//cout&lt;&lt;"tlu(RunTime) makes myRow"&lt;&lt;row[1]&lt;&lt;endl;</span>
00230 <span class="comment">//cout &lt;&lt; "tlu(): Debug 4\n"; cout.flush();</span>
00231   <span class="comment">// Finally, return the row we've built.</span>
00232   <span class="keywordflow">return</span> row;
00233 }
00234 
00235 
<a name="l00236"></a><a class="code" href="classMWCMGController.html#MWCMGControllera6" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllera6">00236</a> <span class="keywordtype">int</span> <a class="code" href="classMWCMGController.html#MWCMGControllera6" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllera6">MWCMGController::LoadLUT</a>(<span class="keywordtype">char</span> *file) {
00237   FILE *fp;
00238   <span class="keywordtype">char</span> *line, *ptr;
00239   <span class="keywordtype">int</span> lc = 0;
00240   <span class="keyword">const</span> <span class="keywordtype">char</span> *DELIM = <span class="stringliteral">"\t"</span>;
00241   <span class="keywordtype">int</span> i,j;
00242   line = <span class="keyword">new</span> <span class="keywordtype">char</span>[1024];
00243 
00244   <span class="keywordflow">if</span> (!(fp = fopen(file, <span class="stringliteral">"r"</span>)))
00245     <span class="keywordflow">return</span> -1;
00246 
00247 <span class="comment">//  cout &lt;&lt; "Debug 1\n";</span>
00248 <span class="comment">//  cout.flush();</span>
00249   <span class="comment">// Count the number of lines in the data file</span>
00250   <span class="keywordflow">while</span> (fgets(line, 1023, fp)) lc++;
00251 <span class="comment">//  cout &lt;&lt; "Debug 1.5\n";</span>
00252 
00253   <span class="comment">// Allocate lc rows and 10 columns</span>
00254   <a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a> = (<span class="keywordtype">double</span> **)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span> *)*(lc+1));
00255   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= lc; i++)
00256     <a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i] = (<span class="keywordtype">double</span> *)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">double</span>)*10);
00257 
00258 <span class="comment">//  cout &lt;&lt; "Debug 2\n";</span>
00259   <span class="comment">// Rewind the file, and...</span>
00260   rewind(fp);
00261 
00262   <span class="comment">// Do the magic...  There's no error-checking for the right number</span>
00263   <span class="comment">// of columns.  If there aren't, we'll crap out.</span>
00264   <span class="keywordflow">for</span> (i = 0; fgets(line, 1023, fp); i++) {
00265     <span class="keywordflow">for</span> (j = 0, ptr = strtok(line, DELIM);
00266                     j &lt; 10;
00267                     j++, ptr = strtok(NULL, DELIM)) {
00268       <span class="keywordflow">if</span> (ptr)
00269         <a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i][j] = atof(ptr);
00270       <span class="keywordflow">else</span> {
00271         printf(<span class="stringliteral">"Error loading table.\n"</span>);
00272         <a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i][j] = 0.0;
00273       }
00274     }
00275 <span class="comment">//  cout &lt;&lt; "Debug loop: " &lt;&lt; i &lt;&lt; ' ' &lt;&lt; j &lt;&lt; endl;</span>
00276   }
00277 <span class="comment">//  cout &lt;&lt; "Debug 3\n";</span>
00278   <a class="code" href="classMWCMGController.html#MWCMGControllerr10" tppabs="http://dsacss.sourceforge.net/classMWCMGController.html#MWCMGControllerr10">lut</a>[i][0] = -1.0;
00279   fclose(fp);
00280   <span class="keyword">delete</span> [] line;
00281   <span class="keywordflow">return</span> 0;
00282 }
00283 
00284 <span class="comment">// Do not change the comments below - they will be added automatically by CVS</span>
00285 <span class="comment">/*****************************************************************************</span>
00286 <span class="comment">*       $Log: MWCMGController.cpp,v $</span>
00287 <span class="comment">*       Revision 1.5  2003/10/24 20:56:11  cskelton</span>
00288 <span class="comment">*       Modified for new GetWheelSpeed syntax.</span>
00289 <span class="comment">*       </span>
00290 <span class="comment">*       Revision 1.4  2003/08/21 23:32:33  cskelton</span>
00291 <span class="comment">*       It works. Lots of couts are included to aid in controller debugging. ReferenceMotion.txt has to be in the directory of the .exe with columns of time, omega,MRP,hdot. The ability to save data that the controller loop is calc-ing hs been added (see MRPoFile)</span>
00292 <span class="comment">*       </span>
00293 <span class="comment">*       Revision 1.3  2003/08/21 13:58:35  cskelton</span>
00294 <span class="comment">*       Controller updated. MRP shadow set added. TLU and LUT corrected.</span>
00295 <span class="comment">*       </span>
00296 <span class="comment">*       Revision 1.2  2003/08/15 16:12:07  cskelton</span>
00297 <span class="comment">*       *** empty log message ***</span>
00298 <span class="comment">*       </span>
00299 <span class="comment">*       Revision 1.1  2003/08/15 04:50:14  cskelton</span>
00300 <span class="comment">*       *** empty log message ***</span>
00301 <span class="comment">*       </span>
00302 <span class="comment">*       Revision 1.3  2003/08/14 18:10:41  mavandyk</span>
00303 <span class="comment">*       Added momentum wheel speed querying.</span>
00304 <span class="comment">*       </span>
00305 <span class="comment">*       Revision 1.2  2003/08/13 23:17:20  mavandyk</span>
00306 <span class="comment">*       Altered structure as outline in meeting.</span>
00307 <span class="comment">*       </span>
00308 <span class="comment">*       Revision 1.1  2003/07/31 20:43:14  mavandyk</span>
00309 <span class="comment">*       This is the default controller for Whorl.</span>
00310 <span class="comment">*       </span>
00311 <span class="comment">*       Revision 1.3  2003/07/07 14:11:24  simpliciter</span>
00312 <span class="comment">*       Removed GetWhorlObject() calls following Whorl pointers.</span>
00313 <span class="comment">*       </span>
00314 <span class="comment">*       </span>
00315 <span class="comment">*</span>
00316 <span class="comment">******************************************************************************/</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 15 11:49:54 2004 for DSACSS Operational Code by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.png" tppabs="http://dsacss.sourceforge.net/doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
