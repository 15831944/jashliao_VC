<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DSACSS Operational Code: MessageClient.cpp Source File</title>
<link href="doxygen.css" tppabs="http://dsacss.sourceforge.net/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<h1>MessageClient.cpp</h1><a href="MessageClient_8cpp.html" tppabs="http://dsacss.sourceforge.net/MessageClient_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 
00008 <span class="preprocessor">#include "<a class="code" href="MessageClient_8h.html" tppabs="http://dsacss.sourceforge.net/MessageClient_8h.html">Comm/MessageClient.h</a>"</span>
00009 
00010 
00011 
<a name="l00012"></a><a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa4" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa4">00012</a> <span class="keywordtype">int</span> <a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa4" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa4">MessageClient::Register</a>(<a class="code" href="classMessageServer.html" tppabs="http://dsacss.sourceforge.net/classMessageServer.html">MessageServer</a> *pServer)
00013 {
00014         <span class="keywordflow">if</span> (<a class="code" href="classMessageClient.html#MessageClientr1" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr1">m_pServer</a> != NULL)
00015         {
00016                 ACE_ERROR_RETURN((LM_ERROR,
00017                         <span class="stringliteral">"(%N:%l) Attempt register a message client twice.\n"</span>),
00018                         -1);
00019         }
00020         
00021         <span class="keywordtype">int</span> retVal = pServer-&gt;<a class="code" href="classMessageServer.html#MessageServerb0" tppabs="http://dsacss.sourceforge.net/classMessageServer.html#MessageServerb0">RegisterClient</a>(<a class="code" href="classMessageClient.html#MessageClientr0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr0">m_id</a>, <span class="keyword">this</span>);
00022                 
00023         <span class="keywordflow">return</span> retVal;
00024 }
00025 
00026 
00027 
<a name="l00028"></a><a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa5" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa5">00028</a> <span class="keywordtype">int</span> <a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa5" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa5">MessageClient::Deregister</a>()
00029 {
00030         <span class="keywordflow">if</span> (<a class="code" href="classMessageClient.html#MessageClientr1" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr1">m_pServer</a> == NULL)
00031                 <span class="keywordflow">return</span> -1;
00032         
00033         <span class="keywordtype">int</span> retVal = <a class="code" href="classMessageClient.html#MessageClientr1" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr1">m_pServer</a>-&gt;<a class="code" href="classMessageServer.html#MessageServerb1" tppabs="http://dsacss.sourceforge.net/classMessageServer.html#MessageServerb1">RemoveClient</a>(<a class="code" href="classMessageClient.html#MessageClientr0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr0">m_id</a>, <span class="keyword">this</span>);
00034                 
00035         <span class="keywordflow">return</span> retVal;
00036 }
00037 
00038 
00039 
00040 <span class="comment">//</span>
00041 <span class="comment">// Constructs a multi-message client.</span>
<a name="l00042"></a><a class="code" href="classMultiMessageClient.html#MultiMessageClienta0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta0">00042</a> <a class="code" href="classMultiMessageClient.html#MultiMessageClienta0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta0">MultiMessageClient::MultiMessageClient</a>(u_int *id, u_int numIDs)
00043         : m_numChildren(numIDs)
00044 {
00045         <a class="code" href="classMultiMessageClient.html#MultiMessageClientr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr0">m_ppChildren</a> = <span class="keyword">new</span> <a class="code" href="classMultiMessageClient_1_1MC.html" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html">MC</a> *[<a class="code" href="classMultiMessageClient.html#MultiMessageClientr1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr1">m_numChildren</a>];
00046 
00047         <span class="keywordflow">for</span> (u_int i = 0; i &lt; <a class="code" href="classMultiMessageClient.html#MultiMessageClientr1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr1">m_numChildren</a>; ++i)
00048         {
00049                 <a class="code" href="classMultiMessageClient.html#MultiMessageClientr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr0">m_ppChildren</a>[i] = <span class="keyword">new</span> MC(id[i], <span class="keyword">this</span>);
00050         }
00051 }
00052 
00053 <span class="comment">//</span>
00054 <span class="comment">// Virtual destructor for the multi-message client.</span>
<a name="l00055"></a><a class="code" href="classMultiMessageClient.html#MultiMessageClienta1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta1">00055</a> <a class="code" href="classMultiMessageClient.html#MultiMessageClienta1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta1">MultiMessageClient::~MultiMessageClient</a>()
00056 {
00057         <span class="keywordflow">for</span> (u_int i = 0; i &lt; <a class="code" href="classMultiMessageClient.html#MultiMessageClientr1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr1">m_numChildren</a>; ++i)
00058         {
00059                 <span class="keyword">delete</span> <a class="code" href="classMultiMessageClient.html#MultiMessageClientr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr0">m_ppChildren</a>[i];
00060         }
00061 
00062         <span class="keyword">delete</span> [] <a class="code" href="classMultiMessageClient.html#MultiMessageClientr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr0">m_ppChildren</a>;
00063 }
00064 
00065 
00066 <span class="comment">//</span>
00067 <span class="comment">// If registered with a message server with the given origination ID,</span>
00068 <span class="comment">// this method sends a message to another client.</span>
00069 <span class="comment">// It returns -1 on error and the number of bytes sent on success.</span>
<a name="l00070"></a><a class="code" href="classMultiMessageClient.html#MultiMessageClienta3" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta3">00070</a> <span class="keywordtype">int</span> <a class="code" href="classMultiMessageClient.html#MultiMessageClienta3" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta3">MultiMessageClient::SendMessage</a>(u_int originator, <span class="keyword">const</span> <span class="keywordtype">void</span> *msg, size_t len, u_int dest)
00071 {
00072         <span class="keywordflow">for</span> (u_int i = 0; i &lt; <a class="code" href="classMultiMessageClient.html#MultiMessageClientr1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr1">m_numChildren</a>; ++i)
00073         {
00074                 <span class="keywordflow">if</span> (<a class="code" href="classMultiMessageClient.html#MultiMessageClientr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr0">m_ppChildren</a>[i]-&gt;<a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa3" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa3">id</a>() == originator)
00075                 {
00076                         <span class="keywordflow">return</span> <a class="code" href="classMultiMessageClient.html#MultiMessageClientr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr0">m_ppChildren</a>[i]-&gt;<a class="code" href="classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa1">SendMessage</a>(msg, len, dest);
00077                 }
00078         }
00079 
00080         ACE_ERROR_RETURN((LM_ERROR,
00081                 <span class="stringliteral">"(%N:%l) Attempt to send a message with ID for which the client"</span>
00082                 <span class="stringliteral">" is not registered.\n"</span>),
00083                 -1);
00084 }
00085 
00086 <span class="comment">//</span>
00087 <span class="comment">// Registers this client with a message server.</span>
00088 <span class="comment">// Returns 0 if all IDs successfully register and -1 on any failure.</span>
<a name="l00089"></a><a class="code" href="classMultiMessageClient.html#MultiMessageClienta4" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta4">00089</a> <span class="keywordtype">int</span> <a class="code" href="classMultiMessageClient.html#MultiMessageClienta4" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta4">MultiMessageClient::Register</a>(<a class="code" href="classMessageServer.html" tppabs="http://dsacss.sourceforge.net/classMessageServer.html">MessageServer</a> *pServer)
00090 {
00091         <span class="keywordtype">int</span> retVal = 0;
00092 
00093         <span class="keywordflow">for</span> (u_int i = 0; i &lt; <a class="code" href="classMultiMessageClient.html#MultiMessageClientr1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr1">m_numChildren</a>; ++i)
00094         {
00095                 <span class="keywordflow">if</span> (<a class="code" href="classMultiMessageClient.html#MultiMessageClientr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr0">m_ppChildren</a>[i]-&gt;<a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa4" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa4">Register</a>(pServer) == -1)
00096                 {
00097                         retVal = -1;
00098                 }
00099         }
00100 
00101         <span class="keywordflow">return</span> -1;
00102 }
00103 
00104 <span class="comment">//</span>
00105 <span class="comment">// Deregisters this client with its message server.</span>
00106 <span class="comment">// Returns 0 if all IDs successfully deregister and -1 on any failure.</span>
<a name="l00107"></a><a class="code" href="classMultiMessageClient.html#MultiMessageClienta5" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta5">00107</a> <span class="keywordtype">int</span> <a class="code" href="classMultiMessageClient.html#MultiMessageClienta5" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta5">MultiMessageClient::Deregister</a>()
00108 {
00109         <span class="keywordtype">int</span> retVal = 0;
00110 
00111         <span class="keywordflow">for</span> (u_int i = 0; i &lt; <a class="code" href="classMultiMessageClient.html#MultiMessageClientr1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr1">m_numChildren</a>; ++i)
00112         {
00113                 <span class="keywordflow">if</span> (<a class="code" href="classMultiMessageClient.html#MultiMessageClientr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr0">m_ppChildren</a>[i]-&gt;<a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa5" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa5">Deregister</a>() == -1)
00114                 {
00115                         retVal = -1;
00116                 }
00117         }
00118 
00119         <span class="keywordflow">return</span> -1;
00120 }
00121 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 15 11:49:54 2004 for DSACSS Operational Code by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.png" tppabs="http://dsacss.sourceforge.net/doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
