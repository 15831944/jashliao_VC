<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DSACSS Operational Code: MessageClient.h Source File</title>
<link href="doxygen.css" tppabs="http://dsacss.sourceforge.net/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<h1>MessageClient.h</h1><a href="MessageClient_8h.html" tppabs="http://dsacss.sourceforge.net/MessageClient_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 
00008 <span class="preprocessor">#ifndef MESSAGE_CLIENT_H</span>
00009 <span class="preprocessor"></span><span class="preprocessor">#define MESSAGE_CLIENT_H</span>
00010 <span class="preprocessor"></span>
00011 <span class="preprocessor">#include "<a class="code" href="MessageServer_8h.html" tppabs="http://dsacss.sourceforge.net/MessageServer_8h.html">Comm/MessageServer.h</a>"</span>
00012 
00013 <span class="comment">//</span>
00014 <span class="comment">// This is the base class for consumers of network messages.</span>
00015 <span class="comment">//</span>
00016 <span class="comment">// Users of this class must perform the following:</span>
00017 <span class="comment">// 1) Implement the ReceiveMessage() method in their derived class.</span>
00018 <span class="comment">// 2) Supply a client ID at construction time.</span>
00019 <span class="comment">// 3) Call Register() with a pointer to a valid MessageServer.</span>
00020 <span class="comment">//</span>
00021 <span class="comment">// As long as the message server keeps running, any messages sent</span>
00022 <span class="comment">// to the specified client ID will be presented to the client.</span>
00023 <span class="comment">// If the client returns (-1) from ReceiveMessage(), the server</span>
00024 <span class="comment">// will deregister the client and it will no longer receive messages.</span>
<a name="l00025"></a><a class="code" href="classMessageClient.html" tppabs="http://dsacss.sourceforge.net/classMessageClient.html">00025</a> <span class="keyword">class </span><a class="code" href="classMessageClient.html" tppabs="http://dsacss.sourceforge.net/classMessageClient.html">MessageClient</a>
00026 {
00027 <span class="keyword">public</span>:
00028         <span class="comment">//</span>
00029         <span class="comment">// Note that the MessageServer class has control of the m_pServer</span>
00030         <span class="comment">// member.</span>
<a name="l00031"></a><a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCn0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCn0">00031</a>         <span class="keyword">friend</span> <span class="keyword">class </span><a class="code" href="classMessageServer.html" tppabs="http://dsacss.sourceforge.net/classMessageServer.html">MessageServer</a>;
00032 
00033         <span class="comment">//</span>
00034         <span class="comment">// Constructs a MessageClient.  The derived class must supply</span>
00035         <span class="comment">// a client identifier at the time of construction.</span>
<a name="l00036"></a><a class="code" href="classMessageClient.html#MessageClienta0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClienta0">00036</a>         <a class="code" href="classMessageClient.html#MessageClienta0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClienta0">MessageClient</a>(u_int id) : <a class="code" href="classMessageClient.html#MessageClientr0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr0">m_id</a>(<a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa3" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa3">id</a>), <a class="code" href="classMessageClient.html#MessageClientr1" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr1">m_pServer</a>(NULL) {}
00037 
00038         <span class="comment">//</span>
00039         <span class="comment">// Virtual destructor. Default behavior is to deregister</span>
00040         <span class="comment">// with the message server (if any).</span>
<a name="l00041"></a><a class="code" href="classMessageClient.html#MessageClienta1" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClienta1">00041</a>         <span class="keyword">virtual</span> <a class="code" href="classMessageClient.html#MessageClienta1" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClienta1">~MessageClient</a>()
00042         {
00043                 <span class="keywordflow">if</span> (<a class="code" href="classMessageClient.html#MessageClientr1" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr1">m_pServer</a> != NULL)
00044                         <a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa5" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa5">Deregister</a>();
00045         }
00046 
00047 
00048         <span class="comment">//</span>
00049         <span class="comment">// Returns the identifier for this client.  The identifier was</span>
00050         <span class="comment">// specified at construction time.</span>
<a name="l00051"></a><a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa3" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa3">00051</a>         u_int <a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa3" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa3">id</a>()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> <a class="code" href="classMessageClient.html#MessageClientr0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr0">m_id</a>; }
00052 
00053 
00054         <span class="comment">//</span>
00055         <span class="comment">// Handles an incoming message. The derived class must implement</span>
00056         <span class="comment">// this pure-virtual method.</span>
00057         <span class="comment">// Note that if this method returns a -1, the server will</span>
00058         <span class="comment">// automatically deregister this client for the given ID.</span>
00059         <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classMessageClient.html#MessageClienta3" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClienta3">ReceiveMessage</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg, size_t len) = 0;
00060 
00061         <span class="comment">//</span>
00062         <span class="comment">// Registers this client with a message server.</span>
00063         <span class="comment">// Returns 0 on success and -1 on failure.</span>
00064         <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa4" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa4">Register</a>(<a class="code" href="classMessageServer.html" tppabs="http://dsacss.sourceforge.net/classMessageServer.html">MessageServer</a> *pServer);
00065 
00066         <span class="comment">//</span>
00067         <span class="comment">// Deregisters this client with its message server.</span>
00068         <span class="comment">// Returns 0 on success and -1 on failure.</span>
00069         <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa5" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa5">Deregister</a>();
00070 
00071 <span class="keyword">protected</span>:
00072         <span class="comment">//</span>
00073         <span class="comment">// If registered with a message server, this method</span>
00074         <span class="comment">// sends a message to another client. </span>
00075         <span class="comment">// It returns -1 on error and the number of bytes sent on success.</span>
<a name="l00076"></a><a class="code" href="classMessageClient.html#MessageClientb0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientb0">00076</a>         <span class="keywordtype">int</span> <a class="code" href="classMessageClient.html#MessageClientb0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientb0">SendMessage</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *msg, size_t len, u_int dest)
00077         {
00078                 <span class="keywordflow">if</span> (<a class="code" href="classMessageClient.html#MessageClientr1" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr1">m_pServer</a> == NULL)
00079                 {
00080                         ACE_ERROR_RETURN((LM_ERROR,
00081                                 <span class="stringliteral">"(%N:%l) Attempt to send a message from an unregistered "</span>
00082                                 <span class="stringliteral">"message client.\n"</span>),-1);
00083                 }
00084 
00085                 <span class="keywordflow">return</span> <a class="code" href="classMessageClient.html#MessageClientr1" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr1">m_pServer</a>-&gt;<a class="code" href="classMessageServer.html#MessageServera8" tppabs="http://dsacss.sourceforge.net/classMessageServer.html#MessageServera8">SendMessage</a>(<a class="code" href="classMessageClient.html#MessageClientr0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr0">m_id</a>, msg, len, dest);
00086         }
00087 
00088         <span class="comment">//</span>
00089         <span class="comment">// Returns a pointer to the client's message server.</span>
00090         <span class="comment">// If not registered, this method returns NULL.</span>
<a name="l00091"></a><a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCb0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCb0">00091</a>         <a class="code" href="classMessageServer.html" tppabs="http://dsacss.sourceforge.net/classMessageServer.html">MessageServer</a> * <a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCb0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCb0">Server</a>() { <span class="keywordflow">return</span> <a class="code" href="classMessageClient.html#MessageClientr1" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr1">m_pServer</a>; }
00092 
00093 <span class="keyword">private</span>:
00094         <span class="comment">//</span>
00095         <span class="comment">// The identifier by which this client is known.</span>
<a name="l00096"></a><a class="code" href="classMessageClient.html#MessageClientr0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr0">00096</a>         <span class="keyword">const</span> u_int             <a class="code" href="classMessageClient.html#MessageClientr0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr0">m_id</a>;
00097 
00098         <span class="comment">//</span>
00099         <span class="comment">// The server with which this client is registered.</span>
00100         <span class="comment">// NOTE: This member is set and cleared exclusively by the</span>
00101         <span class="comment">// server class itself.  This class should not change this member.</span>
<a name="l00102"></a><a class="code" href="classMessageClient.html#MessageClientr1" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr1">00102</a>         <a class="code" href="classMessageServer.html" tppabs="http://dsacss.sourceforge.net/classMessageServer.html">MessageServer</a> * <a class="code" href="classMessageClient.html#MessageClientr1" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientr1">m_pServer</a>;
00103 };
00104 
00105 
00106 
00107 <span class="comment">//</span>
00108 <span class="comment">// This is a base class for clients that wish to handle messages</span>
00109 <span class="comment">// to many client IDs from a single object.</span>
<a name="l00110"></a><a class="code" href="classMultiMessageClient.html" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html">00110</a> <span class="keyword">class </span><a class="code" href="classMultiMessageClient.html" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html">MultiMessageClient</a>
00111 {
00112 <span class="keyword">public</span>:
00113         <span class="comment">//</span>
00114         <span class="comment">// Constructs a multi-message client.</span>
00115         <a class="code" href="classMultiMessageClient.html#MultiMessageClienta0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta0">MultiMessageClient</a>(u_int *id, u_int numIDs);
00116 
00117         <span class="comment">//</span>
00118         <span class="comment">// Virtual destructor for the multi-message client.</span>
00119         <span class="keyword">virtual</span> <a class="code" href="classMultiMessageClient.html#MultiMessageClienta1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta1">~MultiMessageClient</a>();
00120 
00121         <span class="comment">//</span>
00122         <span class="comment">// This pure virtual method is called any time a message is received</span>
00123         <span class="comment">// for any of the registered IDs.</span>
00124         <span class="comment">// NOTE: if this method returns -1, then the client is deregistered</span>
00125         <span class="comment">// for the specific ID for which this method was called.</span>
00126         <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classMultiMessageClient.html#MultiMessageClienta2" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta2">ReceiveMessage</a>(u_int destinationID,
00127                 <span class="keyword">const</span> <span class="keywordtype">char</span> *msg, size_t len) = 0;
00128 
00129         <span class="comment">//</span>
00130         <span class="comment">// If registered with a message server with the given origination ID,</span>
00131         <span class="comment">// this method sends a message to another client.</span>
00132         <span class="comment">// It returns -1 on error and the number of bytes sent on success.</span>
00133         <span class="keywordtype">int</span> <a class="code" href="classMultiMessageClient.html#MultiMessageClienta3" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta3">SendMessage</a>(u_int originator, <span class="keyword">const</span> <span class="keywordtype">void</span> *msg, size_t len, u_int dest);
00134 
00135         <span class="comment">//</span>
00136         <span class="comment">// Registers this client with a message server.</span>
00137         <span class="comment">// Returns 0 if all IDs successfully register and -1 on any failure.</span>
00138         <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classMultiMessageClient.html#MultiMessageClienta4" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta4">Register</a>(<a class="code" href="classMessageServer.html" tppabs="http://dsacss.sourceforge.net/classMessageServer.html">MessageServer</a> *pServer);
00139 
00140         <span class="comment">//</span>
00141         <span class="comment">// Deregisters this client with its message server.</span>
00142         <span class="comment">// Returns 0 if all IDs successfully deregister and -1 on any failure.</span>
00143         <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classMultiMessageClient.html#MultiMessageClienta5" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta5">Deregister</a>();
00144 
00145 <span class="keyword">private</span>:
00146         <span class="comment">//</span>
00147         <span class="comment">// This inner class routes its messages to the parent MultiMessageClient.</span>
<a name="l00148"></a><a class="code" href="classMultiMessageClient_1_1MC.html" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html">00148</a>         <span class="keyword">class </span><a class="code" href="classMultiMessageClient_1_1MC.html" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html">MC</a> : <span class="keyword">public</span> <a class="code" href="classMessageClient.html" tppabs="http://dsacss.sourceforge.net/classMessageClient.html">MessageClient</a>
00149         {
00150         <span class="keyword">public</span>:
00151                 <span class="comment">// Constructs this specialized message client.</span>
<a name="l00152"></a><a class="code" href="classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa0">00152</a>                 <a class="code" href="classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa0">MC</a>(u_int id, <a class="code" href="classMultiMessageClient.html" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html">MultiMessageClient</a> *pParent)
00153                         : <a class="code" href="classMessageClient.html" tppabs="http://dsacss.sourceforge.net/classMessageClient.html">MessageClient</a>(id), <a class="code" href="classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCr0">m_pParent</a>(pParent) {}
00154 
00155                 <span class="comment">// Makes SendMessage public to the MultiMessageClient can call it.</span>
<a name="l00156"></a><a class="code" href="classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa1">00156</a>                 <span class="keywordtype">int</span> <a class="code" href="classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa1">SendMessage</a>(<span class="keyword">const</span> <span class="keywordtype">void</span> *msg, size_t len, u_int dest)
00157                         { <span class="keywordflow">return</span> <a class="code" href="classMessageClient.html#MessageClientb0" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MessageClientb0">MessageClient::SendMessage</a>(msg, len, dest); }
00158 
00159                 <span class="comment">// Forwards a message to the MultiMessageClient.</span>
<a name="l00160"></a><a class="code" href="classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa2" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa2">00160</a>                 <span class="keyword">virtual</span> <span class="keywordtype">int</span> <a class="code" href="classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa2" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCa2">ReceiveMessage</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg, size_t len)
00161                         { <span class="keywordflow">return</span> <a class="code" href="classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCr0">m_pParent</a>-&gt;<a class="code" href="classMultiMessageClient.html#MultiMessageClienta2" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClienta2">ReceiveMessage</a>(<a class="code" href="classMessageClient.html#MultiMessageClient_1_1MCa3" tppabs="http://dsacss.sourceforge.net/classMessageClient.html#MultiMessageClient_1_1MCa3">id</a>(), msg, len); }
00162 
00163         <span class="keyword">private</span>:
<a name="l00164"></a><a class="code" href="classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCr0">00164</a>                 <a class="code" href="classMultiMessageClient.html" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html">MultiMessageClient</a> *<a class="code" href="classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html#MultiMessageClient_1_1MCr0">m_pParent</a>;
00165 
00166         };
00167 
00168 <span class="keyword">private</span>:
00169         <span class="comment">//</span>
00170         <span class="comment">// The array of MessageClients -- one per ID.</span>
<a name="l00171"></a><a class="code" href="classMultiMessageClient.html#MultiMessageClientr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr0">00171</a>         <a class="code" href="classMultiMessageClient_1_1MC.html" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient_1_1MC.html">MC</a> **<a class="code" href="classMultiMessageClient.html#MultiMessageClientr0" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr0">m_ppChildren</a>;
00172 
00173         <span class="comment">//</span>
00174         <span class="comment">// The number of MessageClients in the array.</span>
<a name="l00175"></a><a class="code" href="classMultiMessageClient.html#MultiMessageClientr1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr1">00175</a>         u_int <a class="code" href="classMultiMessageClient.html#MultiMessageClientr1" tppabs="http://dsacss.sourceforge.net/classMultiMessageClient.html#MultiMessageClientr1">m_numChildren</a>;
00176 
00177 };
00178 
00179 <span class="preprocessor">#endif // MESSAGE_CLIENT_H</span>
00180 <span class="preprocessor"></span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 15 11:49:54 2004 for DSACSS Operational Code by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.png" tppabs="http://dsacss.sourceforge.net/doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
