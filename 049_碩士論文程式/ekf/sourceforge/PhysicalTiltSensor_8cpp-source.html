<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DSACSS Operational Code: PhysicalTiltSensor.cpp Source File</title>
<link href="doxygen.css" tppabs="http://dsacss.sourceforge.net/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<h1>PhysicalTiltSensor.cpp</h1><a href="PhysicalTiltSensor_8cpp.html" tppabs="http://dsacss.sourceforge.net/PhysicalTiltSensor_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 
00008 
00010 
00011 
00012 <span class="preprocessor">#include "<a class="code" href="PhysicalTiltSensor_8h.html" tppabs="http://dsacss.sourceforge.net/PhysicalTiltSensor_8h.html">PhysicalTiltSensor.h</a>"</span>
00013 <span class="preprocessor">#include "utils/Time.h"</span>
00014 <span class="preprocessor">#include &lt;fstream.h&gt;</span>
00015 
<a name="l00016"></a><a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora0" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora0">00016</a> <a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora0" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora0">PhysicalTiltSensor::PhysicalTiltSensor</a>()
00017 {
00018         <a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensorr4" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensorr4">m_fd</a> = -1;
00019 }
00020 
<a name="l00021"></a><a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora1" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora1">00021</a> <a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora1" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora1">PhysicalTiltSensor::~PhysicalTiltSensor</a>()
00022 {
00023         close(<a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensorr4" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensorr4">m_fd</a>);
00024 }
00025 
<a name="l00026"></a><a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora2" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora2">00026</a> <span class="keywordtype">int</span> <a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora2" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora2">PhysicalTiltSensor::Initialize</a>()
00027 {
00028         <span class="keywordflow">if</span> (<a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensorr4" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensorr4">m_fd</a> &lt; 0) { <span class="comment">// g_fd has NOT been set yet, then init the daisychain</span>
00029                 <span class="keywordtype">char</span> *stringPort;
00030                 stringPort = <span class="keyword">new</span> <span class="keywordtype">char</span>[80];
00031                 sprintf(stringPort,<span class="stringliteral">"/dev/tty%s"</span>,<a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensorr5" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensorr5">m_Port</a>.c_str());
00032         
00033                 <a class="code" href="common_8c.html#a0" tppabs="http://dsacss.sourceforge.net/common_8c.html#a0">init_serial</a>(stringPort,B9600,&amp;<a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensorr4" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensorr4">m_fd</a>);
00034                 cout &lt;&lt; stringPort &lt;&lt; <span class="stringliteral">"   fd: "</span> &lt;&lt; <a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensorr4" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensorr4">m_fd</a> &lt;&lt; endl;
00035         
00036                 <span class="keywordtype">char</span> *testCommand;
00037                 testCommand = <span class="keyword">new</span> <span class="keywordtype">char</span>[80];
00038                 sprintf(testCommand, <span class="stringliteral">"R"</span>);
00039                 <a class="code" href="common_8c.html#a1" tppabs="http://dsacss.sourceforge.net/common_8c.html#a1">say</a>(<a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensorr4" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensorr4">m_fd</a>, testCommand);
00040                 usleep(500000);
00041                 <a class="code" href="common_8c.html#a2" tppabs="http://dsacss.sourceforge.net/common_8c.html#a2">hear</a>(<a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensorr4" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensorr4">m_fd</a>, testCommand, 15, 0, 10000, <span class="charliteral">'\r'</span>);
00042                 cout &lt;&lt; <span class="stringliteral">"Reset Returned:  "</span> &lt;&lt; testCommand &lt;&lt; endl;
00043                 
00044         }
00045                 
00046         <span class="keywordflow">return</span> 0;
00047 }
00048 
<a name="l00049"></a><a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora3" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora3">00049</a> Vector <a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora3" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora3">PhysicalTiltSensor::GetSensorToBodyQuaternion</a>()
00050 {
00051         Vector qwe(3);
00052         <span class="keywordflow">return</span> qwe;
00053 }
00054 
<a name="l00055"></a><a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora4" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora4">00055</a> <span class="keywordtype">void</span> <a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora4" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora4">PhysicalTiltSensor::GetAngles</a>(<span class="keywordtype">double</span>&amp; pitch, <span class="keywordtype">double</span>&amp; roll, <span class="keywordtype">double</span>&amp; t)
00056 {
00057         <span class="keywordtype">char</span> *testCommand;
00058         testCommand = <span class="keyword">new</span> <span class="keywordtype">char</span>[80];
00059         sprintf(testCommand, <span class="stringliteral">"G"</span>);
00060         <a class="code" href="common_8c.html#a1" tppabs="http://dsacss.sourceforge.net/common_8c.html#a1">say</a>(<a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensorr4" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensorr4">m_fd</a>, testCommand);
00061         
00062         t = Now();
00063         usleep(1000000);
00064         <span class="keywordtype">char</span> *Results= <span class="keyword">new</span> <span class="keywordtype">char</span>[80];
00065         <span class="comment">//Results = new char[80];</span>
00066         <span class="keywordtype">int</span> errval;
00067         errval = <a class="code" href="common_8c.html#a2" tppabs="http://dsacss.sourceforge.net/common_8c.html#a2">hear</a>(<a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensorr4" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensorr4">m_fd</a>, Results, 15, 6, 100000, <span class="charliteral">'\r'</span>);
00068         <span class="comment">//cout &lt;&lt; "errval:  " &lt;&lt; errval &lt;&lt; endl;</span>
00069         
00070         pitch = ((<span class="keywordtype">int</span>)256*(<span class="keywordtype">int</span>) Results[1] + (<span class="keywordtype">int</span>) Results[2])*0.00275415;<span class="comment">//convert from hardware value to degrees</span>
00071         pitch = pitch*3.14159265/180.0;<span class="comment">//convert degress to rad</span>
00072         roll = ((<span class="keywordtype">int</span>)256*Results[3] + (<span class="keywordtype">int</span>) Results[4])*0.00275415;
00073         roll = roll*3.14159265/180.0;
00074 
00075         <span class="keywordflow">if</span>(pitch &gt; 1.30900){
00076                 pitch = 9999;
00077         }       
00078         <span class="keywordflow">if</span>(roll &gt; 1.30900){
00079                 roll = 9999;
00080         }       
00081                 
00082         <span class="keywordflow">return</span>;
00083 }
00084 
<a name="l00085"></a><a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora5" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora5">00085</a> <span class="keywordtype">int</span> <a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora5" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora5">PhysicalTiltSensor::GetFD</a>()
00086 {
00087         <span class="keywordflow">return</span> <a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensorr4" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensorr4">m_fd</a>;
00088 }
00089 
<a name="l00090"></a><a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora6" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora6">00090</a> <span class="keywordtype">void</span> <a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora6" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora6">PhysicalTiltSensor::SetPort</a>(string Port)
00091 {
00092         <a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensorr5" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensorr5">m_Port</a> = Port;
00093 }
00094 
<a name="l00095"></a><a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora7" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora7">00095</a> <a class="code" href="classMeasurement.html" tppabs="http://dsacss.sourceforge.net/classMeasurement.html">Measurement</a> <a class="code" href="classPhysicalTiltSensor.html#PhysicalTiltSensora7" tppabs="http://dsacss.sourceforge.net/classPhysicalTiltSensor.html#PhysicalTiltSensora7">PhysicalTiltSensor::GetMeasurement</a>()
00096 {
00097         <a class="code" href="classMeasurement.html" tppabs="http://dsacss.sourceforge.net/classMeasurement.html">Measurement</a> M;
00098         <span class="keywordflow">return</span> M;
00099 }
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 15 11:49:54 2004 for DSACSS Operational Code by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.png" tppabs="http://dsacss.sourceforge.net/doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
