<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DSACSS Operational Code: VehicleNetConfig.cpp Source File</title>
<link href="doxygen.css" tppabs="http://dsacss.sourceforge.net/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<h1>VehicleNetConfig.cpp</h1><a href="VehicleNetConfig_8cpp.html" tppabs="http://dsacss.sourceforge.net/VehicleNetConfig_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 
00002 
00008 
00009 <span class="preprocessor">#include "<a class="code" href="VehicleNetConfig_8h.html" tppabs="http://dsacss.sourceforge.net/VehicleNetConfig_8h.html">VehicleNetConfig.h</a>"</span>
00010 
<a name="l00011"></a><a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga0" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga0">00011</a> <a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga0" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga0">VehicleNetConfig::VehicleNetConfig</a>()
00012         : m_numMappings(0),
00013           m_pMyMapping(NULL), 
00014           m_unknownMapping(SystemDefs::<a class="code" href="namespaceSystemDefs.html#a2" tppabs="http://dsacss.sourceforge.net/namespaceSystemDefs.html#a2">UNKNOWN_ID</a>, "Unknown"),
00015           m_mcastAddr(),
00016           m_pMcastInterface(NULL),
00017           m_loopbackEnabled(false),
00018           m_timeToLive(1)
00019 {
00020 }
00021 
<a name="l00022"></a><a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga1" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga1">00022</a> <a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga0" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga0">VehicleNetConfig::VehicleNetConfig</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *mySectionName)
00023         : m_numMappings(0),
00024           m_pMyMapping(NULL), 
00025           m_unknownMapping(SystemDefs::<a class="code" href="namespaceSystemDefs.html#a2" tppabs="http://dsacss.sourceforge.net/namespaceSystemDefs.html#a2">UNKNOWN_ID</a>, "Unknown"),
00026           m_mcastAddr(),
00027           m_pMcastInterface(NULL),
00028           m_loopbackEnabled(false),
00029           m_timeToLive(1)
00030 {
00031         this-&gt;<a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga3" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga3">Init</a>(mySectionName);
00032 }
00033 
<a name="l00034"></a><a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga2" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga2">00034</a> <a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga2" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga2">VehicleNetConfig::~VehicleNetConfig</a>()
00035 {
00036         <span class="keyword">delete</span> [] <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp1" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp1">m_pMyMapping</a>;
00037         <span class="keyword">delete</span> <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp4" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp4">m_pMcastInterface</a>;
00038 }
00039 
00040 
<a name="l00041"></a><a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga3" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga3">00041</a> <span class="keywordtype">int</span> <a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga3" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga3">VehicleNetConfig::Init</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *mySectionName)
00042 {
00043         <a class="code" href="classSystemProperties.html" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html">SystemProperties</a> *props = <a class="code" href="classSystemProperties.html#SystemPropertiese0" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiese0">SystemProperties::Instance</a>();
00044 
00045         ACE_Configuration_Section_Key   mySectionKey,
00046                                                                         idSectionKey;
00047 
00048         <span class="keywordflow">if</span> (props-&gt;<a class="code" href="classSystemProperties.html#SystemPropertiesa22" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiesa22">GetSectionKey</a>(mySectionName, mySectionKey))
00049                 ACE_ERROR_RETURN((LM_ERROR, <span class="stringliteral">"(%N:%l) Initialization of VehicleNetConfig failed: Unable to find system config section %s.\n"</span>, mySectionName), -1);
00050 
00051         <span class="keywordflow">if</span> (props-&gt;<a class="code" href="classSystemProperties.html#SystemPropertiesa22" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiesa22">GetSectionKey</a>(mySectionKey, <span class="stringliteral">"IDs"</span>, idSectionKey))
00052                 ACE_ERROR_RETURN((LM_ERROR, <span class="stringliteral">"(%N:%l) Initialization of VehicleNetConfig failed: Unable to find 'IDs' subsection of config.\n"</span>), -1);
00053 
00054         std::string mcastAddrName,
00055                                 mcastIfName;
00056 
00057         <span class="keywordflow">if</span> (props-&gt;<a class="code" href="classSystemProperties.html#SystemPropertiesa2" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiesa2">GetStringEntry</a>(mySectionKey, <span class="stringliteral">"Multicast Address"</span>, mcastAddrName))
00058                 ACE_ERROR_RETURN((LM_ERROR, <span class="stringliteral">"(%N:%l) Initialization of VehicleNetConfig failed: 'Multicast Address' property is missing.\n"</span>), -1);
00059 
00060         <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp3" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp3">m_mcastAddr</a>.set(mcastAddrName.c_str());
00061 
00062         <span class="keywordflow">if</span> (props-&gt;<a class="code" href="classSystemProperties.html#SystemPropertiesa2" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiesa2">GetStringEntry</a>(mySectionKey, <span class="stringliteral">"Multicast Interface"</span>, mcastIfName) == 0)
00063         {
00064                 size_t len = mcastIfName.length();
00065                 <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp4" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp4">m_pMcastInterface</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[len+1];
00066                 mcastIfName.copy(<a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp4" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp4">m_pMcastInterface</a>, len);
00067                 <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp4" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp4">m_pMcastInterface</a>[len]=<span class="charliteral">'\0'</span>;
00068         }
00069 
00070         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val;
00071         <span class="keywordflow">if</span> (props-&gt;<a class="code" href="classSystemProperties.html#SystemPropertiesa3" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiesa3">GetIntegerEntry</a>(mySectionKey, <span class="stringliteral">"Multicast Loopback"</span>, val) == 0)
00072         {
00073                 <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp5" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp5">m_loopbackEnabled</a> = (val != 0);
00074         }
00075 
00076         <span class="keywordflow">if</span> (props-&gt;<a class="code" href="classSystemProperties.html#SystemPropertiesa3" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiesa3">GetIntegerEntry</a>(mySectionKey, <span class="stringliteral">"Multicast TTL"</span>, val) == 0)
00077         {
00078                 <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp6" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp6">m_timeToLive</a> = val;
00079         }
00080 
00081         std::string fieldName;
00082 
00083         <span class="keywordtype">int</span> status = props-&gt;<a class="code" href="classSystemProperties.html#SystemPropertiesa24" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiesa24">EnumerateSections</a>(idSectionKey, 0, fieldName);
00084         <span class="keywordflow">if</span> (status== -1)
00085                 ACE_ERROR_RETURN((LM_ERROR, <span class="stringliteral">"(%N:%l) Initialization of VehicleNetConfig failed: The 'IDs' subsection of config has no vehicle sections.\n"</span>), -1);
00086 
00087         <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp0" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp0">m_numMappings</a> = 1;
00088         <span class="keywordflow">if</span> (status == 0)
00089         {
00090                 <span class="keywordflow">for</span> (; props-&gt;<a class="code" href="classSystemProperties.html#SystemPropertiesa24" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiesa24">EnumerateSections</a>(idSectionKey, <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp0" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp0">m_numMappings</a>, fieldName) == 0; ++<a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp0" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp0">m_numMappings</a>);
00091         }
00092 
00093         ACE_Configuration_Section_Key vehicleKey;
00094         <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp1" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp1">m_pMyMapping</a> = <span class="keyword">new</span> <a class="code" href="structVehicleNetConfig_1_1VehicleMapping.html" tppabs="http://dsacss.sourceforge.net/structVehicleNetConfig_1_1VehicleMapping.html">VehicleMapping</a>[<a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp0" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp0">m_numMappings</a>];
00095 
00096         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp0" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp0">m_numMappings</a>; ++i)
00097         {
00098                 props-&gt;<a class="code" href="classSystemProperties.html#SystemPropertiesa24" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiesa24">EnumerateSections</a>(idSectionKey, i, <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp1" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp1">m_pMyMapping</a>[i].m_vehicleName);
00099 
00100 
00101                 props-&gt;<a class="code" href="classSystemProperties.html#SystemPropertiesa22" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiesa22">GetSectionKey</a>(idSectionKey, <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp1" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp1">m_pMyMapping</a>[i].m_vehicleName.c_str(), vehicleKey);
00102 
00103                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> val;
00104                 <span class="keywordflow">if</span> (props-&gt;<a class="code" href="classSystemProperties.html#SystemPropertiesa3" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiesa3">GetIntegerEntry</a>(vehicleKey, <span class="stringliteral">"ID"</span>, val))
00105                 {
00106                         ACE_ERROR((LM_ERROR, <span class="stringliteral">"(%N:%l) Vehicle '%s' is missing an ID config entry.\n"</span>, <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp1" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp1">m_pMyMapping</a>[i].m_vehicleName.c_str()));
00107                 }
00108                 <span class="keywordflow">else</span>
00109                 {
00110                         <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp1" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp1">m_pMyMapping</a>[i].<a class="code" href="structVehicleNetConfig_1_1VehicleMapping.html#VehicleNetConfig_1_1VehicleMappingo0" tppabs="http://dsacss.sourceforge.net/structVehicleNetConfig_1_1VehicleMapping.html#VehicleNetConfig_1_1VehicleMappingo0">m_vehicleID</a> = static_cast&lt;int&gt;(val);
00111                 }
00112 
00113                 std::string addrString;
00114                 <span class="keywordflow">if</span> (props-&gt;<a class="code" href="classSystemProperties.html#SystemPropertiesa2" tppabs="http://dsacss.sourceforge.net/classSystemProperties.html#SystemPropertiesa2">GetStringEntry</a>(vehicleKey, <span class="stringliteral">"Address"</span>, addrString))
00115                 {
00116                         ACE_ERROR((LM_ERROR, <span class="stringliteral">"(%N:%l) Vehicle '%s' is missing an Address config entry.\n"</span>, <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp1" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp1">m_pMyMapping</a>[i].m_vehicleName.c_str()));
00117                 }
00118                 <span class="keywordflow">else</span>
00119                 {
00120                         <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp1" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp1">m_pMyMapping</a>[i].<a class="code" href="structVehicleNetConfig_1_1VehicleMapping.html#VehicleNetConfig_1_1VehicleMappingo2" tppabs="http://dsacss.sourceforge.net/structVehicleNetConfig_1_1VehicleMapping.html#VehicleNetConfig_1_1VehicleMappingo2">m_netAddress</a>.set(addrString.c_str());
00121                 }
00122         }
00123 
00124         <span class="keywordflow">return</span> 0;
00125 }
00126 
00127 
<a name="l00128"></a><a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga8" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga8">00128</a> <span class="keyword">const</span> ACE_INET_Addr &amp;<a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga8" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga8">VehicleNetConfig::GetVehicleAddress</a>(<a class="code" href="namespaceSystemDefs.html#a0" tppabs="http://dsacss.sourceforge.net/namespaceSystemDefs.html#a0">SystemDefs::VehicleID_t</a> vehicleID)<span class="keyword"> const</span>
00129 <span class="keyword"></span>{
00130         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp0" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp0">m_numMappings</a>; ++i)
00131         {
00132                 <span class="keywordflow">if</span> (vehicleID == <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp1" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp1">m_pMyMapping</a>[i].<a class="code" href="structVehicleNetConfig_1_1VehicleMapping.html#VehicleNetConfig_1_1VehicleMappingo0" tppabs="http://dsacss.sourceforge.net/structVehicleNetConfig_1_1VehicleMapping.html#VehicleNetConfig_1_1VehicleMappingo0">m_vehicleID</a>)
00133                 {
00134                         <span class="keywordflow">return</span> m_pMyMapping[i].m_netAddress;
00135                 }
00136         }
00137 
00138         <span class="keywordflow">return</span> <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp2" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp2">m_unknownMapping</a>.<a class="code" href="structVehicleNetConfig_1_1VehicleMapping.html#VehicleNetConfig_1_1VehicleMappingo2" tppabs="http://dsacss.sourceforge.net/structVehicleNetConfig_1_1VehicleMapping.html#VehicleNetConfig_1_1VehicleMappingo2">m_netAddress</a>;
00139 }
00140 
00141 
<a name="l00142"></a><a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga9" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga9">00142</a> <a class="code" href="namespaceSystemDefs.html#a0" tppabs="http://dsacss.sourceforge.net/namespaceSystemDefs.html#a0">SystemDefs::VehicleID_t</a> <a class="code" href="classVehicleNetConfig.html#VehicleNetConfiga9" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfiga9">VehicleNetConfig::VehicleAddressToID</a>(<span class="keyword">const</span> ACE_INET_Addr &amp;addr)<span class="keyword"> const</span>
00143 <span class="keyword"></span>{
00144         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp0" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp0">m_numMappings</a>; ++i)
00145         {
00146                 <span class="keywordflow">if</span> (addr == <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp1" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp1">m_pMyMapping</a>[i].<a class="code" href="structVehicleNetConfig_1_1VehicleMapping.html#VehicleNetConfig_1_1VehicleMappingo2" tppabs="http://dsacss.sourceforge.net/structVehicleNetConfig_1_1VehicleMapping.html#VehicleNetConfig_1_1VehicleMappingo2">m_netAddress</a>)
00147                 {
00148                         <span class="keywordflow">return</span> m_pMyMapping[i].m_vehicleID;
00149                 }
00150         }
00151 
00152         <span class="keywordflow">return</span> <a class="code" href="classVehicleNetConfig.html#VehicleNetConfigp2" tppabs="http://dsacss.sourceforge.net/classVehicleNetConfig.html#VehicleNetConfigp2">m_unknownMapping</a>.<a class="code" href="structVehicleNetConfig_1_1VehicleMapping.html#VehicleNetConfig_1_1VehicleMappingo0" tppabs="http://dsacss.sourceforge.net/structVehicleNetConfig_1_1VehicleMapping.html#VehicleNetConfig_1_1VehicleMappingo0">m_vehicleID</a>;
00153 }
00154 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 15 11:49:55 2004 for DSACSS Operational Code by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.png" tppabs="http://dsacss.sourceforge.net/doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
