<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DSACSS Operational Code: daqcard.c Source File</title>
<link href="doxygen.css" tppabs="http://dsacss.sourceforge.net/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<h1>daqcard.c</h1><a href="daqcard_8c.html" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="comment">/************************************************************************************************/</span>
00012 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
00013 <span class="preprocessor">#include "<a class="code" href="daqcard_8h.html" tppabs="http://dsacss.sourceforge.net/daqcard_8h.html">daqcard.h</a>"</span>
00014 <span class="preprocessor">#include "<a class="code" href="dscud_8h.html" tppabs="http://dsacss.sourceforge.net/dscud_8h.html">dscud.h</a>"</span>
00015 
<a name="l00016"></a><a class="code" href="daqcard_8c.html#a0" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html#a0">00016</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="daqcard_8c.html#a0" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html#a0">kbhit</a>()
00017 {
00018         <span class="keyword">struct </span>timeval timeout;
00019         fd_set rfds;
00020 
00021         timeout.tv_sec = 0;
00022         timeout.tv_usec = 0;
00023 
00024         FD_ZERO(&amp;rfds);
00025         FD_SET(0, &amp;rfds);
00026 
00027         <span class="keywordflow">return</span> select(0+1, &amp;rfds, NULL, NULL, &amp;timeout);
00028 }
00029 
<a name="l00030"></a><a class="code" href="daqcard_8c.html#a1" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html#a1">00030</a> <span class="keywordtype">void</span> <a class="code" href="daqcard_8c.html#a1" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html#a1">DAConvert</a>(<a class="code" href="structcard__t.html" tppabs="http://dsacss.sourceforge.net/structcard__t.html">card_t</a> *mycard, <span class="keywordtype">int</span> _channel, <span class="keywordtype">int</span> _code)
00031 {
00032         <span class="keywordflow">switch</span> (_channel)
00033         {
00034                 <span class="keywordflow">case</span> 1:
00035                         <span class="keywordflow">if</span>((mycard-&gt;<a class="code" href="structcard__t.html#card__to0" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to0">result</a> = <a class="code" href="dscud_8h.html#a205" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a205">dscDAConvert</a>( mycard-&gt;<a class="code" href="structcard__t.html#card__to1" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to1">dscb</a>, mycard-&gt;<a class="code" href="structcard__t.html#card__to11" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to11">chan38</a>, _code)) != <a class="code" href="dscud_8h.html#a83" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a83">DE_NONE</a>)
00036                         {
00037                                 <a class="code" href="dscud_8h.html#a192" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a192">dscGetLastError</a>(&amp;mycard-&gt;<a class="code" href="structcard__t.html#card__to8" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to8">errorParams</a>);
00038                                 fprintf(stderr, <span class="stringliteral">"%s %s\n"</span>, <a class="code" href="daqcard_8h.html#a0" tppabs="http://dsacss.sourceforge.net/daqcard_8h.html#a0">ERROR_PREFIX</a>, mycard-&gt;<a class="code" href="structcard__t.html#card__to8" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to8">errorParams</a>.<a class="code" href="structERRPARAMS.html#ERRPARAMSo1" tppabs="http://dsacss.sourceforge.net/structERRPARAMS.html#ERRPARAMSo1">errstring</a>);        
00039                         }
00040                         <span class="keywordflow">break</span>;
00041                 <span class="keywordflow">case</span> 2:
00042                         <span class="keywordflow">if</span>((mycard-&gt;<a class="code" href="structcard__t.html#card__to0" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to0">result</a> = <a class="code" href="dscud_8h.html#a205" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a205">dscDAConvert</a>( mycard-&gt;<a class="code" href="structcard__t.html#card__to1" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to1">dscb</a>, mycard-&gt;<a class="code" href="structcard__t.html#card__to12" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to12">chan37</a>, _code)) != <a class="code" href="dscud_8h.html#a83" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a83">DE_NONE</a>)
00043                         {
00044                                 <a class="code" href="dscud_8h.html#a192" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a192">dscGetLastError</a>(&amp;mycard-&gt;<a class="code" href="structcard__t.html#card__to8" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to8">errorParams</a>);
00045                                 fprintf(stderr, <span class="stringliteral">"%s %s\n"</span>, <a class="code" href="daqcard_8h.html#a0" tppabs="http://dsacss.sourceforge.net/daqcard_8h.html#a0">ERROR_PREFIX</a>, mycard-&gt;<a class="code" href="structcard__t.html#card__to8" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to8">errorParams</a>.<a class="code" href="structERRPARAMS.html#ERRPARAMSo1" tppabs="http://dsacss.sourceforge.net/structERRPARAMS.html#ERRPARAMSo1">errstring</a>);        
00046                         }
00047                         <span class="keywordflow">break</span>;
00048                 <span class="keywordflow">default</span>:
00049                         printf(<span class="stringliteral">" bad channel vale: %d \n"</span>, _channel);
00050                         <span class="keywordflow">break</span>;
00051         }
00052 }
00053 
<a name="l00054"></a><a class="code" href="daqcard_8c.html#a2" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html#a2">00054</a> <span class="keywordtype">double</span> <a class="code" href="daqcard_8c.html#a2" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html#a2">ADscan</a>(<a class="code" href="structcard__t.html" tppabs="http://dsacss.sourceforge.net/structcard__t.html">card_t</a> *mycard, <span class="keywordtype">int</span> _channel)
00055 {
00056         <span class="keywordtype">double</span> out_voltage;
00057         <span class="keywordflow">if</span>( (mycard-&gt;<a class="code" href="structcard__t.html#card__to0" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to0">result</a> = <a class="code" href="dscud_8h.html#a202" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a202">dscADScan</a>( mycard-&gt;<a class="code" href="structcard__t.html#card__to1" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to1">dscb</a>, &amp;(mycard-&gt;<a class="code" href="structcard__t.html#card__to5" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to5">dscadscan</a>), mycard-&gt;<a class="code" href="structcard__t.html#card__to6" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to6">samples</a>) ) != <a class="code" href="dscud_8h.html#a83" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a83">DE_NONE</a> )
00058         {
00059                 fprintf(stderr, <span class="stringliteral">"%s%s\n"</span>, <a class="code" href="daqcard_8h.html#a0" tppabs="http://dsacss.sourceforge.net/daqcard_8h.html#a0">ERROR_PREFIX</a>, <a class="code" href="dscud_8h.html#a193" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a193">dscGetErrorString</a>( mycard-&gt;<a class="code" href="structcard__t.html#card__to0" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to0">result</a>) );
00060                 free( mycard-&gt;<a class="code" href="structcard__t.html#card__to6" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to6">samples</a> ); <span class="comment">// remember to free memory</span>
00061                 <span class="keywordflow">return</span> 0;
00062         }
00063         <span class="comment">// NOTE: reevaluate the following line for hardcoding issues.</span>
00064         mycard-&gt;<a class="code" href="structcard__t.html#card__to7" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to7">voltage</a> = (((<span class="keywordtype">short</span>)(mycard-&gt;<a class="code" href="structcard__t.html#card__to5" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to5">dscadscan</a>.<a class="code" href="structDSCADSCAN.html#DSCADSCANo2" tppabs="http://dsacss.sourceforge.net/structDSCADSCAN.html#DSCADSCANo2">sample_values</a>[_channel])+32768)/65536.0)*10.0;
00065         <span class="comment">// added the power thing in denominator (why?)</span>
00066         out_voltage = ((<span class="keywordtype">double</span>)mycard-&gt;<a class="code" href="structcard__t.html#card__to7" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to7">voltage</a>)/pow(2,mycard-&gt;<a class="code" href="structcard__t.html#card__to3" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to3">dscadsettings</a>.<a class="code" href="structDSCADSETTINGS.html#DSCADSETTINGSo1" tppabs="http://dsacss.sourceforge.net/structDSCADSETTINGS.html#DSCADSETTINGSo1">gain</a>); <span class="comment">// NOTE: this casting from a float to a double might not be good.</span>
00067         <span class="keywordflow">return</span> out_voltage;
00068 }
00069 
00070 
<a name="l00071"></a><a class="code" href="daqcard_8c.html#a3" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html#a3">00071</a> <span class="keywordtype">int</span> <a class="code" href="daqcard_8c.html#a3" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html#a3">InitDAQCard</a>(<a class="code" href="structcard__t.html" tppabs="http://dsacss.sourceforge.net/structcard__t.html">card_t</a> *mycard)
00072 {
00073         <a class="code" href="dscud_8h.html#a16" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a16">DSCB</a>  dscb;
00074         <a class="code" href="structDSCCB.html" tppabs="http://dsacss.sourceforge.net/structDSCCB.html">DSCCB</a> dsccb;
00075         
00076         <span class="comment">// Initialize the dscud library</span>
00077         <span class="keywordflow">if</span>( <a class="code" href="dscud_8h.html#a194" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a194">dscInit</a>( <a class="code" href="dscud_8h.html#a17" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a17">DSC_VERSION</a> ) != <a class="code" href="dscud_8h.html#a83" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a83">DE_NONE</a> )
00078         {
00079                 <a class="code" href="dscud_8h.html#a192" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a192">dscGetLastError</a>(&amp;(mycard-&gt;<a class="code" href="structcard__t.html#card__to8" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to8">errorParams</a>));
00080                 fprintf( stderr, <span class="stringliteral">"%s %s\n"</span>, <a class="code" href="daqcard_8h.html#a0" tppabs="http://dsacss.sourceforge.net/daqcard_8h.html#a0">ERROR_PREFIX</a>, (mycard-&gt;<a class="code" href="structcard__t.html#card__to8" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to8">errorParams</a>).errstring );
00081                 <span class="keywordflow">return</span> 0;
00082         }
00083 
00084         <span class="comment">// Initialize the DMM-32-AT board</span>
00085         mycard-&gt;<a class="code" href="structcard__t.html#card__to2" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to2">dsccb</a>.<a class="code" href="structDSCCB.html#DSCCBo0" tppabs="http://dsacss.sourceforge.net/structDSCCB.html#DSCCBo0">boardtype</a> = <a class="code" href="dscud_8h.html#a30" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a30">DSC_DMM32</a>;
00086         mycard-&gt;<a class="code" href="structcard__t.html#card__to2" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to2">dsccb</a>.<a class="code" href="structDSCCB.html#DSCCBo2" tppabs="http://dsacss.sourceforge.net/structDSCCB.html#DSCCBo2">base_address</a> = 0x300;
00087         mycard-&gt;<a class="code" href="structcard__t.html#card__to2" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to2">dsccb</a>.<a class="code" href="structDSCCB.html#DSCCBo5" tppabs="http://dsacss.sourceforge.net/structDSCCB.html#DSCCBo5">int_level</a> = 3;
00088         mycard-&gt;<a class="code" href="structcard__t.html#card__to2" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to2">dsccb</a>.<a class="code" href="structDSCCB.html#DSCCBo3" tppabs="http://dsacss.sourceforge.net/structDSCCB.html#DSCCBo3">dma_level</a> = 3;
00089         mycard-&gt;<a class="code" href="structcard__t.html#card__to2" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to2">dsccb</a>.<a class="code" href="structDSCCB.html#DSCCBo4" tppabs="http://dsacss.sourceforge.net/structDSCCB.html#DSCCBo4">clock_freq</a> = 10000000l;
00090         <span class="keywordflow">if</span>(<a class="code" href="dscud_8h.html#a196" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a196">dscInitBoard</a>(<a class="code" href="dscud_8h.html#a30" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a30">DSC_DMM32</a>, &amp;(mycard-&gt;<a class="code" href="structcard__t.html#card__to2" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to2">dsccb</a>), &amp;(mycard-&gt;<a class="code" href="structcard__t.html#card__to1" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to1">dscb</a>))!= <a class="code" href="dscud_8h.html#a83" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a83">DE_NONE</a>)
00091         {
00092                 <a class="code" href="dscud_8h.html#a192" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a192">dscGetLastError</a>(&amp;(mycard-&gt;<a class="code" href="structcard__t.html#card__to8" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to8">errorParams</a>));
00093                 fprintf(stderr, <span class="stringliteral">"%s %s\n"</span>, <a class="code" href="daqcard_8h.html#a0" tppabs="http://dsacss.sourceforge.net/daqcard_8h.html#a0">ERROR_PREFIX</a>, (mycard-&gt;<a class="code" href="structcard__t.html#card__to8" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to8">errorParams</a>).errstring);
00094                 <span class="keywordflow">return</span> 1;
00095         }
00096 
00097         <span class="comment">// settings for AD scanning</span>
00098         <span class="comment">// NOTE: These DAQ card settings will affect the calibration values needed for things</span>
00099         <span class="comment">// like the MotionPak.  That is, the scale factor and bias given in the MoPak manual </span>
00100         <span class="comment">// would be correct if the DAQ card didn't have to perform conversions on the input signal.</span>
00101         <span class="comment">// But since the DAQ card needs to shift and scale the input range to match its full scale</span>
00102         <span class="comment">// voltage range, we must calculate our own calibration values.  That calibration is done </span>
00103         <span class="comment">// in a stand-alone executable, but we leave this reminder here so that the user remembers that</span>
00104         <span class="comment">// fact in case the following settings are modified.</span>
00105         <span class="comment">// Current Settings as of 5/24/04: Range = 10, Polarity = Bi, Gain = 1.</span>
00106 
00107         mycard-&gt;<a class="code" href="structcard__t.html#card__to3" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to3">dscadsettings</a>.<a class="code" href="structDSCADSETTINGS.html#DSCADSETTINGSo2" tppabs="http://dsacss.sourceforge.net/structDSCADSETTINGS.html#DSCADSETTINGSo2">range</a> = <a class="code" href="dscud_8h.html#a42" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a42">RANGE_10</a>; <span class="comment">// 10 V range</span>
00108         <span class="comment">//mycard-&gt;dscadsettings.range = RANGE_5; // 5 V range</span>
00109         <span class="comment">//mycard-&gt;dscadsettings.polarity = UNIPOLAR; // unipolar</span>
00110         mycard-&gt;<a class="code" href="structcard__t.html#card__to3" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to3">dscadsettings</a>.<a class="code" href="structDSCADSETTINGS.html#DSCADSETTINGSo3" tppabs="http://dsacss.sourceforge.net/structDSCADSETTINGS.html#DSCADSETTINGSo3">polarity</a> = <a class="code" href="dscud_8h.html#a43" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a43">BIPOLAR</a>; <span class="comment">// bipolar</span>
00111         mycard-&gt;<a class="code" href="structcard__t.html#card__to3" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to3">dscadsettings</a>.<a class="code" href="structDSCADSETTINGS.html#DSCADSETTINGSo1" tppabs="http://dsacss.sourceforge.net/structDSCADSETTINGS.html#DSCADSETTINGSo1">gain</a> = <a class="code" href="dscud_8h.html#a45" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a45">GAIN_1</a>;
00112         mycard-&gt;<a class="code" href="structcard__t.html#card__to3" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to3">dscadsettings</a>.<a class="code" href="structDSCADSETTINGS.html#DSCADSETTINGSo4" tppabs="http://dsacss.sourceforge.net/structDSCADSETTINGS.html#DSCADSETTINGSo4">load_cal</a> = (<a class="code" href="dscud_8h.html#a0" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a0">BYTE</a>)<a class="code" href="dscud_8h.html#a10" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a10">TRUE</a>; <span class="comment">// calibration (???????????)</span>
00113         mycard-&gt;<a class="code" href="structcard__t.html#card__to3" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to3">dscadsettings</a>.<a class="code" href="structDSCADSETTINGS.html#DSCADSETTINGSo0" tppabs="http://dsacss.sourceforge.net/structDSCADSETTINGS.html#DSCADSETTINGSo0">current_channel</a> = 0; <span class="comment">// from example (???)</span>
00114         mycard-&gt;<a class="code" href="structcard__t.html#card__to3" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to3">dscadsettings</a>.<a class="code" href="structDSCADSETTINGS.html#DSCADSETTINGSo5" tppabs="http://dsacss.sourceforge.net/structDSCADSETTINGS.html#DSCADSETTINGSo5">scan_interval</a> = 2; <span class="comment">// from example (???)</span>
00115         
00116         mycard-&gt;<a class="code" href="structcard__t.html#card__to0" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to0">result</a> = <a class="code" href="dscud_8h.html#a198" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a198">dscADSetSettings</a>( mycard-&gt;<a class="code" href="structcard__t.html#card__to1" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to1">dscb</a>, &amp;(mycard-&gt;<a class="code" href="structcard__t.html#card__to3" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to3">dscadsettings</a>) );
00117         <span class="comment">/*printf(" result is %d\n",mycard-&gt;result);*/</span>
00118         <span class="comment">/*if ( (mycard-&gt;result = dscADSetSettings( mycard-&gt;dscb, &amp;(mycard-&gt;dscadsettings) ) ) != DE_NONE );</span>
00119 <span class="comment">        {</span>
00120 <span class="comment">                printf("its in here stupid!\n");</span>
00121 <span class="comment">                fprintf(stderr, "%s%s\n", ERROR_PREFIX, dscGetErrorString( mycard-&gt;result ) );</span>
00122 <span class="comment">                return 0;</span>
00123 <span class="comment">        </span>
00124 <span class="comment">        }*/</span>
00125         mycard-&gt;<a class="code" href="structcard__t.html#card__to5" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to5">dscadscan</a>.<a class="code" href="structDSCADSCAN.html#DSCADSCANo0" tppabs="http://dsacss.sourceforge.net/structDSCADSCAN.html#DSCADSCANo0">low_channel</a> = (<a class="code" href="dscud_8h.html#a0" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a0">BYTE</a>) 0;
00126         mycard-&gt;<a class="code" href="structcard__t.html#card__to5" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to5">dscadscan</a>.<a class="code" href="structDSCADSCAN.html#DSCADSCANo1" tppabs="http://dsacss.sourceforge.net/structDSCADSCAN.html#DSCADSCANo1">high_channel</a> = (<a class="code" href="dscud_8h.html#a0" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a0">BYTE</a>) 15;
00127         mycard-&gt;<a class="code" href="structcard__t.html#card__to5" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to5">dscadscan</a>.<a class="code" href="structDSCADSCAN.html#DSCADSCANo3" tppabs="http://dsacss.sourceforge.net/structDSCADSCAN.html#DSCADSCANo3">gain</a> = <a class="code" href="dscud_8h.html#a45" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a45">GAIN_1</a>;
00128 
00129         <span class="comment">// NOTE changed WORD to SWORD in this line to make compiler happy</span>
00130         mycard-&gt;<a class="code" href="structcard__t.html#card__to6" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to6">samples</a> = (<a class="code" href="dscud_8h.html#a3" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a3">SWORD</a>*)malloc( <span class="keyword">sizeof</span>(<a class="code" href="dscud_8h.html#a3" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a3">SWORD</a>) * ( mycard-&gt;<a class="code" href="structcard__t.html#card__to5" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to5">dscadscan</a>.<a class="code" href="structDSCADSCAN.html#DSCADSCANo1" tppabs="http://dsacss.sourceforge.net/structDSCADSCAN.html#DSCADSCANo1">high_channel</a> - mycard-&gt;<a class="code" href="structcard__t.html#card__to5" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to5">dscadscan</a>.<a class="code" href="structDSCADSCAN.html#DSCADSCANo0" tppabs="http://dsacss.sourceforge.net/structDSCADSCAN.html#DSCADSCANo0">low_channel</a> + 1) );
00131 
00132         <span class="comment">// for analog thusters:</span>
00133         mycard-&gt;<a class="code" href="structcard__t.html#card__to11" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to11">chan38</a> = 0;
00134         mycard-&gt;<a class="code" href="structcard__t.html#card__to12" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to12">chan37</a> = 1;
00135         <span class="comment">// for digital thrusters:</span>
00136         <a class="code" href="dscud_8h.html#a0" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a0">BYTE</a> config_bytes = 0x80;
00137         <a class="code" href="dscud_8h.html#a208" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a208">dscDIOSetConfig</a>(mycard-&gt;<a class="code" href="structcard__t.html#card__to1" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to1">dscb</a>, &amp;config_bytes);
00138 
00139 
00140         <span class="keywordflow">return</span> 0;
00141 }
00142 <span class="comment">//Funtion to send a digital signal to daqcard</span>
<a name="l00143"></a><a class="code" href="daqcard_8c.html#a4" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html#a4">00143</a> <span class="keywordtype">void</span> <a class="code" href="daqcard_8c.html#a4" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html#a4">DIOOutputByte</a>(<a class="code" href="structcard__t.html" tppabs="http://dsacss.sourceforge.net/structcard__t.html">card_t</a> *mycard,<span class="keywordtype">int</span> port,BYTE output_b)
00144 {
00145         
00146         <span class="comment">//Sends digital signal to daqcard and prints an error message if operation fails</span>
00147         <span class="keywordflow">if</span>( ( mycard-&gt;<a class="code" href="structcard__t.html#card__to0" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to0">result</a> = <a class="code" href="dscud_8h.html#a210" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a210">dscDIOOutputByte</a>(mycard -&gt;dscb, port, (<a class="code" href="dscud_8h.html#a0" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a0">BYTE</a>)( output_b ) ) ) != <a class="code" href="dscud_8h.html#a83" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a83">DE_NONE</a> ) {
00148                 <a class="code" href="dscud_8h.html#a192" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a192">dscGetLastError</a>(&amp;mycard-&gt;<a class="code" href="structcard__t.html#card__to8" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to8">errorParams</a>);
00149                 fprintf( stderr, <span class="stringliteral">"%s %s\n"</span>, <a class="code" href="daqcard_8h.html#a0" tppabs="http://dsacss.sourceforge.net/daqcard_8h.html#a0">ERROR_PREFIX</a>, (mycard-&gt;<a class="code" href="structcard__t.html#card__to8" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to8">errorParams</a>).errstring );
00150         }
00151 }
00152 
<a name="l00153"></a><a class="code" href="daqcard_8c.html#a5" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html#a5">00153</a> <span class="keywordtype">void</span> <a class="code" href="daqcard_8c.html#a5" tppabs="http://dsacss.sourceforge.net/daqcard_8c.html#a5">ShutDownDAQCard</a>(<a class="code" href="structcard__t.html" tppabs="http://dsacss.sourceforge.net/structcard__t.html">card_t</a> *mycard)
00154 {
00155         <span class="comment">// free memory used by sample values</span>
00156         free(mycard-&gt;<a class="code" href="structcard__t.html#card__to6" tppabs="http://dsacss.sourceforge.net/structcard__t.html#card__to6">samples</a>);
00157         
00158         <span class="comment">// free driver resources</span>
00159         <a class="code" href="dscud_8h.html#a195" tppabs="http://dsacss.sourceforge.net/dscud_8h.html#a195">dscFree</a>();
00160 }
00161 
00162 <span class="comment">// Do not change the comments below - they will be added automatically by CVS</span>
00163 <span class="comment">/*****************************************************************************</span>
00164 <span class="comment">*       $Log: daqcard.c,v $</span>
00165 <span class="comment">*       Revision 1.4  2004/06/15 15:00:23  shaigunjoe</span>
00166 <span class="comment">*       Added changes for digital signal</span>
00167 <span class="comment">*       </span>
00168 <span class="comment">*       Revision 1.3  2004/05/27 19:08:26  shoemaker</span>
00169 <span class="comment">*       Made changes corresponding to new daq card settings and calibration methods</span>
00170 <span class="comment">*       </span>
00171 <span class="comment">*       Revision 1.2  2004/04/11 19:35:50  shoemaker</span>
00172 <span class="comment">*       Fixed bugs in analog code and cleaned up random messages</span>
00173 <span class="comment">*       </span>
00174 <span class="comment">*       Revision 1.1  2004/03/29 17:42:36  shoemaker</span>
00175 <span class="comment">*       Initial submission of lowlevel c-code related to DAQ card</span>
00176 <span class="comment">*       </span>
00177 <span class="comment">*       </span>
00178 <span class="comment">******************************************************************************/</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 15 11:49:54 2004 for DSACSS Operational Code by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.png" tppabs="http://dsacss.sourceforge.net/doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
