<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>DSACSS Operational Code: satctl.h Source File</title>
<link href="doxygen.css" tppabs="http://dsacss.sourceforge.net/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.4 -->
<h1>satctl.h</h1><a href="satctl_8h.html" tppabs="http://dsacss.sourceforge.net/satctl_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#ifndef _SATCTL_H</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#define _SATCTL_H</span>
00003 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span>
00004 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
00005 <span class="preprocessor">#include &lt;unistd.h&gt;</span>
00006 <span class="preprocessor">#include &lt;termios.h&gt;</span>
00007 <span class="preprocessor">#include &lt;string.h&gt;</span>
00008 <span class="preprocessor">#include &lt;math.h&gt;</span>
00009 <span class="preprocessor">#include &lt;sys/time.h&gt;</span>
00010 <span class="preprocessor">#include &lt;sys/types.h&gt;</span>
00011 <span class="preprocessor">#include &lt;sys/stat.h&gt;</span>
00012 <span class="preprocessor">#include &lt;sys/fcntl.h&gt;</span>
00013 <span class="preprocessor">#include &lt;sys/ioctl.h&gt;</span>
00014 <span class="preprocessor">#include &lt;asm/ioctls.h&gt;</span>
00015 <span class="preprocessor">#include &lt;bits/types.h&gt;</span>
00016 
00017 <span class="comment">/* Data structure definitions: */</span>
00018 
00019 <span class="comment">/* A single momentum wheel: */</span>
<a name="l00020"></a><a class="code" href="structwheel__t.html" tppabs="http://dsacss.sourceforge.net/structwheel__t.html">00020</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00021"></a><a class="code" href="structwheel__t.html#wheel__to0" tppabs="http://dsacss.sourceforge.net/structwheel__t.html#wheel__to0">00021</a>   <span class="keywordtype">int</span> wnum;             <span class="comment">/* Wheel number */</span>
<a name="l00022"></a><a class="code" href="structwheel__t.html#wheel__to1" tppabs="http://dsacss.sourceforge.net/structwheel__t.html#wheel__to1">00022</a>   <span class="keywordtype">char</span> *portfn;         <span class="comment">/* Port filename */</span>
<a name="l00023"></a><a class="code" href="structwheel__t.html#wheel__to2" tppabs="http://dsacss.sourceforge.net/structwheel__t.html#wheel__to2">00023</a>   speed_t brate;        <span class="comment">/* Baudrate as a speed_t */</span>
<a name="l00024"></a><a class="code" href="structwheel__t.html#wheel__to3" tppabs="http://dsacss.sourceforge.net/structwheel__t.html#wheel__to3">00024</a>   <span class="keywordtype">int</span> portfd;           <span class="comment">/* Open port fdes */</span>
<a name="l00025"></a><a class="code" href="structwheel__t.html#wheel__to4" tppabs="http://dsacss.sourceforge.net/structwheel__t.html#wheel__to4">00025</a>   <span class="keywordtype">float</span> cvel;           <span class="comment">/* Current velocity (rps) */</span>
<a name="l00026"></a><a class="code" href="structwheel__t.html#wheel__to5" tppabs="http://dsacss.sourceforge.net/structwheel__t.html#wheel__to5">00026</a>   <span class="keywordtype">float</span> pvel;           <span class="comment">/* Previous velocity (rps) */</span>
<a name="l00027"></a><a class="code" href="structwheel__t.html#wheel__to6" tppabs="http://dsacss.sourceforge.net/structwheel__t.html#wheel__to6">00027</a>   <span class="keywordtype">int</span> status;           <span class="comment">/* Current status */</span>
<a name="l00028"></a><a class="code" href="structwheel__t.html#wheel__to7" tppabs="http://dsacss.sourceforge.net/structwheel__t.html#wheel__to7">00028</a>   <span class="keywordtype">int</span> type;             <span class="comment">/* Motor type */</span>
<a name="l00029"></a><a class="code" href="structwheel__t.html#wheel__to8" tppabs="http://dsacss.sourceforge.net/structwheel__t.html#wheel__to8">00029</a>   <span class="keywordtype">float</span> maxaccel;       <span class="comment">/* Maximum acceleration (rps^2) */</span>
<a name="l00030"></a><a class="code" href="structwheel__t.html#wheel__to9" tppabs="http://dsacss.sourceforge.net/structwheel__t.html#wheel__to9">00030</a>   <span class="keywordtype">float</span> maxvel;         <span class="comment">/* Maximum velocity (rps) */</span>
<a name="l00031"></a><a class="code" href="structwheel__t.html#wheel__to10" tppabs="http://dsacss.sourceforge.net/structwheel__t.html#wheel__to10">00031</a>   <span class="keywordtype">float</span> maxcur;         <span class="comment">/* Maximum motor current */</span>
00032                         <span class="comment">/* Add position info */</span>
00033                         <span class="comment">/* Add moment info */</span>
00034 } <a class="code" href="structwheel__t.html" tppabs="http://dsacss.sourceforge.net/structwheel__t.html">wheel_t</a>;
00035 
<a name="l00036"></a><a class="code" href="structla__t.html" tppabs="http://dsacss.sourceforge.net/structla__t.html">00036</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00037"></a><a class="code" href="structla__t.html#la__to0" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to0">00037</a>   <span class="keywordtype">int</span> lades;            <span class="comment">/* LA number */</span>
<a name="l00038"></a><a class="code" href="structla__t.html#la__to1" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to1">00038</a>   <span class="keywordtype">char</span> *serno;          <span class="comment">/* LA serial number */</span>
<a name="l00039"></a><a class="code" href="structla__t.html#la__to2" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to2">00039</a>   <span class="keywordtype">char</span> *portfn;         <span class="comment">/* Port filename */</span>
<a name="l00040"></a><a class="code" href="structla__t.html#la__to3" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to3">00040</a>   <span class="keywordtype">int</span> portfd;           <span class="comment">/* Open port fdes */</span>
<a name="l00041"></a><a class="code" href="structla__t.html#la__to4" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to4">00041</a>   <span class="keywordtype">int</span> hi_l;             <span class="comment">/* Hi limit (on LA's step counter) */</span>
<a name="l00042"></a><a class="code" href="structla__t.html#la__to5" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to5">00042</a>   <span class="keywordtype">int</span> lo_l;             <span class="comment">/* Low limit (on LA's step counter) */</span>
<a name="l00043"></a><a class="code" href="structla__t.html#la__to6" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to6">00043</a>   <span class="keywordtype">int</span> travel;           <span class="comment">/* Total travel in steps (hi_l - lo_l)*/</span>
<a name="l00044"></a><a class="code" href="structla__t.html#la__to7" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to7">00044</a>   <span class="keywordtype">int</span> mtt;              <span class="comment">/* Estimated max end-to-end travel time (usec) */</span>
<a name="l00045"></a><a class="code" href="structla__t.html#la__to8" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to8">00045</a>   <span class="keywordtype">int</span> curpos;           <span class="comment">/* Current commanded abs position (0 @ neg end)</span>
00046 <span class="comment">                         * Note that this is in a shifted range, whereas hi_l</span>
00047 <span class="comment">                         * and lo_l are in the LA's real range.  So at the</span>
00048 <span class="comment">                         * lower limit, curpos = 0, and at the high end,</span>
00049 <span class="comment">                         * curpos = hi_l - lo_l.  In general, curpos is</span>
00050 <span class="comment">                         * realpos - lo_l (where realpos is the position</span>
00051 <span class="comment">                         * according to the LA's step counter as reported</span>
00052 <span class="comment">                         * by SP and IP.  This means that hi_l and lo_l</span>
00053 <span class="comment">                         * MUST be calculated before the LA is practically</span>
00054 <span class="comment">                         * usable.  The shifted range limits then become</span>
00055 <span class="comment">                         * 0 at the low end, and 'travel' at the high end.</span>
00056 <span class="comment">                         */</span>
<a name="l00057"></a><a class="code" href="structla__t.html#la__to9" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to9">00057</a>   <span class="keywordtype">int</span> posvel;           <span class="comment">/* Positioning velocity ( x20,000 steps/sec) */</span>
<a name="l00058"></a><a class="code" href="structla__t.html#la__to10" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to10">00058</a>   <span class="keywordtype">int</span> posacc;           <span class="comment">/* Positioning acceleration (max 20 recommended) */</span>
<a name="l00059"></a><a class="code" href="structla__t.html#la__to11" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to11">00059</a>   <span class="keywordtype">int</span> posdec;           <span class="comment">/* Positioning deceleration (max 20 recommended) */</span>
<a name="l00060"></a><a class="code" href="structla__t.html#la__to12" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to12">00060</a>   <span class="keywordtype">int</span> jogvel;           <span class="comment">/* Jog velocity */</span>
<a name="l00061"></a><a class="code" href="structla__t.html#la__to13" tppabs="http://dsacss.sourceforge.net/structla__t.html#la__to13">00061</a>   <span class="keywordtype">int</span> jogacc;           <span class="comment">/* Jog accel/decel */</span>
00062 } <a class="code" href="structla__t.html" tppabs="http://dsacss.sourceforge.net/structla__t.html">la_t</a>;
00063   
00064 
00065 <span class="comment">/* wheel_t.status - 0 - Not initialized</span>
00066 <span class="comment"> *                  1 - Initialized</span>
00067 <span class="comment"> *                  2 - Initialized but did not reach tvel (but did move)</span>
00068 <span class="comment"> *                  3 - Initialized but stuck (did not move at all)</span>
00069 <span class="comment"> */</span>
00070 
00071 
00072 <span class="comment">/* A single delta-V command action: */</span>
<a name="l00073"></a><a class="code" href="structdva__t.html" tppabs="http://dsacss.sourceforge.net/structdva__t.html">00073</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00074"></a><a class="code" href="structdva__t.html#dva__to0" tppabs="http://dsacss.sourceforge.net/structdva__t.html#dva__to0">00074</a>   <span class="keywordtype">float</span> vtarget;        <span class="comment">/* Target velocity */</span>
<a name="l00075"></a><a class="code" href="structdva__t.html#dva__to1" tppabs="http://dsacss.sourceforge.net/structdva__t.html#dva__to1">00075</a>   <span class="keywordtype">float</span> atarget;        <span class="comment">/* Target acceleration */</span>
<a name="l00076"></a><a class="code" href="structdva__t.html#dva__to2" tppabs="http://dsacss.sourceforge.net/structdva__t.html#dva__to2">00076</a>   <span class="keywordtype">float</span> actime;         <span class="comment">/* Action time (depends on flags) */</span>
<a name="l00077"></a><a class="code" href="structdva__t.html#dva__to3" tppabs="http://dsacss.sourceforge.net/structdva__t.html#dva__to3">00077</a>   <span class="keywordtype">int</span> flags;            <span class="comment">/* Bit-mapped flags: See below*/</span>
00078 } <a class="code" href="structdva__t.html" tppabs="http://dsacss.sourceforge.net/structdva__t.html">dva_t</a>;
00079 
00080 
00081 <span class="comment">/* A single set of attitude data: */</span>
<a name="l00082"></a><a class="code" href="structadat__t.html" tppabs="http://dsacss.sourceforge.net/structadat__t.html">00082</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00083"></a><a class="code" href="structadat__t.html#adat__to0" tppabs="http://dsacss.sourceforge.net/structadat__t.html#adat__to0">00083</a>   <span class="keywordtype">float</span> xrate;
<a name="l00084"></a><a class="code" href="structadat__t.html#adat__to1" tppabs="http://dsacss.sourceforge.net/structadat__t.html#adat__to1">00084</a>   <span class="keywordtype">float</span> yrate;
<a name="l00085"></a><a class="code" href="structadat__t.html#adat__to2" tppabs="http://dsacss.sourceforge.net/structadat__t.html#adat__to2">00085</a>   <span class="keywordtype">float</span> zrate;
<a name="l00086"></a><a class="code" href="structadat__t.html#adat__to3" tppabs="http://dsacss.sourceforge.net/structadat__t.html#adat__to3">00086</a>   <span class="keywordtype">float</span> xaccel;
<a name="l00087"></a><a class="code" href="structadat__t.html#adat__to4" tppabs="http://dsacss.sourceforge.net/structadat__t.html#adat__to4">00087</a>   <span class="keywordtype">float</span> yaccel;
<a name="l00088"></a><a class="code" href="structadat__t.html#adat__to5" tppabs="http://dsacss.sourceforge.net/structadat__t.html#adat__to5">00088</a>   <span class="keywordtype">float</span> zaccel;
<a name="l00089"></a><a class="code" href="structadat__t.html#adat__to6" tppabs="http://dsacss.sourceforge.net/structadat__t.html#adat__to6">00089</a>   <span class="keywordtype">float</span> temp;
<a name="l00090"></a><a class="code" href="structadat__t.html#adat__to7" tppabs="http://dsacss.sourceforge.net/structadat__t.html#adat__to7">00090</a>   <span class="keywordtype">int</span> deltat;
<a name="l00091"></a><a class="code" href="structadat__t.html#adat__to8" tppabs="http://dsacss.sourceforge.net/structadat__t.html#adat__to8">00091</a>   <span class="keywordtype">long</span> serial;
00092 } <a class="code" href="structadat__t.html" tppabs="http://dsacss.sourceforge.net/structadat__t.html">adat_t</a>;
00093 
00094 <span class="comment">/* The master configuration structure */</span>
<a name="l00095"></a><a class="code" href="structmcfg__t.html" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html">00095</a> <span class="keyword">typedef</span> <span class="keyword">struct </span>{
<a name="l00096"></a><a class="code" href="structmcfg__t.html#mcfg__to0" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to0">00096</a>   <span class="keywordtype">char</span> *mwPort;         <span class="comment">/* MW port filename */</span>
<a name="l00097"></a><a class="code" href="structmcfg__t.html#mcfg__to1" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to1">00097</a>   speed_t mwSpeed;      <span class="comment">/* MW port speeds */</span>
00098   <span class="comment">/* This is not the most compact way to do this, but it's less work, and</span>
00099 <span class="comment">   * we're not so short on memory that we need to scrounge for the space</span>
00100 <span class="comment">   * of two and half int's.  This way it's more straightforward, which is</span>
00101 <span class="comment">   * probably more important, since this could potentially be confusing.</span>
00102 <span class="comment">   * The motors will be assigned addresses serially based on their cabling</span>
00103 <span class="comment">   * order.  Then, the first element of this array will contain the</span>
00104 <span class="comment">   * address of the X motor, the second of the Y, and the third of the Z.</span>
00105 <span class="comment">   */</span>
<a name="l00106"></a><a class="code" href="structmcfg__t.html#mcfg__to2" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to2">00106</a>   <span class="keywordtype">int</span> mwOrder[3];       <span class="comment">/* MW motor cabling order */</span>
<a name="l00107"></a><a class="code" href="structmcfg__t.html#mcfg__to3" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to3">00107</a>   <span class="keywordtype">char</span> **laPort;        <span class="comment">/* LA port filenames */</span>
<a name="l00108"></a><a class="code" href="structmcfg__t.html#mcfg__to4" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to4">00108</a>   speed_t *laSpeed;     <span class="comment">/* LA port speeds */</span>
<a name="l00109"></a><a class="code" href="structmcfg__t.html#mcfg__to5" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to5">00109</a>   <span class="keywordtype">char</span> *dmuPort;        <span class="comment">/* DMU port filename */</span>
<a name="l00110"></a><a class="code" href="structmcfg__t.html#mcfg__to6" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to6">00110</a>   speed_t dmuSpeed;     <span class="comment">/* DMU port speed */</span>
<a name="l00111"></a><a class="code" href="structmcfg__t.html#mcfg__to7" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to7">00111</a>   <span class="keywordtype">int</span> regChan;          <span class="comment">/* Thruster regulator channel (out)*/</span>
<a name="l00112"></a><a class="code" href="structmcfg__t.html#mcfg__to8" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to8">00112</a>   <span class="keywordtype">int</span> thlChan;          <span class="comment">/* Thruster Hi/Lo relay (out)*/</span>
<a name="l00113"></a><a class="code" href="structmcfg__t.html#mcfg__to9" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to9">00113</a>   <span class="keywordtype">int</span> thAChan;          <span class="comment">/* Thruster A (out)*/</span>
<a name="l00114"></a><a class="code" href="structmcfg__t.html#mcfg__to10" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to10">00114</a>   <span class="keywordtype">int</span> thBChan;          <span class="comment">/* Thruster B (out)*/</span>
<a name="l00115"></a><a class="code" href="structmcfg__t.html#mcfg__to11" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to11">00115</a>   <span class="keywordtype">int</span> batChan[8];       <span class="comment">/* Battery volt channels (in)*/</span>
<a name="l00116"></a><a class="code" href="structmcfg__t.html#mcfg__to12" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to12">00116</a>   <span class="keywordtype">int</span> dmuRate[3];       <span class="comment">/* DMU xyz turn rates */</span>
<a name="l00117"></a><a class="code" href="structmcfg__t.html#mcfg__to13" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to13">00117</a>   <span class="keywordtype">int</span> dmuAccel[3];      <span class="comment">/* DMU xyz accelerations */</span>
<a name="l00118"></a><a class="code" href="structmcfg__t.html#mcfg__to14" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to14">00118</a>   <span class="keywordtype">int</span> taChan;
<a name="l00119"></a><a class="code" href="structmcfg__t.html#mcfg__to15" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to15">00119</a>   <span class="keywordtype">int</span> tbChan;
<a name="l00120"></a><a class="code" href="structmcfg__t.html#mcfg__to16" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html#mcfg__to16">00120</a>   <span class="keywordtype">int</span> batchan[8];
00121 } <a class="code" href="structmcfg__t.html" tppabs="http://dsacss.sourceforge.net/structmcfg__t.html">mcfg_t</a>;
00122 
00123 
00124 
00125 <span class="comment">/* End of data structure definitions */</span>
00126 
00127 
00128 <span class="comment">/* Global constants (and vars ;-&gt; ) */</span>
00129 
<a name="l00130"></a><a class="code" href="satctl_8h.html#a0" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a0">00130</a> <span class="preprocessor">#define CMD_STRLEN 80   </span><span class="comment">/* A default buffer length for serial comm */</span>
<a name="l00131"></a><a class="code" href="satctl_8h.html#a1" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a1">00131</a> <span class="preprocessor">#define MICROMO 1       </span><span class="comment">/* Motor type for MicroMo (MVP2001A01 w/ 3863H024C) */</span>
<a name="l00132"></a><a class="code" href="satctl_8h.html#a2" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a2">00132</a> <span class="preprocessor">#define SMARTMOTOR 2    </span><span class="comment">/* Motor type for SmartMotor (SM3420) */</span>
00133 
<a name="l00134"></a><a class="code" href="satctl_8h.html#a3" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a3">00134</a> <span class="preprocessor">#define DFLT_TVAL 1000000 </span><span class="comment">/* Default timerval in seconds */</span>
<a name="l00135"></a><a class="code" href="satctl_8h.html#a4" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a4">00135</a> <span class="preprocessor">#define SS_TVEL 30.0    </span><span class="comment">/* Spinup target velocity */</span>
<a name="l00136"></a><a class="code" href="satctl_8h.html#a5" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a5">00136</a> <span class="preprocessor">#define SS_TACC 30.0    </span><span class="comment">/* Spinup target acceleration */</span>
<a name="l00137"></a><a class="code" href="satctl_8h.html#a6" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a6">00137</a> <span class="preprocessor">#define SU_TVTOL 2.0    </span><span class="comment">/* Spinup target velocity error tolerance */</span>
00138 
00139 
00140 <span class="preprocessor">#ifdef INMAIN</span>
00141 <span class="preprocessor"></span><span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="satctl_8h.html#a50" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a50">cfgWords</a>[11][9] = {
00142         <span class="stringliteral">"mwport"</span>,
00143         <span class="stringliteral">"mwspeed"</span>,
00144         <span class="stringliteral">"mworder"</span>,
00145         <span class="stringliteral">"laport"</span>,
00146         <span class="stringliteral">"laspeed"</span>,
00147         <span class="stringliteral">"dmuport"</span>,
00148         <span class="stringliteral">"dmuspeed"</span>,
00149         <span class="stringliteral">"dmudata"</span>,
00150         <span class="stringliteral">"thchan"</span>,
00151         <span class="stringliteral">"batchan"</span>,
00152         <span class="stringliteral">""</span>};
00153   <span class="keyword">struct </span>itimerval <a class="code" href="satctl_8h.html#a39" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a39">mtmr1</a>;       <span class="comment">/* Timers for use in measuring acceleration */</span>
00154   <span class="keyword">struct </span>itimerval <a class="code" href="satctl_8h.html#a40" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a40">mtmr2</a>;
00155   <span class="keyword">struct </span>timeval <a class="code" href="satctl_8h.html#a41" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a41">dflt_tv</a>;       <span class="comment">/* The default settings for mtmr1 and mtmr2 */</span>
00156   <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="satctl_8h.html#a43" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a43">MM_SR</a> = 2000.0;           <span class="comment">/* 1/(500usec) = 1/(5e-4) = 2e+3 */</span>
00157 <span class="comment">/*  const float MM_SR = 2000.0;          1/(1000usec) = 1/(1e-3) = 1e+3 */</span>
00158   <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="satctl_8h.html#a42" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a42">MM_ENC_RES</a> = 15.15576;    <span class="comment">/* Effective CPR to calibrate w/ SM */</span>
00159   <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="satctl_8h.html#a44" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a44">SM_VELSF</a> = 64424.5;       <span class="comment">/* cts / rev/sec */</span>
00160   <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="satctl_8h.html#a45" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a45">SM_ACCSF</a> = 15.84;         <span class="comment">/* cts/sec^2 / rev/sec^2 */</span>
00161   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="satctl_8h.html#a46" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a46">LA_ACC</a> = 20;                <span class="comment">/* LA accel */</span>
00162   <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="satctl_8h.html#a47" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a47">LA_VEL</a> = 5;                 <span class="comment">/* LA velocity */</span>
00163   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="satctl_8h.html#a48" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a48">hex_charset</a> = <span class="stringliteral">"0123456789ABCDEF"</span>;
00164   <span class="keywordtype">int</span> <a class="code" href="satctl_8h.html#a49" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a49">debug</a> = 0;
00165 <span class="preprocessor">#else</span>
<a name="l00166"></a><a class="code" href="satctl_8h.html#a39" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a39">00166</a> <span class="preprocessor"></span>  <span class="keyword">extern</span> <span class="keyword">struct </span>itimerval <a class="code" href="satctl_8h.html#a39" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a39">mtmr1</a>;
<a name="l00167"></a><a class="code" href="satctl_8h.html#a40" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a40">00167</a>   <span class="keyword">extern</span> <span class="keyword">struct </span>itimerval <a class="code" href="satctl_8h.html#a40" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a40">mtmr2</a>;
<a name="l00168"></a><a class="code" href="satctl_8h.html#a41" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a41">00168</a>   <span class="keyword">extern</span> <span class="keyword">struct </span>timeval <a class="code" href="satctl_8h.html#a41" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a41">dflt_tv</a>;
<a name="l00169"></a><a class="code" href="satctl_8h.html#a42" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a42">00169</a>   <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="satctl_8h.html#a42" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a42">MM_ENC_RES</a>;
<a name="l00170"></a><a class="code" href="satctl_8h.html#a43" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a43">00170</a>   <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="satctl_8h.html#a43" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a43">MM_SR</a>;
00171 <span class="comment">/*  extern const float MM_RPM_COUNT;</span>
00172 <span class="comment">  extern const float MM_RPS_COUNT;*/</span>
<a name="l00173"></a><a class="code" href="satctl_8h.html#a44" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a44">00173</a>   <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="satctl_8h.html#a44" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a44">SM_VELSF</a>;
<a name="l00174"></a><a class="code" href="satctl_8h.html#a45" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a45">00174</a>   <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">float</span> <a class="code" href="satctl_8h.html#a45" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a45">SM_ACCSF</a>;
<a name="l00175"></a><a class="code" href="satctl_8h.html#a46" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a46">00175</a>   <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="satctl_8h.html#a46" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a46">LA_ACC</a>;
<a name="l00176"></a><a class="code" href="satctl_8h.html#a47" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a47">00176</a>   <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="satctl_8h.html#a47" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a47">LA_VEL</a>;
<a name="l00177"></a><a class="code" href="satctl_8h.html#a48" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a48">00177</a>   <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="satctl_8h.html#a48" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a48">hex_charset</a>;
<a name="l00178"></a><a class="code" href="satctl_8h.html#a49" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a49">00178</a>   <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">int</span> <a class="code" href="satctl_8h.html#a49" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a49">debug</a>;
00179 <span class="preprocessor">#endif</span>
00180 <span class="preprocessor"></span>
<a name="l00181"></a><a class="code" href="satctl_8h.html#a50" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a50">00181</a> <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span> <a class="code" href="satctl_8h.html#a50" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a50">cfgWords</a>[11][9];
00182 
<a name="l00183"></a><a class="code" href="satctl_8h.html#a7" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a7">00183</a> <span class="preprocessor">#define MM_RPS_COUNT 2000/MM_SR*2000/MM_ENC_RES</span>
00184 <span class="preprocessor"></span>                        <span class="comment">/* 2000/MM_SR * 4 * (2000 / (4 * MM_ENC_RES)) */</span>
<a name="l00185"></a><a class="code" href="satctl_8h.html#a8" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a8">00185</a> <span class="preprocessor">#define MM_RPM_COUNT MM_RPS_COUNT/60.0</span>
00186 <span class="preprocessor"></span><span class="comment">/* End of global constants */</span>
00187 
00188 
00189 
00190 <span class="comment">/* Function prototypes and options defines: */</span>
00191 
00192 <span class="comment">/**********************************************************************</span>
00193 <span class="comment"> * Function: mwInit()</span>
00194 <span class="comment"> * Description:  Initialize a momentum wheel.  Open the serial port,</span>
00195 <span class="comment"> *      verify presence of configured motor type, and perform a variety</span>
00196 <span class="comment"> *      of spinup tests.</span>
00197 <span class="comment"> * Arguments:</span>
00198 <span class="comment"> *      wheel  - Wheel to initialize</span>
00199 <span class="comment"> *      action - Bit-mapped flag of startup tests to run</span>
00200 <span class="comment"> * Return Values:</span>
00201 <span class="comment"> *        -1 - Failed to open port</span>
00202 <span class="comment"> *         0 - Initialized OK</span>
00203 <span class="comment"> *         1 - Failed init tests</span>
00204 <span class="comment"> *         2 - Motor not responding</span>
00205 <span class="comment"> * Bugs: none known</span>
00206 <span class="comment"> * Notes: Stable through several program revisions.</span>
00207 <span class="comment"> * Last Update: 6/15/02</span>
00208 <span class="comment"> * Last Updated By: Cengiz Akinli</span>
00209 <span class="comment"> **********************************************************************/</span>
00210 
00211 <span class="keywordtype">int</span> <a class="code" href="satctl_8h.html#a51" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a51">mwInit</a>(<a class="code" href="structwheel__t.html" tppabs="http://dsacss.sourceforge.net/structwheel__t.html">wheel_t</a> *wheel, <span class="keywordtype">int</span> actions);
00212 
00213 <span class="comment">/* Spinup testing will proceed in order down this list.  Simple spinup should</span>
00214 <span class="comment"> * be more than adequate most of the time.  Because of potential for motor</span>
00215 <span class="comment"> * damage, shaking modes will not be immediately coded.</span>
00216 <span class="comment"> */</span>
<a name="l00217"></a><a class="code" href="satctl_8h.html#a9" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a9">00217</a> <span class="preprocessor">#define MWIT_SSPINUP     0x0001 </span><span class="comment">/* Simple spinup to a preset +RPM and check */</span>
<a name="l00218"></a><a class="code" href="satctl_8h.html#a10" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a10">00218</a> <span class="preprocessor">#define MWIT_BDSSPINUP   0x0002 </span><span class="comment">/* Bidirectional simple spinup */</span>
00219 
00220 <span class="comment">/* The below should ONLY be used in failure modes- i.e. to free a stuck motor */</span>
<a name="l00221"></a><a class="code" href="satctl_8h.html#a11" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a11">00221</a> <span class="preprocessor">#define MWIT_RSPINUP_3   0x0004 </span><span class="comment">/* 3-stage ramped current spinup (to 60% max) */</span>
<a name="l00222"></a><a class="code" href="satctl_8h.html#a12" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a12">00222</a> <span class="preprocessor">#define MWIT_BDRSPINUP_3 0x0008 </span><span class="comment">/* Bidirectional 3-stage ramped current */</span>
<a name="l00223"></a><a class="code" href="satctl_8h.html#a13" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a13">00223</a> <span class="preprocessor">#define MWIT_RSPINUP_5   0x0010 </span><span class="comment">/* 5-stage ramped current (to max current) */</span>
<a name="l00224"></a><a class="code" href="satctl_8h.html#a14" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a14">00224</a> <span class="preprocessor">#define MWIT_BDRSPINUP_5 0x0020 </span><span class="comment">/* Bidirectional 5-stage ramped current */</span>
00225 
00226 <span class="comment">/* Last resort only- not implemented as of 11/25/02 */</span>
<a name="l00227"></a><a class="code" href="satctl_8h.html#a15" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a15">00227</a> <span class="preprocessor">#define MWIT_SHAKE_25    0x0040 </span><span class="comment">/* 2 Hz shaking at 25% max current */</span>
<a name="l00228"></a><a class="code" href="satctl_8h.html#a16" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a16">00228</a> <span class="preprocessor">#define MWIT_SHAKE_50    0x0080 </span><span class="comment">/* 2 Hz shaking at 50% max current */</span>
<a name="l00229"></a><a class="code" href="satctl_8h.html#a17" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a17">00229</a> <span class="preprocessor">#define MWIT_SHAKE_75    0x0100 </span><span class="comment">/* 2 Hz shaking at 75% max current */</span>
<a name="l00230"></a><a class="code" href="satctl_8h.html#a18" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a18">00230</a> <span class="preprocessor">#define MWIT_SHAKE_100   0x0200 </span><span class="comment">/* 2 Hz shaking at max current */</span>
00231 
00232 
00233 
00234 <span class="comment">/**********************************************************************</span>
00235 <span class="comment"> * Function: mwStop()</span>
00236 <span class="comment"> * Description:  Shut down a momentum wheel (must be at v=0 to shutdown)</span>
00237 <span class="comment"> * Arguments:</span>
00238 <span class="comment"> *      wheel  - Wheel to initialize</span>
00239 <span class="comment"> *      status - Failure status</span>
00240 <span class="comment"> * Returns:</span>
00241 <span class="comment"> *         0 - Shut down OK</span>
00242 <span class="comment"> *         1 - Motor not at 0 velocity - no action taken</span>
00243 <span class="comment"> *         2 - Motor not responding</span>
00244 <span class="comment"> * Bugs: none known</span>
00245 <span class="comment"> * Notes: Stable through several program revisions.</span>
00246 <span class="comment"> * Last Update: 6/15/02</span>
00247 <span class="comment"> * Last Updated By: Cengiz Akinli</span>
00248 <span class="comment"> **********************************************************************/</span>
00249 
00250 <span class="keywordtype">int</span> <a class="code" href="satctl_8h.html#a52" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a52">mwStop</a>(<a class="code" href="structwheel__t.html" tppabs="http://dsacss.sourceforge.net/structwheel__t.html">wheel_t</a> *wheel);
00251 
00252 
00253 
00254 <span class="comment">/**********************************************************************</span>
00255 <span class="comment"> * Function: mwChangeVel()</span>
00256 <span class="comment"> * Description:  Change a wheel's target velocity</span>
00257 <span class="comment"> * Arguments:</span>
00258 <span class="comment"> *      wheel   - Designated wheel</span>
00259 <span class="comment"> *      params  - Delta-v action parameter structure</span>
00260 <span class="comment"> *      status  - Failure status</span>
00261 <span class="comment"> * Returns:</span>
00262 <span class="comment"> *        -1 - Some failure occured (see status)</span>
00263 <span class="comment"> *         0 - Initialized OK</span>
00264 <span class="comment"> * Bugs: none known</span>
00265 <span class="comment"> * Notes: Transience allows a new velocity to be set for a fixed period</span>
00266 <span class="comment"> *      of time, after which the wheel is returned to the previous</span>
00267 <span class="comment"> *      velocity.  Flagging an action as transient affects how blocking</span>
00268 <span class="comment"> *      is implemented.  When you set the blocking flag for a transient</span>
00269 <span class="comment"> *      action, the function blocks until the wheel returns to the</span>
00270 <span class="comment"> *      previous velocity.  For a non-transient motion, the function</span>
00271 <span class="comment"> *      blocks only for the number of microseconds in the actime</span>
00272 <span class="comment"> *      parameter, which is then counted starting from the beginning of</span>
00273 <span class="comment"> *      the action OR from the time the wheel reaches the target</span>
00274 <span class="comment"> *      velocity, depending on whether the MWCV_TTA or MWCV_TAV flags</span>
00275 <span class="comment"> *      are set respectively.</span>
00276 <span class="comment"> * Last Update: 6/15/02</span>
00277 <span class="comment"> * Last Updated By: Cengiz Akinli</span>
00278 <span class="comment"> **********************************************************************/</span>
00279 
00280 <span class="keywordtype">int</span> <a class="code" href="satctl_8h.html#a53" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a53">mwChangeVel</a>(<a class="code" href="structwheel__t.html" tppabs="http://dsacss.sourceforge.net/structwheel__t.html">wheel_t</a> *wheel, <a class="code" href="structdva__t.html" tppabs="http://dsacss.sourceforge.net/structdva__t.html">dva_t</a> *params, <span class="keywordtype">int</span> *status);
00281 
00282 <span class="comment">/* dva_t flags: */</span>
<a name="l00283"></a><a class="code" href="satctl_8h.html#a19" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a19">00283</a> <span class="preprocessor">#define MWCV_TTA 0x01   </span><span class="comment">/* actime is total time for action (includes accel) */</span>
<a name="l00284"></a><a class="code" href="satctl_8h.html#a20" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a20">00284</a> <span class="preprocessor">#define MWCV_TAV 0x02   </span><span class="comment">/* actime is only time at target vel (excludes accel) */</span>
<a name="l00285"></a><a class="code" href="satctl_8h.html#a21" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a21">00285</a> <span class="preprocessor">#define MWCV_FAOR 0x04  </span><span class="comment">/* Fail on acceleration out of range (and do nothing) */</span>
<a name="l00286"></a><a class="code" href="satctl_8h.html#a22" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a22">00286</a> <span class="preprocessor">#define MWCV_FVOR 0x08  </span><span class="comment">/* Fail on velocity out of range (and do nothing) */</span>
<a name="l00287"></a><a class="code" href="satctl_8h.html#a23" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a23">00287</a> <span class="preprocessor">#define MWCV_BLOCK 0x10 </span><span class="comment">/* Block until end of action.  If non-transient, this</span>
00288 <span class="comment">                         * will end up being the acceleration time. */</span>
<a name="l00289"></a><a class="code" href="satctl_8h.html#a24" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a24">00289</a> <span class="preprocessor">#define MWCV_TRANS 0x20 </span><span class="comment">/* Motion is transient.  Return to previous velocity</span>
00290 <span class="comment">                         * along same acceleration after actime seconds.</span>
00291 <span class="comment">                         * MWCV_BLOCK is implied.  MWCV_TTA and MWCV_TAV</span>
00292 <span class="comment">                         * control behavior in this case.</span>
00293 <span class="comment">                         */</span>
00294 <span class="comment">/* mwChangeVel() status bitmap: */</span>
<a name="l00295"></a><a class="code" href="satctl_8h.html#a25" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a25">00295</a> <span class="preprocessor">#define MWCV_AOR_S 0x01 </span><span class="comment">/* Acceleration overrange failure */</span>
<a name="l00296"></a><a class="code" href="satctl_8h.html#a26" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a26">00296</a> <span class="preprocessor">#define MWCV_VOR_S 0x02 </span><span class="comment">/* Velocity overrange failure */</span>
00297 
00298 
00299 <span class="comment">/* Motion Pak data acquisition</span>
00300 <span class="comment"> * This will be a standalone process forked by the dmuInit call and killed</span>
00301 <span class="comment"> * by the dmuStop call.  It will poll the MP at the selected rate, calculate</span>
00302 <span class="comment"> * the calibrated data and write it to a shared memory segment for pickup by</span>
00303 <span class="comment"> * dmuReadData().  Currently, there is no overflow checking.  Thus, care</span>
00304 <span class="comment"> * should be taken to ensure that the read interval is sufficiently short,</span>
00305 <span class="comment"> * and that the shared mem segment large enough such that the chance of</span>
00306 <span class="comment"> * overwriting unread data is minimized.  Overflow checking, and perhaps</span>
00307 <span class="comment"> * dynamic reallocation, cacheing, and other more sophisticated handling</span>
00308 <span class="comment"> * of data would be a more robust solution, but also could be involved and,</span>
00309 <span class="comment"> * if the existing system is well implemented, it would also be unnecessary.</span>
00310 <span class="comment"> */</span>
00311 
00312 <span class="comment">/* Motion pak data read: */</span>
00313 
00314 <span class="comment">/**********************************************************************</span>
00315 <span class="comment"> * Function: dmuInit()</span>
00316 <span class="comment"> * Description:  Initialize the DMU</span>
00317 <span class="comment"> * Arguments:</span>
00318 <span class="comment"> *     maxBufSz - Maximum number of data sets to buffer (Note: bytesize</span>
00319 <span class="comment"> *                per set will be 7*sizeof(float)).</span>
00320 <span class="comment"> *     rate     - Read rate in reads per second (0 for max allowed by baudrate)</span>
00321 <span class="comment"> *     rpid     - Read process PID - out</span>
00322 <span class="comment"> *     flags    - Bit-mapped flags</span>
00323 <span class="comment"> *</span>
00324 <span class="comment"> * Returns:</span>
00325 <span class="comment"> *        -1 - Could not create FIFO</span>
00326 <span class="comment"> *         0 - Initialized OK</span>
00327 <span class="comment"> *         1 - rate exceeds max</span>
00328 <span class="comment"> *         2 - open() failed on port</span>
00329 <span class="comment"> *         3 - open() failed on data pipe</span>
00330 <span class="comment"> *         4 - open() failed on control pipe</span>
00331 <span class="comment"> *         5 - fork() failed</span>
00332 <span class="comment"> * Bugs: </span>
00333 <span class="comment"> * Notes: See notes above regarding shared mem segment size vs read rates.</span>
00334 <span class="comment"> * Last Update: 7/8/02</span>
00335 <span class="comment"> * Last Updated By: Cengiz Akinli</span>
00336 <span class="comment"> **********************************************************************/</span>
00337 
00338 <span class="keywordtype">int</span> <a class="code" href="dmu_8c.html#a10" tppabs="http://dsacss.sourceforge.net/dmu_8c.html#a10">dmuInit</a>(<span class="keywordtype">long</span> maxBufferSize, <span class="keywordtype">int</span> rate, <span class="keywordtype">int</span> flags);
00339 
<a name="l00340"></a><a class="code" href="satctl_8h.html#a27" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a27">00340</a> <span class="preprocessor">#define DMUI_FBA 0x01   </span><span class="comment">/* On full data buffer, begin averaging data */</span>
<a name="l00341"></a><a class="code" href="satctl_8h.html#a28" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a28">00341</a> <span class="preprocessor">#define DMUI_FBD 0x02   </span><span class="comment">/* On full data buffer, begin dropping data */</span>
<a name="l00342"></a><a class="code" href="satctl_8h.html#a29" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a29">00342</a> <span class="preprocessor">#define DMU_PORT "/dev/mopak"</span>
00343 <span class="preprocessor"></span>
00344 
00345 <span class="comment">/**********************************************************************</span>
00346 <span class="comment"> * Function: dmuStop()</span>
00347 <span class="comment"> * Description:  Shutdown the DMU read process.</span>
00348 <span class="comment"> * Arguments:</span>
00349 <span class="comment"> *         rpid - Read process PID</span>
00350 <span class="comment"> *</span>
00351 <span class="comment"> * Returns:</span>
00352 <span class="comment"> *         0 - OK</span>
00353 <span class="comment"> *         1 - Error on close()</span>
00354 <span class="comment"> * Bugs: </span>
00355 <span class="comment"> * Notes:</span>
00356 <span class="comment"> * Last Update: 7/8/02</span>
00357 <span class="comment"> * Last Updated By: Cengiz Akinli</span>
00358 <span class="comment"> **********************************************************************/</span>
00359 
00360 <span class="keywordtype">int</span> <a class="code" href="satctl_8h.html#a55" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a55">dmuStop</a>(pid_t rpid);
00361 
00362 
00363 
00364 <span class="comment">/**********************************************************************</span>
00365 <span class="comment"> * Function: dmuReadData()</span>
00366 <span class="comment"> * Description:  Read data from the DMU.  This will read ALL buffered</span>
00367 <span class="comment"> *              data with each call.  accData AND ALL of its members</span>
00368 <span class="comment"> *              must be statically allocated in advance.</span>
00369 <span class="comment"> * Arguments:</span>
00370 <span class="comment"> *      accData - Acceleration data struct</span>
00371 <span class="comment"> *      fp      - File pointer to data pipe</span>
00372 <span class="comment"> *      maxsets - Maximum number of sets to read (accData should be</span>
00373 <span class="comment"> *                  pre-allocated for this many sets</span>
00374 <span class="comment"> *</span>
00375 <span class="comment"> *   Returns:</span>
00376 <span class="comment"> *         Data sets read</span>
00377 <span class="comment"> *        -2 - Buffer filled</span>
00378 <span class="comment"> *        -1 - Pipe closed</span>
00379 <span class="comment"> * Bugs: </span>
00380 <span class="comment"> * Notes:</span>
00381 <span class="comment"> * Last Update: 7/8/02</span>
00382 <span class="comment"> * Last Updated By: Cengiz Akinli</span>
00383 <span class="comment"> **********************************************************************/</span>
00384 
00385 <span class="keywordtype">int</span> <a class="code" href="dmu_8c.html#a13" tppabs="http://dsacss.sourceforge.net/dmu_8c.html#a13">dmuReadData</a>(<a class="code" href="structadat__t.html" tppabs="http://dsacss.sourceforge.net/structadat__t.html">adat_t</a> **accData, <span class="keywordtype">int</span> maxsets);
00386 
00387 
00388 __uint16_t <a class="code" href="satctl_8h.html#a57" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a57">mbcrc_16</a>(__uint8_t *ptr, <span class="keywordtype">int</span> len);
00389 
00390 
00391 <span class="comment">/**********************************************************************</span>
00392 <span class="comment"> * Function: laInit()</span>
00393 <span class="comment"> * Description:  Initialize a linear actuator</span>
00394 <span class="comment"> * Arguments:</span>
00395 <span class="comment"> *      lades  - actuator descriptor</span>
00396 <span class="comment"> *      action - Bit-mapped flag of startup tests to run</span>
00397 <span class="comment"> * Return Values:</span>
00398 <span class="comment"> *        -1 - Failed to open port</span>
00399 <span class="comment"> *         0 - Initialized OK</span>
00400 <span class="comment"> *         1 - Move/Wait in progress (sleep and try back later)</span>
00401 <span class="comment"> *         2 - Servo fault requiring power cycle of controller</span>
00402 <span class="comment"> *         3 - Controller not responding</span>
00403 <span class="comment"> *         4 - SP cmd fail during LAIT_CTRA</span>
00404 <span class="comment"> *         5 - Failed to reach limit in la-&gt;mtt</span>
00405 <span class="comment"> * Bugs: none known</span>
00406 <span class="comment"> * Notes: </span>
00407 <span class="comment"> * Last Update: 11/25/02</span>
00408 <span class="comment"> * Last Updated By: Cengiz Akinli</span>
00409 <span class="comment"> **********************************************************************/</span>
00410 
00411 <span class="keywordtype">int</span> <a class="code" href="satctl_8h.html#a58" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a58">laInit</a>(<a class="code" href="structla__t.html" tppabs="http://dsacss.sourceforge.net/structla__t.html">la_t</a> *lades, <span class="keywordtype">int</span> action);
00412 
00413 <span class="comment">/**********************************************************************</span>
00414 <span class="comment"> * Function: laMove()</span>
00415 <span class="comment"> * Description:  Move a linear actuator relative to it current position</span>
00416 <span class="comment"> * Arguments:</span>
00417 <span class="comment"> *      lades  - actuator descriptor</span>
00418 <span class="comment"> *      steps  - distance to move in counts</span>
00419 <span class="comment"> * Return Values:</span>
00420 <span class="comment"> *        -1 - Failed to open port</span>
00421 <span class="comment"> *         0 - Initialized OK</span>
00422 <span class="comment"> *         1 - Move/Wait in progress (sleep and try back later)</span>
00423 <span class="comment"> *         2 - Servo fault requiring power cycle of controller</span>
00424 <span class="comment"> *         3 - Controller not responding</span>
00425 <span class="comment"> *         4 - SP cmd fail during LAIT_CTRA</span>
00426 <span class="comment"> *         5 - Failed to reach limit in la-&gt;mtt</span>
00427 <span class="comment"> * Bugs: none known</span>
00428 <span class="comment"> * Notes: </span>
00429 <span class="comment"> * Last Update: 11/25/02</span>
00430 <span class="comment"> * Last Updated By: Cengiz Akinli</span>
00431 <span class="comment"> **********************************************************************/</span>
00432 
00433 <span class="keywordtype">int</span> <a class="code" href="satctl_8h.html#a59" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a59">laMove</a>(<a class="code" href="structla__t.html" tppabs="http://dsacss.sourceforge.net/structla__t.html">la_t</a> *lades, <span class="keywordtype">int</span> steps);
00434 
<a name="l00435"></a><a class="code" href="satctl_8h.html#a30" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a30">00435</a> <span class="preprocessor">#define LAIT_COMM       0x01    </span><span class="comment">/* Test comm */</span>
<a name="l00436"></a><a class="code" href="satctl_8h.html#a31" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a31">00436</a> <span class="preprocessor">#define LAIT_PRGP       0x02    </span><span class="comment">/* Program presets */</span>
<a name="l00437"></a><a class="code" href="satctl_8h.html#a32" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a32">00437</a> <span class="preprocessor">#define LAIT_JPOS       0x04    </span><span class="comment">/* Jog to positive end */</span>
<a name="l00438"></a><a class="code" href="satctl_8h.html#a33" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a33">00438</a> <span class="preprocessor">#define LAIT_JNEG       0x08    </span><span class="comment">/* Jog to negative end */</span>
<a name="l00439"></a><a class="code" href="satctl_8h.html#a34" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a34">00439</a> <span class="preprocessor">#define LAIT_CTRA       0x10    </span><span class="comment">/* Calc total travel */</span>
<a name="l00440"></a><a class="code" href="satctl_8h.html#a35" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a35">00440</a> <span class="preprocessor">#define LAIT_MCEN       0x20    </span><span class="comment">/* Move to center (after CTRA) */</span>
<a name="l00441"></a><a class="code" href="satctl_8h.html#a36" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a36">00441</a> <span class="preprocessor">#define LAIT_MPOS       0x40    </span><span class="comment">/* Move to positive end (after CTRA) */</span>
<a name="l00442"></a><a class="code" href="satctl_8h.html#a37" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a37">00442</a> <span class="preprocessor">#define LAIT_MNEG       0x80    </span><span class="comment">/* Move to negative end (after CTRA) */</span>
<a name="l00443"></a><a class="code" href="satctl_8h.html#a38" tppabs="http://dsacss.sourceforge.net/satctl_8h.html#a38">00443</a> <span class="preprocessor">#define LAIT_SLIM       5000    </span><span class="comment">/* Soft limit cushion.  This is the closest</span>
00444 <span class="comment">                                 * to the limit switches that the software will</span>
00445 <span class="comment">                                 * allow the actuators to move (except during</span>
00446 <span class="comment">                                 * init, where the switches are set).  Counter</span>
00447 <span class="comment">                                 * resolution is ~ 20,000/inch.*/</span>
00448 
00449 <span class="preprocessor">#endif</span>
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Jun 15 11:49:54 2004 for DSACSS Operational Code by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.png" tppabs="http://dsacss.sourceforge.net/doxygen.png" alt="doxygen" align="middle" border=0 > 
</a>1.3.4 </small></address>
</body>
</html>
