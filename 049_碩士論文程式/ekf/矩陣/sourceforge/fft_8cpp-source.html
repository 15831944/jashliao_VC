<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>fft.cpp Source File</title>
<link href="doxygen.css" tppabs="http://libnurbs.sourceforge.net/docs/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html" tppabs="http://libnurbs.sourceforge.net/docs/index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html" tppabs="http://libnurbs.sourceforge.net/docs/hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html" tppabs="http://libnurbs.sourceforge.net/docs/annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html" tppabs="http://libnurbs.sourceforge.net/docs/files.html">File List</a> &nbsp; <a class="qindex" href="functions.html" tppabs="http://libnurbs.sourceforge.net/docs/functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>fft.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/*</font>
00002 <font class="comment">Fast Fourier/Cosine/Sine Transform</font>
00003 <font class="comment">    dimension   :one</font>
00004 <font class="comment">    data length :power of 2</font>
00005 <font class="comment">    decimation  :frequency</font>
00006 <font class="comment">    radix       :2</font>
00007 <font class="comment">    data        :inplace</font>
00008 <font class="comment">    table       :not use</font>
00009 <font class="comment">functions</font>
00010 <font class="comment">    cdft: Complex Discrete Fourier Transform</font>
00011 <font class="comment">    rdft: Real Discrete Fourier Transform</font>
00012 <font class="comment">    ddct: Discrete Cosine Transform</font>
00013 <font class="comment">    ddst: Discrete Sine Transform</font>
00014 <font class="comment">    dfct: Cosine Transform of RDFT (Real Symmetric DFT)</font>
00015 <font class="comment">    dfst: Sine Transform of RDFT (Real Anti-symmetric DFT)</font>
00016 <font class="comment">function prototypes</font>
00017 <font class="comment">    void cdft(int, double, double, double *);</font>
00018 <font class="comment">    void rdft(int, double, double, double *);</font>
00019 <font class="comment">    void ddct(int, double, double, double *);</font>
00020 <font class="comment">    void ddst(int, double, double, double *);</font>
00021 <font class="comment">    void dfct(int, double, double, double *);</font>
00022 <font class="comment">    void dfst(int, double, double, double *);</font>
00023 <font class="comment"></font>
00024 <font class="comment"></font>
00025 <font class="comment">-------- Complex DFT (Discrete Fourier Transform) --------</font>
00026 <font class="comment">    [definition]</font>
00027 <font class="comment">        &lt;case1&gt;</font>
00028 <font class="comment">            X[k] = sum_j=0^n-1 x[j]*exp(2*pi*i*j*k/n), 0&lt;=k&lt;n</font>
00029 <font class="comment">        &lt;case2&gt;</font>
00030 <font class="comment">            X[k] = sum_j=0^n-1 x[j]*exp(-2*pi*i*j*k/n), 0&lt;=k&lt;n</font>
00031 <font class="comment">        (notes: sum_j=0^n-1 is a summation from j=0 to n-1)</font>
00032 <font class="comment">    [usage]</font>
00033 <font class="comment">        &lt;case1&gt;</font>
00034 <font class="comment">            cdft(2*n, cos(M_PI/n), sin(M_PI/n), a);</font>
00035 <font class="comment">        &lt;case2&gt;</font>
00036 <font class="comment">            cdft(2*n, cos(M_PI/n), -sin(M_PI/n), a);</font>
00037 <font class="comment">    [parameters]</font>
00038 <font class="comment">        2*n          :data length (int)</font>
00039 <font class="comment">                      n &gt;= 1, n = power of 2</font>
00040 <font class="comment">        a[0...2*n-1] :input/output data (double *)</font>
00041 <font class="comment">                      input data</font>
00042 <font class="comment">                          a[2*j] = Re(x[j]), a[2*j+1] = Im(x[j]), 0&lt;=j&lt;n</font>
00043 <font class="comment">                      output data</font>
00044 <font class="comment">                          a[2*k] = Re(X[k]), a[2*k+1] = Im(X[k]), 0&lt;=k&lt;n</font>
00045 <font class="comment">    [remark]</font>
00046 <font class="comment">        Inverse of </font>
00047 <font class="comment">            cdft(2*n, cos(M_PI/n), -sin(M_PI/n), a);</font>
00048 <font class="comment">        is </font>
00049 <font class="comment">            cdft(2*n, cos(M_PI/n), sin(M_PI/n), a);</font>
00050 <font class="comment">            for (j = 0; j &lt;= 2 * n - 1; j++) {</font>
00051 <font class="comment">                a[j] *= 1.0 / n;</font>
00052 <font class="comment">            }</font>
00053 <font class="comment">        .</font>
00054 <font class="comment"></font>
00055 <font class="comment"></font>
00056 <font class="comment">-------- Real DFT / Inverse of Real DFT --------</font>
00057 <font class="comment">    [definition]</font>
00058 <font class="comment">        &lt;case1&gt; RDFT</font>
00059 <font class="comment">            R[k] = sum_j=0^n-1 a[j]*cos(2*pi*j*k/n), 0&lt;=k&lt;=n/2</font>
00060 <font class="comment">            I[k] = sum_j=0^n-1 a[j]*sin(2*pi*j*k/n), 0&lt;k&lt;n/2</font>
00061 <font class="comment">        &lt;case2&gt; IRDFT (excluding scale)</font>
00062 <font class="comment">            a[k] = R[0]/2 + R[n/2]/2 + </font>
00063 <font class="comment">                   sum_j=1^n/2-1 R[j]*cos(2*pi*j*k/n) + </font>
00064 <font class="comment">                   sum_j=1^n/2-1 I[j]*sin(2*pi*j*k/n), 0&lt;=k&lt;n</font>
00065 <font class="comment">    [usage]</font>
00066 <font class="comment">        &lt;case1&gt;</font>
00067 <font class="comment">            rdft(n, cos(M_PI/n), sin(M_PI/n), a);</font>
00068 <font class="comment">        &lt;case2&gt;</font>
00069 <font class="comment">            rdft(n, cos(M_PI/n), -sin(M_PI/n), a);</font>
00070 <font class="comment">    [parameters]</font>
00071 <font class="comment">        n            :data length (int)</font>
00072 <font class="comment">                      n &gt;= 2, n = power of 2</font>
00073 <font class="comment">        a[0...n-1]   :input/output data (double *)</font>
00074 <font class="comment">                      &lt;case1&gt;</font>
00075 <font class="comment">                          output data</font>
00076 <font class="comment">                              a[2*k] = R[k], 0&lt;=k&lt;n/2</font>
00077 <font class="comment">                              a[2*k+1] = I[k], 0&lt;k&lt;n/2</font>
00078 <font class="comment">                              a[1] = R[n/2]</font>
00079 <font class="comment">                      &lt;case2&gt;</font>
00080 <font class="comment">                          input data</font>
00081 <font class="comment">                              a[2*j] = R[j], 0&lt;=j&lt;n/2</font>
00082 <font class="comment">                              a[2*j+1] = I[j], 0&lt;j&lt;n/2</font>
00083 <font class="comment">                              a[1] = R[n/2]</font>
00084 <font class="comment">    [remark]</font>
00085 <font class="comment">        Inverse of </font>
00086 <font class="comment">            rdft(n, cos(M_PI/n), sin(M_PI/n), a);</font>
00087 <font class="comment">        is </font>
00088 <font class="comment">            rdft(n, cos(M_PI/n), -sin(M_PI/n), a);</font>
00089 <font class="comment">            for (j = 0; j &lt;= n - 1; j++) {</font>
00090 <font class="comment">                a[j] *= 2.0 / n;</font>
00091 <font class="comment">            }</font>
00092 <font class="comment">        .</font>
00093 <font class="comment"></font>
00094 <font class="comment"></font>
00095 <font class="comment">-------- DCT (Discrete Cosine Transform) / Inverse of DCT --------</font>
00096 <font class="comment">    [definition]</font>
00097 <font class="comment">        &lt;case1&gt; IDCT (excluding scale)</font>
00098 <font class="comment">            C[k] = sum_j=0^n-1 a[j]*cos(pi*j*(k+1/2)/n), 0&lt;=k&lt;n</font>
00099 <font class="comment">        &lt;case2&gt; DCT</font>
00100 <font class="comment">            C[k] = sum_j=0^n-1 a[j]*cos(pi*(j+1/2)*k/n), 0&lt;=k&lt;n</font>
00101 <font class="comment">    [usage]</font>
00102 <font class="comment">        &lt;case1&gt;</font>
00103 <font class="comment">            ddct(n, cos(M_PI/n/2), sin(M_PI/n/2), a);</font>
00104 <font class="comment">        &lt;case2&gt;</font>
00105 <font class="comment">            ddct(n, cos(M_PI/n/2), -sin(M_PI/n/2), a);</font>
00106 <font class="comment">    [parameters]</font>
00107 <font class="comment">        n            :data length (int)</font>
00108 <font class="comment">                      n &gt;= 2, n = power of 2</font>
00109 <font class="comment">        a[0...n-1]   :input/output data (double *)</font>
00110 <font class="comment">                      output data</font>
00111 <font class="comment">                          a[k] = C[k], 0&lt;=k&lt;n</font>
00112 <font class="comment">    [remark]</font>
00113 <font class="comment">        Inverse of </font>
00114 <font class="comment">            ddct(n, cos(M_PI/n/2), -sin(M_PI/n/2), a);</font>
00115 <font class="comment">        is </font>
00116 <font class="comment">            a[0] *= T(0.5);</font>
00117 <font class="comment">            ddct(n, cos(M_PI/n/2), sin(M_PI/n/2), a);</font>
00118 <font class="comment">            for (j = 0; j &lt;= n - 1; j++) {</font>
00119 <font class="comment">                a[j] *= 2.0 / n;</font>
00120 <font class="comment">            }</font>
00121 <font class="comment">        .</font>
00122 <font class="comment"></font>
00123 <font class="comment"></font>
00124 <font class="comment">-------- DST (Discrete Sine Transform) / Inverse of DST --------</font>
00125 <font class="comment">    [definition]</font>
00126 <font class="comment">        &lt;case1&gt; IDST (excluding scale)</font>
00127 <font class="comment">            S[k] = sum_j=1^n A[j]*sin(pi*j*(k+1/2)/n), 0&lt;=k&lt;n</font>
00128 <font class="comment">        &lt;case2&gt; DST</font>
00129 <font class="comment">            S[k] = sum_j=0^n-1 a[j]*sin(pi*(j+1/2)*k/n), 0&lt;k&lt;=n</font>
00130 <font class="comment">    [usage]</font>
00131 <font class="comment">        &lt;case1&gt;</font>
00132 <font class="comment">            ddst(n, cos(M_PI/n/2), sin(M_PI/n/2), a);</font>
00133 <font class="comment">        &lt;case2&gt;</font>
00134 <font class="comment">            ddst(n, cos(M_PI/n/2), -sin(M_PI/n/2), a);</font>
00135 <font class="comment">    [parameters]</font>
00136 <font class="comment">        n            :data length (int)</font>
00137 <font class="comment">                      n &gt;= 2, n = power of 2</font>
00138 <font class="comment">        a[0...n-1]   :input/output data (double *)</font>
00139 <font class="comment">                      &lt;case1&gt;</font>
00140 <font class="comment">                          input data</font>
00141 <font class="comment">                              a[j] = A[j], 0&lt;j&lt;n</font>
00142 <font class="comment">                              a[0] = A[n]</font>
00143 <font class="comment">                          output data</font>
00144 <font class="comment">                              a[k] = S[k], 0&lt;=k&lt;n</font>
00145 <font class="comment">                      &lt;case2&gt;</font>
00146 <font class="comment">                          output data</font>
00147 <font class="comment">                              a[k] = S[k], 0&lt;k&lt;n</font>
00148 <font class="comment">                              a[0] = S[n]</font>
00149 <font class="comment">    [remark]</font>
00150 <font class="comment">        Inverse of </font>
00151 <font class="comment">            ddst(n, cos(M_PI/n/2), -sin(M_PI/n/2), a);</font>
00152 <font class="comment">        is </font>
00153 <font class="comment">            a[0] *= T(0.5);</font>
00154 <font class="comment">            ddst(n, cos(M_PI/n/2), sin(M_PI/n/2), a);</font>
00155 <font class="comment">            for (j = 0; j &lt;= n - 1; j++) {</font>
00156 <font class="comment">                a[j] *= 2.0 / n;</font>
00157 <font class="comment">            }</font>
00158 <font class="comment">        .</font>
00159 <font class="comment"></font>
00160 <font class="comment"></font>
00161 <font class="comment">-------- Cosine Transform of RDFT (Real Symmetric DFT) --------</font>
00162 <font class="comment">    [definition]</font>
00163 <font class="comment">        C[k] = sum_j=0^n a[j]*cos(pi*j*k/n), 0&lt;=k&lt;=n</font>
00164 <font class="comment">    [usage]</font>
00165 <font class="comment">        dfct(n, cos(M_PI/n), sin(M_PI/n), a);</font>
00166 <font class="comment">    [parameters]</font>
00167 <font class="comment">        n            :data length - 1 (int)</font>
00168 <font class="comment">                      n &gt;= 2, n = power of 2</font>
00169 <font class="comment">        a[0...n]     :input/output data (double *)</font>
00170 <font class="comment">                      output data</font>
00171 <font class="comment">                          a[k] = C[k], 0&lt;=k&lt;=n</font>
00172 <font class="comment">    [remark]</font>
00173 <font class="comment">        Inverse of </font>
00174 <font class="comment">            a[0] *= T(0.5);</font>
00175 <font class="comment">            a[n] *= T(0.5);</font>
00176 <font class="comment">            dfct(n, cos(M_PI/n), sin(M_PI/n), a);</font>
00177 <font class="comment">        is </font>
00178 <font class="comment">            a[0] *= T(0.5);</font>
00179 <font class="comment">            a[n] *= T(0.5);</font>
00180 <font class="comment">            dfct(n, cos(M_PI/n), sin(M_PI/n), a);</font>
00181 <font class="comment">            for (j = 0; j &lt;= n; j++) {</font>
00182 <font class="comment">                a[j] *= 2.0 / n;</font>
00183 <font class="comment">            }</font>
00184 <font class="comment">        .</font>
00185 <font class="comment"></font>
00186 <font class="comment"></font>
00187 <font class="comment">-------- Sine Transform of RDFT (Real Anti-symmetric DFT) --------</font>
00188 <font class="comment">    [definition]</font>
00189 <font class="comment">        S[k] = sum_j=1^n-1 a[j]*sin(pi*j*k/n), 0&lt;k&lt;n</font>
00190 <font class="comment">    [usage]</font>
00191 <font class="comment">        dfst(n, cos(M_PI/n), sin(M_PI/n), a);</font>
00192 <font class="comment">    [parameters]</font>
00193 <font class="comment">        n            :data length + 1 (int)</font>
00194 <font class="comment">                      n &gt;= 2, n = power of 2</font>
00195 <font class="comment">        a[0...n-1]   :input/output data (double *)</font>
00196 <font class="comment">                      output data</font>
00197 <font class="comment">                          a[k] = S[k], 0&lt;k&lt;n</font>
00198 <font class="comment">                      (a[0] is used for work area)</font>
00199 <font class="comment">    [remark]</font>
00200 <font class="comment">        Inverse of </font>
00201 <font class="comment">            dfst(n, cos(M_PI/n), sin(M_PI/n), a);</font>
00202 <font class="comment">        is </font>
00203 <font class="comment">            dfst(n, cos(M_PI/n), sin(M_PI/n), a);</font>
00204 <font class="comment">            for (j = 1; j &lt;= n - 1; j++) {</font>
00205 <font class="comment">                a[j] *= 2.0 / n;</font>
00206 <font class="comment">            }</font>
00207 <font class="comment">        .</font>
00208 <font class="comment">*/</font>
00209 
00210 <font class="preprocessor">#ifndef fft_SOURCES</font>
00211 <font class="preprocessor"></font><font class="preprocessor">#define fft_SOURCES</font>
00212 <font class="preprocessor"></font>
00213 <font class="preprocessor">#include "integrate.h"</font>
00214 
00217 <font class="keyword">namespace </font>PLib {
00218 
00219 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00220 <font class="keywordtype">void</font> bitrv2(<font class="keywordtype">int</font> n, BasicArray&lt;T&gt; &amp;a)
00221 {
00222     <font class="keywordtype">int</font> j, j1, k, k1, l, m, m2, n2;
00223     T xr, xi;
00224     
00225     m = n &gt;&gt; 2;
00226     m2 = m &lt;&lt; 1;
00227     n2 = n - 2;
00228     k = 0;
00229     <font class="keywordflow">for</font> (j = 0; j &lt;= m2 - 4; j += 4) {
00230         <font class="keywordflow">if</font> (j &lt; k) {
00231             xr = a[j];
00232             xi = a[j + 1];
00233             a[j] = a[k];
00234             a[j + 1] = a[k + 1];
00235             a[k] = xr;
00236             a[k + 1] = xi;
00237         } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (j &gt; k) {
00238             j1 = n2 - j;
00239             k1 = n2 - k;
00240             xr = a[j1];
00241             xi = a[j1 + 1];
00242             a[j1] = a[k1];
00243             a[j1 + 1] = a[k1 + 1];
00244             a[k1] = xr;
00245             a[k1 + 1] = xi;
00246         }
00247         k1 = m2 + k;
00248         xr = a[j + 2];
00249         xi = a[j + 3];
00250         a[j + 2] = a[k1];
00251         a[j + 3] = a[k1 + 1];
00252         a[k1] = xr;
00253         a[k1 + 1] = xi;
00254         l = m;
00255         <font class="keywordflow">while</font> (k &gt;= l) {
00256             k -= l;
00257             l &gt;&gt;= 1;
00258         }
00259         k += l;
00260     }
00261 }
00262 
00263 
00264 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00265 <font class="keywordtype">void</font> cdft(<font class="keywordtype">int</font> n, T wr, T wi, BasicArray&lt;T&gt; &amp;a)
00266 {
00267     <font class="keywordtype">int</font> i, j, k, l, m;
00268     T wkr, wki, wdr, wdi, ss, xr, xi;
00269     
00270     m = n;
00271     <font class="keywordflow">while</font> (m &gt; 4) {
00272         l = m &gt;&gt; 1;
00273         wkr = 1;
00274         wki = 0;
00275         wdr = 1 - 2 * wi * wi;
00276         wdi = 2 * wi * wr;
00277         ss = 2 * wdi;
00278         wr = wdr;
00279         wi = wdi;
00280         <font class="keywordflow">for</font> (j = 0; j &lt;= n - m; j += m) {
00281             i = j + l;
00282             xr = a[j] - a[i];
00283             xi = a[j + 1] - a[i + 1];
00284             a[j] += a[i];
00285             a[j + 1] += a[i + 1];
00286             a[i] = xr;
00287             a[i + 1] = xi;
00288             xr = a[j + 2] - a[i + 2];
00289             xi = a[j + 3] - a[i + 3];
00290             a[j + 2] += a[i + 2];
00291             a[j + 3] += a[i + 3];
00292             a[i + 2] = wdr * xr - wdi * xi;
00293             a[i + 3] = wdr * xi + wdi * xr;
00294         }
00295         <font class="keywordflow">for</font> (k = 4; k &lt;= l - 4; k += 4) {
00296             wkr -= ss * wdi;
00297             wki += ss * wdr;
00298             wdr -= ss * wki;
00299             wdi += ss * wkr;
00300             <font class="keywordflow">for</font> (j = k; j &lt;= n - m + k; j += m) {
00301                 i = j + l;
00302                 xr = a[j] - a[i];
00303                 xi = a[j + 1] - a[i + 1];
00304                 a[j] += a[i];
00305                 a[j + 1] += a[i + 1];
00306                 a[i] = wkr * xr - wki * xi;
00307                 a[i + 1] = wkr * xi + wki * xr;
00308                 xr = a[j + 2] - a[i + 2];
00309                 xi = a[j + 3] - a[i + 3];
00310                 a[j + 2] += a[i + 2];
00311                 a[j + 3] += a[i + 3];
00312                 a[i + 2] = wdr * xr - wdi * xi;
00313                 a[i + 3] = wdr * xi + wdi * xr;
00314             }
00315         }
00316         m = l;
00317     }
00318     <font class="keywordflow">if</font> (m &gt; 2) {
00319         <font class="keywordflow">for</font> (j = 0; j &lt;= n - 4; j += 4) {
00320             xr = a[j] - a[j + 2];
00321             xi = a[j + 1] - a[j + 3];
00322             a[j] += a[j + 2];
00323             a[j + 1] += a[j + 3];
00324             a[j + 2] = xr;
00325             a[j + 3] = xi;
00326         }
00327     }
00328     <font class="keywordflow">if</font> (n &gt; 4) {
00329         bitrv2(n, a);
00330     }
00331 }
00332 
00333 
00334 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00335 <font class="keywordtype">void</font> rdft(<font class="keywordtype">int</font> n, T wr, T wi, BasicArray&lt;T&gt; &amp;a)
00336 {
00337     <font class="keywordtype">int</font> j, k;
00338     T wkr, wki, wdr, wdi, ss, xr, xi, yr, yi;
00339     
00340     <font class="keywordflow">if</font> (n &gt; 4) {
00341         wkr = 0;
00342         wki = 0;
00343         wdr = wi * wi;
00344         wdi = wi * wr;
00345         ss = 4 * wdi;
00346         wr = 1 - 2 * wdr;
00347         wi = 2 * wdi;
00348         <font class="keywordflow">if</font> (wi &gt;= 0) {
00349             cdft(n, wr, wi, a);
00350             xi = a[0] - a[1];
00351             a[0] += a[1];
00352             a[1] = xi;
00353         }
00354         <font class="keywordflow">for</font> (k = (n &gt;&gt; 1) - 4; k &gt;= 4; k -= 4) {
00355             j = n - k;
00356             xr = a[k + 2] - a[j - 2];
00357             xi = a[k + 3] + a[j - 1];
00358             yr = wdr * xr - wdi * xi;
00359             yi = wdr * xi + wdi * xr;
00360             a[k + 2] -= yr;
00361             a[k + 3] -= yi;
00362             a[j - 2] += yr;
00363             a[j - 1] -= yi;
00364             wkr += ss * wdi;
00365             wki += ss * (T(0.5) - wdr);
00366             xr = a[k] - a[j];
00367             xi = a[k + 1] + a[j + 1];
00368             yr = wkr * xr - wki * xi;
00369             yi = wkr * xi + wki * xr;
00370             a[k] -= yr;
00371             a[k + 1] -= yi;
00372             a[j] += yr;
00373             a[j + 1] -= yi;
00374             wdr += ss * wki;
00375             wdi += ss * (T(0.5) - wkr);
00376         }
00377         j = n - 2;
00378         xr = a[2] - a[j];
00379         xi = a[3] + a[j + 1];
00380         yr = wdr * xr - wdi * xi;
00381         yi = wdr * xi + wdi * xr;
00382         a[2] -= yr;
00383         a[3] -= yi;
00384         a[j] += yr;
00385         a[j + 1] -= yi;
00386         <font class="keywordflow">if</font> (wi &lt; 0) {
00387             a[1] = T(0.5) * (a[0] - a[1]);
00388             a[0] -= a[1];
00389             cdft(n, wr, wi, a);
00390         }
00391     } <font class="keywordflow">else</font> {
00392         <font class="keywordflow">if</font> (wi &lt; 0) {
00393             a[1] = T(0.5) * (a[0] - a[1]);
00394             a[0] -= a[1];
00395         }
00396         <font class="keywordflow">if</font> (n &gt; 2) {
00397             xr = a[0] - a[2];
00398             xi = a[1] - a[3];
00399             a[0] += a[2];
00400             a[1] += a[3];
00401             a[2] = xr;
00402             a[3] = xi;
00403         }
00404         <font class="keywordflow">if</font> (wi &gt;= 0) {
00405             xi = a[0] - a[1];
00406             a[0] += a[1];
00407             a[1] = xi;
00408         }
00409     }
00410 }
00411 
00412 
00413 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00414 <font class="keywordtype">void</font> ddct(<font class="keywordtype">int</font> n, T wr, T wi, BasicArray&lt;T&gt; &amp;a)
00415 {
00416     <font class="keywordtype">int</font> j, k, m;
00417     T wkr, wki, wdr, wdi, ss, xr;
00418     
00419     <font class="keywordflow">if</font> (n &gt; 2) {
00420         wkr = T(0.5);
00421         wki = T(0.5);
00422         wdr = T(0.5) * (wr - wi);
00423         wdi = T(0.5) * (wr + wi);
00424         ss = 2 * wi;
00425         <font class="keywordflow">if</font> (wi &lt; 0) {
00426             xr = a[n - 1];
00427             <font class="keywordflow">for</font> (k = n - 2; k &gt;= 2; k -= 2) {
00428                 a[k + 1] = a[k] - a[k - 1];
00429                 a[k] += a[k - 1];
00430             }
00431             a[1] = 2 * xr;
00432             a[0] *= 2;
00433             rdft(n, 1 - ss * wi, ss * wr, a);
00434             xr = wdr;
00435             wdr = wdi;
00436             wdi = xr;
00437             ss = -ss;
00438         }
00439         m = n &gt;&gt; 1;
00440         <font class="keywordflow">for</font> (k = 1; k &lt;= m - 3; k += 2) {
00441             j = n - k;
00442             xr = wdi * a[k] - wdr * a[j];
00443             a[k] = wdr * a[k] + wdi * a[j];
00444             a[j] = xr;
00445             wkr -= ss * wdi;
00446             wki += ss * wdr;
00447             xr = wki * a[k + 1] - wkr * a[j - 1];
00448             a[k + 1] = wkr * a[k + 1] + wki * a[j - 1];
00449             a[j - 1] = xr;
00450             wdr -= ss * wki;
00451             wdi += ss * wkr;
00452         }
00453         k = m - 1;
00454         j = n - k;
00455         xr = wdi * a[k] - wdr * a[j];
00456         a[k] = wdr * a[k] + wdi * a[j];
00457         a[j] = xr;
00458         a[m] *= wki + ss * wdr;
00459         <font class="keywordflow">if</font> (wi &gt;= 0) {
00460             rdft(n, 1 - ss * wi, ss * wr, a);
00461             xr = a[1];
00462             <font class="keywordflow">for</font> (k = 2; k &lt;= n - 2; k += 2) {
00463                 a[k - 1] = a[k] - a[k + 1];
00464                 a[k] += a[k + 1];
00465             }
00466             a[n - 1] = xr;
00467         }
00468     } <font class="keywordflow">else</font> {
00469         <font class="keywordflow">if</font> (wi &gt;= 0) {
00470             xr = T(0.5) * (wr + wi) * a[1];
00471             a[1] = a[0] - xr;
00472             a[0] += xr;
00473         } <font class="keywordflow">else</font> {
00474             xr = a[0] - a[1];
00475             a[0] += a[1];
00476             a[1] = T(0.5) * (wr - wi) * xr;
00477         }
00478     }
00479 }
00480 
00481 
00482 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00483 <font class="keywordtype">void</font> ddst(<font class="keywordtype">int</font> n, T wr, T wi, BasicArray&lt;T&gt; &amp;a)
00484 {
00485     <font class="keywordtype">int</font> j, k, m;
00486     T wkr, wki, wdr, wdi, ss, xr;
00487     
00488     <font class="keywordflow">if</font> (n &gt; 2) {
00489         wkr = T(0.5);
00490         wki = T(0.5);
00491         wdr = T(0.5) * (wr - wi);
00492         wdi = T(0.5) * (wr + wi);
00493         ss = 2 * wi;
00494         <font class="keywordflow">if</font> (wi &lt; 0) {
00495             xr = a[n - 1];
00496             <font class="keywordflow">for</font> (k = n - 2; k &gt;= 2; k -= 2) {
00497                 a[k + 1] = a[k] + a[k - 1];
00498                 a[k] -= a[k - 1];
00499             }
00500             a[1] = -2 * xr;
00501             a[0] *= 2;
00502             rdft(n, 1 - ss * wi, ss * wr, a);
00503             xr = wdr;
00504             wdr = -wdi;
00505             wdi = xr;
00506             wkr = -wkr;
00507         }
00508         m = n &gt;&gt; 1;
00509         <font class="keywordflow">for</font> (k = 1; k &lt;= m - 3; k += 2) {
00510             j = n - k;
00511             xr = wdi * a[j] - wdr * a[k];
00512             a[k] = wdr * a[j] + wdi * a[k];
00513             a[j] = xr;
00514             wkr -= ss * wdi;
00515             wki += ss * wdr;
00516             xr = wki * a[j - 1] - wkr * a[k + 1];
00517             a[k + 1] = wkr * a[j - 1] + wki * a[k + 1];
00518             a[j - 1] = xr;
00519             wdr -= ss * wki;
00520             wdi += ss * wkr;
00521         }
00522         k = m - 1;
00523         j = n - k;
00524         xr = wdi * a[j] - wdr * a[k];
00525         a[k] = wdr * a[j] + wdi * a[k];
00526         a[j] = xr;
00527         a[m] *= wki + ss * wdr;
00528         <font class="keywordflow">if</font> (wi &gt;= 0) {
00529             rdft(n, 1 - ss * wi, ss * wr, a);
00530             xr = a[1];
00531             <font class="keywordflow">for</font> (k = 2; k &lt;= n - 2; k += 2) {
00532                 a[k - 1] = a[k + 1] - a[k];
00533                 a[k] += a[k + 1];
00534             }
00535             a[n - 1] = -xr;
00536         }
00537     } <font class="keywordflow">else</font> {
00538         <font class="keywordflow">if</font> (wi &gt;= 0) {
00539             xr = T(0.5) * (wr + wi) * a[1];
00540             a[1] = xr - a[0];
00541             a[0] += xr;
00542         } <font class="keywordflow">else</font> {
00543             xr = a[0] + a[1];
00544             a[0] -= a[1];
00545             a[1] = T(0.5) * (wr - wi) * xr;
00546         }
00547     }
00548 }
00549 
00550 
00551 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00552 <font class="keywordtype">void</font> bitrv(<font class="keywordtype">int</font> n, BasicArray&lt;T&gt; &amp;a)
00553 {
00554     <font class="keywordtype">int</font> j, k, l, m, m2, n1;
00555     T xr;
00556     
00557     <font class="keywordflow">if</font> (n &gt; 2) {
00558         m = n &gt;&gt; 2;
00559         m2 = m &lt;&lt; 1;
00560         n1 = n - 1;
00561         k = 0;
00562         <font class="keywordflow">for</font> (j = 0; j &lt;= m2 - 2; j += 2) {
00563             <font class="keywordflow">if</font> (j &lt; k) {
00564                 xr = a[j];
00565                 a[j] = a[k];
00566                 a[k] = xr;
00567             } <font class="keywordflow">else</font> <font class="keywordflow">if</font> (j &gt; k) {
00568                 xr = a[n1 - j];
00569                 a[n1 - j] = a[n1 - k];
00570                 a[n1 - k] = xr;
00571             }
00572             xr = a[j + 1];
00573             a[j + 1] = a[m2 + k];
00574             a[m2 + k] = xr;
00575             l = m;
00576             <font class="keywordflow">while</font> (k &gt;= l) {
00577                 k -= l;
00578                 l &gt;&gt;= 1;
00579             }
00580             k += l;
00581         }
00582     }
00583 }
00584 
00585 
00586 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00587 <font class="keywordtype">void</font> dfct(<font class="keywordtype">int</font> n, T wr, T wi, BasicArray&lt;T&gt; &amp;a)
00588 {
00589     <font class="keywordtype">int</font> j, k, m, mh;
00590     T xr, xi, an;
00591     
00592     m = n &gt;&gt; 1;
00593     <font class="keywordflow">for</font> (j = 0; j &lt;= m - 1; j++) {
00594         k = n - j;
00595         xr = a[j] + a[k];
00596         a[j] -= a[k];
00597         a[k] = xr;
00598     }
00599     an = a[n];
00600     <font class="keywordflow">while</font> (m &gt;= 2) {
00601         ddct(m, wr, wi, a);
00602         xr = 1 - 2 * wi * wi;
00603         wi *= 2 * wr;
00604         wr = xr;
00605         bitrv(m, a);
00606         mh = m &gt;&gt; 1;
00607         xi = a[m];
00608         a[m] = a[0];
00609         a[0] = an - xi;
00610         an += xi;
00611         <font class="keywordflow">for</font> (j = 1; j &lt;= mh - 1; j++) {
00612             k = m - j;
00613             xr = a[m + k];
00614             xi = a[m + j];
00615             a[m + j] = a[j];
00616             a[m + k] = a[k];
00617             a[j] = xr - xi;
00618             a[k] = xr + xi;
00619         }
00620         xr = a[mh];
00621         a[mh] = a[m + mh];
00622         a[m + mh] = xr;
00623         m = mh;
00624     }
00625     xi = a[1];
00626     a[1] = a[0];
00627     a[0] = an + xi;
00628     a[n] = an - xi;
00629     bitrv(n, a);
00630 }
00631 
00632 
00633 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00634 <font class="keywordtype">void</font> dfst(<font class="keywordtype">int</font> n, T wr, T wi, BasicArray&lt;T&gt; &amp;a)
00635 {
00636     <font class="keywordtype">int</font> j, k, m, mh;
00637     T xr, xi;
00638     
00639     m = n &gt;&gt; 1;
00640     <font class="keywordflow">for</font> (j = 1; j &lt;= m - 1; j++) {
00641         k = n - j;
00642         xr = a[j] - a[k];
00643         a[j] += a[k];
00644         a[k] = xr;
00645     }
00646     a[0] = a[m];
00647     <font class="keywordflow">while</font> (m &gt;= 2) {
00648         ddst(m, wr, wi, a);
00649         xr = 1 - 2 * wi * wi;
00650         wi *= 2 * wr;
00651         wr = xr;
00652         bitrv(m, a);
00653         mh = m &gt;&gt; 1;
00654         <font class="keywordflow">for</font> (j = 1; j &lt;= mh - 1; j++) {
00655             k = m - j;
00656             xr = a[m + k];
00657             xi = a[m + j];
00658             a[m + j] = a[j];
00659             a[m + k] = a[k];
00660             a[j] = xr + xi;
00661             a[k] = xr - xi;
00662         }
00663         a[m] = a[0];
00664         a[0] = a[m + mh];
00665         a[m + mh] = a[mh];
00666         m = mh;
00667     }
00668     a[1] = a[0];
00669     a[0] = 0;
00670     bitrv(n, a);
00671 }
00672 
00673 }
00674 
00675 <font class="preprocessor">#endif</font>
</pre></div><hr><address><small>Generated on Tue Jun 24 13:26:55 2003 for NURBS++ by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.gif" tppabs="http://libnurbs.sourceforge.net/docs/doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
