<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>hnurbsS_sp.cpp Source File</title>
<link href="doxygen.css" tppabs="http://libnurbs.sourceforge.net/docs/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html" tppabs="http://libnurbs.sourceforge.net/docs/index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html" tppabs="http://libnurbs.sourceforge.net/docs/hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html" tppabs="http://libnurbs.sourceforge.net/docs/annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html" tppabs="http://libnurbs.sourceforge.net/docs/files.html">File List</a> &nbsp; <a class="qindex" href="functions.html" tppabs="http://libnurbs.sourceforge.net/docs/functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>hnurbsS_sp.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/*=====================================================================</font>
00002 <font class="comment">        File: hnurbsS_sp.cpp</font>
00003 <font class="comment">     Purpose:       </font>
00004 <font class="comment">    Revision: $Id: hnurbsS_sp.cpp,v 1.2 2002/05/13 21:07:46 philosophil Exp $</font>
00005 <font class="comment">  Created by: Philippe Lavoie          (14 May, 1998)</font>
00006 <font class="comment"> Modified by: </font>
00007 <font class="comment"></font>
00008 <font class="comment"> Copyright notice:</font>
00009 <font class="comment">          Copyright (C) 1996-1997 Philippe Lavoie</font>
00010 <font class="comment"> </font>
00011 <font class="comment">          This library is free software; you can redistribute it and/or</font>
00012 <font class="comment">          modify it under the terms of the GNU Library General Public</font>
00013 <font class="comment">          License as published by the Free Software Foundation; either</font>
00014 <font class="comment">          version 2 of the License, or (at your option) any later version.</font>
00015 <font class="comment"> </font>
00016 <font class="comment">          This library is distributed in the hope that it will be useful,</font>
00017 <font class="comment">          but WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00018 <font class="comment">          MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00019 <font class="comment">          Library General Public License for more details.</font>
00020 <font class="comment"> </font>
00021 <font class="comment">          You should have received a copy of the GNU Library General Public</font>
00022 <font class="comment">          License along with this library; if not, write to the Free</font>
00023 <font class="comment">          Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</font>
00024 <font class="comment">=====================================================================*/</font>
00025 <font class="preprocessor">#include &lt;hnurbsS_sp.h&gt;</font>
00026 <font class="preprocessor">#include &lt;string.h&gt;</font>
00027 
00030 <font class="keyword">namespace </font>PLib {
00031 
00044 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keywordtype">int</font> N&gt;
<a name="l00045"></a><a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a28'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a28">00045</a> <font class="keywordtype">void</font> HNurbsSurfaceSP&lt;T,N&gt;::updateMaxU() {
00046   <font class="keywordflow">if</font>(<a class="code" href="classPLib_1_1NurbsSurface.html#n3" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n3">degU</a>&gt;3){
00047 <font class="preprocessor">#ifdef USE_EXCEPTION</font>
00048 <font class="preprocessor"></font>    <font class="keywordflow">throw</font> <a class="code" href="classNurbsError.html" tppabs="http://libnurbs.sourceforge.net/docs/classNurbsError.html">NurbsError</a>();
00049 <font class="preprocessor">#else</font>
00050 <font class="preprocessor"></font>    Error error(<font class="stringliteral">"HNurbsSurfaceSP&lt;T,N&gt;::updateMaxU()"</font>) ;
00051     error &lt;&lt; <font class="stringliteral">"This class doesn't support surfaces having a degree of 4 and higher.\n"</font> ;
00052     error.fatal() ;
00053 <font class="preprocessor">#endif</font>
00054 <font class="preprocessor"></font>  }
00055   <font class="keywordflow">else</font>{
00056     maxU.resize(<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.rows()) ;
00057     maxAtU_.resize(<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.rows()) ;
00058     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0;i&lt;<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.rows();++i){
00059       <font class="keywordflow">if</font>(!maxInfluence(i,<a class="code" href="classPLib_1_1NurbsSurface.html#n0" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n0">U</a>,<a class="code" href="classPLib_1_1NurbsSurface.html#n3" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n3">degU</a>,maxAtU_[i]))
00060         cerr &lt;&lt; <font class="stringliteral">"Problem in maxInfluence U!\n"</font> ;
00061       maxU[i] = nurbsBasisFun(maxAtU_[i],i,<a class="code" href="classPLib_1_1NurbsSurface.html#n3" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n3">degU</a>,<a class="code" href="classPLib_1_1NurbsSurface.html#n0" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n0">U</a>) ;
00062     }
00063     
00064   }
00065 }
00066 
00079 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keywordtype">int</font> N&gt;
<a name="l00080"></a><a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a29'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a29">00080</a> <font class="keywordtype">void</font> HNurbsSurfaceSP&lt;T,N&gt;::updateMaxV() {
00081   <font class="keywordflow">if</font>(<a class="code" href="classPLib_1_1NurbsSurface.html#n4" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n4">degV</a>&gt;3){
00082 <font class="preprocessor">#ifdef USE_EXCEPTION</font>
00083 <font class="preprocessor"></font>    <font class="keywordflow">throw</font> <a class="code" href="classNurbsError.html" tppabs="http://libnurbs.sourceforge.net/docs/classNurbsError.html">NurbsError</a>();
00084 <font class="preprocessor">#else</font>
00085 <font class="preprocessor"></font>    Error error(<font class="stringliteral">"HNurbsSurfaceSP&lt;T,N&gt;::updateMaxV()"</font>) ;
00086     error &lt;&lt; <font class="stringliteral">"This class doesn't support surfaces having a degree of 4 and higher.\n"</font> ;
00087     error.fatal() ;
00088 <font class="preprocessor">#endif</font>
00089 <font class="preprocessor"></font>  }
00090   <font class="keywordflow">else</font>{
00091     maxV.resize(<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.cols()) ;
00092     maxAtV_.resize(<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.cols()) ;
00093     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0;i&lt;<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.cols();++i){
00094       <font class="keywordflow">if</font>(!maxInfluence(i,<a class="code" href="classPLib_1_1NurbsSurface.html#n1" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n1">V</a>,<a class="code" href="classPLib_1_1NurbsSurface.html#n4" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n4">degV</a>,maxAtV_[i]))
00095         cerr &lt;&lt; <font class="stringliteral">"Problem in maxInfluence V!\n"</font> ;
00096       maxV[i] = nurbsBasisFun(maxAtV_[i],i,<a class="code" href="classPLib_1_1NurbsSurface.html#n4" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n4">degV</a>,<a class="code" href="classPLib_1_1NurbsSurface.html#n1" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n1">V</a>) ;
00097     }
00098     
00099   }
00100 }
00101 
00114 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keywordtype">int</font> N&gt;
<a name="l00115"></a><a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a20'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a20">00115</a> <font class="keywordtype">void</font> HNurbsSurfaceSP&lt;T,N&gt;::modSurfCPby(<font class="keywordtype">int</font> i, <font class="keywordtype">int</font> j, <font class="keyword">const</font> HPoint_nD&lt;T,N&gt;&amp; a) {
00116   offset(i,j) +=  a / (maxU[i]*maxV[j]) ; 
00117   <font class="keywordflow">if</font>(baseLevel_){
00118     Point_nD&lt;T,N&gt; vecOffset ; 
00119     vecOffset = offset(i,j).x()*ivec(i,j) +
00120       offset(i,j).y()*jvec(i,j) +
00121       offset(i,j).z()*kvec(i,j) ;
00122     <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).x() = baseSurf.ctrlPnts()(i,j).x()+vecOffset.x() ;
00123     <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).y() = baseSurf.ctrlPnts()(i,j).y()+vecOffset.y() ;
00124     <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).z() = baseSurf.ctrlPnts()(i,j).z()+vecOffset.z() ;
00125   }
00126   <font class="keywordflow">else</font>
00127     <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j) = offset(i,j) ; 
00128 }
00129 
00150 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keywordtype">int</font> N&gt;
<a name="l00151"></a><a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a21'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a21">00151</a> <font class="keywordtype">void</font> HNurbsSurfaceSP&lt;T,N&gt;::modOnlySurfCPby(<font class="keywordtype">int</font> i, <font class="keywordtype">int</font> j, <font class="keyword">const</font> HPoint_nD&lt;T,N&gt;&amp; a){
00152   <font class="keywordtype">int</font> k ; 
00153 
00154   <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a> = offset ; 
00155 
00156   <font class="comment">// by definition the offset has w = 0 , but this isn't valid for</font>
00157   <font class="comment">// the control points, increasing the w by 1, will generate a valid surface</font>
00158   <font class="keywordflow">if</font>(baseLevel_)
00159     <font class="keywordflow">for</font>(k=0;k&lt;<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.rows();++k)
00160       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> l=0;l&lt;<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.cols();++l)
00161         <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(k,l).w() += T(1) ; 
00162 
00163   <font class="keywordtype">int</font> sizeU, sizeV ;
00164 
00165   sizeU = 2*<a class="code" href="classPLib_1_1NurbsSurface.html#n3" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n3">degU</a>+3 ; 
00166   <font class="keywordflow">if</font>(i-<a class="code" href="classPLib_1_1NurbsSurface.html#n3" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n3">degU</a>-1&lt;0) sizeU += i-<a class="code" href="classPLib_1_1NurbsSurface.html#n3" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n3">degU</a>-1 ; 
00167   <font class="keywordflow">if</font>(i+<a class="code" href="classPLib_1_1NurbsSurface.html#n3" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n3">degU</a>+1&gt;=<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.rows()) sizeU -= i+<a class="code" href="classPLib_1_1NurbsSurface.html#n3" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n3">degU</a>+1-<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.rows() ;
00168 
00169   sizeV = 2*<a class="code" href="classPLib_1_1NurbsSurface.html#n4" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n4">degV</a>+3 ;
00170   <font class="keywordflow">if</font>(j-<a class="code" href="classPLib_1_1NurbsSurface.html#n4" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n4">degV</a>-1&lt;0) sizeV += j-<a class="code" href="classPLib_1_1NurbsSurface.html#n4" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n4">degV</a>-1 ; 
00171   <font class="keywordflow">if</font>(j+<a class="code" href="classPLib_1_1NurbsSurface.html#n4" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n4">degV</a>+1&gt;=<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.cols()) sizeV -= j+<a class="code" href="classPLib_1_1NurbsSurface.html#n4" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n4">degV</a>+1-<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.cols() ;
00172   
00173   Vector&lt;T&gt; u(sizeU) ;
00174   Vector&lt;T&gt; v(sizeV) ;
00175   Vector&lt;Point_nD&lt;T,N&gt; &gt; pts(sizeU*sizeV) ; 
00176   Vector&lt;int&gt; pu(sizeU*sizeV) ;
00177   Vector&lt;int&gt; pv(sizeU*sizeV) ;
00178 
00179   <font class="keywordtype">int</font> n=0;
00180   <font class="keywordtype">int</font> nu = 0 ;
00181   <font class="keywordtype">int</font> nv = 0 ; 
00182   <font class="keywordflow">for</font>(k=i-<a class="code" href="classPLib_1_1NurbsSurface.html#n3" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n3">degU</a>-1;k&lt;=i+<a class="code" href="classPLib_1_1NurbsSurface.html#n3" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n3">degU</a>+1;++k){
00183     <font class="keywordflow">if</font>(k&lt;0)
00184       <font class="keywordflow">continue</font> ;
00185     <font class="keywordflow">if</font>(k&gt;=<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.rows())
00186       <font class="keywordflow">break</font> ; 
00187     nv = 0 ;
00188     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> l=j-<a class="code" href="classPLib_1_1NurbsSurface.html#n4" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n4">degV</a>-1;l&lt;=j+<a class="code" href="classPLib_1_1NurbsSurface.html#n4" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n4">degV</a>+1;++l){
00189       <font class="keywordflow">if</font>(l&lt;0)
00190         <font class="keywordflow">continue</font> ;
00191       <font class="keywordflow">if</font>(l&gt;=<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.cols())
00192         <font class="keywordflow">break</font> ; 
00193       <font class="keywordflow">if</font>( k == i &amp;&amp; j==l){
00194         pts[n].x() = a.x() ; 
00195         pts[n].y() = a.y() ; 
00196         pts[n].z() = a.z() ; 
00197       }
00198       <font class="comment">//else</font>
00199       <font class="comment">//pts[n] = Point_nD&lt;T,N&gt;(0,0,0) ;</font>
00200       pu[n] = nu ; 
00201       pv[n] = nv ; 
00202       <font class="keywordflow">if</font>(k==i){
00203         v[nv] = maxAtV_[l] ; <font class="comment">// only need to initialise this once</font>
00204       }
00205       ++n ;
00206       ++nv ; 
00207     }  
00208     u[nu] = maxAtU_[k] ;
00209     ++nu ; 
00210   }
00211 
00212   u.resize(nu) ;
00213   v.resize(nv) ; 
00214   pts.resize(n) ;
00215   pu.resize(n) ; 
00216   pv.resize(n) ; 
00217 
00218   <font class="keywordflow">if</font>(NurbsSurface&lt;T,N&gt;::movePoint(u,v,pts,pu,pv)){
00219     offset = <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a> ; 
00220     <font class="comment">// an offset shouldn't have a weight value.</font>
00221     <font class="keywordflow">if</font>(baseLevel_)
00222       <font class="keywordflow">for</font>(k=0;k&lt;<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.rows();++k)
00223         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> l=0;l&lt;<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.cols();++l)
00224           offset(k,l).w() -= T(1) ; 
00225   }
00226   <a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a14'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a14">updateSurface</a>(); 
00227 }
00228 
00229 <font class="comment">/*</font>
00230 <font class="comment">  not defined for now. I'm not sure we need it/want it.</font>
00231 <font class="comment"></font>
00232 <font class="comment"> * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * *</font>
00233 <font class="comment">  Modifies the surface point to a certain value.</font>
00234 <font class="comment">  \param i  the row of the surface point</font>
00235 <font class="comment">               j  the column of the surface point</font>
00236 <font class="comment">               a  modify the surface point to this value</font>
00237 <font class="comment">  \return</font>
00238 <font class="comment">  \warning The degree in U and V of the surface must be of 3 or less.</font>
00239 <font class="comment"></font>
00240 <font class="comment">  \author Philippe Lavoie</font>
00241 <font class="comment">  \date 14 May, 1998</font>
00242 <font class="comment"> * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * */</font>
00243 <font class="comment">/*void HNurbsSurfaceSP&lt;T,N&gt;::modSurfCP(int i, int j, const HPoint_nD&lt;T,N&gt;&amp; a) {</font>
00244 <font class="comment">  modSurfCPby(i,j,a-surfP(i,j)) ;</font>
00245 <font class="comment">}</font>
00246 <font class="comment">*/</font>
00247 
00261 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keywordtype">int</font> N&gt;
<a name="l00262"></a><a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a16'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a16">00262</a> HNurbsSurfaceSP&lt;T,N&gt;* HNurbsSurfaceSP&lt;T,N&gt;::addLevel(<font class="keywordtype">int</font> n, <font class="keywordtype">int</font> s) {
00263   HNurbsSurfaceSP&lt;T,N&gt; *newLevel ;
00264 
00265   <font class="keywordflow">if</font>(nextLevel_)
00266     <font class="keywordflow">return</font> 0 ;
00267 
00268   Vector&lt;T&gt; newU,newV ;
00269   
00270   <a class="code" href="classPLib_1_1HNurbsSurface.html#a11" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurface.html#a11">splitUV</a>(n,s,n,s,newU,newV) ;
00271 
00272   newLevel = <font class="keyword">new</font> HNurbsSurfaceSP&lt;T,N&gt;(<font class="keyword">this</font>,newU,newV) ;
00273 
00274   <font class="keywordflow">return</font> newLevel ;
00275 }
00276 
00288 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keywordtype">int</font> N&gt;
<a name="l00289"></a><a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a17'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a17">00289</a> HNurbsSurfaceSP&lt;T,N&gt;* HNurbsSurfaceSP&lt;T,N&gt;::addLevel() {
00290   HNurbsSurfaceSP&lt;T,N&gt; *newLevel ;
00291 
00292   <font class="keywordflow">if</font>(nextLevel_)
00293     <font class="keywordflow">return</font> 0 ;
00294 
00295   newLevel = <font class="keyword">new</font> HNurbsSurfaceSP&lt;T,N&gt;(this) ;
00296 
00297   <font class="keywordflow">return</font> newLevel ;
00298 }
00299 
00308 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keywordtype">int</font> N&gt;
<a name="l00309"></a><a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a18'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a18">00309</a> <font class="keywordtype">void</font> HNurbsSurfaceSP&lt;T,N&gt;::copy(<font class="keyword">const</font> HNurbsSurface&lt;T,N&gt;&amp; nS){
00310   HNurbsSurface&lt;T,N&gt; *levelP ;
00311   levelP = nS.nextLevel() ;
00312 
00313   NurbsSurface&lt;T,N&gt;::operator=(nS) ;
00314   rU = nS.rU ;
00315   rV = nS.rV ;
00316   offset = nS.offset ;
00317 
00318   updateMaxUV() ; 
00319 
00320   firstLevel_ = <font class="keyword">this</font> ;
00321 
00322   <font class="keywordflow">if</font>(levelP){
00323     HNurbsSurfaceSP&lt;T,N&gt; *newLevel ;
00324     newLevel =  <font class="keyword">new</font> HNurbsSurfaceSP&lt;T,N&gt;(this) ; 
00325     newLevel-&gt;copy(*levelP) ;
00326     nextLevel_ = newLevel ;
00327     lastLevel_ = nextLevel_-&gt;lastLevel() ;
00328   }
00329   <font class="keywordflow">else</font>{
00330     lastLevel_ = <font class="keyword">this</font> ;
00331   }
00332 
00333 }
00334 
00349 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keywordtype">int</font> N&gt;
<a name="l00350"></a><a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a14'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a14">00350</a> <font class="keywordtype">void</font> HNurbsSurfaceSP&lt;T,N&gt;::updateSurface(<font class="keywordtype">int</font> i0, <font class="keywordtype">int</font> j0){
00351   <font class="keywordflow">if</font>(i0&gt;=0 &amp;&amp; j0&gt;=0){
00352     <font class="keywordflow">if</font>(offset(i0,j0).x()==0.0 &amp;&amp; offset(i0,j0).y()==0.0 &amp;&amp; offset(i0,j0).z()==0.0)
00353       <font class="keywordflow">return</font> ;
00354   }
00355   <font class="keywordflow">if</font>(baseLevel_){
00356     <font class="keywordflow">if</font>(<a class="code" href="classPLib_1_1HNurbsSurface.html#a23" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurface.html#a23">initBase</a>()){
00357       <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a> = baseSurf.ctrlPnts() ;
00358       <a class="code" href="classPLib_1_1NurbsSurface.html#n0" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n0">U</a> = baseSurf.knotU() ;
00359       <a class="code" href="classPLib_1_1NurbsSurface.html#n1" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n1">V</a> = baseSurf.knotV() ;
00360       <a class="code" href="classPLib_1_1NurbsSurface.html#n3" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n3">degU</a> = baseSurf.degreeU() ;
00361       <a class="code" href="classPLib_1_1NurbsSurface.html#n4" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n4">degV</a> = baseSurf.degreeV() ;
00362       updateMaxUV() ; 
00363     }
00364     <font class="keywordflow">if</font>(i0&gt;=0 &amp;&amp; j0&gt;=0){
00365       Point_nD&lt;T,N&gt; vecOffset ;
00366       vecOffset = offset(i0,j0).x()*ivec(i0,j0) +
00367         offset(i0,j0).y()*jvec(i0,j0) +
00368         offset(i0,j0).z()*kvec(i0,j0) ;
00369       <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i0,j0).x() = baseSurf.ctrlPnts()(i0,j0).x()+vecOffset.x() ;
00370       <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i0,j0).y() = baseSurf.ctrlPnts()(i0,j0).y()+vecOffset.y() ;
00371       <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i0,j0).z() = baseSurf.ctrlPnts()(i0,j0).z()+vecOffset.z() ;
00372     }
00373     <font class="keywordflow">else</font>{
00374       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0;i&lt;<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.rows();++i)
00375         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j=0;j&lt;<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.cols();++j){
00376           <font class="keywordflow">if</font>(offset(i,j).x() != 0 || 
00377              offset(i,j).y() != 0 || offset(i,j).z() || 0){
00378             Point_nD&lt;T,N&gt; vecOffset ;
00379             vecOffset = offset(i,j).x()*ivec(i,j) +
00380               offset(i,j).y()*jvec(i,j) +
00381               offset(i,j).z()*kvec(i,j) ;
00382             <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).x() = baseSurf.ctrlPnts()(i,j).x()+vecOffset.x() ;
00383             <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).y() = baseSurf.ctrlPnts()(i,j).y()+vecOffset.y() ;
00384             <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).z() = baseSurf.ctrlPnts()(i,j).z()+vecOffset.z() ;
00385           }
00386         }
00387     }
00388   }
00389   <font class="keywordflow">else</font>{
00390     <font class="keywordflow">if</font>(i0&gt;=0 &amp;&amp; j0&gt;=0)
00391       <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i0,j0) = offset(i0,j0) ;
00392     <font class="keywordflow">else</font>{
00393       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0;i&lt;<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.rows();++i)
00394         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j=0;j&lt;<a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>.cols();++j){
00395           <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j) = offset(i,j) ;
00396         }
00397     }
00398   }
00399 
00400   ++updateN ;
00401 }
00402 
00411 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keywordtype">int</font> N&gt;
<a name="l00412"></a><a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a15'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a15">00412</a> <font class="keywordtype">void</font> HNurbsSurfaceSP&lt;T,N&gt;::updateLevels(<font class="keywordtype">int</font> upLevel){
00413   <font class="keywordflow">if</font>(!okMax())
00414     updateMaxUV() ; 
00415   <font class="keywordflow">if</font>(upLevel&gt;=0){
00416     <font class="keywordflow">if</font>(level()&lt;=upLevel){
00417       this-&gt;<a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a14'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a14">updateSurface</a>() ;
00418     }
00419   }
00420   <font class="keywordflow">else</font>{
00421     this-&gt;<a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a14'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a14">updateSurface</a>() ;
00422   }
00423 
00424   <font class="keywordflow">if</font>(upLevel&gt;level() || upLevel&lt;0){
00425     <font class="keywordflow">if</font>(nextLevel_)
00426       ((HNurbsSurfaceSP&lt;T,N&gt;*)nextLevel_)-&gt;updateLevels(upLevel) ;
00427   }
00428 }
00429 
00440 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keywordtype">int</font> N&gt;
<a name="l00441"></a><a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a19'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a19">00441</a> <font class="keywordtype">int</font> HNurbsSurfaceSP&lt;T,N&gt;::read(ifstream &amp;fin){
00442   <font class="keywordflow">if</font>(!fin) {
00443     <font class="keywordflow">return</font> 0 ;
00444   }
00445   <font class="keywordtype">int</font> nu,nv,du,dv;
00446   <font class="keywordtype">char</font> *type ;
00447   type = <font class="keyword">new</font> <font class="keywordtype">char</font>[4] ;
00448   <font class="keywordflow">if</font>(!fin.read(type,<font class="keyword">sizeof</font>(<font class="keywordtype">char</font>)*4)) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00449   <font class="keywordtype">int</font> r1 = strncmp(type,<font class="stringliteral">"hns3"</font>,4) ;
00450   <font class="keywordtype">int</font> r2 = strncmp(type,<font class="stringliteral">"hns4"</font>,4) ;
00451   <font class="keywordtype">int</font> r3 = strncmp(type,<font class="stringliteral">"hnso"</font>,4) ;
00452   <font class="keywordflow">if</font>(!(r1 || r2 || r3)) 
00453     <font class="keywordflow">return</font> 0 ;
00454   T *p,*p2 ;
00455   <font class="keywordflow">if</font>(!r1 || !r2){
00456     <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)&amp;nu,<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>))) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00457     <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)&amp;nv,<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>))) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00458     <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)&amp;du,<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>))) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00459     <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)&amp;dv,<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>))) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00460     
00461     <a class="code" href="classPLib_1_1NurbsSurface.html#a15" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#a15">resize</a>(nu,nv,du,dv) ;
00462     
00463     <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)<a class="code" href="classPLib_1_1NurbsSurface.html#n0" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n0">U</a>.memory(),<font class="keyword">sizeof</font>(T)*<a class="code" href="classPLib_1_1NurbsSurface.html#n0" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n0">U</a>.n())) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00464     <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)<a class="code" href="classPLib_1_1NurbsSurface.html#n1" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n1">V</a>.memory(),<font class="keyword">sizeof</font>(T)*<a class="code" href="classPLib_1_1NurbsSurface.html#n1" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n1">V</a>.n())) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00465     
00466     <font class="keywordflow">if</font>(!r1){
00467       p = <font class="keyword">new</font> T[3*nu*nv] ;
00468       <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)p,<font class="keyword">sizeof</font>(T)*3*nu*nv)) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00469       p2 = p ;
00470       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0;i&lt;nu;i++)
00471         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j=0;j&lt;nv;j++){
00472           <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).x() = *(p++) ;
00473           <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).y() = *(p++) ;
00474           <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).z() = *(p++) ;
00475           <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).w() = 1.0 ;
00476         }
00477       <font class="keyword">delete</font> []p2 ;
00478     }
00479     <font class="keywordflow">else</font>{
00480       p = <font class="keyword">new</font> T[4*nu*nv] ;
00481       <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)p,<font class="keyword">sizeof</font>(T)*4*nu*nv)) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00482       p2 = p ;
00483       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0;i&lt;nu;i++)
00484         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j=0;j&lt;nv;j++){
00485           <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).x() = *(p++) ;
00486           <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).y() = *(p++) ;
00487           <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).z() = *(p++) ;
00488           <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a>(i,j).w() = *(p++) ;
00489         }
00490       <font class="keyword">delete</font> []p2 ;
00491     }
00492     offset = <a class="code" href="classPLib_1_1NurbsSurface.html#n2" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1NurbsSurface.html#n2">P</a> ;
00493     this-&gt;<a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a14'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a14">updateSurface</a>() ;
00494   }
00495   <font class="keywordflow">else</font> { <font class="comment">// reading the offset information</font>
00496     <font class="keywordtype">int</font> ru,rv ;
00497     <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)&amp;ru,<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>))) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00498     <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)&amp;rv,<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>))) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00499     rU.resize(ru) ;
00500     rV.resize(rv) ;
00501     <font class="keywordflow">if</font>(rU.n()&gt;0)
00502       <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)rU.memory(),<font class="keyword">sizeof</font>(T)*rU.n())) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00503     <font class="keywordflow">if</font>(rV.n()&gt;0)
00504       <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)rV.memory(),<font class="keyword">sizeof</font>(T)*rV.n())) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00505     
00506     <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)&amp;nu,<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>))) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00507     <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)&amp;nv,<font class="keyword">sizeof</font>(<font class="keywordtype">int</font>))) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00508 
00509     p = <font class="keyword">new</font> T[4*nu*nv] ;
00510     <font class="keywordflow">if</font>(!fin.read((<font class="keywordtype">char</font>*)p,<font class="keyword">sizeof</font>(T)*4*nu*nv)) { <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 0 ;}
00511     p2 = p ;
00512     offset.resize(nu,nv) ;
00513     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=0;i&lt;nu;i++)
00514       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j=0;j&lt;nv;j++){
00515         offset(i,j).x() = *(p++) ;
00516         offset(i,j).y() = *(p++) ;
00517         offset(i,j).z() = *(p++) ;
00518         offset(i,j).w() = *(p++) ;
00519       }
00520     <font class="keyword">delete</font> []p2 ;    
00521     --baseUpdateN ;
00522     this-&gt;<a class="code" href="javascript:if(confirm('http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html  \n\nThis file was not retrieved by Teleport Pro, because it was unavailable, or its retrieval was aborted, or the project was stopped too soon.  \n\nDo you want to open it from the server?'))window.location='http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a14'" tppabs="http://libnurbs.sourceforge.net/docs/classPLib_1_1HNurbsSurfaceSP.html#a14">updateSurface</a>() ;
00523   }
00524 
00525   <font class="comment">// now we must read all the level information (if any)</font>
00526   <font class="keywordtype">char</font> *ptxt ;
00527   ptxt = <font class="keyword">new</font> <font class="keywordtype">char</font>[7] ;
00528   <font class="comment">// the following line is used so that purify doesn't give a warning</font>
00529   ptxt[0] = ptxt[1] = ptxt[2] = ptxt[3] = ptxt[4] = ptxt[5] = ptxt[6] = 0 ;
00530   <font class="keywordtype">int</font> mark  = fin.tellg() ;
00531   <font class="keywordflow">if</font>(!fin.read(ptxt,<font class="keyword">sizeof</font>(<font class="keywordtype">char</font>)*5))
00532     { <font class="keyword">delete</font> []ptxt ; <font class="keyword">delete</font> []type ; <font class="keywordflow">return</font> 1 ; }
00533   <font class="keywordtype">char</font> *pat ;
00534   pat = strstr(ptxt,<font class="stringliteral">"level"</font>) ;
00535   <font class="keywordflow">if</font>(pat){
00536     <font class="comment">// insert a new level</font>
00537     HNurbsSurfaceSP&lt;T,N&gt; *newPatch = <font class="keyword">new</font> HNurbsSurfaceSP&lt;T,N&gt;(this) ; 
00538     <font class="keywordflow">if</font>(newPatch){
00539       <font class="keywordflow">if</font>(!newPatch-&gt;read(fin)) 
00540         <font class="keywordflow">return</font> 0 ;      
00541     }
00542     <font class="keywordflow">else</font>
00543       <font class="keywordflow">return</font> 0 ;
00544   }
00545   <font class="keywordflow">else</font>{ 
00546     <font class="comment">// something else is after the HNurbs</font>
00547     <font class="comment">// restore were the file was before the read</font>
00548     fin.seekg(mark);
00549   }
00550 
00551   <font class="keyword">delete</font> []ptxt ;
00552   <font class="keyword">delete</font> []type ;
00553   <font class="keywordflow">return</font> 1 ;
00554 }
00555 
00556 } <font class="comment">// end namespace</font>
</pre></div><hr><address><small>Generated on Tue Jun 24 13:26:55 2003 for NURBS++ by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.gif" tppabs="http://libnurbs.sourceforge.net/docs/doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
