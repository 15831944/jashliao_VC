<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>intccq.cpp Source File</title>
<link href="doxygen.css" tppabs="http://libnurbs.sourceforge.net/docs/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html" tppabs="http://libnurbs.sourceforge.net/docs/index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html" tppabs="http://libnurbs.sourceforge.net/docs/hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html" tppabs="http://libnurbs.sourceforge.net/docs/annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html" tppabs="http://libnurbs.sourceforge.net/docs/files.html">File List</a> &nbsp; <a class="qindex" href="functions.html" tppabs="http://libnurbs.sourceforge.net/docs/functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>intccq.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/*=============================================================================</font>
00002 <font class="comment">        File: intccq.cpp</font>
00003 <font class="comment">     Purpose:       </font>
00004 <font class="comment">    Revision: $Id: intccq.cpp,v 1.2 2002/05/13 21:07:45 philosophil Exp $</font>
00005 <font class="comment">  Created by: Philippe Lavoie          (3 Oct, 1996)</font>
00006 <font class="comment"> Modified by: </font>
00007 <font class="comment"></font>
00008 <font class="comment"> Copyright notice:</font>
00009 <font class="comment">          Copyright (C) 1996-1998 Philippe Lavoie</font>
00010 <font class="comment"> </font>
00011 <font class="comment">          This library is free software; you can redistribute it and/or</font>
00012 <font class="comment">          modify it under the terms of the GNU Library General Public</font>
00013 <font class="comment">          License as published by the Free Software Foundation; either</font>
00014 <font class="comment">          version 2 of the License, or (at your option) any later version.</font>
00015 <font class="comment"> </font>
00016 <font class="comment">          This library is distributed in the hope that it will be useful,</font>
00017 <font class="comment">          but WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00018 <font class="comment">          MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00019 <font class="comment">          Library General Public License for more details.</font>
00020 <font class="comment"> </font>
00021 <font class="comment">          You should have received a copy of the GNU Library General Public</font>
00022 <font class="comment">          License along with this library; if not, write to the Free</font>
00023 <font class="comment">          Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</font>
00024 <font class="comment">=============================================================================*/</font>
00025 
00026 <font class="preprocessor">#ifndef intccqq_SOURCES</font>
00027 <font class="preprocessor"></font><font class="preprocessor">#define intccqq_SOURCES</font>
00028 <font class="preprocessor"></font>
00029 
00030 <font class="comment">/*</font>
00031 <font class="comment">Clenshaw-Curtis-Quadrature</font>
00032 <font class="comment">Numerical Automatic Integrator</font>
00033 <font class="comment">    method    : Chebyshev Series Expansion</font>
00034 <font class="comment">    dimension : one</font>
00035 <font class="comment">    table     : use</font>
00036 <font class="comment">function</font>
00037 <font class="comment">    intcc  : integrator of f(x) over [a,b].</font>
00038 <font class="comment">necessary package</font>
00039 <font class="comment">    fft2f.c  : FFT package</font>
00040 <font class="comment">*/</font>
00041 
00042 <font class="comment">/*</font>
00043 <font class="comment">intcc</font>
00044 <font class="comment">    [description]</font>
00045 <font class="comment">        I = integral of f(x) over [a,b]</font>
00046 <font class="comment">    [declaration]</font>
00047 <font class="comment">        void intccini(int lenw, double *w);</font>
00048 <font class="comment">        void intcc(double (*f)(double), double a, double b, double eps, </font>
00049 <font class="comment">            int lenw, double *w, double *i, double *err);</font>
00050 <font class="comment">    [usage]</font>
00051 <font class="comment">        intccini(lenw, w);  // initialization of w</font>
00052 <font class="comment">        ...</font>
00053 <font class="comment">        intcc(f, a, b, eps, lenw, w, &amp;i, &amp;err);</font>
00054 <font class="comment">    [parameters]</font>
00055 <font class="comment">        lenw      : (length of w[]) - 1 (int)</font>
00056 <font class="comment">        w         : work area and weights of the quadrature </font>
00057 <font class="comment">                    formula, w[0...lenw] (double *)</font>
00058 <font class="comment">        f         : integrand f(x) (double (*f)(double))</font>
00059 <font class="comment">        a         : lower limit of integration (double)</font>
00060 <font class="comment">        b         : upper limit of integration (double)</font>
00061 <font class="comment">        eps       : relative error requested (double)</font>
00062 <font class="comment">        i         : approximation to the integral (double *)</font>
00063 <font class="comment">        err       : estimate of the absolute error (double *)</font>
00064 <font class="comment">    [remarks]</font>
00065 <font class="comment">        initial parameters</font>
00066 <font class="comment">            lenw &gt;= 14 and </font>
00067 <font class="comment">            lenw &gt; (maximum number of f(x) evaluations) * 3 / 2</font>
00068 <font class="comment">            example :</font>
00069 <font class="comment">                lenc = 3200;</font>
00070 <font class="comment">        function</font>
00071 <font class="comment">            f(x) needs to be analytic over [a,b].</font>
00072 <font class="comment">        relative error</font>
00073 <font class="comment">            eps is relative error requested excluding </font>
00074 <font class="comment">            cancellation of significant digits.</font>
00075 <font class="comment">            i.e. eps means : (absolute error) / </font>
00076 <font class="comment">                             (integral_a^b |f(x)| dx).</font>
00077 <font class="comment">            eps does not mean : (absolute error) / I.</font>
00078 <font class="comment">        error message</font>
00079 <font class="comment">            err &gt;= 0 : normal termination.</font>
00080 <font class="comment">            err &lt; 0  : abnormal termination (n &gt; nmax).</font>
00081 <font class="comment">                       i.e. convergent error is detected :</font>
00082 <font class="comment">                           1. f(x) or (d/dx)^n f(x) has </font>
00083 <font class="comment">                              discontinuous points or sharp </font>
00084 <font class="comment">                              peaks over [a,b].</font>
00085 <font class="comment">                              you must use other routine.</font>
00086 <font class="comment">                           2. relative error of f(x) is </font>
00087 <font class="comment">                              greater than eps.</font>
00088 <font class="comment">                           3. f(x) has oscillatory factor </font>
00089 <font class="comment">                              and frequency of the oscillation </font>
00090 <font class="comment">                              is very high.</font>
00091 <font class="comment">*/</font>
00092 
00093 
00094 <font class="preprocessor">#include "integrate.h"</font>
00095 <font class="preprocessor">#include &lt;math.h&gt;</font>
00096 
00099 <font class="keyword">namespace </font>PLib {
00100 
00111 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00112 <font class="keywordtype">void</font> intccini(BasicArray&lt;T&gt; &amp;w)
00113 {
00114   <font class="keywordtype">int</font> lenw = w.n() - 1 ; 
00115   <font class="keywordtype">int</font> j, k, l, m;
00116   T cos2, sin1, sin2, hl;
00117     
00118   cos2 = 0;
00119   sin1 = 1;
00120   sin2 = 1;
00121   hl = T(0.5);
00122   k = lenw;
00123   l = 2;
00124   <font class="keywordflow">while</font> (l &lt; k - l - 1) {
00125     w[0] = hl * T(0.5);
00126     <font class="keywordflow">for</font> (j = 1; j &lt;= l; j++) {
00127       w[j] = hl / (1 - 4 * j * j);
00128     }
00129     w[l] *= T(0.5);
00130     dfct(l, T(0.5) * cos2, sin1, w);
00131     cos2 = sqrt(2 + cos2);
00132     sin1 /= cos2;
00133     sin2 /= 2 + cos2;
00134     w[k] = sin2;
00135     w[k - 1] = w[0];
00136     w[k - 2] = w[l];
00137     k -= 3;
00138     m = l;
00139     <font class="keywordflow">while</font> (m &gt; 1) {
00140       m &gt;&gt;= 1;
00141       <font class="keywordflow">for</font> (j = m; j &lt;= l - m; j += (m &lt;&lt; 1)) {
00142         w[k] = w[j];
00143         k--;
00144       }
00145     }
00146     hl *= T(0.5);
00147     l *= 2;
00148   }
00149 }
00150 
00151 
00207 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keyword">class</font> OPPtr&gt;
00208 T intcc(OPPtr f, T a, T b, T eps, BasicArray&lt;T&gt; &amp;w, T&amp; err)
00209 {
00210   T i ; 
00211   <font class="keywordtype">int</font> j, k, l;
00212   T esf, eref, erefh, hh, ir, iback, irback, ba, ss, x, y, fx, 
00213     errir;
00214   <font class="keywordtype">int</font> lenw = w.n() - 1 ;
00215   esf = 10;
00216   ba = T(0.5) * (b - a);
00217   ss = 2 * w[lenw];
00218   x = ba * w[lenw];
00219   w[0] = T(0.5) * (*f)(a);
00220   w[3] = T(0.5) * (*f)(b);
00221   w[2] = (*f)(a + x);
00222   w[4] = (*f)(b - x);
00223   w[1] = (*f)(a + ba);
00224   eref = T(0.5) * (fabs(w[0]) + fabs(w[1]) + fabs(w[2]) + fabs(w[3]) + 
00225                    fabs(w[4]));
00226   w[0] += w[3];
00227   w[2] += w[4];
00228   ir = w[0] + w[1] + w[2];
00229   i = w[0] * w[lenw - 1] + w[1] * w[lenw - 2] + w[2] * w[lenw - 3];
00230   erefh = eref * sqrt(eps);
00231   eref *= eps;
00232   hh = T(0.25);
00233   l = 2;
00234   k = lenw - 5;
00235   <font class="keywordflow">do</font> {
00236     iback = i;
00237     irback = ir;
00238     x = ba * w[k + 1];
00239     y = 0;
00240     i = w[0] * w[k];
00241     <font class="keywordflow">for</font> (j = 1; j &lt;= l; j++) {
00242       x += y;
00243       y += ss * (ba - x);
00244       fx = (*f)(a + x) + (*f)(b - x);
00245       ir += fx;
00246       i += w[j] * w[k - j] + fx * w[k - j - l];
00247       w[j + l] = fx;
00248     }
00249     ss = 2 * w[k + 1];
00250     err = esf * l * fabs(i - iback);
00251     hh *= T(0.25);
00252     errir = hh * fabs(ir - 2 * irback);
00253     l *= 2;
00254     k -= l + 2;
00255   } <font class="keywordflow">while</font> ((err &gt; erefh || errir &gt; eref) &amp;&amp; k &gt; 4 * l);
00256   i *= b - a;
00257   <font class="keywordflow">if</font> (err &gt; erefh || errir &gt; eref) {
00258     err *= -fabs(b - a);
00259   } <font class="keywordflow">else</font> {
00260     err = eref * fabs(b - a);
00261   }
00262   <font class="keywordflow">return</font> i ;
00263 }
00264 
00320 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keyword">class</font> OPPtr&gt;
00321 T intcc2(OPPtr f, T a, T b, T eps, BasicArray&lt;T&gt; w, T&amp; err)
00322 {
00323   T i ; 
00324   <font class="keywordtype">int</font> j, k, l;
00325   T esf, eref, erefh, hh, ir, iback, irback, ba, ss, x, y, fx, 
00326     errir;
00327   <font class="keywordtype">int</font> lenw = w.n() - 1 ;
00328   esf = 10;
00329   ba = T(0.5) * (b - a);
00330   ss = 2 * w[lenw];
00331   x = ba * w[lenw];
00332   w[0] = T(0.5) * (*f)(a);
00333   w[3] = T(0.5) * (*f)(b);
00334   w[2] = (*f)(a + x);
00335   w[4] = (*f)(b - x);
00336   w[1] = (*f)(a + ba);
00337   eref = T(0.5) * (fabs(w[0]) + fabs(w[1]) + fabs(w[2]) + fabs(w[3]) + 
00338                    fabs(w[4]));
00339   w[0] += w[3];
00340   w[2] += w[4];
00341   ir = w[0] + w[1] + w[2];
00342   i = w[0] * w[lenw - 1] + w[1] * w[lenw - 2] + w[2] * w[lenw - 3];
00343   erefh = eref * sqrt(eps);
00344   eref *= eps;
00345   hh = T(0.25);
00346   l = 2;
00347   k = lenw - 5;
00348   <font class="keywordflow">do</font> {
00349     iback = i;
00350     irback = ir;
00351     x = ba * w[k + 1];
00352     y = 0;
00353     i = w[0] * w[k];
00354     <font class="keywordflow">for</font> (j = 1; j &lt;= l; j++) {
00355       x += y;
00356       y += ss * (ba - x);
00357       fx = (*f)(a + x) + (*f)(b - x);
00358       ir += fx;
00359       i += w[j] * w[k - j] + fx * w[k - j - l];
00360       w[j + l] = fx;
00361     }
00362     ss = 2 * w[k + 1];
00363     err = esf * l * fabs(i - iback);
00364     hh *= T(0.25);
00365     errir = hh * fabs(ir - 2 * irback);
00366     l *= 2;
00367     k -= l + 2;
00368   } <font class="keywordflow">while</font> ((err &gt; erefh || errir &gt; eref) &amp;&amp; k &gt; 4 * l);
00369   i *= b - a;
00370   <font class="keywordflow">if</font> (err &gt; erefh || errir &gt; eref) {
00371     err *= -fabs(b - a);
00372   } <font class="keywordflow">else</font> {
00373     err = eref * fabs(b - a);
00374   }
00375   <font class="keywordflow">return</font> i ;
00376 }
00377 
00378 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keyword">class</font> OPPtr&gt; 
00379 T integrate(OPPtr f, T a, T b, T eps, <font class="keywordtype">int</font> n, T &amp;err) {
00380   BasicArray&lt;T&gt; w(n) ; 
00381   intccini(w) ; 
00382   <font class="keywordflow">return</font> intcc(f,a,b,eps,w,err) ; 
00383 }
00384 
00385 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keyword">class</font> OPPtr&gt; 
00386 T integrate2(OPPtr f, T a, T b, T eps, <font class="keywordtype">int</font> n, T &amp;err) {
00387   BasicArray&lt;T&gt; w(n) ; 
00388   intccini(w) ; 
00389   <font class="keywordflow">return</font> intcc2(f,a,b,eps,w,err) ; 
00390 }
00391 
00447 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keyword">class</font> OPvPtr&gt;
00448 T intcc(OPvPtr f, <font class="keywordtype">void</font>* userData, T a, T b, T eps, BasicArray&lt;T&gt; &amp;w, T&amp; err)
00449 {
00450   T i ; 
00451   <font class="keywordtype">int</font> j, k, l;
00452   T esf, eref, erefh, hh, ir, iback, irback, ba, ss, x, y, fx, 
00453     errir;
00454   <font class="keywordtype">int</font> lenw = w.n() - 1 ;
00455   esf = 10;
00456   ba = T(0.5) * (b - a);
00457   ss = 2 * w[lenw];
00458   x = ba * w[lenw];
00459   w[0] = T(0.5) * (*f)(a,userData);
00460   w[3] = T(0.5) * (*f)(b,userData);
00461   w[2] = (*f)(a + x,userData);
00462   w[4] = (*f)(b - x,userData);
00463   w[1] = (*f)(a + ba,userData);
00464   eref = T(0.5) * (fabs(w[0]) + fabs(w[1]) + fabs(w[2]) + fabs(w[3]) + 
00465                    fabs(w[4]));
00466   w[0] += w[3];
00467   w[2] += w[4];
00468   ir = w[0] + w[1] + w[2];
00469   i = w[0] * w[lenw - 1] + w[1] * w[lenw - 2] + w[2] * w[lenw - 3];
00470   erefh = eref * sqrt(eps);
00471   eref *= eps;
00472   hh = T(0.25);
00473   l = 2;
00474   k = lenw - 5;
00475   <font class="keywordflow">do</font> {
00476     iback = i;
00477     irback = ir;
00478     x = ba * w[k + 1];
00479     y = 0;
00480     i = w[0] * w[k];
00481     <font class="keywordflow">for</font> (j = 1; j &lt;= l; j++) {
00482       x += y;
00483       y += ss * (ba - x);
00484       fx = (*f)(a + x,userData) + (*f)(b - x,userData);
00485       ir += fx;
00486       i += w[j] * w[k - j] + fx * w[k - j - l];
00487       w[j + l] = fx;
00488     }
00489     ss = 2 * w[k + 1];
00490     err = esf * l * fabs(i - iback);
00491     hh *= T(0.25);
00492     errir = hh * fabs(ir - 2 * irback);
00493     l *= 2;
00494     k -= l + 2;
00495   } <font class="keywordflow">while</font> ((err &gt; erefh || errir &gt; eref) &amp;&amp; k &gt; 4 * l);
00496   i *= b - a;
00497   <font class="keywordflow">if</font> (err &gt; erefh || errir &gt; eref) {
00498     err *= -fabs(b - a);
00499   } <font class="keywordflow">else</font> {
00500     err = eref * fabs(b - a);
00501   }
00502   <font class="keywordflow">return</font> i ;
00503 }
00504 
00560 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keyword">class</font> OPvPtr&gt;
00561 T intcc2(OPvPtr f, <font class="keywordtype">void</font>* userData, T a, T b, T eps, BasicArray&lt;T&gt; w, T&amp; err)
00562 {
00563   T i ; 
00564   <font class="keywordtype">int</font> j, k, l;
00565   T esf, eref, erefh, hh, ir, iback, irback, ba, ss, x, y, fx, 
00566     errir;
00567   <font class="keywordtype">int</font> lenw = w.n() - 1 ;
00568   esf = 10;
00569   ba = T(0.5) * (b - a);
00570   ss = 2 * w[lenw];
00571   x = ba * w[lenw];
00572   w[0] = T(0.5) * (*f)(a,userData);
00573   w[3] = T(0.5) * (*f)(b,userData);
00574   w[2] = (*f)(a + x,userData);
00575   w[4] = (*f)(b - x,userData);
00576   w[1] = (*f)(a + ba,userData);
00577   eref = T(0.5) * (fabs(w[0]) + fabs(w[1]) + fabs(w[2]) + fabs(w[3]) + 
00578                    fabs(w[4]));
00579   w[0] += w[3];
00580   w[2] += w[4];
00581   ir = w[0] + w[1] + w[2];
00582   i = w[0] * w[lenw - 1] + w[1] * w[lenw - 2] + w[2] * w[lenw - 3];
00583   erefh = eref * sqrt(eps);
00584   eref *= eps;
00585   hh = T(0.25);
00586   l = 2;
00587   k = lenw - 5;
00588   <font class="keywordflow">do</font> {
00589     iback = i;
00590     irback = ir;
00591     x = ba * w[k + 1];
00592     y = 0;
00593     i = w[0] * w[k];
00594     <font class="keywordflow">for</font> (j = 1; j &lt;= l; j++) {
00595       x += y;
00596       y += ss * (ba - x);
00597       fx = (*f)(a + x,userData) + (*f)(b - x,userData);
00598       ir += fx;
00599       i += w[j] * w[k - j] + fx * w[k - j - l];
00600       w[j + l] = fx;
00601     }
00602     ss = 2 * w[k + 1];
00603     err = esf * l * fabs(i - iback);
00604     hh *= T(0.25);
00605     errir = hh * fabs(ir - 2 * irback);
00606     l *= 2;
00607     k -= l + 2;
00608   } <font class="keywordflow">while</font> ((err &gt; erefh || errir &gt; eref) &amp;&amp; k &gt; 4 * l);
00609   i *= b - a;
00610   <font class="keywordflow">if</font> (err &gt; erefh || errir &gt; eref) {
00611     err *= -fabs(b - a);
00612   } <font class="keywordflow">else</font> {
00613     err = eref * fabs(b - a);
00614   }
00615   <font class="keywordflow">return</font> i ;
00616 }
00617 
00618 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keyword">class</font> OPvPtr&gt; 
00619 T integrate(OPvPtr f, <font class="keywordtype">void</font>* userData, T a, T b, T eps, <font class="keywordtype">int</font> n, T &amp;err) {
00620   BasicArray&lt;T&gt; w(n) ; 
00621   intccini(w) ; 
00622   <font class="keywordflow">return</font> intcc(f,userData,a,b,eps,w,err) ; 
00623 }
00624 
00625 <font class="keyword">template</font> &lt;<font class="keyword">class</font> T, <font class="keyword">class</font> OPvPtr&gt; 
00626 T integrate2(OPvPtr f, <font class="keywordtype">void</font>* userData, T a, T b, T eps, <font class="keywordtype">int</font> n, T &amp;err) {
00627   BasicArray&lt;T&gt; w(n) ; 
00628   intccini(w) ; 
00629   <font class="keywordflow">return</font> intcc2(f,userData,a,b,eps,w,err) ; 
00630 }
00631 
00632 
00633 
00634 }
00635 
00636 
00637 <font class="preprocessor">#endif</font>
</pre></div><hr><address><small>Generated on Tue Jun 24 13:26:55 2003 for NURBS++ by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.gif" tppabs="http://libnurbs.sourceforge.net/docs/doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
