<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>rec_filter.cpp Source File</title>
<link href="doxygen.css" tppabs="http://libnurbs.sourceforge.net/docs/doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.2.14 -->
<center>
<a class="qindex" href="index.html" tppabs="http://libnurbs.sourceforge.net/docs/index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html" tppabs="http://libnurbs.sourceforge.net/docs/hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="annotated.html" tppabs="http://libnurbs.sourceforge.net/docs/annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html" tppabs="http://libnurbs.sourceforge.net/docs/files.html">File List</a> &nbsp; <a class="qindex" href="functions.html" tppabs="http://libnurbs.sourceforge.net/docs/functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>rec_filter.cpp</h1><div class="fragment"><pre>00001 <font class="comment">/*=============================================================================</font>
00002 <font class="comment">        File: rec_filter.cpp</font>
00003 <font class="comment">     Purpose:</font>
00004 <font class="comment">    Revision: $Id: rec_filter.cpp,v 1.3 2003/05/15 02:34:55 philosophil Exp $</font>
00005 <font class="comment">  Created by: Philippe Lavoie          (18 February 1999)</font>
00006 <font class="comment"> Modified by: </font>
00007 <font class="comment"></font>
00008 <font class="comment"> Copyright notice:</font>
00009 <font class="comment">          Copyright (C) 1996-1997 Philippe Lavoie</font>
00010 <font class="comment"> </font>
00011 <font class="comment">          This library is free software; you can redistribute it and/or</font>
00012 <font class="comment">          modify it under the terms of the GNU Library General Public</font>
00013 <font class="comment">          License as published by the Free Software Foundation; either</font>
00014 <font class="comment">          version 2 of the License, or (at your option) any later version.</font>
00015 <font class="comment"> </font>
00016 <font class="comment">          This library is distributed in the hope that it will be useful,</font>
00017 <font class="comment">          but WITHOUT ANY WARRANTY; without even the implied warranty of</font>
00018 <font class="comment">          MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU</font>
00019 <font class="comment">          Library General Public License for more details.</font>
00020 <font class="comment"> </font>
00021 <font class="comment">          You should have received a copy of the GNU Library General Public</font>
00022 <font class="comment">          License along with this library; if not, write to the Free</font>
00023 <font class="comment">          Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.</font>
00024 <font class="comment">=============================================================================*/</font>
00025 
00026 <font class="preprocessor">#ifndef REC_FILTER_SOURCE</font>
00027 <font class="preprocessor"></font><font class="preprocessor">#define REC_FILTER_SOURCE</font>
00028 <font class="preprocessor"></font>
00029 <font class="preprocessor">#include "rec_filter.h"</font>
00030 
00033 <font class="keyword">namespace </font>PLib{
00034 
00035 <font class="keywordtype">void</font> toParams(<font class="keywordtype">double</font> a1, <font class="keywordtype">double</font> a2, <font class="keywordtype">double</font> a3, <font class="keywordtype">double</font> a4, <font class="keywordtype">double</font> a5, <font class="keywordtype">double</font> a6, <font class="keywordtype">double</font> a7, <font class="keywordtype">double</font> a8, <font class="keywordtype">double</font> b1, <font class="keywordtype">double</font> b2, <font class="keywordtype">double</font> c1, <font class="keywordtype">double</font> c2, <font class="keywordtype">double</font> k, Params&amp; params){
00036   params.a1 = a1 ;
00037   params.a2 = a2 ;
00038   params.a3 = a3 ;
00039   params.a4 = a4 ;
00040   params.a5 = a5 ;
00041   params.a6 = a6 ;
00042   params.a7 = a7 ;
00043   params.a8 = a8 ;
00044   params.b1 = b1 ;
00045   params.b2 = b2 ;
00046   params.c1 = c1 ;
00047   params.c2 = c2 ; 
00048   params.k = k ;
00049 }
00050 
00051 <font class="keywordtype">void</font> fromParams(<font class="keyword">const</font> Params&amp; params, <font class="keywordtype">double</font> &amp;a1, <font class="keywordtype">double</font> &amp;a2, <font class="keywordtype">double</font> &amp;a3, <font class="keywordtype">double</font> &amp;a4, <font class="keywordtype">double</font> &amp;a5, <font class="keywordtype">double</font> &amp;a6, <font class="keywordtype">double</font> &amp;a7, <font class="keywordtype">double</font> &amp;a8, <font class="keywordtype">double</font> &amp;b1, <font class="keywordtype">double</font> &amp;b2, <font class="keywordtype">double</font> &amp;c1, <font class="keywordtype">double</font> &amp;c2, <font class="keywordtype">double</font> &amp;k){
00052   a1 = params.a1 ;
00053   a2 = params.a2 ;
00054   a3 = params.a3 ;
00055   a4 = params.a4 ;
00056   a5 = params.a5 ;
00057   a6 = params.a6 ;
00058   a7 = params.a7 ;
00059   a8 = params.a8 ;
00060   b1 = params.b1 ;
00061   b2 = params.b2 ;
00062   c1 = params.c1 ;
00063   c2 = params.c2 ; 
00064   k = params.k ;
00065 }
00066 
00067 <font class="keywordtype">void</font> generalRFx(<font class="keyword">const</font> Params&amp; params, <font class="keyword">const</font> Basic2DArray&lt;double&gt; &amp;x, Basic2DArray&lt;double&gt; &amp;y){
00068   Basic2DArray&lt;double&gt; y1,y2 ;
00069   y1.resize(x);
00070   y2.resize(x);
00071   y.resize(x);
00072   
00073   <font class="keywordtype">double</font> a1,a2,a3,a4,a5,a6,a7,a8 ;
00074   <font class="keywordtype">double</font> b1,b2 ;
00075   <font class="keywordtype">double</font> c1,c2 ;
00076   <font class="keywordtype">double</font> k ;
00077   
00078   fromParams(params,a1,a2,a3,a4,a5,a6,a7,a8,b1,b2,c1,c2,k) ;
00079   <font class="keywordtype">int</font> i,j ;
00080   <font class="keyword">const</font> <font class="keywordtype">int</font> rows = x.rows() ;
00081   <font class="keyword">const</font> <font class="keywordtype">int</font> cols = x.cols() ; 
00082   
00083   <font class="keywordflow">for</font>(i=0;i&lt;rows-1;++i){
00084     y1(i,0) = a1*x(i,0) ;
00085     y1(i,1) = a1*x(i,1) + a2*x(i,0) + b1*y1(i,0) ;
00086     <font class="keywordflow">for</font>(j=2;j&lt;cols-1;++j){
00087       y1(i,j) = a1*x(i,j) + a2*x(i,j-1) + b1*y1(i,j-1) + b2*y1(i,j-2) ;
00088     }
00089   }
00090 
00091   <font class="keywordflow">for</font>(i=rows-1;i&gt;=0;--i){
00092     j = cols-1 ;
00093     y2(i,j) = 0 ;
00094     y(i,j) = c1*(y1(i,j)+y2(i,j));
00095     j = cols-2 ;
00096     y2(i,j) = a3*x(i,j+1) + b1*y2(i,j+1) ;
00097     y(i,j) = c1*(y1(i,j)+y2(i,j));
00098     <font class="keywordflow">for</font>(j=cols-3;j&gt;=0;--j){
00099       y2(i,j) = a3*x(i,j+1) + a4*x(i,j+2) + b1*y2(i,j+1) + b2*y2(i,j+2) ;
00100       y(i,j) = c1*(y1(i,j)+y2(i,j));
00101     }
00102   }  
00103 
00104 }
00105 
00106 
00107 <font class="keywordtype">void</font> generalRFy(<font class="keyword">const</font> Params&amp; params, <font class="keyword">const</font> Basic2DArray&lt;double&gt; &amp;r, Basic2DArray&lt;double&gt; &amp;y){
00108   Basic2DArray&lt;double&gt; y1,y2 ;
00109   y1.resize(r);
00110   y2.resize(r);
00111   y.resize(r);
00112   
00113   <font class="keywordtype">double</font> a1,a2,a3,a4,a5,a6,a7,a8 ;
00114   <font class="keywordtype">double</font> b1,b2 ;
00115   <font class="keywordtype">double</font> c1,c2 ;
00116   <font class="keywordtype">double</font> k ;
00117   
00118   fromParams(params,a1,a2,a3,a4,a5,a6,a7,a8,b1,b2,c1,c2,k) ;
00119   <font class="keywordtype">int</font> i,j ;
00120   <font class="keyword">const</font> <font class="keywordtype">int</font> rows = r.rows() ;
00121   <font class="keyword">const</font> <font class="keywordtype">int</font> cols = r.cols() ; 
00122   
00123   <font class="keywordflow">for</font>(j=0;j&lt;cols-1;++j){
00124     y1(0,j) = a5*r(0,j) ;
00125     y1(1,j) = a5*r(1,j) + a6*r(0,j) + b1*y1(0,j);
00126     <font class="keywordflow">for</font>(i=2;i&lt;rows-1;++i){
00127       y1(i,j) = a5*r(i,j) + a6*r(i-1,j) + b1*y1(i-1,j) + b2*y1(i-2,j) ;
00128     }
00129   }
00130 
00131   <font class="keywordflow">for</font>(j=cols-1;j&gt;=0;--j){
00132     i = rows-1 ;
00133     y2(i,j) = 0 ;
00134     y(i,j) = c2*(y1(i,j)+y2(i,j));
00135     i = rows-2 ;
00136     y2(i,j) = a7*r(i+1,j) + b1*y2(i+1,j) ;
00137     y(i,j) = c2*(y1(i,j)+y2(i,j));    
00138     <font class="keywordflow">for</font>(i=rows-3;i&gt;=0;--i){
00139       y2(i,j) = a7*r(i+1,j) + a8*r(i+2,j) + b1*y2(i+1,j) + b2*y2(i+2,j) ;
00140       y(i,j) = c2*(y1(i,j)+y2(i,j));
00141     }
00142   }
00143 }
00144 
00145 
00146 
00147 <font class="keywordtype">void</font> generalRF(<font class="keyword">const</font> Params&amp; params, <font class="keyword">const</font> Basic2DArray&lt;double&gt; &amp;x, Basic2DArray&lt;double&gt; &amp;y){
00148   Basic2DArray&lt;double&gt; y1,y2,r ;
00149   y1.resize(x);
00150   y2.resize(x);
00151   r.resize(x) ;
00152   y.resize(x);
00153   
00154   <font class="keywordtype">double</font> a1,a2,a3,a4,a5,a6,a7,a8 ;
00155   <font class="keywordtype">double</font> b1,b2 ;
00156   <font class="keywordtype">double</font> c1,c2 ;
00157   <font class="keywordtype">double</font> k ;
00158   
00159   fromParams(params,a1,a2,a3,a4,a5,a6,a7,a8,b1,b2,c1,c2,k) ;
00160 
00161   <font class="keywordtype">int</font> i,j ;
00162   <font class="keyword">const</font> <font class="keywordtype">int</font> rows = x.rows() ;
00163   <font class="keyword">const</font> <font class="keywordtype">int</font> cols = x.cols() ; 
00164   
00165   <font class="keywordflow">for</font>(i=0;i&lt;rows-1;++i){
00166     y1(i,0) = a1*x(i,0) ;
00167     y1(i,1) = a1*x(i,1) + a2*x(i,0) + b1*y1(i,0) ;
00168     <font class="keywordflow">for</font>(j=2;j&lt;cols-1;++j){
00169       y1(i,j) = a1*x(i,j) + a2*x(i,j-1) + b1*y1(i,j-1) + b2*y1(i,j-2) ;
00170     }
00171   }
00172 
00173   <font class="keywordflow">for</font>(i=rows-1;i&gt;=0;--i){
00174     j = cols-1 ;
00175     y2(i,j) = 0 ;
00176     r(i,j) = c1*(y1(i,j)+y2(i,j));
00177     j = cols-2 ;
00178     y2(i,j) = a3*x(i,j+1) + b1*y2(i,j+1) ;
00179     r(i,j) = c1*(y1(i,j)+y2(i,j));
00180     <font class="keywordflow">for</font>(j=cols-3;j&gt;=0;--j){
00181       y2(i,j) = a3*x(i,j+1) + a4*x(i,j+2) + b1*y2(i,j+1) + b2*y2(i,j+2) ;
00182       r(i,j) = c1*(y1(i,j)+y2(i,j));
00183     }
00184   }  
00185 
00186   <font class="keywordflow">for</font>(j=0;j&lt;cols-1;++j){
00187     y1(0,j) = a5*r(0,j) ;
00188     y1(1,j) = a5*r(1,j) + a6*r(0,j) + b1*y1(0,j);
00189     <font class="keywordflow">for</font>(i=2;i&lt;rows-1;++i){
00190       y1(i,j) = a5*r(i,j) + a6*r(i-1,j) + b1*y1(i-1,j) + b2*y1(i-2,j) ;
00191     }
00192   }
00193 
00194   <font class="keywordflow">for</font>(j=cols-1;j&gt;=0;--j){
00195     i = rows-1 ;
00196     y2(i,j) = 0 ;
00197     y(i,j) = c2*(y1(i,j)+y2(i,j));
00198     i = rows-2 ;
00199     y2(i,j) = a7*r(i+1,j) + b1*y2(i+1,j) ;
00200     y(i,j) = c2*(y1(i,j)+y2(i,j));    
00201     <font class="keywordflow">for</font>(i=rows-3;i&gt;=0;--i){
00202       y2(i,j) = a7*r(i+1,j) + a8*r(i+2,j) + b1*y2(i+1,j) + b2*y2(i+2,j) ;
00203       y(i,j) = c2*(y1(i,j)+y2(i,j));
00204     }
00205   }
00206 
00207 }
00208 
00209 <font class="keywordtype">void</font> smooth2ndOrder(Params&amp; params, <font class="keywordtype">double</font> alpha){
00210   <font class="keyword">const</font> <font class="keywordtype">double</font> expa = exp(-alpha) ;
00211   <font class="keyword">const</font> <font class="keywordtype">double</font> expa2 = exp(-2*alpha) ;
00212   params.k = (1-expa)*(1-expa)/(1+2*alpha*expa-expa2) ;
00213   params.b1 = 2*expa ;
00214   params.b2 = -expa2 ;
00215   params.a1 = params.a5 = params.k ;
00216   params.a2 = params.a6 = params.k*expa*(alpha-1) ;
00217   params.a3 = params.a7 = params.k*expa*(alpha+1) ;
00218   params.a4 = params.a8 = -params.k*expa2;
00219   params.c1 = params.c2 = 1 ;
00220 }
00221 
00222 <font class="keywordtype">void</font> xderiv2ndOrderSmooth(Params&amp; params, <font class="keywordtype">double</font> alpha){
00223   <font class="keyword">const</font> <font class="keywordtype">double</font> expa = exp(-alpha) ;
00224   <font class="keyword">const</font> <font class="keywordtype">double</font> expa2 = exp(-2*alpha) ;
00225   params.k = (1-expa)*(1-expa)/(1+2*alpha*expa-expa2) ;
00226   params.b1 = 2*expa ;
00227   params.b2 = -expa2 ;
00228   params.a1 = 0 ;
00229   params.a2 = 1 ;
00230   params.a3 = -1 ;
00231   params.a4 = 0 ;
00232   params.a5 = params.k ;
00233   params.a6 = params.k*expa*(alpha-1) ;
00234   params.a7 = params.k*expa*(alpha+1) ;
00235   params.a8 = -params.k*expa2 ;
00236   params.c1 = -1*(1-expa)*(1-expa);
00237   params.c2 = 1 ;
00238 }
00239 
00240 <font class="keywordtype">void</font> yderiv2ndOrderSmooth(Params&amp; params, <font class="keywordtype">double</font> alpha){
00241   <font class="keyword">const</font> <font class="keywordtype">double</font> expa = exp(-alpha) ;
00242   <font class="keyword">const</font> <font class="keywordtype">double</font> expa2 = exp(-2*alpha) ;
00243   params.k = (1-expa)*(1-expa)/(1+2*alpha*expa-expa2) ;
00244   params.b1 = 2*expa ;
00245   params.b2 = -expa2 ;
00246   params.a1 = params.k ;
00247   params.a2 = params.k*expa*(alpha-1) ;
00248   params.a3 = params.k*expa*(alpha+1) ;
00249   params.a4 = -params.k*expa2 ;
00250   params.a5 = 0 ;
00251   params.a6 = 1 ;
00252   params.a7 = -1 ;
00253   params.a8 = 0 ;
00254   params.c1 = 1 ;
00255   params.c2 = -1*(1-expa)*(1-expa);
00256 }
00257 
00258 <font class="keywordtype">void</font> xderiv2ndOrder(Params&amp; params, <font class="keywordtype">double</font> alpha){
00259   <font class="keyword">const</font> <font class="keywordtype">double</font> expa = exp(-alpha) ;
00260   <font class="keyword">const</font> <font class="keywordtype">double</font> expa2 = exp(-2*alpha) ;
00261   params.k = (1-expa)*(1-expa)/(expa) ;
00262   params.b1 = 2*expa ;
00263   params.b2 = -2*expa2 ;
00264   params.a1 = 0 ;
00265   params.a2 = 1 ;
00266   params.a3 = -1 ;
00267   params.a4 = 0 ;
00268   params.c1 = params.k*expa ;
00269   params.c2 = params.k*expa ;
00270 }
00271 
00272 <font class="keywordtype">void</font> yderiv2ndOrder(Params&amp; params, <font class="keywordtype">double</font> alpha){
00273   <font class="keyword">const</font> <font class="keywordtype">double</font> expa = exp(-alpha) ;
00274   <font class="keyword">const</font> <font class="keywordtype">double</font> expa2 = exp(-2*alpha) ;
00275   params.k = (1-expa)*(1-expa)/(expa) ;
00276   params.b1 = 2*expa ;
00277   params.b2 = -2*expa2 ;
00278   params.a5 = 0 ;
00279   params.a6 = 1 ;
00280   params.a7 = -1 ;
00281   params.a8 = 0 ;
00282   params.c1 = params.k*expa ;
00283   params.c2 = params.k*expa ;
00284 }
00285 
00286 <font class="keywordtype">void</font> smooth1stOrder(Params&amp; params, <font class="keywordtype">double</font> alpha, <font class="keywordtype">double</font> k0){
00287   <font class="keyword">const</font> <font class="keywordtype">double</font> expa = exp(-alpha) ;
00288   params.k = (1-expa)/(1+expa) ; <font class="comment">//(1-exp(-2*alpha))/(2*alpha*expa) ; </font>
00289   params.b1 = expa ;
00290   params.b2 = 0;
00291   params.a1 = 1 ;
00292   params.a2 = 0 ;
00293   params.a3 = expa ;
00294   params.a4 = 0 ;
00295   params.a5 = 1 ;
00296   params.a6 = 0 ;
00297   params.a7 = expa ;
00298   params.a8 = 0 ;
00299   params.c1 = params.k ;
00300   params.c2 = params.k ;
00301 }
00302 
00303 <font class="keywordtype">void</font> LL1stOrder(Params&amp; params, <font class="keywordtype">double</font> alpha){
00304   <font class="keyword">const</font> <font class="keywordtype">double</font> expa = exp(-alpha) ;
00305   <font class="keyword">const</font> <font class="keywordtype">double</font> expa2 = exp(-2*alpha);
00306   params.k = (1-expa2)/(2*alpha*expa) ; <font class="comment">//(1-expa)/(1+expa) ;</font>
00307   params.b1 = 2*expa ;
00308   params.b2 = -expa2;
00309   params.a1 = 0 ;
00310   params.a2 = 1 ;
00311   params.a3 = 1 ;
00312   params.a4 = 0 ;
00313   params.a5 = 0 ;
00314   params.a6 = 1 ;
00315   params.a7 = 1 ;
00316   params.a8 = 0 ;
00317   params.c1 = params.c2 = (1-expa2)/2 ;
00318 }
00319 
00320 <font class="keywordtype">void</font> ubyteToDouble(<font class="keyword">const</font> Basic2DArray&lt;unsigned char&gt;&amp; img, Basic2DArray&lt;double&gt;&amp; mat){
00321   mat.resize(img.rows(),img.cols());
00322   <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=img.rows()-1;i&gt;=0;--i)
00323     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j=img.cols()-1;j&gt;=0;--j)
00324       mat(i,j) = img(i,j) ;
00325 }
00326 
00327 <font class="keywordtype">void</font> doubleToUbyte(<font class="keyword">const</font> Basic2DArray&lt;double&gt;&amp; mat, Basic2DArray&lt;unsigned char&gt;&amp; img){
00328   img.resize(mat.rows(),mat.cols());
00329   <font class="keywordflow">for</font>(<font class="keywordtype">int</font> i=img.rows()-1;i&gt;=0;--i)
00330     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j=img.cols()-1;j&gt;=0;--j)
00331       img(i,j) = (<font class="keywordtype">unsigned</font> <font class="keywordtype">char</font>)mat(i,j) ;
00332 }
00333 
00334 <font class="keywordtype">double</font> quadInterp(<font class="keywordtype">double</font> x, <font class="keywordtype">double</font> x0, <font class="keywordtype">double</font> f0, <font class="keywordtype">double</font> x1, <font class="keywordtype">double</font> f1, <font class="keywordtype">double</font> x2, <font class="keywordtype">double</font> f2){
00335   <font class="keyword">const</font> <font class="keywordtype">double</font> f01 = firstDivDiff(x0,f0,x1,f1) ;
00336   <font class="keyword">const</font> <font class="keywordtype">double</font> f012 = secondDivDiff(x0,f0,x1,f1,x2,f2);
00337   <font class="keywordtype">double</font> fx = f0 + (x-x0)*f01 + (x-x0)*(x-x1)*f012 ;
00338   <font class="keywordflow">return</font> fx;
00339 }
00340 
00341 <font class="keywordtype">int</font> findEdge(<font class="keyword">const</font> Basic2DArray&lt;double&gt;&amp; dx, <font class="keyword">const</font> Basic2DArray&lt;double&gt;&amp; dy, Basic2DArray&lt;double&gt; &amp;edge, Basic2DArray&lt;double&gt;&amp; gradN, <font class="keywordtype">double</font> thresh){
00342   <font class="keywordflow">if</font>(dx.rows() != dy.rows() || dx.cols() != dy.cols())
00343     <font class="keywordflow">return</font> 0;
00344   edge.resize(dx) ;
00345   gradN.resize(dx);
00346   <font class="comment">//Basic2DArray&lt;double&gt; gradN(dx.rows(),dx.cols());</font>
00347   <font class="keywordtype">int</font> i,j ;
00348 
00349   <font class="keywordflow">for</font>(i=0;i&lt;dx.rows();++i)
00350     <font class="keywordflow">for</font>(j=0;j&lt;dx.cols();++j){
00351       gradN(i,j) = sqrt(dx(i,j)*dx(i,j) + dy(i,j)*dy(i,j)) ;
00352     }
00353  
00354 
00355   <font class="keywordflow">for</font>(i=1;i&lt;dx.rows()-1;++i)
00356     <font class="keywordflow">for</font>(j=1;j&lt;dx.cols()-1;++j){
00357       <font class="keywordflow">if</font>(absolute(dx(i,j)) &gt; absolute(dy(i,j))){
00358         <font class="keywordtype">double</font> d = 1/dx(i,j) ;
00359         <font class="keywordtype">double</font> y = dy(i,j)/dx(i,j) ;
00360         <font class="keywordtype">double</font> b = quadInterp(i+y,i-1,gradN(i-1,j+1),i,gradN(i,j+1),i+1,gradN(i+1,j+1));
00361         <font class="keywordtype">double</font> c = quadInterp(i-y,i-1,gradN(i-1,j-1),i,gradN(i,j-1),i+1,gradN(i+1,j-1));
00362         <font class="keywordflow">if</font>(gradN(i,j) &gt;= b &amp;&amp; gradN(i,j) &gt;= c &amp;&amp; gradN(i,j) &gt; thresh)
00363           edge(i,j) = 200;
00364         <font class="keywordflow">else</font>
00365           edge(i,j) = 0 ; 
00366 
00367       }
00368       <font class="keywordflow">else</font>{
00369         <font class="keywordtype">double</font> d = 1/dy(i,j) ;
00370         <font class="keywordtype">double</font> x = dx(i,j)/dy(i,j) ;
00371         <font class="keywordtype">double</font> b = quadInterp(j-x,j-1,gradN(i-1,j-1),j,gradN(i-1,j),j+1,gradN(i-1,j+1));
00372         <font class="keywordtype">double</font> c = quadInterp(j+x,j-1,gradN(i+1,j-1),j,gradN(i+1,j),j+1,gradN(i+1,j+1));
00373         <font class="keywordflow">if</font>(gradN(i,j) &gt;= b &amp;&amp; gradN(i,j) &gt;= c &amp;&amp; gradN(i,j) &gt; thresh)
00374           edge(i,j) = 200;
00375         <font class="keywordflow">else</font>
00376           edge(i,j) = 0 ; 
00377       }
00378     }
00379   <font class="keywordflow">return</font> 1;
00380 }
00381 
00382 <font class="keywordtype">int</font> findSubEdge(<font class="keyword">const</font> Basic2DArray&lt;double&gt;&amp; dx, <font class="keyword">const</font> Basic2DArray&lt;double&gt;&amp; dy, Basic2DArray&lt;double&gt; &amp;edge, <font class="keywordtype">double</font> thresh, <font class="keyword">const</font> Basic2DArray&lt;double&gt;&amp; in){
00383   <font class="keywordflow">if</font>(dx.rows() != dy.rows() || dx.cols() != dy.cols())
00384     <font class="keywordflow">return</font> 0;
00385   <font class="keyword">const</font> <font class="keywordtype">int</font> zoom = 7 ;
00386   <font class="keyword">const</font> <font class="keywordtype">int</font> zoom2 = 4 ;
00387   edge.resize(dx.rows()*zoom,dx.cols()*zoom) ;
00388   Basic2DArray&lt;double&gt; gradN(dx.rows(),dx.cols());
00389   <font class="keywordtype">int</font> i,j ;
00390 
00391   <font class="keywordflow">for</font>(i=0;i&lt;dx.rows();++i)
00392     <font class="keywordflow">for</font>(j=0;j&lt;dx.cols();++j){
00393       gradN(i,j) = sqrt(dx(i,j)*dx(i,j) + dy(i,j)*dy(i,j)) ;
00394     }
00395  
00396 
00397   <font class="keywordflow">for</font>(i=1;i&lt;dx.rows()-1;++i)
00398     <font class="keywordflow">for</font>(j=1;j&lt;dx.cols()-1;++j)
00399       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> k=0;k&lt;zoom;++k)
00400         <font class="keywordflow">for</font>(<font class="keywordtype">int</font> l=0;l&lt;zoom;l++)
00401           edge(i*zoom+k-zoom2,j*zoom+l-zoom2) =  (in(i,j)&gt;250) ? 250 : in(i,j);
00402 
00403 
00404   <font class="keywordflow">for</font>(i=1;i&lt;dx.rows()-1;++i)
00405     <font class="keywordflow">for</font>(j=1;j&lt;dx.cols()-1;++j){
00406       <font class="keywordflow">if</font>(absolute(dx(i,j)) &gt; absolute(dy(i,j))){
00407         <font class="keywordtype">double</font> d = 1/dx(i,j) ;
00408         <font class="keywordtype">double</font> y = dy(i,j)/dx(i,j) ;
00409         <font class="keywordtype">double</font> c = quadInterp(i+y,i-1,gradN(i-1,j+1),i,gradN(i,j+1),i+1,gradN(i+1,j+1));
00410         <font class="keywordtype">double</font> a = quadInterp(i-y,i-1,gradN(i-1,j-1),i,gradN(i,j-1),i+1,gradN(i+1,j-1));
00411         <font class="keywordflow">if</font>(gradN(i,j) &gt;= a &amp;&amp; gradN(i,j) &gt;= c &amp;&amp; gradN(i,j) &gt; thresh){
00412           <font class="keywordtype">double</font> m = (a-c)/( 2*(a-2*gradN(i,j)+c)) ;
00413           <font class="keywordtype">double</font> di, dj ;
00414           <font class="keywordflow">if</font>(absolute(m)&gt;0.5) cerr &lt;&lt; <font class="stringliteral">" m = "</font> &lt;&lt; m &lt;&lt; <font class="stringliteral">" "</font> &lt;&lt; a &lt;&lt; <font class="stringliteral">" "</font> &lt;&lt; gradN(i,j) &lt;&lt; <font class="stringliteral">" "</font> &lt;&lt; c &lt;&lt; <font class="stringliteral">" at "</font> &lt;&lt; i &lt;&lt; j &lt;&lt; endl ; 
00415           dj = zoom*m*absolute(dx(i,j))/gradN(i,j) ;
00416           di = zoom*m*absolute(dy(i,j))/gradN(i,j) ;
00417           <font class="keywordflow">if</font>(m&lt;0 &amp;&amp; dx(i,j)*dy(i,j)&lt;0)
00418             di *= -1 ;
00419           <font class="keywordflow">if</font>(m&gt;0 &amp;&amp; dx(i,j)*dy(i,j)&lt;0)
00420             di *= -1 ;
00421           <font class="comment">/*</font>
00422 <font class="comment">          for(int k=0;k&lt;zoom;++k)</font>
00423 <font class="comment">            for(int l=0;l&lt;zoom;l++)</font>
00424 <font class="comment">              edge(i*zoom+k-zoom2,j*zoom+l-zoom2) = 255;</font>
00425 <font class="comment">          */</font>
00426           edge(i*zoom+di,j*zoom+dj) = 0 ; 
00427         }
00428       }
00429       <font class="keywordflow">else</font>{
00430         <font class="keywordtype">double</font> d = 1/dy(i,j) ;
00431         <font class="keywordtype">double</font> x = dx(i,j)/dy(i,j) ;
00432         <font class="keywordtype">double</font> a = quadInterp(j-x,j-1,gradN(i-1,j-1),j,gradN(i-1,j),j+1,gradN(i-1,j+1));
00433         <font class="keywordtype">double</font> c = quadInterp(j+x,j-1,gradN(i+1,j-1),j,gradN(i+1,j),j+1,gradN(i+1,j+1));
00434         <font class="keywordflow">if</font>(gradN(i,j) &gt;= a &amp;&amp; gradN(i,j) &gt;= c &amp;&amp; gradN(i,j) &gt; thresh){
00435           <font class="keywordtype">double</font> m = (a-c)/( 2*(a-2*gradN(i,j)+c)) ;
00436           <font class="keywordtype">double</font> di, dj ;
00437           <font class="keywordflow">if</font>(absolute(m)&gt;0.5) cerr &lt;&lt; <font class="stringliteral">" m = "</font> &lt;&lt; m &lt;&lt; <font class="stringliteral">" "</font> &lt;&lt; a &lt;&lt; <font class="stringliteral">" "</font> &lt;&lt; gradN(i,j) &lt;&lt; <font class="stringliteral">" "</font> &lt;&lt; c &lt;&lt; <font class="stringliteral">" at "</font> &lt;&lt; i &lt;&lt; j &lt;&lt; endl ; 
00438           dj = zoom*m*absolute(dx(i,j))/gradN(i,j);
00439           <font class="keywordflow">if</font>(m&lt;0 &amp;&amp; dx(i,j)*dy(i,j)&lt;0)
00440             dj *= -1 ; 
00441           <font class="keywordflow">if</font>(m&gt;0 &amp;&amp; dx(i,j)*dy(i,j)&lt;0)
00442             dj *= -1 ; 
00443           di = zoom*m*absolute(dy(i,j))/gradN(i,j) ; 
00444           <font class="comment">/*</font>
00445 <font class="comment">          for(int k=0;k&lt;zoom;++k)</font>
00446 <font class="comment">            for(int l=0;l&lt;zoom;l++)</font>
00447 <font class="comment">              edge(i*zoom+k-zoom2,j*zoom+l-zoom2) = 255 ;</font>
00448 <font class="comment">          */</font>
00449           edge(i*zoom+di,j*zoom+dj) = 0 ; 
00450         }
00451       }
00452     }
00453   <font class="keywordflow">return</font> 1;
00454 }
00455 
00456 
00457 <font class="comment">/*</font>
00458 <font class="comment">int main(){</font>
00459 <font class="comment">  IM_Image img;</font>
00460 <font class="comment">  if(!img.read("test.png")){</font>
00461 <font class="comment">    cerr &lt;&lt; "Can't open file test.png\n" ;</font>
00462 <font class="comment">  }</font>
00463 <font class="comment">  Matrix&lt;double&gt; in,dx,dy,e,e2,g ;</font>
00464 <font class="comment">  ubyteToDouble(img,in);</font>
00465 <font class="comment">  Params params ;</font>
00466 <font class="comment"></font>
00467 <font class="comment">  const double alpha = 1.0 ;</font>
00468 <font class="comment"></font>
00469 <font class="comment">  xderiv2ndOrder(params,alpha);</font>
00470 <font class="comment">  generalRFx(params,in,dx);</font>
00471 <font class="comment"></font>
00472 <font class="comment">  yderiv2ndOrder(params,alpha);</font>
00473 <font class="comment">  generalRFy(params,in,dy);</font>
00474 <font class="comment">  cout &lt;&lt; "Testing the quad interpolation\n" ;</font>
00475 <font class="comment">  </font>
00476 <font class="comment">  cout &lt;&lt; quadInterp(2.5,0,10,5,5,10,0) &lt;&lt; endl ; </font>
00477 <font class="comment">  cout &lt;&lt; quadInterp(-0.5,-1,4,0,5,1,1) &lt;&lt; endl ; </font>
00478 <font class="comment">  cout &lt;&lt; quadInterp(-0.4,-1,4,0,5,1,1) &lt;&lt; endl ; </font>
00479 <font class="comment">  cout &lt;&lt; quadInterp(-0.3,-1,4,0,5,1,1) &lt;&lt; endl ; </font>
00480 <font class="comment">  cout &lt;&lt; quadInterp(-0.2,-1,4,0,5,1,1) &lt;&lt; endl ; </font>
00481 <font class="comment">  cout &lt;&lt; quadInterp(9.2,8.0,2.0794,9.0,2.1972,9.5,2.2513) &lt;&lt; endl ; </font>
00482 <font class="comment"></font>
00483 <font class="comment">  findEdge(dx,dy,e,g,20);</font>
00484 <font class="comment">  findSubEdge(dx,dy,e2,20,in) ;</font>
00485 <font class="comment"></font>
00486 <font class="comment">  dx += 128 ;</font>
00487 <font class="comment">  doubleToUbyte(dx,img);</font>
00488 <font class="comment">  img.write("outputA.png");</font>
00489 <font class="comment">  </font>
00490 <font class="comment">  dy += 128 ;</font>
00491 <font class="comment">  doubleToUbyte(dy,img);</font>
00492 <font class="comment">  img.write("outputB.png");</font>
00493 <font class="comment"></font>
00494 <font class="comment">  doubleToUbyte(e,img);</font>
00495 <font class="comment">  img.write("edge.png");</font>
00496 <font class="comment"></font>
00497 <font class="comment">  doubleToUbyte(e2,img);</font>
00498 <font class="comment">  img.write("edge2.png");</font>
00499 <font class="comment"></font>
00500 <font class="comment">  doubleToUbyte(g,img);</font>
00501 <font class="comment">  img.write("grad.png");</font>
00502 <font class="comment"></font>
00503 <font class="comment">  </font>
00504 <font class="comment"></font>
00505 <font class="comment">}</font>
00506 <font class="comment">*/</font>
00507 
00508  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt; 
00509  RecursiveFilter&lt;T&gt;::RecursiveFilter(<font class="keyword">const</font> Basic2DArray&lt;T&gt;&amp; in, Basic2DArray&lt;T&gt;&amp; out): input(in), output(out) {
00510    input_ = <font class="keyword">new</font> Basic2DArray&lt;double&gt;(in.rows(),in.cols()) ;
00511    output_ = <font class="keyword">new</font> Basic2DArray&lt;double&gt;(out.rows(),out.cols()) ;
00512    output.resize(out.rows(),out.cols());
00513    toDouble(input,*input_);
00514  }
00515  
00516  <font class="keyword">template</font> &lt;&gt;
00517    RecursiveFilter&lt;double&gt;::RecursiveFilter(<font class="keyword">const</font> Basic2DArray&lt;double&gt;&amp; in, Basic2DArray&lt;double&gt;&amp; out): input(in), output(out) {
00518    input_ = const_cast&lt;Basic2DArray&lt;double&gt;*&gt;(&amp;in) ;
00519    <font class="comment">//input_ = &amp;in ;</font>
00520    output_ = &amp;out ;
00521    output.resize(out.rows(),out.cols());
00522  }
00523  
00524  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00525    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_xderiv2ndOrderSmooth(<font class="keywordtype">double</font> alpha){
00526    xderiv2ndOrderSmooth(params,alpha) ;
00527    generalRFx(params,*input_,*output_);
00528    cerr &lt;&lt; <font class="stringliteral">"size = "</font> &lt;&lt; output_-&gt;rows() &lt;&lt; <font class="stringliteral">","</font> &lt;&lt; output_-&gt;cols() &lt;&lt; endl ; 
00529    fromDouble(*output_,output) ;
00530  }
00531  
00532  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00533    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_yderiv2ndOrderSmooth(<font class="keywordtype">double</font> alpha){
00534    yderiv2ndOrderSmooth(params,alpha);
00535    generalRFy(params,*input_,*output_);
00536    fromDouble(*output_,output) ;
00537  }
00538  
00539  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00540    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_xderiv2ndOrder(<font class="keywordtype">double</font> alpha){
00541    xderiv2ndOrder(params,alpha) ;
00542    generalRFx(params,*input_,*output_);
00543    fromDouble(*output_,output) ;
00544  }                                  
00545  
00546  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00547    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_yderiv2ndOrder(<font class="keywordtype">double</font> alpha){
00548    yderiv2ndOrder(params,alpha);
00549    generalRFy(params,*input_,*output_);
00550    fromDouble(*output_,output) ;
00551  }
00552  
00553  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00554    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_smooth1stOrder(<font class="keywordtype">double</font> alpha, <font class="keywordtype">double</font> k0){
00555    smooth1stOrder(params,alpha,k0) ;
00556    generalRF(params,*input_,*output_);
00557    fromDouble(*output_,output);
00558  }
00559  
00560  
00561  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00562    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_smooth1stOrder_x(<font class="keywordtype">double</font> alpha, <font class="keywordtype">double</font> k0){
00563    smooth1stOrder(params,alpha,k0) ;
00564    generalRFx(params,*input_,*output_);
00565    fromDouble(*output_,output) ;
00566  }
00567  
00568  
00569  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00570    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_smooth1stOrder_y(<font class="keywordtype">double</font> alpha, <font class="keywordtype">double</font> k0){
00571    smooth1stOrder(params,alpha,k0) ;
00572    generalRFy(params,*input_,*output_);
00573    fromDouble(*output_,output) ;
00574  }
00575  
00576  
00577  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00578    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_smooth2ndOrder(<font class="keywordtype">double</font> alpha){
00579    smooth2ndOrder(params,alpha) ;
00580    generalRF(params,*input_,*output_);
00581    fromDouble(*output_,output) ;
00582  }
00583  
00584  
00585  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00586    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_smooth2ndOrder_x(<font class="keywordtype">double</font> alpha){
00587    smooth2ndOrder(params,alpha) ;
00588    generalRFx(params,*input_,*output_);
00589    fromDouble(*output_,output) ;
00590  }
00591  
00592  
00593  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00594    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_smooth2ndOrder_y(<font class="keywordtype">double</font> alpha){
00595    smooth2ndOrder(params,alpha) ;
00596    generalRFy(params,*input_,*output_);
00597    fromDouble(*output_,output) ;
00598  }
00599  
00600  
00601  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00602    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_LL1stOrder(<font class="keywordtype">double</font> alpha){
00603    LL1stOrder(params,alpha);
00604    generalRF(params,*input_,*output_);
00605    fromDouble(*output_,output) ;
00606  }
00607  
00608  
00609  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00610    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_LL1stOrder_x(<font class="keywordtype">double</font> alpha){
00611    LL1stOrder(params,alpha);
00612    generalRFx(params,*input_,*output_);
00613    fromDouble(*output_,output) ;
00614  }
00615  
00616  
00617  <font class="keyword">template</font> &lt;<font class="keyword">class</font> T&gt;
00618    <font class="keywordtype">void</font> RecursiveFilter&lt;T&gt;::compute_LL1stOrder_y(<font class="keywordtype">double</font> alpha){
00619    LL1stOrder(params,alpha);
00620    generalRFy(params,*input_,*output_);
00621    fromDouble(*output_,output) ;
00622  }
00623  
00624 }
00625 
00626 
00627 
00628 <font class="preprocessor">#endif</font>
</pre></div><hr><address><small>Generated on Tue Jun 24 13:26:58 2003 for NURBS++ by
<a href="javascript:if(confirm('http://www.doxygen.org/index.html  \n\nThis file was not retrieved by Teleport Pro, because it is addressed on a domain or path outside the boundaries set for its Starting Address.  \n\nDo you want to open it from the server?'))window.location='http://www.doxygen.org/index.html'" tppabs="http://www.doxygen.org/index.html">
<img src="doxygen.gif" tppabs="http://libnurbs.sourceforge.net/docs/doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.14 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2002</small></address>
</body>
</html>
